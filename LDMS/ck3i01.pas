//==============================================================================
// 프로그램 설명 : 검진접수관리
// 시스템        : 통합검진
// 수정일자      : 2005.05.07
// 수정자        : 최지혜
// 수정내용      : 우편발송, 내원상담 추가
// 참고사항      :
//==============================================================================
// 수정일자      : 2005.11.24
// 수정자        : 김승철
// 수정내용      : 직역구분에 3-의료급여 추가
//==============================================================================
// 수정일자      : 2006.01.03
// 수정자        : 유동구
// 수정내용      : 단체금액 세분화, E-MAIL 추가
//==============================================================================
// 수정일자      : 2006.03.21
// 수정자        : 구수정
// 수정내용      : 라벨지출력 추가
//==============================================================================
// 수정일자      : 2006.03.28
// 수정자        : 김승철
// 수정내용      : 공단부담금80% 로 변경
//==============================================================================
// 수정일자      : 2006.04.08
// 수정자        : 김승철
// 수정내용      : 7-본사[여의도(VIP_종검)] 추가(18층 VIP에서 종검 접수용)
//==============================================================================
// 수정일자      : 2006.06.29
// 수정자        : 유동구
// 수정내용      : VIP쿠폰사용 추가..
//==============================================================================
// 수정일자      : 2007.01.22
// 수정자        : 유동구
// 수정내용      : DI01(대사증후군동의함)추가..
//==============================================================================
// 수정일자      : 2007.03.27
// 수정자        : 유동구
// 수정내용      : PACS INSERT 추가..
//==============================================================================
// 수정일자      : 2007.04.02
// 수정자        : 구수정
// 수정내용      : 무료검진항목추가, 급여공제.복지카드결재추가..
//==============================================================================
// 수정일자      : 2007.05.25
// 수정자        : 김승철
// 수정내용      : PACS의 SEEK_TIME ':' 표시 제거.
//==============================================================================
// 수정일자      : 2007.05.31
// 수정자        : 구수정
// 수정내용      : 2007년도 접수차트추가
//==============================================================================
// 수정일자      : 2008.04.19
// 수정자        : 김승철
// 수정내용      : 부산PACS 접수 추가.
//==============================================================================
// 수정일자      : 2008.05.13
// 수정자        : 유동구
// 수정내용      : 혈액샘플번호 자동 전센터 추가.
//==============================================================================
// 수정일자      : 2008.07.08
// 수정자        : 김승철
// 수정내용      : 부산센터 층구분 추가.
//==============================================================================
// 수정일자      : 2008.07.09
// 수정자        : 유동구
// 수정내용      : 혈액샘플번호 MAX값 찾기 수정..
//==============================================================================
// 수정일자      : 2008.07.15
// 수정자        : 유동구
// 수정내용      : 대사동의 재검 코드 자동 입력되게 수정..
//==============================================================================
// 수정일자      : 2008.10.02
// 수정자        : 구수정
// 수정내용      : 단체코드, 영업담당자 변경시 청구, 입금에도 변경되도록 수정..
//==============================================================================
// 수정일자      : 2008.12.01
// 수정자        : 유동구
// 수정내용      : 임신 가능성 추가..
//==============================================================================
// 수정일자      : 2008.12.22
// 수정자        : 송재호
// 수정내용      : 분석부 계산법 추가..
//==============================================================================
// 수정일자      : 2009.01.23
// 수정자        : 송재호
// 수정내용      : 내원구분4(외래)도 자동샘플넘버에 추가
//==============================================================================
// 수정일자      : 2009.05.06
// 수정자        : 유동구
// 수정내용      : PACS 전송 시 검진진행에도 전송 추가..
//==============================================================================
// 수정일자      : 2009.05.13
// 수정자        : 송재호
// 수정내용      : 프로파일 코드 항목 표시..
//==============================================================================
// 수정일자      : 2009.05.20
// 수정자        : 송재호
// 수정내용      : 장비 생성되면 삭제 제어.
//==============================================================================
// 수정일자      : 2009.06.01
// 수정자        : 송재호
// 수정내용      : 선등록 E-mail 주소 추가
//==============================================================================
// 수정일자      : 2009.07.08
// 수정자        : 김승철
// 수정내용      : 단체금액은 없고 개인금액만 있는경우 노신금액 적용.
//==============================================================================
// 수정일자      : 2010.06.17
// 수정자        : 유동구
// 수정내용      : 바코드프린터 용지 ALL 튼걸로 바꿈...
//==============================================================================
// 수정일자      : 2010.07.07
// 수정자        : 송재호
// 수정내용      : PACS전송시 CPMS전송되는 부분 저장시 CPMS전송으로 변경.
//==============================================================================
// 수정일자      : 2010.07.27
// 수정자        : 유동구
// 수정내용      : 보건증 접수 누구나 가능하게 수정..(접수가 되어야 보건증 출력가능함)
//==============================================================================
// 수정일자      : 2010.11.22
// 수정자        : 김희석
// 수정내용      : 여의도 14층 외래 추가 (16)
//==============================================================================
// 수정일자      : 2010.11.30
// 수정자        : 유동구
// 수정내용      : 재방문 문구 추가, 회원번호 추가
//==============================================================================
// 수정일자      : 2010.12.01
// 수정자        : 김승철
// 수정내용      : 재방문관련 신규인경우 오류내용 수정.
//==============================================================================
// 수정일자      : 2011.02.22
// 수정자        : 송재호
// 수정내용      : 지난날짜에 추가코드에 장비코드 뿐만 아니라 SS00(채용(종검))코드도 넣을 수 있도록 수정.
//==============================================================================
// 수정일자      : 2011.03.9
// 수정자        : 김희석
// 수정내용      : 입사일 선등록에서 끌어오도록 수정 
//==============================================================================
// 수정일자      : 2011.04.07
// 수정자        : 김희석
// 수정내용      : JJOL JJOC 코드 팍스로 넘길수 있도록 수정
//==============================================================================
// 수정일자      : 2011.04.15
// 수정자        : 김희석
// 수정내용      : H00001, 120001, 115999,431331,611098,712421,511111  재방문  할인 적용
//==============================================================================
// 수정일자      : 2011.04.25
// 수정자        : 김희석
// 수정내용      : 수원 층구분 (2충, 3층 )
//==============================================================================
// 수정일자      : 2011.04.26
// 수정자        : 송재호
// 수정내용      : 주민번호 자릿수 체크 강남만 제외(진료챠트 바코드 활용_ 강남경)
//==============================================================================
// 수정일자      : 2011.05.04
// 수정자        : 송재호
// 수정내용      : 당일접수 삭제시 CPMS부분도 삭제.
//==============================================================================
// 수정일자      : 2011.08.01
// 수정자        : 유동구
// 수정내용      : DI03 자동 등록시 CV코드틑 제외함('요기'멘트넣음..)
//==============================================================================
// 수정일자      : 2011.08.01
// 수정자        : 김승철
// 수정내용      : 내원상담,우편발송,이메일발송,홈페이지조회 체크빼면 Sangdam_Rev 삭제되도록.('요기'멘트넣음)
//==============================================================================
// 수정일자      : 2011.08.22
// 수정자        : 유동구
// 수정내용      : 차트관리(PDF추가)..('요기'멘트넣음)
//==============================================================================
// 수정일자      : 2011.09.07
// 수정자        : 김희석
// 수정내용      : 부서,주소 , 사번 ,단체 코드 인적에서
//                 검진사업부 권지현과장님 요청 병원부합의
//==============================================================================
// 수정일자      : 2011.11.03
// 수정자        : 구수정
// 수정내용      : 무료검진수정
//==============================================================================
// 수정일자      : 2011.11.10
// 수정자        : 구수정
// 수정내용      : 장비,채용검사 추가경고창 UP_Change추가
//==============================================================================
// 수정일자      : 2011.11.17
// 수정자        : 김희석
// 수정내용      : 추가 검사 수정
//==============================================================================
// 수정일자      : 2012.01.09
// 수정자        : 김희석
// 수정내용      : 회사전달 체크 추가
//==============================================================================
// 수정일자      : 2012.03.15
// 수정자        : 김희석
// 수정내용      : 개인정보 활용동의체크 추가 
//=============================================================================
// 수정일자      : 2012.07.17
// 수정자        : 유동구
// 수정내용      : 신주소 / 재검대상자 확인 팝업 추가.
//=============================================================================
// 수정일자      : 2012.07.30
// 수정자        : 김희석
// 수정내용      : 장비삭제(소견 무일경우만)
//=============================================================================
// 수정일자      : 2012.08.31
// 수정자        : 김희석
// 수정내용      : 회사제출 정보 동의 체크 추가 
//=============================================================================
// 수정일자      : 2012.09.19
// 수정자        : 김희석
// 수정내용      : 추가코드 4 자리 아니면 팝업, 이전 전화번호와 다를경우 안내창 추가 
//============================================================================
// 수정일자      : 2012.10.27
// 수정자        : 김희석
// 수정내용      : 종검, 1차접수 중복방지팝업
//============================================================================
// 수정일자      : 2012.11.16
// 수정자        : 김승철
// 수정내용      : 본원 신신인경우 PACS전송시 IPDOPD 값 'S' 전송
//============================================================================
// 수정일자      : 2013.3.26
// 수정자        : 김희석
// 수정내용      : 강남 DR 코드로 제외 JJ51,JJ52,JJ53,JJCA,JJCB,JJLK,JJRK
//===========================================================================
// 수정일자      : 2013.4.01
// 수정자        : 김희석
// 수정내용      : JJ2U PACS 추가
//===========================================================================
// 수정일자      : 2013.4.10
// 수정자        : 김승철
// 수정내용      : 저장시 UV_injStatus 값 체크하도록.->선등록조회시 선등록 주민번호의 num_id 끌고오는것 때문에 저장시 다시 체크함.
//===========================================================================
// 수정일자      : 2013.4.12
// 수정자        : 김승철
// 수정내용      : 기초저장시 나안,교정중 한쪽이 0으로 들어가는부분 변경안되게끔.
//===========================================================================
// 수정일자      : 2013.6.22
// 수정자        : 김희석
// 수정내용      : 수원, 부산 층구분 추가
//===========================================================================
// 수정일자      : 2013.8.07
// 수정자        : 김승철
// 수정내용      : 접수년도에 특정암-분변잠혈 양성으로 재검대상자인경우
//===========================================================================
// 수정일자      : 2013.09.23
// 수정자        : 김승철
// 참고사항      : 부산센터 회원번호 출력기능 추가
//==============================================================================
// 수정일자      : 2013.9.30
// 수정자        : 김희석
// 참고사항      : 메일 주소 선택 추가 ,sod,citrate 체크 추가 
//==============================================================================
// 수정일자      : 2013.12.09
// 수정자        : 김승철
// 참고사항      : 추가항목 취소구분 추가
//==============================================================================
// 수정일자      : 2014.08.05
// 수정자        : 백승현
// 참고사항      : 접수시 검진년도 Validation 체크 현재년도보다 10년 이상일시 메세지창 발생
//==============================================================================
// 수정일자      : 2014.09.19
// 수정자        : 백승현
// 참고사항      : 결과활용동의란 추가
//==============================================================================
// 수정일자      : 2015.05.26
// 수정자        : 김창규
// 수정내용      : DI04 자동 등록시 TSH, Free T4, TSH 추가
//==============================================================================
// 수정일자      : 2015.07.10
// 수정자        : 김창규
// 수정내용      : PACS 장비코드 추가 (소견 연동 작업)
//==============================================================================
// 수정일자      : 2015.10.12
// 수정자        : 김창규
// 수정내용      : 이지스여성의원 PACS 장비코드 추가 (JK17 MRI)  구분 ipdopd = 'E' 사용
//==============================================================================
// 수정일자      : 2016.02.29
// 수정자        : 박대용
// 수정내용      : 자궁암 관련 본원, 이지스 분류, 간암 상반기와 하반기로 분류됨에 따라 변경.
//==============================================================================
// 수정일자      : 2016.03.29
// 수정자        : 김창규
// 수정내용      : 사용하지 않는코드가 있으면 다른 코드로 추가 할것(김창규) E069 -> C078로
//==============================================================================
// 수정일자      : 2017.03.06
// 수정자        : 유동구
// 수정내용      : 특수검진 접수 신규 개발 적용...
//==============================================================================

unit CK3I01;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  ORSingle, Menus, Buttons, ComCtrls, ToolWin, Db, DBTables, Grids, DBGrids,
  Grids_ts, TSGrid, ExtCtrls, StdCtrls, Mask, Printers, DateEdit, ValEdit, ActnList,
  ZAbstractRODataset, ZAbstractDataset, ZDataset, ZConnection, ShellAPI,
  DBClient, MConnect, MidasCon;

type
  TfrmCK3I01 = class(TfrmSingle)
    qryGumgin: TQuery;
    qryI_Gumgin: TQuery;
    qryU_Gumgin: TQuery;
    qryD_gumgin: TQuery;
    pnlDetail: TPanel;
    btnPInsert: TBitBtn;
    btnPSave: TBitBtn;
    btnPCancel: TBitBtn;
    qrySeq: TQuery;
    valSUGA_JANGBI: TValEdit;
    valSUGA_HUL: TValEdit;
    Panel4: TPanel;
    edtCOD_HUL: TEdit;
    btnCOD_HUL: TSpeedButton;
    edtDESC_HUL: TEdit;
    valSUGA_CANCER: TValEdit;
    edtDESC_CANCER: TEdit;
    btnCOD_CANCER: TSpeedButton;
    edtCOD_CANCER: TEdit;
    Panel7: TPanel;
    btnHm_insert: TSpeedButton;
    edtCOD_CHUGA: TEdit;
    grdCOD_CHUGA: TtsGrid;
    btnCOD_CHUGA: TSpeedButton;
    edtDESC_CHUGA: TEdit;
    valCOD_CHUGA: TValEdit;
    btnHm_delete: TSpeedButton;
    Panel24: TPanel;
    valSUM: TValEdit;
    Label6: TLabel;
    Panel3: TPanel;
    valSUGA_TOT: TValEdit;
    Panel8: TPanel;
    valSUGA_JOHAP: TValEdit;
    valYUL_MCIJ: TValEdit;
    Panel12: TPanel;
    Panel13: TPanel;
    cmbGUBN_NSCG: TComboBox;
    Panel18: TPanel;
    cmbGUBN_TKCG: TComboBox;
    Panel19: TPanel;
    Panel20: TPanel;
    cmbGUBN_BGCG: TComboBox;
    Panel21: TPanel;
    cmbGUBN_ADCG: TComboBox;
    Panel22: TPanel;
    cmbGUBN_AGCG: TComboBox;
    Panel23: TPanel;
    cmbGUBN_GOCG: TComboBox;
    Panel5: TPanel;
    mskDAT_GMGN: TDateEdit;
    btnDAT_GMGN: TSpeedButton;
    Panel2: TPanel;
    edtCOD_JANGBI: TEdit;
    btnCOD_JANGBI: TSpeedButton;
    edtDESC_JANGBI: TEdit;
    edtCOD_DC: TEdit;
    btnCOD_DC: TSpeedButton;
    edtDESC_DC: TEdit;
    Panel6: TPanel;
    Panel9: TPanel;
    Panel10: TPanel;
    mskNUM_JUMIN: TMaskEdit;
    Panel14: TPanel;
    edtDESC_NAME: TEdit;
    Panel15: TPanel;
    edtDESC_DEPT: TEdit;
    btnDESC_DEPT: TSpeedButton;
    Panel16: TPanel;
    mskNUM_POST: TMaskEdit;
    edtDESC_ADDR: TEdit;
    Panel17: TPanel;
    Panel25: TPanel;
    edtNUM_TEL: TEdit;
    Panel26: TPanel;
    cmbCOD_JISA: TComboBox;
    Panel27: TPanel;
    cmbCOD_SALER: TComboBox;
    Panel28: TPanel;
    edtNUM_SABUN: TEdit;
    valSUGA_GIBD: TValEdit;
    Bevel2: TBevel;
    Panel31: TPanel;
    Panel32: TPanel;
    Panel33: TPanel;
    Panel34: TPanel;
    Panel35: TPanel;
    cmbGUBN_NOSIN: TComboBox;
    cmbGUBN_TKGM: TComboBox;
    cmbGUBN_BOGUN: TComboBox;
    cmbGUBN_ADULT: TComboBox;
    cmbGUBN_AGAB: TComboBox;
    cmbGUBN_GONG: TComboBox;
    btnSize: TSpeedButton;
    Panel36: TPanel;
    Label3: TLabel;
    Label2: TLabel;
    btnJumin: TSpeedButton;
    cmbGmgn: TComboBox;
    mskJumin: TMaskEdit;
    edtName: TEdit;
    Bevel5: TBevel;
    Panel38: TPanel;
    gubn_jik: TEdit;
    Panel39: TPanel;
    cmbGUBN_JIK: TComboBox;
    Panel40: TPanel;
    mskDAT_IPSA: TDateEdit;
    Bevel6: TBevel;
    Bevel3: TBevel;
    Bevel4: TBevel;
    Panel30: TPanel;
    Panel11: TPanel;
    Panel29: TPanel;
    Panel41: TPanel;
    Panel42: TPanel;
    Panel43: TPanel;
    Panel44: TPanel;
    Panel45: TPanel;
    edtNUM_SAMP: TEdit;
    cmbGUBN_NEAWON: TComboBox;
    Bevel7: TBevel;
    Panel47: TPanel;
    Bevel8: TBevel;
    Panel48: TPanel;
    Panel49: TPanel;
    Panel50: TPanel;
    ckYSNO_DRINKY: TCheckBox;
    ckYSNO_SMOKEY: TCheckBox;
    ckDESC_KGBL1: TCheckBox;
    Panel51: TPanel;
    ckYSNO_YSHUY: TCheckBox;
    ckDESC_KGBL2: TCheckBox;
    ckDESC_KGBL3: TCheckBox;
    ckDESC_KGBL4: TCheckBox;
    ckDESC_KGBL5: TCheckBox;
    ckDESC_KGBL6: TCheckBox;
    edtDESC_KGBL: TEdit;
    Panel53: TPanel;
    Panel54: TPanel;
    Panel56: TPanel;
    Panel57: TPanel;
    Panel58: TPanel;
    Panel60: TPanel;
    Panel61: TPanel;
    ckEYE1: TCheckBox;
    ckEYE2: TCheckBox;
    Panel62: TPanel;
    Panel63: TPanel;
    Panel64: TPanel;
    ckYSNO_FOLK: TCheckBox;
    valSINJANG: TValEdit;
    valCHEJUNG: TValEdit;
    valBIMAN: TValEdit;
    valHUL_H: TValEdit;
    valHUL_L: TValEdit;
    valEAR_LEFT10: TValEdit;
    valEAR_RIGHT10: TValEdit;
    valEYE_LMAN: TValEdit;
    valEYE_RMAN: TValEdit;
    qryMunjin: TQuery;
    qryI_Munjin: TQuery;
    qryU_Munjin: TQuery;
    qryD_Munjin: TQuery;
    qryKicho: TQuery;
    qryI_Kicho: TQuery;
    qryU_Kicho: TQuery;
    qryD_Kicho: TQuery;
    qryGmgn: TQuery;
    Panel37: TPanel;
    valSUGA_DANCHE: TValEdit;
    qryInjouk: TQuery;
    qryI_Injouk: TQuery;
    qryU_Injouk: TQuery;
    qryReser: TQuery;
    qryPumyi: TQuery;
    qryMagam: TQuery;
    ckYSNO_DRINKN: TCheckBox;
    ckYSNO_SMOKEN: TCheckBox;
    ckYSNO_YSHUN: TCheckBox;
    Panel65: TPanel;
    edtNUM_BALKUB: TEdit;
    Panel66: TPanel;
    Panel67: TPanel;
    Panel68: TPanel;
    Panel69: TPanel;
    Panel70: TPanel;
    Panel71: TPanel;
    edtGUBN_NSYH: TEdit;
    edtGUBN_TKYH: TEdit;
    edtGUBN_BGYH: TEdit;
    edtGUBN_ADYH: TEdit;
    edtGUBN_AGYH: TEdit;
    edtGUBN_GOYH: TEdit;
    gubn_saup: TEdit;
    qryNo_hangmok: TQuery;
    qryJaegumhm: TQuery;
    qryDanche: TQuery;
    Panel72: TPanel;
    Panel73: TPanel;
    HUL_Check: TCheckBox;
    qryU_HCondition: TQuery;
    qryI_HCondition: TQuery;
    qryHul_Condition: TQuery;
    qryD_HCondition: TQuery;
    qryS_gumgin: TQuery;
    qryD_injouk: TQuery;
    qryD_Chunggu: TQuery;
    qryD_Mechul: TQuery;
    qryD_Ipkum: TQuery;
    Panel74: TPanel;
    cmbBohm: TComboBox;
    Com_BD: TComboBox;
    Panel75: TPanel;
    qrySawon: TQuery;
    Panel46: TPanel;
    vip: TCheckBox;
    SBtn_PreRegister: TSpeedButton;
    Gubn_Label: TLabel;
    CkBox_Jumin: TCheckBox;
    ActionList1: TActionList;
    Action1: TAction;
    qryD_Tkgum: TQuery;
    Btn_Complain: TBitBtn;
    qryComplain: TQuery;
    Timer1: TTimer;
    Action2: TAction;
    qryI_nsad: TQuery;
    Panel76: TPanel;
    mskNeawon: TDateEdit;
    qrySangdam_Rev: TQuery;
    qrySDupdate: TQuery;
    qrySDinsert: TQuery;
    mskPost: TDateEdit;
    Panel80: TPanel;
    qryCa_gubun: TQuery;
    qryCa_update: TQuery;
    qryI_Send_Gumgin: TQuery;
    qryD_Send_Gumgin: TQuery;
    qrySDdelete: TQuery;
    qryJohap: TQuery;
    rdgGubn_Hulgum: TRadioGroup;
    qryYijungChk: TQuery;
    qryNhic: TQuery;
    GB_danchesuga: TGroupBox;
    Panel81: TPanel;
    VEdt_Jgum: TValEdit;
    Panel82: TPanel;
    VEdt_Tgum: TValEdit;
    Label4: TLabel;
    Panel83: TPanel;
    CK_susin: TCheckBox;
    Edt_email: TEdit;
    Panel84: TPanel;
    Label_yh: TLabel;
    qryChunggu: TQuery;
    qryU_Chunggu: TQuery;
    qryI_Chunggu: TQuery;
    Comb_printer: TComboBox;
    Label5: TLabel;
    MEdt_No: TMaskEdit;
    qryI_Coupon_use: TQuery;
    qryU_coupon_use: TQuery;
    Panel85: TPanel;
    Edt_SuimSawon: TEdit;
    qryPumyiJisa: TQuery;
    chk_pacs: TCheckBox;
    ZConnection: TZConnection;
    qryI_Pacs: TZQuery;
    qryPf_hm: TQuery;
    Action3: TAction;
    qryFree: TQuery;
    qryI_Free: TQuery;
    qryU_Free: TQuery;
    Check_free1: TCheckBox;
    Check_free2: TCheckBox;
    Check_free3: TCheckBox;
    Panel88: TPanel;
    valSUGA_GONGJE: TValEdit;
    Panel87: TPanel;
    Panel89: TPanel;
    Panel90: TPanel;
    Panel91: TPanel;
    cmbGUBN_LIFE: TComboBox;
    edtGUBN_LFYH: TEdit;
    cmbGUBN_LFCG: TComboBox;
    Bevel9: TBevel;
    CBox_samp: TCheckBox;
    qrySAMPLE: TQuery;
    qryD_coupon_use: TQuery;
    qryCoupon_use: TQuery;
    Panel_yeonse: TPanel;
    Label9: TLabel;
    Label10: TLabel;
    qryTkgum: TQuery;
    qrySAMPLE_NO: TQuery;
    Label11: TLabel;
    Label12: TLabel;
    PACS: TDatabase;
    qryI_BUSAN_Order: TQuery;
    qryI_BUSAN_ADT: TQuery;
    qryS_Busan_Order: TQuery;
    qryTemp: TQuery;
    qryIpkum: TQuery;
    qry_UChunggu: TQuery;
    qryI_Ipkum: TQuery;
    ckGUBN_PREG2: TCheckBox;
    ckGUBN_PREG: TCheckBox;
    Bevel10: TBevel;
    Panel92: TPanel;
    qryI_SAMPLE_NO: TQuery;
    VEdt_Tgum2: TValEdit;
    Label13: TLabel;
    Label14: TLabel;
    Label15: TLabel;
    qryI_Information: TQuery;
    qry_Information: TQuery;
    qryU_Information: TQuery;
    qryI_JangbiCheck: TQuery;
    qry_JangbiCheck: TQuery;
    btnJ_PROFILE: TSpeedButton;
    grdMaster: TtsGrid;
    btnH_PROFILE: TSpeedButton;
    btnC_PROFILE: TSpeedButton;
    qry_JangbiWork: TQuery;
    rdHmpg: TCheckBox;
    rdEmail: TCheckBox;
    rdNeawon: TCheckBox;
    rdPost: TCheckBox;
    btnSugum: TBitBtn;
    BitBtn1: TBitBtn;
    Panel86: TPanel;
    Comb_CNTY: TComboBox;
    qryU_JangbiCheck: TQuery;
    chk_CPMS: TCheckBox;
    Label1: TLabel;
    Label16: TLabel;
    Panel93: TPanel;
    Label17: TLabel;
    Label18: TLabel;
    Panel55: TPanel;
    Label19: TLabel;
    Label20: TLabel;
    Bevel11: TBevel;
    Panel52: TPanel;
    Panel59: TPanel;
    Shape1: TShape;
    Shape2: TShape;
    Cmb_Print: TComboBox;
    Panel94: TPanel;
    Pnl_ID: TPanel;
    qryD_Information: TQuery;
    qryD_standby: TQuery;
    qryD_jangbicheck: TQuery;
    qryD_Free: TQuery;
    rdCompany: TCheckBox;
    qry_pumyi_suga: TQuery;
    Chk_ysno_useinfo: TCheckBox;
    Chk_ysno_Homepage: TCheckBox;
    qryWJReser: TQuery;
    qryU_WJReser: TQuery;
    Btn_Post: TBitBtn;
    qrySokun: TQuery;
    qryComm06: TQuery;
    Ck_UA: TCheckBox;
    Ck_UBA: TCheckBox;
    Ck_DJA: TCheckBox;
    Ck_GA: TCheckBox;
    Ck_JGA: TCheckBox;
    Ck_1cha: TCheckBox;
    Label7: TLabel;
    Label8: TLabel;
    Label21: TLabel;
    Label22: TLabel;
    Label23: TLabel;
    Label24: TLabel;
    Panel77: TPanel;
    Lb_1cha: TLabel;
    Lb_UA: TLabel;
    Lb_DJA: TLabel;
    Lb_GA: TLabel;
    Lb_UBA: TLabel;
    Lb_JGA: TLabel;
    Panel78: TPanel;
    Panel79: TPanel;
    Panel95: TPanel;
    Panel96: TPanel;
    Panel97: TPanel;
    qryHangmok_Gongdan: TQuery;
    qryNo_hangmok_Cancer: TQuery;
    Chk_Ysno_company: TCheckBox;
    qry_Num_tel: TQuery;
    qryD_Nhic: TQuery;
    CK_Breastfeed: TCheckBox;
    CK_Partner: TCheckBox;
    CK_Period: TCheckBox;
    Panel98: TPanel;
    qryI_Gumgin_Check: TQuery;
    qryU_Gumgin_Check: TQuery;
    qry_Gumgin_Check: TQuery;
    qryD_Gumgin_Check: TQuery;
    CK_Urin: TCheckBox;
    CK_Blood: TCheckBox;
    CK_Trust_company: TCheckBox;
    CK_Pacs: TCheckBox;
    qryU_Kicho_EYE_MAN: TQuery;
    qryU_Kicho_EYE_KYO: TQuery;
    qry_hul_sokun: TQuery;
    Chk_DI: TCheckBox;
    qry_ipkum: TQuery;
    qryU_Pay: TQuery;
    qryU_Dep: TQuery;
    qryGulKwa: TQuery;
    cmb_email: TComboBox;
    Panel99: TPanel;
    Query1: TQuery;
    qryCancel_jangbi: TQuery;
    qryU_Cancel_jangbi: TQuery;
    qryI_Cancel_jangbi: TQuery;
    CK_Sod_Citrate: TCheckBox;
    mskCompany: TDateEdit;
    CK_Gongdan_Chgu: TCheckBox;
    ckJinryoChart: TCheckBox;
    qryVIP: TQuery;
    Chk_New_Add: TCheckBox;
    Label25: TLabel;
    qry_hm: TQuery;
    qryD_cancel_jangbi: TQuery;
    Ck_ysno_result_Use: TCheckBox;
    qry_Tot_Munjin2010: TQuery;
    qryU_Tot_Munjin2010: TQuery;
    qryI_Tot_Munjin2010: TQuery;
    qry_ReserInfo: TQuery;
    qryI_ReserInfo: TQuery;
    qryD_ReserInfo: TQuery;
    rdMobile: TCheckBox;
    qrySmoke: TQuery;
    edtTk_Print: TDateEdit;
    Label26: TLabel;
    qryTk_Print: TQuery;
    CK_Label: TComboBox;
    chk_BarCode: TCheckBox;
    qryI_PACS_2015: TZQuery;
    Chk_Free: TCheckBox;
    qryProfile_hm: TQuery;
    qrySin_Sokun: TQuery;
    qry_gmgn_retest: TQuery;
    qryJJPP: TQuery;
    Panel100: TPanel;
    ValTop: TValEdit;
    Label27: TLabel;
    qryD_cancel_jangbi2: TQuery;
    btn_Ysno_gocg: TSpeedButton;
    GBox_Ysno_gocg: TGroupBox;
    Ysno_UA: TCheckBox;
    Ysno_DJA: TCheckBox;
    Ysno_GA: TCheckBox;
    Ysno_UBA: TCheckBox;
    Ysno_JGA: TCheckBox;
    edt_Ysno_gocg: TEdit;
    qryD_Tk_JeaGum_chk: TQuery;
    qryPregmgn: TQuery;
    btn_pregmgn: TBitBtn;
    edtGong_Print: TDateEdit;
    Lbl_Gong_print: TLabel;
    qryNs_sokun: TQuery;
    Chk_BarcodeRreview: TCheckBox;
    Ck_Ysno_SMS_Agreement: TCheckBox;
    qryHangmokSuga: TQuery;
    qryChk_suga: TQuery;
    btn_pt: TButton;
    qry_priv: TQuery;
    PopupMenu1: TPopupMenu;
    PDF1: TMenuItem;
    qryChk_Free: TQuery;
    qryChk_FreeCD: TQuery;
    ChkBoxOverlap: TCheckBox;
    qry_Tot_Munjin2018: TQuery;
    qryI_Tot_Munjin2018: TQuery;
    qryU_Tot_Munjin2018: TQuery;
    PopupMenu2: TPopupMenu;
    N1: TMenuItem;
    qry_getHangmok: TQuery;
    qry_getJJFK: TQuery;
    Panel101: TPanel;
    Panel102: TPanel;
    cmbPat_id_type: TComboBox;
    edtPat_Id: TEdit;
    Panel103: TPanel;
    qryPerson_IDType: TQuery;
    qryI_Person_IDType: TQuery;
    qryU_Person_IDType: TQuery;
    qryD_Person_IDType: TQuery;
    CheckBox1: TCheckBox;
    procedure btnInsertClick(Sender: TObject);
    procedure btnSaveClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure btnQueryClick(Sender: TObject);
    procedure btnDeleteClick(Sender: TObject);
    procedure btnCancelClick(Sender: TObject);
    procedure UP_Change(Sender: TObject);
    procedure btnPInsertClick(Sender: TObject);
    procedure UP_KeyUp(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure UP_Click(Sender: TObject);
    procedure UP_Overlap(Sender: TObject);
    procedure Manual_Print;
    procedure btnHm_insertClick(Sender: TObject);
    procedure btnHm_deleteClick(Sender: TObject);
    procedure grdCOD_CHUGACellLoaded(Sender: TObject; DataCol,
      DataRow: Integer; var Value: Variant);
    procedure UP_Exit(Sender: TObject);
    procedure btnSugumClick(Sender: TObject);
    procedure btnPrintClick(Sender: TObject);
    procedure cmbRelationChange(Sender: TObject);
    procedure SBtn_PreRegisterClick(Sender: TObject);
    procedure Action1Execute(Sender: TObject);
    procedure Timer1Timer(Sender: TObject);
    procedure Btn_ComplainClick(Sender: TObject);
    procedure Action2Execute(Sender: TObject);
    procedure cmbGmgnKeyPress(Sender: TObject; var Key: Char);
    procedure Action3Execute(Sender: TObject);
    procedure grdMasterCellEdit(Sender: TObject; DataCol,
  DataRow: Integer; ByUser: Boolean);
    procedure BitBtn1Click(Sender: TObject);
    procedure grdMasterCellLoaded(Sender: TObject; DataCol,
      DataRow: Integer; var Value: Variant);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure edtDESC_NAMEKeyPress(Sender: TObject; var Key: Char);
    procedure Ck_UAClick(Sender: TObject);
    procedure Ck_DJAClick(Sender: TObject);
    procedure Ck_GAClick(Sender: TObject);
    procedure Ck_UBAClick(Sender: TObject);
    procedure Ck_JGAClick(Sender: TObject);     
    procedure Ck_Ysno_Gocg(Sender: TObject);
    procedure grdMasterComboInit(Sender: TObject; Combo: TtsComboGrid;
      DataCol, DataRow: Integer);
    procedure grdMasterComboCellLoaded(Sender: TObject;
      Combo: TtsComboGrid; DataCol, DataRow: Integer; var Value: Variant);
    procedure grdCOD_CHUGACellEdit(Sender: TObject; DataCol,
      DataRow: Integer; ByUser: Boolean);
    procedure grdCOD_CHUGAComboInit(Sender: TObject; Combo: TtsComboGrid;
      DataCol, DataRow: Integer);
    procedure grdCOD_CHUGAComboCellLoaded(Sender: TObject;
      Combo: TtsComboGrid; DataCol, DataRow: Integer; var Value: Variant);
    procedure grdCOD_CHUGAClickCell(Sender: TObject; DataColDown,
      DataRowDown, DataColUp, DataRowUp: Integer; DownPos,
      UpPos: TtsClickPosition);
    procedure Panel100Exit(Sender: TObject);
    procedure btnPrintMouseUp(Sender: TObject; Button: TMouseButton;
      Shift: TShiftState; X, Y: Integer);
    procedure Panel100DblClick(Sender: TObject);
    procedure edtNUM_SAMPDblClick(Sender: TObject);         
    procedure Gong_Cancel_Jangbi(Gubn_grid : String; DataRow : Integer);
    procedure cmb_emailKeyPress(Sender: TObject; var Key: Char);
    procedure Panel9Click(Sender: TObject);
    procedure btn_pregmgnClick(Sender: TObject);
    procedure btn_ptClick(Sender: TObject);
    procedure PDF1Click(Sender: TObject);
    procedure N1Click(Sender: TObject);

private
    { Private declarations }

    // 지사'코드
    UV_sJisa , sNscg, sHangmokList : String;

    UV_sBasicSQL, UV_injStatus, UV_sNum_id, UV_sGubn_neawon, UV_sPRStatus,
    UV_sDesc_Coupon, UV_sDesc_Coupon_etc, UV_sNum_Jumin,  UV_sYsno_gocg : String;

    // 추가항목과 연관된 변수
    UV_vCod_chuga_d, UV_vDesc_chuga, UV_vSuga_kmi, UV_vGubn_free, UV_vCod_hm, UV_vDesc_kor, UV_vGubn_Cancel, UV_vGubn_Cancel_select, UV_vCancel_Etc,
    UV_vGubn_Cancel_Chuga, UV_Cancel_Chuga_Etc : Variant;

    // 타이머 변수...
    UI_Timechk : Integer;

    // 기본 프린터 변수...
    UV_iPrinrer : Integer;

    // 상담내원 체크
    SDcheck, UV_bCouponChk, UV_Check_ipkm,Magam_Check,Gumgin_Check, Chuga_Check, C078_Check, S021_Check, C088_Check, C089_Check, S079_Check, S090_Check, Chk_hul, Chk_jindan, Chk_hul2, bSaler : boolean;

    //기초,문진 생성 체크
    nErrorCount_Kicho, nErrorCount_Munjin : integer;

    // 공통적으로 사용하는 함수(이름을 동일하게 사용)
    procedure UP_ChugaVarMemSet(iLength : Integer);
    function  UF_Condition : Boolean;
    function  UF_Save : Boolean;
    procedure UP_ChugaSugaCount;
    procedure UP_YhCheck(sChasu, sGubun : string);
    procedure UP_TkCheck(sChasu : string);
    procedure UP_PumyiDisplay;
    procedure UP_ChungGu_Suga(Gubun, sGubun : String; SugaA, Suga : Extended);
    //procedure UP_PACSInsert(sHangmok, sID, sHM_name, sGubn, sCount : String);
    procedure UP_PACSInsert(sCode, sHangmok, sID, sHM_name, sGubn, sCount : String);
    procedure BUSAN_PACSInsert(sHangmok, sID, sHM_name, sGubn, sCount : String);
    procedure UP_GumsaCheck(gubun, sID_1, sJisa_1, sNsGubn_1, sNsCg_1, sDate1, sDate2 : String);
    procedure UP_Johap_SugaUpdate;           
    procedure UP_GUBN_GOYH_Change;

    Procedure UP_Select_Ysno_Result_Ues(Cod_jisa, Dat_Gmgn, Num_Id : String);
    Procedure UP_Update_Ysno_Result_Ues(Cod_jisa, Dat_Gmgn, Num_id : String);

    function  UF_Nhic(sGubun : String): String;
    function  UF_No_Hangmok(sDate, sGubun : String; iYh : Integer; var iSuga : Integer): String;
    function  UF_No_Hangmok_Ysno_gocg(sDate, sGubun : String; iYh : Integer): String;
    function  UF_No_Hangmok1(sDate, sGubun : String; iYh : Integer): String;
    function  UF_Jae_Hangmok(sJisa, sJumin, sGubun : String; iYh : Integer; var iSuga : Integer): String;
    function  UF_Num_Eng(sNum : String; var sEng : String ): Boolean;
    function  UF_Num_Hour(sNum : String; var sEng : String ): Boolean;
    function  UF_Sokun_cnvt(sCod_sokun : String): String;
    function  UF_Hmatter_cnvt(sCod_Hmatter : String): String;
    function  UF_Num_Tel(sData : String) : String;

    function UF_DAT_GMGN_Validation(sDate : String) : Boolean;        //shsh                     
    Procedure UP_Insert_Munjin(sDesc_kgbl : String);
    Procedure UP_Insert_Kicho;
    function UF_Check_Munjin : Boolean;
    function UF_Check_Kicho  : Boolean;
    function UF_Retest_Check(Flag : Integer; sNum_jumin : String) : Boolean;
    function GF_HangmokDupCheck2(sDate, sJangbi, sHul, sCancer,
      sChuga: String; var sCode, sDule: String): Boolean;

    function UF_2ChaMigum_Check(sDat_gmgn, sCod_jisa, sNum_jumin : String) : Boolean;
  public
    { Public declarations }
    UV_Suga1, UV_Suga2, UV_Suga3, UV_Suga4, UV_Suga5, UV_Suga6, UV_Suga7 : Extended;
    UV_sGubn_nosin, UV_sGubn_agab, UV_sGubn_agab2, UV_sGubn_Cancer, UV_sGubn_Cancer2,
    UV_TkDesc_yh, UV_sGubn_PySeq, UV_sGubn_PyYh, UV_sDesc_email, UV_sSel_hm, UV_sAdd_hm, UV_sNum_seq, UV_sGubn_reser, UV_sYear, UV_sYsno_munjin, UV_DI05 : String;
    suga_johap : Extended;
  end;

var
  frmCK3I01: TfrmCK3I01;
  vChuga_d, sGmgn, sDesc_gmgn, chk_sel, vChuga_s, ysno_nosin, cod_sel, ysno_gibd, sGubn_UA, sGubn_DJA, sGubn_GA, sGubn_UBA, sGubn_JGA : String;
  iSeq, UV_Max_no : Integer;
  UV_SugaA1, UV_SugaA2, UV_SugaA3, UV_SugaA4, UV_SugaA5, UV_SugaA6, UV_SugaA7 : Extended;
  UV_GubnA1, UV_GubnA2, UV_GubnA3, UV_GubnA4, UV_GubnA5, UV_GubnA6, UV_GubnA7, UV_Time : String;
  DllPost : function : Pwidechar; stdcall;
  H : HINST;
  S : PWideChar;

implementation

uses ZZFunc, ZZMenu, ZZComm, MdmsFunc, ZZNewPost,
     CK3I011, CK3I012, CK3I013, CK3I014, CK3I015, CK3I016, CK3I017, CK3I019, CK3I019_18, CK3I020, CK3IA1, CK3I021, CK3I023,
     CK3P01,  CK3P02,  CK3P03,  CK3P04,  CK3P06,  CK3P07,  CK3P08,  CK3P11,  CK3P12,     CK3P13, CK3P14, CK3P15, CK3P16,
     CK3I01A, CK3I024, CK3I026, CK3P17,  CK3P09,  CK3IA2,
     //연대바코드
     CK3P18,
     //2015바코드
     CK3P21,  CK3P22, ck6pa1, ck6pb1, CK6PA4, CKEI02;

{$R *.DFM}

function TfrmCK3I01.UF_2ChaMigum_Check(sDat_gmgn, sCod_jisa, sNum_jumin : String) : Boolean;
var
   sSqlText : string;
begin
   Result := False;

   sSqlText :=            ' SELECT * FROM gumgin WITH (NOLOCK) ';
   sSqlText := sSqlText + ' WHERE Cod_jisa = ''' + sCod_jisa  + ''' ';
   sSqlText := sSqlText + ' AND num_jumin  = ''' + sNum_jumin + ''' ';
   sSqlText := sSqlText + ' AND dat_gmgn IN (SELECT dat_gmgn_2cha FROM Tk_JeaGum_chk WITH (NOLOCK) ';
   sSqlText := sSqlText + '                   WHERE Cod_jisa      = ''' + sCod_jisa  + '''  ';
   sSqlText := sSqlText + '                     AND num_jumin     = ''' + sNum_jumin + '''  ';
   sSqlText := sSqlText + '                     AND dat_gmgn_1cha = ''' + sDat_gmgn  + ''') ';

   qryTemp.Active := False;
   qryTemp.SQL.Clear;
   qryTemp.SQL.Text := sSqlText;
   qryTemp.Active := True;

   if qryTemp.IsEmpty then Result := True;

   qryTemp.Active := False;
end;

procedure TfrmCK3I01.UP_ChugaVarMemSet(iLength : Integer);
begin
   // Variant Memory Allocation
   if iLength = 0 then
   begin
      // Variant변수를 사용하기 위해서 생성
      UV_vCod_chuga_d := VarArrayCreate([0, 0], varOleStr);
      UV_vDesc_chuga  := VarArrayCreate([0, 0], varOleStr);
      UV_vSuga_kmi    := VarArrayCreate([0, 0], varOleStr);
      UV_vGubn_free   := VarArrayCreate([0, 0], varOleStr);
      UV_vCod_hm      := VarArrayCreate([0, 0], varOleStr);
      UV_vDesc_kor    := VarArrayCreate([0, 0], varOleStr);
      UV_vGubn_Cancel := VarArrayCreate([0, 0], varOleStr);
      UV_vGubn_Cancel_select := VarArrayCreate([0, 0], varOleStr);
      UV_vCancel_Etc  := VarArrayCreate([0, 0], varOleStr);
      UV_vGubn_Cancel_Chuga := VarArrayCreate([0, 0], varOleStr);
      UV_Cancel_Chuga_Etc   := VarArrayCreate([0, 0], varOleStr);
   end
   else
   begin
      // 이미 생성된 변수들의 크기를 조정
      VarArrayRedim(UV_vCod_chuga_d, iLength);
      VarArrayRedim(UV_vDesc_chuga,  iLength);
      VarArrayRedim(UV_vSuga_kmi,    iLength);
      VarArrayRedim(UV_vGubn_free,   iLength);
      VarArrayRedim(UV_vCod_hm,      iLength);
      VarArrayRedim(UV_vDesc_kor,    iLength);
      VarArrayRedim(UV_vGubn_Cancel, iLength);
      VarArrayRedim(UV_vGubn_Cancel_select, iLength);
      VarArrayRedim(UV_vCancel_Etc,  iLength);
      VarArrayRedim(UV_vGubn_Cancel_Chuga,  iLength);
      VarArrayRedim(UV_Cancel_Chuga_Etc,    iLength);
   end;
end;

function TfrmCK3I01.UF_Condition : Boolean;
begin
   Result := True;

   // 조회조건중 필수항목이 입력되었는지 Check
   if (mskJumin.Text = '') or (cmbGmgn.ItemIndex = -1) then
   begin
      GF_MsgBox('Warning', 'CONDITION');
      Result := False;
   end;
end;

function  TfrmCK3I01.UF_Num_Tel(sData : String) : String;
var i, iPos : Integer;
begin
   if Trim(sData) = '' then
   begin
      Result := '';
      exit;
   end;
   // -를 제거
   for i := 1 to Length(sData) do
   begin
      iPos := Pos('-', sData);
      if iPos = 0 then break;
      // -룰 제거
      sData := Copy(sData, 1, iPos-1) + Copy(sdata, iPos+1, Length(sData));
   end;
   Result := sData;
end;

function TfrmCK3I01.GF_HangmokDupCheck2(sDate, sJangbi, sHul, sCancer, sChuga : String; var sCode, sDule : String) : Boolean;
var vCod_hm, vCod_chuga, vCod_hm_tk, vCod_prf_tk, vCod_chuga_tk : Variant;
    index, index_tk,i, j, iRet, icnt : Integer;
    sSelect : String;
    bC028, bC026,
    bC045, bC048, bC025, bT039 : Boolean;
begin
   vCod_hm := VarArrayCreate([0, 0], varOleStr);
   vCod_hm_tk := VarArrayCreate([0, 0], varOleStr);
   
   // 검사코드를 추출
   index := 0;
   index_tk := 0;
   bC028 := False; bC026 := False;
   bC045 := False; bC048 := False; bC025 := False;
   sCode := '';
   with dmComm.qryShare do
   begin
      Active := False;
      sSelect := 'SELECT cod_hm FROM profile_hm WHERE cod_pf = :cod_pf';
      SQL.Clear;
      SQL.Add(sSelect);

      // 1. 혈액에 대한 검사항목 추출
      if sHul <> '' then
      begin
         Active := False;
         ParamByName('COD_PF').AsString := sHul;
         Active := True;

         if RecordCount > 0 then
         begin
            VarArrayRedim(vCod_hm, RecordCount-1);
            while not Eof do
            begin
               vCod_hm[index] := FieldByName('COD_HM').AsString;
               Inc(index);
               Next;
            end;
         end;
      end;

      // 2. 종양에 대한 검사항목 추출
      if sCancer <> '' then
      begin
         Active := False;
         ParamByName('COD_PF').AsString := sCancer;
         Active := True;

         if RecordCount > 0 then
         begin
            VarArrayRedim(vCod_hm, index+RecordCount-1);
            while not Eof do
            begin
               vCod_hm[index] := FieldByName('COD_HM').AsString;
               Inc(index);
               Next;
            end;
         end;
      end;

      // 3. 장비에 대한 검사항목 추출
      if sJangbi <> '' then
      begin
         Active := False;
         ParamByName('COD_PF').AsString := sJangbi;
         Active := True;

         if RecordCount > 0 then
         begin
            VarArrayRedim(vCod_hm, index+RecordCount-1);
            while not Eof do
            begin
               vCod_hm[index] := FieldByName('COD_HM').AsString;
               Inc(index);
               Next;
            end;
         end;
      end;

      //특검
      if cmbGUBN_TKGM.Text <> '' then
      begin
         qryTkgum.Close;
         qryTkgum.ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text,1,2);
         qryTkgum.ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         qryTkgum.ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
         qryTkgum.Open;

         if qryTkgum.IsEmpty = False then
         begin
             iRet := GF_MulToSingle(qryTkgum.FieldByName('cod_prf').AsString, 4, vCod_prf_tk);
             for i := 0 to iRet - 1 do
             begin
                 Active := False;
                 ParamByName('COD_PF').AsString := vCod_prf_tk[i];
                 Active := True;

                 if RecordCount > 0 then
                 begin
                    VarArrayRedim(vCod_hm_tk, index_tk + RecordCount-1);
                    while not Eof do
                    begin
                       vCod_hm_tk[index_tk] := FieldByName('COD_HM').AsString;
                       Inc(index_tk);
                       Next;
                    end;
                 end;
             end;
         end;
         iRet := GF_MulToSingle(qryTkgum.FieldByName('cod_chuga').AsString, 4, vCod_chuga_tk);
         VarArrayRedim(vCod_hm_tk, index_tk + iRet);
         for i := 0 to iRet-1 do
         begin
            vCod_hm_tk[index_tk] := vCod_chuga_tk[i];
            Inc(index_tk);
         end;
         qryTkgum.Close;
      end;
   end;

   // 4. 추가코드에 대한 검사항목 추출
   iRet := GF_MulToSingle(sChuga, 4, vCod_chuga);
   VarArrayRedim(vCod_hm, index+iRet);
   for i := 0 to iRet-1 do
   begin
      vCod_hm[index] := vCod_chuga[i];
      Inc(index);
   end;

   // 중복되는 자료가 존재하는지 Check
   for i := 0 to index - 1 do
   begin
      for j := 0 to index - 1 do
      begin
         // 자기자신일 경우 제외
         if i = j then continue;

         if vCod_hm[i] = vCod_hm[j] then
         begin
            if (vCod_hm[j] = 'H023') or (vCod_hm[j] = 'H024') then
            begin
                 Result := True;
                 exit;
            end
            else
            begin
                 GF_MsgBox('Warning', '검사항목(' + vCod_hm[i] + ')이 중복되었습니다.');
                 sDule := vCod_hm[i];
                 Result := False;
                 exit;
            end;
         end;
      end;
   end;
   //[2018.01.29-유동구]연세대 합의 완료(홍보팀 - 노재혁 선임 체크)
   {
   if (pos('DI01', sChuga) > 0 ) or (pos('DI02', sChuga) > 0 ) or (pos('DI03', sChuga) > 0 ) then
   begin
      for i := 0 to index - 1 do
      begin
         if pos('C026',vCod_hm[i]) > 0 then  bC026 := True;
         if pos('C028',vCod_hm[i]) > 0 then  bC028 := True;
      end;

      if bC026 = False then sCode := 'C026';
      if bC028 = False then sCode := sCode + 'C028';
   end;
   }
   //연대 환경호르몬(2015)
   if (pos('DI04', sChuga) > 0 ) then
   begin
      for i := 0 to index - 1 do
      begin
         if pos('T039',vCod_hm[i]) > 0 then  bT039 := True;
      end;

      if bT039 = False then sCode := 'T039';
   end;
   //연대 금연(2015)
   if (pos('DI05', sChuga) > 0 ) then
   begin
      for i := 0 to index - 1 do
      begin
         if pos('T039',vCod_hm[i]) > 0 then  bT039 := True;
      end;

      if bT039 = False then sCode := 'T039';
   end;

   //08.12.22 분석부 계산법 추가(송재호)
   if (pos('C046', sChuga) > 0 ) then
   begin
      for i := 0 to index - 1 do
      begin
         if pos('C045',vCod_hm[i]) > 0 then  bC045 := True;
         if pos('C048',vCod_hm[i]) > 0 then  bC048 := True;
      end;

      if bC045 = False then sCode := sCode + 'C045';
      if bC048 = False then sCode := sCode + 'C048';
   end;
   if (pos('C027', sChuga) > 0 ) then
   begin
      for i := 0 to index - 1 do
      begin
         if pos('C025',vCod_hm[i]) > 0 then  bC025 := True;
         if pos('C026',vCod_hm[i]) > 0 then  bC026 := True;
         if pos('C028',vCod_hm[i]) > 0 then  bC028 := True;
      end;

      for i := 0 to index_tk - 1 do
      begin
         if pos('C025',vCod_hm_tk[i]) > 0 then  bC025 := True;
         if pos('C026',vCod_hm_tk[i]) > 0 then  bC026 := True;
         if pos('C028',vCod_hm_tk[i]) > 0 then  bC028 := True;
      end;

      if bC025 = False then sCode := sCode + 'C025';
      if (bC026 = False) and (pos('C026',sCode) <= 0) then sCode := sCode + 'C026';
      if (bC028 = False) and (pos('C028',sCode) <= 0) then sCode := sCode + 'C028';
   end;

   Result := True;
end;

function TfrmCK3I01.UF_Save : Boolean;
var sCod_chuga, sDesc_kgbl, sCod_hm, cod_name, sName, sCheungGubn, cCod_chuga,
    sSelect, sWhere, sChugaHangmok, sDupl_hangmok, sHul_hm, sGubnGumgin,
    vdat_ipkum, vsuga_ipkum, vsuga_cash, vsuga_card, vgubn_ipkum,
    vgubn_ikht, vdat_insert, vcod_insert, vdat_update, vcod_update,sEng,sHour : String;
    iCount, iRet, I, j, icnt : Integer;
    vCod_chuga, vCod_chuga2, vCod_totyh : variant;
    eSuga : Extended;
    vCheck_ik, freechk : Boolean;

begin
   Result := False;

   // 작업중인지 Check
   if not UV_bEdit then exit;

   // Validation Check

   // 일련번호는 자동으로 생성하므로 Not Null Check 필요없슴
   // 1. Not Null Check
   if not GF_NotNullCheck(pnlDetail) then exit;

   // 자료추출
   // sCod_chuga := '';
   // for i := 1 to grdCOD_CHUGA.Rows do
   //    sCod_chuga := sCod_chuga + grdCOD_CHUGA.Cell[1, i];
   sCod_chuga := GF_GridToSingle(grdCod_Chuga);

   //DI03추가===================================================================
   sSelect := '';
   sSelect := ' select  Convert(varchar(12),dateadd(m ,-6, getdate()),112) As Mon_6 ';

   qryTemp.Active := False;
   qryTemp.SQL.Clear;
   qryTemp.SQL.Add(sSelect);
   qryTemp.Active := True;

   // 08.07.15 대사증후군관련 작업 - 재 검진 왔을 때 코드 넣어 주기.. (2011.08.01-'요기')
   if (Panel_yeonse.Visible = True) and (Chk_DI.Checked = false) and (mskDAT_GMGN.Enabled = True) and (copy(edtCOD_JANGBI.Text,1,2) <> 'CV') and
      (qryTemp.FieldByName('Mon_6').AsString > (copy(Panel_yeonse.Caption,1,4) + copy(Panel_yeonse.Caption,6,2) + copy(Panel_yeonse.Caption,9,2))) then
   begin
      if (pos('DI03', sCod_chuga) <= 0) and (Copy(cmbGUBN_NEAWON.Text, 1, 1) <> '2') and
         ((cmbGUBN_NOSIN.ItemIndex = 1) or (cmbGUBN_ADULT.ItemIndex = 1) or
          (Trim(edtCOD_JANGBI.Text) <> '') or (Trim(edtCOD_HUL.Text) <> '')) then
      begin
           sCod_chuga := sCod_chuga + 'DI03';
           // 추가코드에 등록
           with grdCOD_CHUGA do
           begin
                UP_ChugaVarMemSet(Rows);
                UV_vCod_chuga_d[Rows]  := 'DI03';
                UV_vDesc_chuga[Rows]   := '연구재검진(대사)';
                UV_vSuga_kmi[Rows]     := '0';
                UV_vGubn_free[Rows]    := '0';
                Rows := Rows + 1;
           end;
      end;
   end;
   qryTemp.Active := False;
   //===========================================================================
{
   sChugaHangmok := '';
   if not GF_HangmokDupCheck2(mskDAT_GMGN.Text, edtCOD_JANGBI.Text, edtCOD_HUL.Text, edtCOD_CANCER.Text, sCod_chuga, sChugaHangmok) then exit;
   // 08.12.22 검사자동추가.. 기존 대사증후군에 분석부계산법 추가.. (송재호)
   if sChugaHangmok <> '' then
   begin
      if pos('C026', sChugaHangmok) > 0 then
      begin
         // 추가코드에 등록
         with grdCOD_CHUGA do
         begin
            UP_ChugaVarMemSet(Rows+1);
            UV_vCod_chuga_d[Rows]  := 'C026';
            UV_vDesc_chuga[Rows]   := 'HDL-콜레스테롤';
            UV_vSuga_kmi[Rows]     := '0';
            UV_vGubn_free[Rows]    := '0';
            Rows := Rows + 1;
         end;
      end;
      if pos('C028', sChugaHangmok) > 0 then
      begin
         // 추가코드에 등록
         with grdCOD_CHUGA do
         begin
            UP_ChugaVarMemSet(Rows+1);
            UV_vCod_chuga_d[Rows]  := 'C028';
            UV_vDesc_chuga[Rows]   := '중성지방';
            UV_vSuga_kmi[Rows]     := '0';
            UV_vGubn_free[Rows]    := '0';
            Rows := Rows + 1;
         end;
      end;
      if pos('C045', sChugaHangmok) > 0 then
      begin
         // 추가코드에 등록
         with grdCOD_CHUGA do
         begin
            UP_ChugaVarMemSet(Rows+1);
            UV_vCod_chuga_d[Rows]  := 'C045';
            UV_vDesc_chuga[Rows]   := 'Fe';
            UV_vSuga_kmi[Rows]     := '0';
            UV_vGubn_free[Rows]    := '0';
            Rows := Rows + 1;
         end;
      end;
      if pos('C048', sChugaHangmok) > 0 then
      begin
         // 추가코드에 등록
         with grdCOD_CHUGA do
         begin
            UP_ChugaVarMemSet(Rows+1);
            UV_vCod_chuga_d[Rows]  := 'C048';
            UV_vDesc_chuga[Rows]   := 'UIBC';
            UV_vSuga_kmi[Rows]     := '0';
            UV_vGubn_free[Rows]    := '0';
            Rows := Rows + 1;
         end;
      end;
      if pos('C025', sChugaHangmok) > 0 then
      begin
         // 추가코드에 등록
         with grdCOD_CHUGA do
         begin
            UP_ChugaVarMemSet(Rows+1);
            UV_vCod_chuga_d[Rows]  := 'C025';
            UV_vDesc_chuga[Rows]   := '콜레스테롤';
            UV_vSuga_kmi[Rows]     := '0';
            UV_vGubn_free[Rows]    := '0';
            Rows := Rows + 1;
         end;
      end;
   end;
}
   sChugaHangmok := '';
   sDupl_hangmok := '';
   if not GF_HangmokDupCheck2(mskDAT_GMGN.Text, edtCOD_JANGBI.Text, edtCOD_HUL.Text, edtCOD_CANCER.Text, sCod_chuga, sChugaHangmok, sDupl_hangmok) then
   begin
      for icnt := 1 to grdCod_CHUGA.Rows do
      begin
         grdCOD_CHUGA.RowSelected[icnt] := False;
      end;
      grdCOD_CHUGA.TopRow := 1;

      for icnt := 1 to grdCOD_CHUGA.Rows do
      begin
          if grdCOD_CHUGA.cell[1, icnt] =  sDupl_hangmok then
          begin
             grdCOD_CHUGA.TopRow := icnt;
             grdCOD_CHUGA.RowSelected[icnt] := true;
             btnHm_delete.Click;
             break;
          end;
      end;
      exit;
   end;
   // 2015.05.26 DI04 - TSH, Free-T4, T3 추가 (연대_환경호르몬)
   if sChugaHangmok <> '' then
   begin
      if pos('T039', sChugaHangmok) > 0 then
      begin
         // 추가코드에 등록
         with grdCOD_CHUGA do
         begin
            UP_ChugaVarMemSet(Rows+1);
            UV_vCod_chuga_d[Rows]  := 'T039';
            UV_vDesc_chuga[Rows]   := '니코틴 정량(혈청)';
            UV_vSuga_kmi[Rows]     := '0';
            UV_vGubn_free[Rows]    := '0';
            Rows := Rows + 1;
         end;
      end;
   end;

   // Save Confirm message
   if not GF_MsgBox('Confirmation', 'SAVE') then exit;

   mskNUM_JUMIN.ReadOnly := True; // 주민번호 수정 못하게끔..
   sDesc_kgbl := '';
   if ckDESC_KGBL1.Checked = True then
      sDesc_kgbl := '간장질환,'
   else if ckDESC_KGBL2.Checked = True then
      sDesc_kgbl := sDesc_kgbl + '고혈압,'
   else if ckDESC_KGBL3.Checked = True then
      sDesc_kgbl := sDesc_kgbl + '뇌졸증,'
   else if ckDESC_KGBL4.Checked = True then
      sDesc_kgbl := sDesc_kgbl + '심장병,'
   else if ckDESC_KGBL5.Checked = True then
      sDesc_kgbl := sDesc_kgbl + '당뇨병,'
   else if ckDESC_KGBL6.Checked = True then
      sDesc_kgbl := sDesc_kgbl + '암,';
   if Trim(edtDESC_KGBL.Text) <> '' then
      sDesc_kgbl := sDesc_kgbl + edtDESC_KGBL.Text + ',';

   // DB 작업
   dmComm.database.StartTransaction;
   try
      if UV_iStatus = GC_Insert then
      begin
         //인적자료 다시 확인..
         with qryInjouk do
         begin
            // Filter 제거
            Filtered := False;

            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               UV_sNum_id := FieldByName('NUM_ID').AsString;
               Pnl_ID.Caption := '회원번호(' + FieldByName('NUM_ID').AsString + ')';

               if FieldByName('Ysno_Sod_Citrate').AsString <> '' then
               begin
                  if FieldByName('Ysno_Sod_Citrate').AsString ='Y' then CK_Sod_Citrate.Checked  := True
                  else                                                  CK_Sod_Citrate.Checked  := False;
               end;

{
               //[2017.08.05-유동구]과거자료 업데이트로 인한 현재 자료 저장 틀어짐...[
               if FieldByName('ysno_Homepage').AsString <> '' then
               begin
                  if FieldByName('ysno_Homepage').AsString ='Y' then Chk_ysno_Homepage.Checked  := True
                  else                                               Chk_ysno_Homepage.Checked  := False;
               end;
               if FieldByName('ysno_Company').AsString <> '' then
               begin
                  if FieldByName('ysno_Company').AsString ='Y' then Chk_ysno_Company.Checked  := True
                  else                                              Chk_ysno_Company.Checked  := False;
               end;
}
            end;
            Active := False;
         end;

         with qryGumgin do
         begin
            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            ParamByName('dat_gmgn').AsString  :=  mskDAT_GMGN.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               GF_MsgBox('Information', '중복입력입니다. 확인하세요..!!');
               dmComm.database.Rollback;
               mskNUM_JUMIN.SetFocus;
               Exit;
            end;
            Active := False;
         end;

         if (Trim(edtNUM_SAMP.Text) <> '') then
         begin
            with qrySAMPLE_NO do
            begin
               Active := False;
               ParamByName('cod_jisa').AsString := copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('dat_gmgn').AsString := mskDAT_GMGN.Text;
               ParamByName('Num_samp').AsString := edtNUM_SAMP.Text;
               Active := True;
               if RecordCount > 0 then
               begin
                  GF_MsgBox('Information', '샘플번호 중복입력입니다. 확인하세요..!!');
                  dmComm.database.Rollback;
                  edtNUM_SAMP.SetFocus;
                  Exit;
               end;
               Active := False;
            end;
         end;

         sSelect := ''; sWhere := '';
         if (Trim(edtNUM_SAMP.Text) = '') and (CBox_samp.Checked = True) then
         begin
            if (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '1') or (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '3') or (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '4') then
            begin
               //---------------------------------------------------------------
               {if (Copy(cmbCOD_JISA.Text, 1, 2) = '51') then
               begin
                  //샘플번호 찾기[수원,광주-혈액구분으로 구분자 사용]...
                  with qrySAMPLE do
                  begin
                     sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin ';
                     sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                     sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                     sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                     case rdgGubn_Hulgum.ItemIndex of
                        2 : begin
                               if (copy(cmbGUBN_NOSIN.Text,1,1) = '1') or (copy(cmbGUBN_ADULT.Text,1,1) = '1') or (copy(cmbGUBN_LIFE.Text, 1,1) = '1') then
                               begin
                                  sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                                  sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + '''';
                               end
                               else
                               begin
                                  //한의 광주종합검사2파트1700684
                                  //sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                                  //sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '4' + '''';
                                  sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                                  sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + '''';
                               end;
                            end;
                        else sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                     end;

                     Active := False;
                     SQL.Clear;
                     SQL.Add(sSelect + sWhere);
                     Active := True;

                     if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                        (Trim(FieldByName('SAMPLE').AsString) = '0') then
                     begin
                        case rdgGubn_Hulgum.ItemIndex of
                           0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 0 - 연구소
                           1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 1 - 센터
                           2 : begin
                                  if (copy(cmbGUBN_NOSIN.Text,1,1) = '1') or
                                     (copy(cmbGUBN_ADULT.Text,1,1) = '1') or
                                     (copy(cmbGUBN_LIFE.Text, 1,1) = '1') then edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'  // 2 - 연구소 + 센터(노신포함)
                                  //한의 광주종합검사2파트1700684
                                  //else                                         edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 2 - 연구소 + 센터(노신미포함)
                                  else                                         edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001';
                               end;
                        end;
                     end
                     else
                     begin
                        edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                     end;
                     Active := False;
                  end;
               end}
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '51') then
               begin
                  //샘플번호 찾기[수원,광주-혈액구분으로 구분자 사용]...
                  with qrySAMPLE do
                  begin
                     sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin with(nolock) ';
                     sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                     sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                     sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                     {if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                        sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''51'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + ''''
                     else  if Trim(Copy(Com_BD.Text, 1, 2))= '21' then
                           sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''51'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 4) + '''';
                     }
                     if rdgGubn_Hulgum.itemindex = 1 then
                     begin
                         if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                         begin
                            sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''511'' '
                         end
                         else if Trim(Copy(Com_BD.Text, 1, 2))= '21' then
                         begin
                            sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''512'' ';
                         end;
                     end else if rdgGubn_Hulgum.itemindex = 2 then
                     begin
                         if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                         begin
                            sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''513'' '
                         end
                         else if Trim(Copy(Com_BD.Text, 1, 2))= '21' then
                         begin
                            sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''514'' ';
                         end;
                     end;

                     Active := False;
                     SQL.Clear;
                     SQL.Add(sSelect + sWhere);
                     Active := True;

                     if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                        (Trim(FieldByName('SAMPLE').AsString) = '0') then
                     begin
                        if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                           case rdgGubn_Hulgum.ItemIndex of
                                 //0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 0 - 연구소
                                 1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 1 - 센터
                                 2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 2 - 연구소 + 센터
                           end
                        else if Trim(Copy(Com_BD.Text, 1, 2)) = '21' then
                           case rdgGubn_Hulgum.ItemIndex of
                                 //0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 0 - 연구소
                                 1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 1 - 센터
                                 2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 2 - 연구소 + 센터
                           end;
                     end
                     else
                        edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                     Active := False;
                  end;
               end
               else if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
               begin
                  //샘플번호 찾기[수원,광주-혈액구분으로 구분자 사용]...
                  with qrySAMPLE do
                  begin
                     sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin ';
                     sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                     sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                     sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                     if Trim(Copy(Com_BD.Text, 1, 2)) = '17' then
                        sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''43'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + ''''
                     else  if Trim(Copy(Com_BD.Text, 1, 2))= '18' then
                           sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''43'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 4) + '''';


                     Active := False;
                     SQL.Clear;
                     SQL.Add(sSelect + sWhere);
                     Active := True;

                     if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                        (Trim(FieldByName('SAMPLE').AsString) = '0') then
                     begin
                        if Trim(Copy(Com_BD.Text, 1, 2)) = '17' then
                           case rdgGubn_Hulgum.ItemIndex of
                                 0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 0 - 연구소
                                 1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 1 - 센터
                                 2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 2 - 연구소 + 센터
                           end
                        else if Trim(Copy(Com_BD.Text, 1, 2)) = '18' then
                           case rdgGubn_Hulgum.ItemIndex of
                                 0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 0 - 연구소
                                 1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '5001'; // 1 - 센터
                                 2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '6001'; // 2 - 연구소 + 센터
                           end;
                     end
                     else
                        edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                     Active := False;
                  end;
               end
               else
               begin
                  //샘플번호 찾기[기본형-층구분으로 구분자 사용]...
                  with qrySAMPLE do
                  begin
                     sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin ';
                     sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                     sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                     sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                     if (Trim(Copy(Com_BD.Text, 1, 2)) = '5') or (Trim(Copy(Com_BD.Text, 1, 2)) = '7') then
                       sWhere  := sWhere + ' and gubn_jinch in (''5'',''7'')'
                     else if (Trim(Copy(Com_BD.Text, 1, 2)) = '11') or (Trim(Copy(Com_BD.Text, 1, 2)) = '16') then
                       sWhere  := sWhere + ' and gubn_jinch in (''11'',''16'')'
                     else
                        sWhere  := sWhere + ' and gubn_jinch = ''' + Trim(Copy(Com_BD.Text, 1, 2)) + '''';

                     case Com_BD.ItemIndex of
                            0 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '0' + ''''; // 0 -구분없음
                            1 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; // 1 -(1)본원[종검-2F]
                            2 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 2 -(2)본원[일반-3F]
                            3 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + ''''; // 3 -(1)강남[종검-7F]
//                            4 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 4 -(2)강남[일반-6F]
                         5, 7 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; // 5 -(1)여의도[VIP-18F],7 -여의도[종검-18F]
                            6 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 6 -(2)여의도[종검-17F]
                            8 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + ''''; // 8 -(3)여의도[일반-15F]
                            9 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 9 -(2)강남[VIP-8F]
                           10 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + ''''; //10 -(3)본원[신신-4F]
                       11, 16 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '4' + ''''; //11 -(4)여의도[일반-14F], 16-여의도[외래-14F]
                           12 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; //12 -(1)부산[종검-20F]
                           13 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; //13 -(2)부산[일반-22F]
                           14 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; //14 -(1)강남[일반-2F]
                           19 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '4' + ''''; //19 -(4)강남[VIP-4F]
                     end;

                     Active := False;
                     SQL.Clear;
                     SQL.Add(sSelect + sWhere);
                     Active := True;

                     if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                        (Trim(FieldByName('SAMPLE').AsString) = '0') then
                     begin
                        case Com_BD.ItemIndex of
                              0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '0001'; // 0 -구분없음
                              1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 1 -(1)본원[종검-2F]
                              2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 2 -(2)본원[일반-3F]
                              3 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 3 -(3)강남[종검-7F]
//                              4 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 4 -(2)강남[일반-6F]
                           5, 7 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 5 -(1)여의도[VIP-18F],7 -여의도[종검-18F]
                              6 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 6 -(2)여의도[종검-17F]
                              8 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 8 -(3)여의도[일반-15F]
                              9 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 9 -(2)강남[VIP-8F]
                             10 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; //10 -(3)본원[신신-4F]
                         11, 16 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; //11 -(4)여의도[일반-14F], 16-여의도[외래-14F]
                             12 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; //12 -(1)부산[종검-20F]
                             13 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; //13 -(2)부산[일반-22F]
                             14 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; //14 -(1)14-강남[일반-2F]
                             19 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; //14 -(4)19-강남[VIP-4F]
                             15 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '5001'; //15 -(5)강남[외래-3F]
                        end;
                     end
                     else
                        edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                     Active := False;
                  end;
                  //---------------------------------------------------------------
               end;
            end
            else if (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '2') then
            begin
{
               with qrySAMPLE do
               begin
                  sSelect := ' select Max(num_samp) AS SAMPLE from gumgin ';
                  sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                  sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                  sWhere  := sWhere + ' and gubn_neawon = ''2''';
                  if (Trim(Copy(Com_BD.Text, 1, 2)) = '5') or (Trim(Copy(Com_BD.Text, 1, 2)) = '7') then
                    sWhere  := sWhere + ' and gubn_jinch in (''5'',''7'')'
                  else
                    sWhere  := sWhere + ' and gubn_jinch = ''' + Trim(Copy(Com_BD.Text, 1, 2)) + '''';

                  Active := False;
                  SQL.Clear;
                  SQL.Add(sSelect + sWhere);
                  Active := True;

                  if Trim(FieldByName('SAMPLE').AsString) = '' then
                  begin
                     case Com_BD.ItemIndex of
                           0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '5001'; // 0 -구분없음
                           1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 1 -(1)본원[종검-2F]
                           2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 2 -(2)본원[일반-3F]
                           3 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 3 -(1)강남[종검-7F]
                           4 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 4 -(2)강남[일반-6F]
                        5, 7 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 5 -(1)여의도[VIP-18F],7 -여의도[종검-18F]
                           6 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 6 -(2)여의도[종검-17F]
                           8 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 8 -(3)여의도[일반-15F]
                           9 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 9 -(3)강남[VIP-8F]
                          10 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; //10 -(3)본원[신신-4F]
                          11 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; //11 -(4)여의도[일반-14F]
                     end;
                  end
                  else
                     edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
               end;
}
            end;
         end;

         // 인적이 존재하는지 확인
         with qryInjouk do
         begin
            // Filter 제거
            Filtered := False;

            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               UV_injStatus := 'Y';

               if FieldByName('Ysno_Sod_Citrate').AsString <> '' then
               begin
                  if FieldByName('Ysno_Sod_Citrate').AsString ='Y' then CK_Sod_Citrate.Checked  := True
                  else                                                  CK_Sod_Citrate.Checked  := False;
               end;
{
               //[2017.08.05-유동구]과거자료 업데이트로 인한 현재 자료 저장 틀어짐...
               if FieldByName('ysno_Homepage').AsString <> ''  then
               begin
                  if FieldByName('ysno_Homepage').AsString ='Y' then Chk_ysno_Homepage.Checked  := True
                  else                                               Chk_ysno_Homepage.Checked  := False;
               end;
               if FieldByName('ysno_Company').AsString <> ''  then
               begin
                  if FieldByName('ysno_Company').AsString ='Y' then Chk_ysno_Company.Checked  := True
                  else                                              Chk_ysno_Company.Checked  := False;
               end;
}
            end
            ELSE
               UV_injStatus := 'N';                                             //2013.04.10 철. 인적체크.
            Active := False;
         end;

         // 일련번호 생성
         if UV_injStatus = 'N' then
         begin
            with qrySeq do
            begin
               Active := False;
               ParamByName('NUM_IDS').AsString := Copy(cmbCOD_JISA.Text, 1, 2) +
                                                  Copy(mskDAT_GMGN.Text, 3, 2) + '000000';
               ParamByName('NUM_IDE').AsString := Copy(cmbCOD_JISA.Text, 1, 2) +
                                                  Copy(mskDAT_GMGN.Text, 3, 2) + '999999';
               Active := True;

               if FieldByName('RESULT').AsString = '' then
               begin
                  UV_sNum_id := Copy(cmbCOD_JISA.Text, 1, 2) + Copy(mskDAT_GMGN.Text, 3, 2) + '000001';
                  Pnl_ID.Caption := '회원번호(' + Copy(cmbCOD_JISA.Text, 1, 2) + Copy(mskDAT_GMGN.Text, 3, 2) + '000001' + ')';
               end
               else
               begin
                  UV_sNum_id := FloatToStr(FieldByName('RESULT').AsFloat + 1);
                  Pnl_ID.Caption := '회원번호(' + FloatToStr(FieldByName('RESULT').AsFloat + 1) + ')';
               end;
               // Table disconnect
               Active := False;
            end;

            with qryI_Injouk do
            begin
               Active := False;
               ParamByName('NUM_ID').AsString := UV_sNum_id;
               Active := True;
               if RecordCount <= 0 then
               begin
                  Insert;
                  FieldByName('NUM_ID').AsString      := UV_sNum_id;
                  FieldByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
                  FieldByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
                  FieldByName('NUM_TEL').AsString     := edtNUM_TEL.Text;
                  FieldByName('NUM_POST').AsString    := mskNUM_POST.Text;
                  FieldByName('DESC_ADDR').AsString   := edtDESC_ADDR.Text;
                  FieldByName('COD_DC').AsString      := edtCOD_DC.Text;
                  FieldByName('DESC_DEPT').AsString   := edtDESC_DEPT.Text;
                  if ckYSNO_FOLK.Checked = True then
                     FieldByName('YSNO_FOLK').AsString := 'Y'
                  else
                     FieldByName('YSNO_FOLK').AsString := 'N';
                  FieldByName('DAT_IPSA').AsString   := mskDAT_IPSA.Text;
                  FieldByName('GUBN_JIK').AsString   := '';
                  //////////////////////////
                  FieldByName('NUM_SABUN').AsString  := edtNUM_SABUN.Text;
                  FieldByName('NUM_BOHM1').AsString  := '';
                  FieldByName('NUM_BOHM2').AsString  := '';

                  if CK_susin.Checked = True then
                     FieldByName('GUBN_SUSIN').AsString := 'Y'
                  else
                     FieldByName('GUBN_SUSIN').AsString := 'N';

                  if Chk_ysno_useinfo.Checked = True then
                     FieldByName('ysno_useinfo').AsString :='Y'
                  else
                     FieldByName('ysno_useinfo').AsString :='N';

                  if CK_Sod_Citrate.Checked = True then
                     FieldByName('Ysno_Sod_Citrate').AsString :='Y'
                  else
                     FieldByName('Ysno_Sod_Citrate').AsString :='N';

                  if Chk_ysno_Homepage.Checked = True then
                     FieldByName('ysno_Homepage').AsString :='Y'
                  else
                     FieldByName('ysno_Homepage').AsString :='N';

                  if Chk_ysno_Company.Checked = True then
                     FieldByName('ysno_Company').AsString :='Y'
                  else
                     FieldByName('ysno_Company').AsString :='N';

                  if Ck_Ysno_SMS_Agreement.Checked = True then
                     FieldByName('Ysno_SMS_Agreement').AsString :='Y'
                  else
                     FieldByName('Ysno_SMS_Agreement').AsString :='N';

                  FieldByName('DESC_EMAIL').AsString  := Edt_email.Text;
                  FieldByName('gubn_cnty').AsString   := Copy(Comb_CNTY.Text,1,3);

                  FieldByName('DAT_INSERT').AsString := GV_sToday;
                  FieldByName('COD_INSERT').AsString := GV_sUserId;

                  Post;
                  GP_query_log(qryI_Injouk, 'CK3I01', 'I', 'Y');
               end;
               Active := False;
            end;
         end
         else
         begin
            with qryU_Injouk do
            begin
               ParamByName('NUM_ID').AsString := UV_sNum_id;
               ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
               ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
               ParamByName('NUM_TEL').AsString     := edtNUM_TEL.Text;
               ParamByName('NUM_POST').AsString    := mskNUM_POST.Text;
               ParamByName('DESC_ADDR').AsString   := edtDESC_ADDR.Text;
               ParamByName('COD_DC').AsString      := edtCOD_DC.Text;
               ParamByName('DESC_DEPT').AsString   := edtDESC_DEPT.Text;
               if ckYSNO_FOLK.Checked = True then
                  ParamByName('YSNO_FOLK').AsString := 'Y'
               else
                  ParamByName('YSNO_FOLK').AsString := 'N';
               ParamByName('DAT_IPSA').AsString   := mskDAT_IPSA.Text;
               ParamByName('GUBN_JIK').AsString   := '';
               ParamByName('NUM_SABUN').AsString  := edtNUM_SABUN.Text;
               ParamByName('NUM_BOHM1').AsString  := '';
               ParamByName('NUM_BOHM2').AsString  := '';

               if CK_susin.Checked = True then
                  ParamByName('GUBN_SUSIN').AsString := 'Y'
               else
                  ParamByName('GUBN_SUSIN').AsString := 'N';

               if Chk_ysno_useinfo.Checked = True then
                  ParamByName('ysno_useinfo').AsString :='Y'
               else
                  ParamByName('ysno_useinfo').AsString :='N';

               if CK_Sod_Citrate.Checked = True then
                  ParamByName('ysno_Sod_Citrate').AsString :='Y'
               else
                  ParamByName('ysno_Sod_Citrate').AsString :='N';


               if Chk_ysno_Homepage.Checked = True then
                  ParamByName('ysno_Homepage').AsString :='Y'
               else
                  ParamByName('ysno_Homepage').AsString :='N';

               if Chk_ysno_Company.Checked = True then
                  ParamByName('ysno_Company').AsString :='Y'
               else
                  ParamByName('ysno_Company').AsString :='N';

               if Ck_Ysno_SMS_Agreement.Checked = True then
                  ParamByName('Ysno_SMS_Agreement').AsString :='Y'
               else
                  ParamByName('Ysno_SMS_Agreement').AsString :='N';

               ParamByName('DESC_EMAIL').AsString  := Edt_email.Text;
               ParamByName('gubn_CNTY').AsString   := Copy(Comb_CNTY.Text,1,3);

               ParamByName('DAT_UPDATE').AsString  := GV_sToday;
               ParamByName('COD_UPDATE').AsString  := GV_sUserId;

               Execsql;
                GP_query_log(qryU_Injouk, 'CK3I01', 'U', 'Y');
            end;
         end;

         with qryI_Gumgin do
         begin
            ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
            ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            ParamByName('NUM_ID').AsString      := UV_sNum_id;
            ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
            ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
            ParamByName('NUM_TEL').AsString     := edtNUM_TEL.Text;
            ParamByName('NUM_POST').AsString    := mskNUM_POST.Text;
            ParamByName('DESC_ADDR').AsString   := edtDESC_ADDR.Text;
            ParamByName('COD_DC').AsString      := edtCOD_DC.Text;
            ParamByName('DESC_DEPT').AsString   := edtDESC_DEPT.Text;
            if ckYSNO_FOLK.Checked = True then
               ParamByName('YSNO_FOLK').AsString := 'Y'
            else
               ParamByName('YSNO_FOLK').AsString := 'N';

            if ckGUBN_PREG.Checked = True then
               ParamByName('gubn_preg').AsString := 'Y'
            else if ckGUBN_PREG2.Checked = True then
               ParamByName('gubn_preg').AsString := 'P'
            else
               ParamByName('gubn_preg').AsString := 'N';

            ParamByName('DAT_IPSA').AsString    := mskDAT_IPSA.Text;
            //2016.05.23 김창규 특검처리
            If Copy(cmbGubn_Tkgm.Text,1,1) > '0' Then
               ParamByName('GUBN_JIK').AsString   := Copy(cmbGubn_Jik.Text,1,1)
            Else
               ParamByName('GUBN_JIK').AsString    := '';
               
            ParamByName('NUM_SABUN').AsString   := edtNUM_SABUN.Text;
            ParamByName('COD_SALER').AsString   := Copy(cmbCOD_SALER.Text, 1, 6);
            ParamByName('NUM_BALKUB').AsString  := edtNUM_BALKUB.Text;
            ParamByName('NUM_BOHM1').AsString   := '';
            ParamByName('NUM_BOHM2').AsString   := '';
            ParamByName('DESC_HOJU').AsString   := MEdt_No.Text;
            ParamByName('GUBN_NEAWON').AsString := Copy(cmbGUBN_NEAWON.Text, 1, 1);
            ParamByName('GUBN_JINCH').AsString  := Copy(Com_BD.Text, 1, 2);


            ParamByName('NUM_SAMP').AsString    := edtNUM_SAMP.Text;


            ParamByName('GUBN_HULGUM').AsString := intTostr(rdgGubn_Hulgum.itemindex + 1);
            ParamByName('COD_JANGBI').AsString  := edtCOD_JANGBI.Text;
            ParamByName('COD_HUL').AsString     := edtCOD_HUL.Text;
            ParamByName('COD_CANCER').AsString  := edtCOD_CANCER.Text;

            ParamByName('COD_CHUGA').AsString   := sCod_chuga + sChugaHangmok;

            if Copy(cmbGUBN_NEAWON.Text, 1,1) = '5' then
            begin
                 ParamByName('SUGA_DANCHE').AsFloat  := 0;
                 ParamByName('SUGA_GIBD').AsFloat    := 0;
                 ParamByName('SUGA_BOHUM').AsFloat   := 0;
                 ParamByName('suga_johap').AsFloat   := 0;
                 ParamByName('SUGA_TOT').AsFloat     := 0;
                 ParamByName('SUGA_KMI').AsFloat     := 0;
                 ParamByName('YUL_MCIJ').AsFloat     := 100;
            end
            else
            begin
                 ParamByName('SUGA_DANCHE').AsFloat  := valSUGA_DANCHE.Value;
                 ParamByName('SUGA_GIBD').AsFloat    := valSUGA_GIBD.Value;
                 ParamByName('SUGA_BOHUM').AsFloat   := valSUGA_GONGJE.Value;
                 ParamByName('suga_johap').AsFloat   := valsuga_johap.Value;
                 ParamByName('SUGA_TOT').AsFloat     := valSUGA_DANCHE.Value + valSUGA_GIBD.Value + valsuga_johap.Value;
                 ParamByName('SUGA_KMI').AsFloat     := valSUGA_JANGBI.Value + valSUGA_HUL.Value
                                                 + valSUGA_CANCER.Value + valSUM.Value;
                 ParamByName('YUL_MCIJ').AsFloat     := valYUL_MCIJ.Value;
            end;
            ParamByName('GUBN_NOSIN').AsString  := Copy(cmbGUBN_NOSIN.Text, 1, 1);
            ParamByName('GUBN_NSCG').AsString   := Copy(cmbGUBN_NSCG.Text, 1, 1);
            ParamByName('GUBN_NSYH').AsString   := Copy(edtGUBN_NSYH.Text, 1, pos('-', edtGUBN_NSYH.Text)-1);
            ParamByName('GUBN_TKGM').AsString   := Copy(cmbGUBN_TKGM.Text, 1, 1);
            ParamByName('GUBN_tkcg').AsString   := Copy(cmbGUBN_TKCG.Text, 1, 1);
            ParamByName('GUBN_TKYH').AsString   := Copy(edtGUBN_TKYH.Text, 1, pos('-', edtGUBN_TKYH.Text)-1);
            ParamByName('GUBN_BOGUN').AsString  := Copy(cmbGUBN_BOGUN.Text, 1, 1);
            ParamByName('GUBN_BGCG').AsString   := Copy(cmbGUBN_BGCG.Text, 1, 1);
            ParamByName('GUBN_BGYH').AsString   := Copy(edtGUBN_BGYH.Text, 1, pos('-', edtGUBN_BGYH.Text)-1);
            ParamByName('GUBN_ADULT').AsString  := Copy(cmbGUBN_ADULT.Text, 1, 1);
            ParamByName('GUBN_ADCG').AsString   := Copy(cmbGUBN_ADCG.Text, 1, 1);
            ParamByName('GUBN_ADYH').AsString   := Copy(edtGUBN_ADYH.Text, 1, pos('-', edtGUBN_ADYH.Text)-1);
            ParamByName('GUBN_AGAB').AsString   := Copy(cmbGUBN_AGAB.Text, 1, 1);
            ParamByName('GUBN_AGCG').AsString   := Copy(cmbGUBN_AGCG.Text, 1, 1);
            ParamByName('GUBN_AGYH').AsString   := Copy(edtGUBN_AGYH.Text, 1, pos('-', edtGUBN_AGYH.Text)-1);
            ParamByName('GUBN_GONG').AsString   := Copy(cmbGUBN_GONG.Text, 1, 1);
            ParamByName('GUBN_GOCG').AsString   := Copy(cmbGUBN_GOCG.Text, 1, 1);
            ParamByName('GUBN_GOYH').AsString   := Copy(edtGUBN_GOYH.Text, 1, pos('-', edtGUBN_GOYH.Text)-1);
            ParamByName('GUBN_LIFE').AsString   := Copy(cmbGUBN_LIFE.Text, 1, 1);                  //07.05.10 철
            ParamByName('GUBN_LFCG').AsString   := Copy(cmbGUBN_LFCG.Text, 1, 1);
            ParamByName('GUBN_LFYH').AsString   := Copy(edtGUBN_LFYH.Text, 1, pos('-', edtGUBN_LFYH.Text)-1);

            ParamByName('YSNO_BUNJU').AsString  := 'N';
            ParamByName('YSNO_SOKUN').AsString  := 'N';
            ParamByName('COD_GMGN').AsString    := sGmgn;
            ParamByName('NUM_SEQ').AsInteger    := iSeq;
            ParamByName('YN_MEDIC').AsString    := Copy(cmbBohm.Text, 1, 1);

            ParamByName('DAT_CHGU').AsString    := '';
            ParamByName('CHGU_DANCHE').AsString := 'N';
            ParamByName('CHGU_JOHAP').AsString  := 'N';

            ParamByName('GUBN_PRINT').AsString  := Copy(Cmb_Print.Text, 1, 2);

            ParamByName('DAT_INSERT').AsString  := GV_sToday;
            ParamByName('COD_INSERT').AsString  := GV_sUserId;
            if ckYSNO_FOLK.Checked = True then
               ParamByName('YSNO_FOLK').AsString := 'Y'
            else
               ParamByName('YSNO_FOLK').AsString := 'N';

            if Chk_ysno_useinfo.Checked = True then
               ParamByName('ysno_useinfo').AsString :='Y'
            else
               ParamByName('ysno_useinfo').AsString :='N';

            ParamByName('Ysno_gocg').AsString   := Copy(edt_Ysno_gocg.Text, 1, pos('-', edt_Ysno_gocg.Text)-1);

            Execsql;
            GP_query_log(qryI_Gumgin, 'CK3I01', 'I', 'Y');
         end;                       

         if (CK_Breastfeed.checked) or (CK_Period.checked) or (CK_Partner.checked) or (Ck_Gongdan_Chgu.checked) or
            (CK_Urin.checked) or (CK_Blood.checked) or (CK_Trust_company.checked) or (CK_Pacs.checked) then
             begin
             with qryI_Gumgin_Check do
             begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('NUM_ID').AsString      := UV_sNum_id;
               ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
               if CK_Breastfeed.checked then  ParamByName('Breastfeed').AsString   := 'Y'
               else ParamByName('Breastfeed').AsString   := 'N';
               if  CK_Period.checked then  ParamByName('Period').AsString    := 'Y'
               else ParamByName('Period').AsString   := 'N';
               if  CK_Partner.checked then  ParamByName('partner').AsString  := 'Y'
               else ParamByName('partner').AsString   := 'N';
               if  CK_Urin.checked then  ParamByName('CK_Urin').AsString     := 'Y'
               else ParamByName('CK_Urin').AsString   := 'N';
               if  CK_Blood.checked then  ParamByName('CK_Blood').AsString   := 'Y'
               else ParamByName('CK_Blood').AsString   := 'N';
               if  CK_Trust_company.Checked then ParamByName('CK_Trust_company').AsString := 'Y'
               else ParamByName('CK_Trust_company').AsString   := 'N';
               if  CK_Pacs.Checked then ParamByName('CK_Pacs').AsString := 'Y'
               else ParamByName('CK_Pacs').AsString   := 'N';
               if  Ck_Gongdan_Chgu.Checked then ParamByName('Ck_Gongdan_Chgu').AsString := 'Y'
               else ParamByName('Ck_Gongdan_Chgu').AsString   := 'N';

               ParamByName('COD_INSERT').AsString  := GV_sUserId;
               Execsql;
               GP_query_log(qryI_Gumgin_Check, 'CK3I01', 'I', 'Y');
            end;
         end;

         //결과활용동의
         UP_Update_Ysno_Result_Ues(Copy(cmbCOD_JISA.Text, 1, 2),mskDAT_GMGN.Text ,UV_sNum_id);

         if (mskDAT_GMGN.Text >= '20120901') and
            ( ((Copy(cmbGUBN_NOSIN.Text, 1, 1) = '1') and (Copy(cmbGUBN_NSCG.Text, 1, 1) = '2')) or
              ((Copy(cmbGUBN_NOSIN.Text, 1, 1) = '2') and (Copy(cmbGUBN_NSCG.Text, 1, 1) = '2')) or
              ((Copy(cmbGUBN_ADULT.Text, 1, 1) = '1') and (Copy(cmbGUBN_ADCG.Text, 1, 1) = '2')) or
              ((Copy(cmbGUBN_ADULT.Text, 1, 1) = '2') and (Copy(cmbGUBN_ADCG.Text, 1, 1) = '2')) or
              ((Copy(cmbGUBN_LIFE.Text, 1, 1) = '1') and (Copy(cmbGUBN_LFCG.Text, 1, 1) = '2')) or
              ((Copy(cmbGUBN_LIFE.Text, 1, 1) = '2') and (Copy(cmbGUBN_LFCG.Text, 1, 1) = '2')) or
              (Copy(cmbGUBN_GONG.Text, 1, 1) = '1') ) then
         begin
            with qryI_Send_Gumgin do
            begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('NUM_ID').AsString      := UV_sNum_id;
               ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
               ParamByName('COD_INSERT').AsString  := GV_sUserId;

               Execsql;
               GP_query_log(qryI_Send_Gumgin, 'CK3I01', 'I', 'Y');
            end;
         end;

         if (length(MEdt_No.Text) = 10) or (UV_bCouponChk = True) then
         begin
            with qryI_coupon_use do
            begin
               ParamByName('cod_jisa').AsString    := copy(UV_sDesc_Coupon,1,2);
               ParamByName('num_year').AsString    := copy(UV_sDesc_Coupon,3,4);
               ParamByName('num_seq').AsString     := copy(UV_sDesc_Coupon,7,4);
               ParamByName('num_balkub').AsString  := copy(MEdt_No.Text,6,5);
               ParamByName('cod_usejisa').AsString := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('num_id').AsString      := UV_sNum_id;
               ParamByName('cod_sawon').AsString   := GV_sUserId;
               ParamByName('desc_etc').AsString    := UV_sDesc_Coupon_etc;
               ParamByName('dat_insert').AsString  := GV_sToday;
               ParamByName('cod_insert').AsString := GV_sUserId;

               Execsql;
               GP_query_log(qryI_coupon_use, 'CK3I01', 'I', 'Y');
            end;
         end;

         //[2108.05.16-유동구]향정 처방전 식별유형 저장..
         //---------------------------------------------------------------------
         if (Trim(cmbPat_id_type.Text) <> '') and (Trim(edtPat_Id.Text) <> '') then
         begin
            with qryI_Person_IDType do
            begin
               ParamByName('Cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('Num_id').AsString      := UV_sNum_id;
               ParamByName('Dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('Pat_id_type').AsString := copy(cmbPat_id_type.Text,1,1);
               ParamByName('Pat_id').AsString      := edtPat_Id.Text;
               ParamByName('Cod_insert').AsString  := GV_sUserId;

               Execsql;
               GP_query_log(qryI_Person_IDType, 'CK3I01', 'I', 'Y');
            end;
         end;
         //=====================================================================

         qryChunggu.Active := False;
         qryChunggu.ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         qryChunggu.ParamByName('Num_jumin').AsString := mskNUM_JUMIN.Text;
         qryChunggu.ParamByName('dat_chgu').AsString  := mskDAT_GMGN.Text;
         qryChunggu.ParamByName('gubn_chgu').AsString := '3';
         qryChunggu.Active := True;
         if (qryChunggu.RecordCount = 0) and (valSUGA_GIBD.Value > 0) and (valSUGA_GONGJE.Value > 0) then
         begin
            with qryI_Chunggu do
            begin
               ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('dat_chgu').AsString   := mskDAT_GMGN.Text;
               ParamByName('gubn_chgu').AsString  := '3';
               if Trim(frmCK3I01.edtCOD_DC.Text) = '' then
                  ParamByName('cod_dc').AsString  := '******'
               else
                  ParamByName('cod_dc').AsString  := edtCOD_DC.Text;
               ParamByName('num_jumin').AsString  := mskNum_jumin.Text;
               ParamByName('dat_gmgn').AsString   := mskDat_gmgn.Text;
               ParamByName('suga_chgu').AsFloat   := valSUGA_GIBD.Value;
               ParamByName('cod_saler').AsString  := Copy(cmbCOD_SALER.Text, 1, 6);
               ParamByName('ysno_jisa').AsString  := 'Y';
               ParamByName('suga_ipkum').AsFloat  := 0;
               ParamByName('dat_chsd').AsString   := mskDAT_GMGN.Text;
               ParamByName('dat_ched').AsString   := mskDAT_GMGN.Text;
               ParamByName('gubn_chdc').AsString  := '3';
               ParamByName('ysno_misu').AsString  := 'Y';
               ParamByName('DAT_INSERT').AsString := GV_sToday;
               ParamByName('COD_INSERT').AsString := GV_sUserId;

               Execsql;
               GP_query_log(qryI_Chunggu, 'CK3I01', 'I', 'Y');
            end;
         end
         else if (qryChunggu.RecordCount = 0) and (valSUGA_GIBD.Value > 0) and (valSUGA_GONGJE.Value <= 0) then
         begin
            with qryI_Chunggu do
            begin
               ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('dat_chgu').AsString   := mskDAT_GMGN.Text;
               ParamByName('gubn_chgu').AsString  := '3';
               if Trim(frmCK3I01.edtCOD_DC.Text) = '' then
                  ParamByName('cod_dc').AsString  := '******'
               else
                  ParamByName('cod_dc').AsString  := edtCOD_DC.Text;
               ParamByName('num_jumin').AsString  := mskNum_jumin.Text;
               ParamByName('dat_gmgn').AsString   := mskDat_gmgn.Text;
               ParamByName('suga_chgu').AsFloat   := valSUGA_GIBD.Value;
               ParamByName('cod_saler').AsString  := Copy(cmbCOD_SALER.Text, 1, 6);
               ParamByName('ysno_jisa').AsString  := 'Y';
               ParamByName('suga_ipkum').AsFloat  := 0;
               ParamByName('dat_chsd').AsString   := mskDAT_GMGN.Text;
               ParamByName('dat_ched').AsString   := mskDAT_GMGN.Text;
               ParamByName('gubn_chdc').AsString  := '2';
               ParamByName('ysno_misu').AsString  := 'Y';
               ParamByName('DAT_INSERT').AsString := GV_sToday;
               ParamByName('COD_INSERT').AsString := GV_sUserId;

               Execsql;
               GP_query_log(qryI_Chunggu, 'CK3I01', 'I', 'Y');
            end;
         end;
         qryChunggu.Active := False;
{
         with qryI_Munjin do
         begin
            ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            ParamByName('NUM_ID').AsString      := UV_sNum_id;
            if ckYSNO_DRINKY.Checked  = True then
               ParamByName('YSNO_DRINK').AsString := 'Y'
            else if ckYSNO_DRINKN.Checked  = True then
               ParamByName('YSNO_DRINK').AsString := 'N'
            else
               ParamByName('YSNO_DRINK').AsString := '';

            if ckYSNO_SMOKEY.Checked  = True then
               ParamByName('YSNO_SMOKE').AsString := 'Y'
            else if ckYSNO_SMOKEN.Checked  = True then
               ParamByName('YSNO_SMOKE').AsString := 'N'
            else
               ParamByName('YSNO_SMOKE').AsString := '';

            if ckYSNO_YSHUY.Checked  = True then
               ParamByName('YSNO_YSHU').AsString := 'Y'
            else if ckYSNO_YSHUN.Checked  = True then
               ParamByName('YSNO_YSHU').AsString := 'N'
            else
               ParamByName('YSNO_YSHU').AsString := '';

            ParamByName('DESC_KGBL').AsString   := sDesc_kgbl;
            ParamByName('DAT_INSERT').AsString  := GV_sToday;
            ParamByName('COD_INSERT').AsString  := GV_sUserId;

            Execsql;
            GP_query_log(qryI_Munjin, 'CK3I01', 'I', 'Y');
         end;

         with qryI_Kicho do
         begin
            ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
            ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            ParamByName('NUM_ID').AsString      := UV_sNum_id;
            ParamByName('SINJANG').AsFloat      := valSINJANG.Value;
            ParamByName('CHEJUNG').AsFloat      := valCHEJUNG.Value;
            ParamByName('BIMAN').AsFloat        := valBIMAN.Value;
            ParamByName('HUL_H').AsFloat        := valHUL_H.Value;
            ParamByName('HUL_L').AsFloat        := valHUL_L.Value;
            ParamByName('EAR_LEFT10').AsFloat    := valEAR_LEFT10.Value;
            ParamByName('EAR_RIGHT10').AsFloat   := valEAR_RIGHT10.Value;
            if vip.checked = true then
               ParamByName('ysno_label').AsString := 'Y'
            else
               ParamByName('ysno_label').AsString := 'N';
            if ckEYE1.Checked  = True then
            begin
               ParamByName('EYE_LMAN').AsFloat   := valEYE_LMAN.Value;
               ParamByName('EYE_RMAN').AsFloat   := valEYE_RMAN.Value;
               ParamByName('EYE_LKYO').AsFloat   := 0;
               ParamByName('EYE_RKYO').AsFloat   := 0;

            end
            else if ckEYE2.Checked = True then
            begin
               ParamByName('EYE_LKYO').AsFloat   := valEYE_LMAN.Value;
               ParamByName('EYE_RKYO').AsFloat   := valEYE_RMAN.Value;
               ParamByName('EYE_LMAN').AsFloat   := 0;
               ParamByName('EYE_RMAN').AsFloat   := 0;

            end;
            ParamByName('DAT_INSERT').AsString  := GV_sToday;
            ParamByName('COD_INSERT').AsString  := GV_sUserId;

            Execsql;
            GP_query_log(qryI_Kicho, 'CK3I01', 'I', 'Y');
         end;
}
         //shsh
         UP_Insert_Munjin(sDesc_kgbl);
         //정보생성 확인 - Munjin : 생성 안되어 있을시 1초후 재 생성. 단 5번 시도
         nErrorCount_Munjin := 0;
         while not UF_Check_Munjin do
         begin
           Sleep(100);
           if nErrorCount_Munjin < 5 then
           begin
             UP_Insert_Munjin(sDesc_kgbl);
             inc(nErrorCount_Munjin);
           end;
         end;

         UP_Insert_Kicho;
         //정보생성 확인 - Kicho  : 생성 안되어 있을시 1초후 재 생성. 단 5번 시도
         nErrorCount_Kicho := 0;
         while not UF_Check_Kicho do
         begin
           Sleep(100);
           if nErrorCount_Kicho < 5 then
           begin
             UP_Insert_Kicho;
             inc(nErrorCount_Kicho);
           end;
         end;


          //무료검진
          freechk := false;
          for j := 1 to grdCOD_CHUGA.Rows do
          begin
               if grdCOD_CHUGA.Cell[4, j] = 1 then
               begin
                    freechk := true;
                    break;
               end;
          end;

         if (Check_free1.Checked = true) or (Check_free2.Checked = true) or (Check_free3.Checked = true) or (freechk = true) or
            (Copy(cmbBohm.Text, 1, 1) = '3') or (Copy(cmbBohm.Text, 1, 1) = '4') or (Copy(cmbBohm.Text, 1, 1) = '5') or (MEdt_No.text <> '') then
         begin
            qryFree.Active := False;
            qryFree.ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
            qryFree.ParamByName('Num_id').AsString    := UV_sNum_id;
            qryFree.ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
            qryFree.Active := True;
            if (qryFree.RecordCount = 0)then
            begin
                 with qryI_Free do
                 begin
                      ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                      ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                      ParamByName('NUM_ID').AsString      := UV_sNum_id;

                      if Check_free1.Checked = true then
                         ParamByName('COD_JANGBI').AsString  := edtCOD_JANGBI.Text
                      else if Check_free1.Checked = false then
                         ParamByName('COD_JANGBI').AsString  := '';

                      if Check_free2.Checked = true then
                         ParamByName('COD_HUL').AsString     := edtCOD_HUL.Text
                      else if Check_free2.Checked = false then
                         ParamByName('COD_HUL').AsString     := '';

                      if Check_free3.Checked = true then
                         ParamByName('COD_CANCER').AsString  := edtCOD_CANCER.Text
                      else if Check_free3.Checked = false then
                         ParamByName('COD_CANCER').AsString  := '';


                      // 추가코드에 무료검진이 존재하는지 Check
                      for i := 1 to grdCOD_CHUGA.Rows do
                      begin
                           if grdCOD_CHUGA.Cell[4, i] = 1 then
                           begin
                                cCod_chuga :=  cCod_chuga + grdCOD_CHUGA.Cell[1, i];
                                ParamByName('GUBN_FREE').AsString := '5';
                           end
                           else if grdCOD_CHUGA.Cell[4, i] = 0 then
                                cCod_chuga := cCod_chuga + '';
                      end;
                      ParamByName('COD_CHUGA').AsString   := cCod_chuga;

                      if MEdt_No.text <> '' then
                      begin
                         ParamByName('GUBN_FREE').AsString := '1';
                         //ParamByName('num_coupon').AsString := MEdt_No.text;
                      end
                      else if Copy(cmbBohm.Text, 1, 1) = '3' then
                         ParamByName('GUBN_FREE').AsString := '2'
                      else if Copy(cmbBohm.Text, 1, 1) = '4' then
                         ParamByName('GUBN_FREE').AsString := '3'
                      else if Copy(cmbBohm.Text, 1, 1) = '5' then
                         ParamByName('GUBN_FREE').AsString := '4'
                      else if (Check_free1.Checked = true) or (Check_free2.Checked = true) or (Check_free3.Checked = true) then
                         ParamByName('GUBN_FREE').AsString := '5';

                      ParamByName('DAT_INSERT').AsString  := GV_sToday;
                      ParamByName('COD_INSERT').AsString  := GV_sUserId;

                      if ((MEdt_No.text <> '') or (Copy(cmbBohm.Text, 1, 1) = '3') or (Copy(cmbBohm.Text, 1, 1) = '4') or (Copy(cmbBohm.Text, 1, 1) = '5')
                         or (Check_free1.Checked = true) or (Check_free2.Checked = true)
                         or (Check_free3.Checked = true) or (cCod_chuga <>  '')) then
                            Execsql;

                       GP_query_log(qryI_Free, 'CK3I01', 'I', 'Y');
                end;
            end;
            qryFree.Active := False;
         end;

   {      // 암검사관련 05.05.26
         if (trim(Gubn_jik.text) <> '') or (trim(Gubn_am.text) <> '') or (trim(bogun_kiho.text) <> '') then
         begin
            with qryCa_gubun do
            begin
               close;
               ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
               ParamByName('num_id').AsString   := UV_sNum_id;
               ParamByName('dat_gmgn').AsString := mskDat_gmgn.text;
               open;
               if recordcount > 0 then
               begin
                  with qryCa_update do
                  begin
                     close;
                     if trim(Gubn_jik.text) <> '' then ParamByName('gubn_jik').AsString := intTostr(gubn_jik.itemindex)
                     else                              ParamByName('gubn_jik').AsString := '';
                     if trim(Gubn_am.text)  <> '' then ParamByName('gubn_am').AsString  := intTostr(gubn_am.itemindex)
                     else                              ParamByName('gubn_am').AsString  := '';
                     ParamByName('bogun_kiho').AsString     := trim(bogun_kiho.text);
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     ParamByName('cod_update').AsString     := GV_sUserId;
                     ParamByName('dat_update').AsString     := GV_sToday;
                     execsql;
                     GP_query_log(qryCa_update, 'CK3I01', 'U', 'Y');
                  end;
               end else
               begin
                  with qryCa_insert do
                  begin
                     close;
                     if trim(Gubn_jik.text) <> '' then ParamByName('gubn_jik').AsString := intTostr(gubn_jik.itemindex)
                     else                              ParamByName('gubn_jik').AsString := '';
                     if trim(Gubn_am.text)  <> '' then ParamByName('gubn_am').AsString  := intTostr(gubn_am.itemindex)
                     else                              ParamByName('gubn_am').AsString  := '';
                     ParamByName('bogun_kiho').AsString     := trim(bogun_kiho.text);
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     ParamByName('cod_insert').AsString     := GV_sUserId;
                     ParamByName('dat_insert').AsString     := GV_sToday;
                     execsql;
                     GP_query_log(qryCa_insert, 'CK3I01', 'I', 'Y');
                  end;
               end;
               close;
            end;
         end;    }

         // 내원상담, 우편발송 추가
         if (rdNeawon.checked) or (rdPost.checked) or (rdHmpg.checked) or (rdEmail.checked) or (rdCompany.checked) or (rdMobile.checked) then
         begin
            with qrySangdam_Rev do
            begin
               close;
               ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
               ParamByName('num_id').AsString   := UV_sNum_id;
               ParamByName('dat_gmgn').AsString := mskDat_gmgn.text;
               open;
               if recordcount > 0 then
               begin
                  with qrySDupdate do
                  begin
                     close;
                     if rdNeawon.checked then    ParamByName('bang_suryung').AsString := '1'
                     else if rdPost.checked then
                     begin
                        // 이메일발송 같이 체크될 경우 5(우편발송+이메일발송)
                        if rdEmail.checked then ParamByName('bang_suryung').AsString := '5'
                        //홈페이지 + 우편 => 7
                        else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '7'
                        //우편 + 회사전달 => 8
                        else if rdCompany.checked then ParamByName('bang_suryung').AsString := '8'
                        else ParamByName('bang_suryung').AsString := '2';
                     end
                     else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '3'
                     else if rdEmail.checked then ParamByName('bang_suryung').AsString := '4'
                     else if rdCompany.checked then ParamByName('bang_suryung').AsString := '6'
                     else if rdMobile.checked then ParamByName('bang_suryung').AsString := '9';
                     if rdNeawon.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := trim(mskNeawon.text);
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdPost.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := trim(mskPost.Text);
                        if rdCompany.checked then
                          ParamByName('dat_company').AsString := trim(mskCompany.Text)
                        else
                          ParamByName('dat_company').AsString    := '';
                     end
                     else if rdHmpg.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdEmail.checked then
                     begin
                        ParamByName('dat_balsong').AsString := '';
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_company').AsString := '';
                     end
                     else if rdCompany.checked then
                     begin
                        ParamByName('dat_balsong').AsString := '';
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_company').AsString := trim(mskCompany.Text);
                     end
                     else if rdMobile.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end;
                     ParamByName('cod_update').AsString     := GV_sUserId;
                     ParamByName('dat_update').AsString     := GV_sToday;
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     execsql;
                     GP_query_log(qrySDupdate, 'CK3I01', 'U', 'Y');
                  end;
               end else
               begin
                  with qrySDinsert do
                  begin
                     close;
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     if rdNeawon.checked then    ParamByName('bang_suryung').AsString := '1'
                     else if rdPost.checked then
                     begin
                        // 이메일발송 체크일 경우 5(우편발송+이메일발송)
                        if rdEmail.checked then ParamByName('bang_suryung').AsString := '5'
                        //홈페이지 + 우편 => 7
                        else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '7'
                        //우편 + 회사전달 => 8
                        else if rdCompany.checked then ParamByName('bang_suryung').AsString := '8'
                        else ParamByName('bang_suryung').AsString := '2';
                     end
                     else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '3'
                     else if rdEmail.checked then ParamByName('bang_suryung').AsString := '4'
                     else if rdCompany.checked then ParamByName('bang_suryung').AsString := '6'
                     else if rdMobile.checked then ParamByName('bang_suryung').AsString := '9';
                     if rdNeawon.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := trim(mskNeawon.text);
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdPost.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := trim(mskPost.Text);
                        if rdCompany.checked then
                          ParamByName('dat_company').AsString := trim(mskCompany.Text)
                        else
                          ParamByName('dat_company').AsString    := '';
                     end
                     else if rdHmpg.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdEmail.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdCompany.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := trim(mskCompany.Text);
                     end
                     else if rdMobile.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end;
                     ParamByName('dat_insert').AsString     := GV_sToday;
                     ParamByName('cod_insert').AsString     := GV_sUserId;
                     ParamByName('dat_update').AsString     := '';
                     ParamByName('cod_update').AsString     := '';
                     execsql;
                     GP_query_log(qrySDinsert, 'CK3I01', 'I', 'Y');
                   end;
               end;
               close;
            end;
         end;

         if HUL_Check.Checked  = True then
         begin
            with qryI_HCondition do
            begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('NUM_ID').AsString      := UV_sNum_id;
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('HUL_CK').AsString      := 'Y';
               ParamByName('DAT_INSERT').AsString  := GV_sToday;
               ParamByName('COD_INSERT').AsString  := GV_sUserId;
               Execsql;
               GP_query_log(qryI_HCondition, 'CK3I01', 'I', 'Y');
            end;
         end;

         //web예약업데이트
         if GV_sToday >= '20120702' then
         begin
             if (UV_sNum_seq <> '') and (UV_sGubn_reser = '2') then
             begin
                  with qryWJReser do
                  begin
                     Active := False;
                     ParamByName('YEAR').AsString        := copy(mskDAT_GMGN.Text,1,4);
                     ParamByName('NUM_SEQ').AsString     := UV_sNum_seq;
                     Active := True;

                     if RecordCount > 0 then
                     begin
                          with qryU_WJReser do
                          begin
                               ParamByName('Year').AsString         := qryWJReser.FieldByName('Year').AsString;
                               ParamByName('cod_jisa').AsString     := qryWJReser.FieldByName('cod_jisa').AsString;
                               ParamByName('num_seq').AsString      := qryWJReser.FieldByName('num_seq').AsString;
                               ParamByName('Idx').AsInteger         := qryWJReser.FieldByName('Idx').AsInteger;
                               ParamByName('gum_date').AsString     := mskDAT_GMGN.Text;
                               Execsql;
                               GP_query_log(qryU_WJReser, 'CK3I01', 'I', 'Y');
                          end;
                     end;
                  end;
             end;
         end;

         //예약정보와 회원번호 매핑
         if (UV_sYear <> '') and (UV_sNum_seq <> '') and (UV_sGubn_reser <> '') then
         begin
              with qry_ReserInfo do
              begin
                 Active := False;
                 ParamByName('YEAR').AsString        := UV_sYear;
                 ParamByName('NUM_SEQ').AsString     := UV_sNum_seq;
                 ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                 ParamByName('NUM_ID').AsString      := UV_sNum_id;
                 ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                 Active := True;

                 if RecordCount <= 0 then
                 begin
                      with qryI_ReserInfo do
                      begin
                           ParamByName('YEAR').AsString        := UV_sYear;
                           ParamByName('NUM_SEQ').AsString     := UV_sNum_seq;
                           ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                           ParamByName('NUM_ID').AsString      := UV_sNum_id;
                           ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                           ParamByName('Gubn_reser').AsString  := UV_sGubn_reser;
                           ParamByName('ysno_munjin').AsString := UV_sYsno_munjin;
                           ParamByName('Cod_insert').AsString  := GV_sUserId;
                           Execsql;
                           GP_query_log(qryI_ReserInfo, 'CK3I01', 'I', 'Y');
                      end;
                 end;
              end;
         end;

        // 검사항목 추출..
        if (chk_pacs.Checked = True) OR (chk_CPMS.Checked = True) then
        begin
           sCod_hm := ''; sHul_hm := '';
           if edtCOD_HUL.Text <> '' then
           begin
              qryPf_hm.Active := False;
              qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
              qryPf_hm.Active := True;
              if qryPf_hm.RecordCount > 0 then
              begin
                 while not qryPf_hm.Eof do
                 begin
                    if copy(qryPf_hm.FieldByName('COD_HM').AsString,1,2) = 'JJ' then
                       sCod_hm := sCod_hm + qryPf_hm.FieldByName('COD_HM').AsString
                    else
                       sHul_hm := sHul_hm + qryPf_hm.FieldByName('COD_HM').AsString;
                    qryPf_hm.Next;
                 end;
              end;
              qryPf_hm.Active := False;
           end;

           if cmbGUBN_TKGM.Text <> '' then
           begin
              with qryTkgum do
              begin
                 Active := False;
                 ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                 ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
                 ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                 Active := True;

                 if qryTkgum.RecordCount > 0 then
                 begin
                    iRet := GF_MulToSingle(qryTkgum.FieldByName('cod_chuga').AsString, 4, vCod_chuga2);
                    for i := 0 to iRet-1 do
                    begin
                       if copy(vCod_chuga2[i],1,2) = 'JJ' then sCod_hm := sCod_hm + vCod_chuga2[i]
                       else                                    sHul_hm := sHul_hm + vCod_chuga2[i];
                    end;

                    iRet := GF_MulToSingle(qryTkgum.FieldByName('cod_prf').AsString, 4, vCod_chuga2);
                    for i := 0 to iRet-1 do
                    begin
                     if copy(vCod_chuga2[i],1,4) <> '' then
                       begin
                          qryPf_hm.Active := False;
                          qryPf_hm.ParamByName('Cod_Pf').AsString := copy(vCod_chuga2[i],1,4);
                          qryPf_hm.Active := True;
                          if qryPf_hm.RecordCount > 0 then
                          begin
                             while not qryPf_hm.Eof do
                             begin
                                if copy(qryPf_hm.FieldByName('COD_HM').AsString,1,2) = 'JJ' then
                                   sCod_hm := sCod_hm + qryPf_hm.FieldByName('COD_HM').AsString
                                else
                                   sHul_hm := sHul_hm + qryPf_hm.FieldByName('COD_HM').AsString;
                                qryPf_hm.Next;
                             end;
                          end;
                          qryPf_hm.Active := False;
                       end;
                    end;
                 end;     //end of if
                 Active := False;
              end;        //end of with
           end;//end of if

           if edtCOD_CANCER.Text <> '' then
           begin
              qryPf_hm.Active := False;
              qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
              qryPf_hm.Active := True;
              if qryPf_hm.RecordCount > 0 then
              begin
                 while not qryPf_hm.Eof do
                 begin
                    if copy(qryPf_hm.FieldByName('COD_HM').AsString,1,2) = 'JJ' then
                       sCod_hm := sCod_hm + qryPf_hm.FieldByName('COD_HM').AsString
                    else
                       sHul_hm := sHul_hm + qryPf_hm.FieldByName('COD_HM').AsString;
                    qryPf_hm.Next;
                 end;
              end;
              qryPf_hm.Active := False;
           end;

           if edtCOD_JANGBI.Text <> '' then
           begin
              qryPf_hm.Active := False;
              qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
              qryPf_hm.Active := True;
              if qryPf_hm.RecordCount > 0 then
              begin
                 while not qryPf_hm.Eof do
                 begin
                    if copy(qryPf_hm.FieldByName('COD_HM').AsString,1,2) = 'JJ' then
                       sCod_hm := sCod_hm + qryPf_hm.FieldByName('COD_HM').AsString
                    else
                       sHul_hm := sHul_hm + qryPf_hm.FieldByName('COD_HM').AsString;
                    qryPf_hm.Next;
                 end;
              end;
              qryPf_hm.Active := False;
           end;

           iRet := GF_MulToSingle(sCod_chuga, 4, vCod_chuga);
           for i := 0 to iRet-1 do
           begin
              if copy(vCod_chuga[i],1,2) = 'JJ'        then sCod_hm := sCod_hm + vCod_chuga[i]
              Else if copy(vCod_chuga[i],1,4) = 'JK17' then sCod_hm := sCod_hm + vCod_chuga[i]
              else                                     sHul_hm := sHul_hm + vCod_chuga[i];
           end;

           // 노신, 성인병, 간염에 대한 검사항목 추출
           cod_name := '';
           // 노신유형Display
           if cmbGUBN_NOSIN.ItemIndex = 1 then
              cod_name := cod_name + UF_No_Hangmok1(copy(GV_sToday,1,4), '1', StrToint(Copy(edtGUBN_NSYH.text,1, pos('-', edtGUBN_NSYH.Text)-1)) );
           //성인병유형Display
           if cmbGUBN_ADULT.ItemIndex = 1 then
              cod_name := cod_name + UF_No_Hangmok1(copy(GV_sToday,1,4), '4', StrToint(Copy(edtGUBN_ADYH.text,1,pos('-', edtGUBN_ADYH.Text)-1)) );
           // 생애전환기유형Display
           if cmbGUBN_LIFE.ItemIndex = 1 then
              cod_name := cod_name + UF_No_Hangmok1(copy(GV_sToday,1,4), '7', StrToint(Copy(edtGUBN_LFYH.text,1,pos('-', edtGUBN_LFYH.Text)-1)) );

           iRet := GF_MulToSingle(cod_name, 4, vCod_totyh);
           for i := 0 to iRet-1 do
           begin
              if copy(vCod_totyh[i],1,2) = 'JJ' then sCod_hm := sCod_hm + vCod_totyh[i]
              else                                   sHul_hm := sHul_hm + vCod_totyh[i];
           end;
        end;

//PACS INSERT 부분(START)-------------------------------------------------------
//부산 전용부분(START)__________________________________________________________
         if (chk_pacs.Checked = True) and (Copy(cmbCOD_JISA.Text, 1, 2) = '61') then
         begin
            iCount := 1;

            if not qryS_Busan_Order.Active then
            begin
               qryS_Busan_Order.Close;
               qryS_Busan_Order.SQL.Clear;
               qryS_Busan_Order.SQL.Add('select max(to_number(substr(ACCESSIONNO,5,2))) AS Max_no, to_char(sysdate,''hhmmdd'') as Time from KMIorder');
               qryS_Busan_Order.SQL.Add('where to_char(sysdate,''YYYYMMDD'') = ' + GV_sToday + ' ');
               qryS_Busan_Order.SQL.Add('and to_char(sysdate,''hhmmdd'') = ' + FormatDateTime('hhnnss', Time) + ' ');
               qryS_Busan_Order.Open;
            end;
            if qryS_Busan_Order.FieldByName('Max_no').AsString <> '' then
               UV_Max_no := qryS_Busan_Order.FieldByName('Max_no').AsInteger
            else
               UV_Max_no := 1;
            UV_Time      := qryS_Busan_Order.FieldByName('Time').AsString;

            UF_Num_Hour(FormatDateTime('hh', Time), sEng);
            sHour := sEng;


            with qryI_BUSAN_ADT do
            begin
               Close;
               Sql.Clear;
               SQL.BeginUpdate;
               Sql.Add(' INSERT INTO KMIADT ');
               Sql.Add('   (QUEUEID, FLAG, WORKTIME, PATID, EVENTTYPE, PATNAME, PERSONALID, BIRTHDAY, SEX ) ');
               Sql.Add(' VALUES (:QUEUEID, :FLAG, SYSDATE, :PATID, :EVENTTYPE, :PATNAME, :PERSONALID, :BIRTHDAY, :SEX) ');
               Sql.EndUpdate;

               Active := False;
               ParamByName('QUEUEID').AsString     :=  mskDAT_GMGN.Text + FormatDateTime('hhnnss', Time) + GF_LPad(IntToStr(iCount),4,'0');
//               ParamByName('QUEUEID').AsString     :=  mskDAT_GMGN.Text + UV_Time + GF_LPad(IntToStr(iCount),4,'0');
               ParamByName('FLAG').AsString        :=  'N';
               ParamByName('PATID').AsString       :=  mskNUM_JUMIN.Text;
               ParamByName('EVENTTYPE').AsString   :=  'A08';
               ParamByName('PATNAME').AsString     :=  trim(edtDESC_NAME.Text);
               ParamByName('PERSONALID').AsString  :=  mskNUM_JUMIN.Text;
               if (Copy(mskNUM_JUMIN.Text, 7, 1) = '3') or (Copy(mskNUM_JUMIN.Text, 7, 1) = '4') then
                  ParamByName('BIRTHDAY').AsString := '20' + Copy(mskNUM_JUMIN.Text, 1, 6)
               else
                  ParamByName('BIRTHDAY').AsString := '19' + Copy(mskNUM_JUMIN.Text, 1, 6);

               if ((Copy(mskNUM_JUMIN.Text,7,1) = '1') or (Copy(mskNUM_JUMIN.Text,7,1) = '3') or
                   (Copy(mskNUM_JUMIN.Text,7,1) = '5') or (Copy(mskNUM_JUMIN.Text,7,1) = '7')) then
                  ParamByName('SEX').AsString   :=  'M'
               else
                  ParamByName('SEX').AsString   :=  'F';
               Prepare;
               ExecSQL;
               inc(iCount);
            end;
{
            // PACS DATABAE 연결 부분...
            if copy(cmbCOD_JISA.Text,1,2) = '61' then
            begin
               PACS
               ZConnection.HostName := '192.168.2.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end;                              }

            // PACS 입력쿼리 부분...
            if (copy(Com_BD.Text,1,2) <> '00') and (copy(Com_BD.Text,1,2) <> '') then
               sCheungGubn := copy(Com_BD.Text, pos('[',Com_BD.Text) + 1, pos(']',Com_BD.Text) - (pos('[',Com_BD.Text)+1))
            else
               sCheungGubn := '';
            //2015.10.12 이지스여성의원 JK17
            if (pos('JK17', sCod_hm) > 0) then
            begin
               GF_HangmokName('JK17', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JK17', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            //X-Ray(DR - 42EA)
            if (pos('JJ12', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ12', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ12', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ15', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ15', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ15', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ25', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ25', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ25', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ26', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ26', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ26', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ28', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ28', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ28', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ29', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ29', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ29', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ30', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ30', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ30', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ31', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ31', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ31', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ33', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ33', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ33', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ37', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ37', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ37', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ42', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ42', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ42', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ44', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ44', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ44', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ46', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ46', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ46', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ48', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ48', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ48', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ55', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ55', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ55', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ57', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ57', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ57', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ59', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ59', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ59', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            if (pos('JJ61', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ61', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ61', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ62', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ62', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ62', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ63', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ63', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ63', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ64', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ64', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ64', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ65', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ65', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ65', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ67', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ67', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ67', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ71', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ71', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ71', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ77', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ77', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ77', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ81', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ81', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ81', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ82', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ82', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ82', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ91', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ91', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ91', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ92', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ92', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ92', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ95', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ95', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ95', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ96', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ96', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ96', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJAB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJAB', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJAB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJB7', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJB7', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJB7', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJC4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJC4', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJC4', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJD0', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD0', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJD0', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJD4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD4', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJD4', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJD7', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD7', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJD7', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJD9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD9', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJD9', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJDI', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDI', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJDI', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJDO', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDO', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJDO', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJE1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE1', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJE1', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJE3', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE3', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJE3', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH6', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH6', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH6', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //골밀도(OT - 6EA)
{            if (pos('JJ16', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ16', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ16', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;     }
            if (pos('JJH0', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH0', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH0', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH1', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH1', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH2', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH2', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH2', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH3', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH3', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH3', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH4', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH4', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //안저(FS)
            if (pos('JJ03', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ03', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ03', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ94', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ94', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ94', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //내시경(ES - 6EA)
            if (pos('JJ34', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ34', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ34', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJB9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJB9', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJB9', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ36', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ36', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ36', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ83', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ83', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ83', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ84', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ84', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ84', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ86', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ86', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ86', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //UGI(RF - 3EA)
            if (pos('JJ13', sCod_hm) > 0) and (pos('JJ34', sCod_hm) <= 0) and (pos('JJB9', sCod_hm) <= 0) then
            begin
               GF_HangmokName('JJ13', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ13', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ32', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ32', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ32', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ80', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ80', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ80', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJOC', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJOC', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJOC', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJOL', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJOL', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJOL', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //CT(CT - 17EA)
            if (pos('JJ50', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ50', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ50', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ51', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ51', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ51', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ26', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ26', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJ52', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ52', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ52', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ55', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ55', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJ53', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ53', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ53', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ30', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ30', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJ54', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ54', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ54', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ5J', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5J', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ5J', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ90', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ90', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ90', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ25', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ25', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJDB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDB', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJDB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ62', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ62', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJDD', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDD', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJDD', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ62', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ62', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJE4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE4', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJE4', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ33', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ33', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJH5', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH5', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH5', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ55', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ55', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJH7', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH7', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH7', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH8', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH8', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH8', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJH9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH9', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJH9', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJHB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJHB', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJHB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJEC', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJEC', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJEC', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCX', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCX', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCX', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCY', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCY', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCY', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCZ', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCZ', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCZ', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            //2007.07.02 브레인 PET 촬영시 브레인CT 자동추가
            if (pos('JJP1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ50', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ50', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ5D', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5D', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ5D', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJED', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJED', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJED', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJHE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJHE', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJHE', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJHF', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJHF', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJHF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJRB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRB', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJRB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //MRI(MR - 22EA)
            if (pos('JJC8', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJC8', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJC8', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJC9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJC9', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJC9', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCA', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCA', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCA', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ55', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ55', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJCB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCB', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ26', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ26', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJCD', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCD', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCD', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCE', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCE', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCF', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCF', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCH', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCH', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCH', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCG', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCG', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCG', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCN', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCN', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCN', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJDN', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDN', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJDN', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJLA', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLA', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJLA', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ42', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ42', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJLE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLE', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJLE', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ64', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ64', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJLK', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLK', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJLK', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ30', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ30', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJLS', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLS', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJLS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ92', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ92', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJRA', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRA', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJRA', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ42', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ42', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJRE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRE', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJRE', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ71', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ71', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJRK', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRK', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJRK', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ30', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ30', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJRS', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRS', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJRS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ92', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ92', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJCI', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCI', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCI', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCJ', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCJ', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCJ', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
//               GF_HangmokName('JJ59', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
//               BUSAN_PACSInsert('JJ59', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
//               inc(iCount);
            end;
            if (pos('JJCK', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCK', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCK', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJCL', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCL', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJCL', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJRF', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRF', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJRF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJLP', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLP', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJLP', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            //유방촬영(CR)
            if (pos('JJ14', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ14', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ14', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //초음파(US - 16EA)
            if (pos('JJ10', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ10', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ10', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ20', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ20', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ20', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ21', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ21', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ21', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ22', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ22', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ22', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ23', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ23', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ23', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ24', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ24', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ24', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ27', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ27', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ27', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ38', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ38', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ38', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ39', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ39', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ39', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ41', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ41', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ41', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ47', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ47', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ47', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ56', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ56', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ56', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ79', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ79', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ79', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJA0', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJA0', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJA0', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJB8', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJB8', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJB8', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJE2', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE2', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJE2', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;
            if (pos('JJ5E', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5E', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ5E', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            //2010.03.29 철. 심전도 추가
            if (pos('JJ09', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ09', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ09', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            if (pos('JJ5L', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5L', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ5L', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

            if (pos('JJ5S', sCod_hm) > 0) then //한의 재단의료행정팀장1800093
            begin
               GF_HangmokName('JJ5S', mskDat_gmgn.text, sName);
               BUSAN_PACSInsert('JJ5S', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),4,'0'));
               inc(iCount);
            end;

         end
//부산 전용부분(END)____________________________________________________________

//부산이외 PACS부분(START)______________________________________________________
         else if chk_pacs.Checked = True then
         begin
            // PACS DATABAE 연결 부분...
            if copy(cmbCOD_JISA.Text,1,2) = '15' then
            begin
               if mskDat_gmgn.text >= '20130623' then
                  ZConnection.HostName := '192.168.102.251'
               else
                  ZConnection.HostName := '192.168.2.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end
            else if copy(cmbCOD_JISA.Text,1,2) = '11' then
            begin
               if mskDat_gmgn.text >= '20130703' then
                  ZConnection.HostName := '192.168.104.251'
               else
                  ZConnection.HostName := '192.168.9.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end
            else if copy(cmbCOD_JISA.Text,1,2) = '12' then
            begin
               if mskDat_gmgn.text >= '20130628' then
                  ZConnection.HostName := '192.168.111.251'
               else
                  ZConnection.HostName := '192.168.11.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end
            else if copy(cmbCOD_JISA.Text,1,2) = '43' then
            begin
               if mskDat_gmgn.text >= '20130723' then
                  ZConnection.HostName := '192.168.105.251'
               else
                  ZConnection.HostName := '192.168.5.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end
            else if copy(cmbCOD_JISA.Text,1,2) = '51' then
            begin
               if mskDat_gmgn.text >= '20130725' then
                  ZConnection.HostName := '192.168.106.251'
               else
                  ZConnection.HostName := '192.168.6.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end
            else if copy(cmbCOD_JISA.Text,1,2) = '71' then
            begin
               if mskDat_gmgn.text >= '20130725' then
                  ZConnection.HostName := '192.168.107.251'
               else
                  ZConnection.HostName := '192.168.7.251';
               ZConnection.Database := 'Health';
               ZConnection.User     := 'pacsuser';
               ZConnection.Password := 'pacsuser';
               ZConnection.Port     := 3306;
            end
            else exit;

            try
               ZConnection.Connect;
            except
               begin
                  ShowMessage('PACS 서버에 접속할 수 없습니다.');
                  dmComm.database.Rollback;
                  exit;
               end;
            end;

            // PACS 입력쿼리 부분...
            iCount := 1;
            if (copy(Com_BD.Text,1,2) <> '00') and (copy(Com_BD.Text,1,2) <> '') then
               sCheungGubn := copy(Com_BD.Text, pos('[',Com_BD.Text) + 1, pos(']',Com_BD.Text) - (pos('[',Com_BD.Text)+1))
            else
               sCheungGubn := '';
            //2015.10.12 이지스여성의원 JK17 - 자궁MR
            if (pos('JK17', sCod_hm) > 0) then
            begin
               GF_HangmokName('JK17', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JK17', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            //X-Ray(DR - 42EA)
            if (pos('JJ12', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ12', mskDat_gmgn.text, sName);
               if (copy(cmbCOD_JISA.Text,1,2) = '43') and
                  ((Copy(edtCOD_JANGBI.Text, 1, 2) = 'SS') or (Copy(edtCOD_JANGBI.Text, 1, 2) = 'GS') or
                  (Copy(edtCOD_JANGBI.Text, 1, 2) = 'CM') or (Copy(edtCOD_JANGBI.Text, 1, 2) = 'CV')) then
               begin
                  if (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '2') and (mskDat_gmgn.text >= '20140801') then
                  begin
                     //UP_PACSInsert('DX', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                     //UP_PACSInsert('JJ12', 'DX', UV_sNum_id, sName+'**', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJ12', 'DX', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  end else
                     //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     //UP_PACSInsert('JJ12', 'DR', UV_sNum_id, sName+'**', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJ12', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               end else
                 UP_PACSInsert('JJ12', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ15', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ15', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ15', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            //-- 2016.05.04 김창규 추가 --/
            if (pos('JJOL', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJOL', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJOL', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJOC', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJOC', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJOC', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            //-- 2016.05.04 김창규 추가 End --/
            if (pos('JJ25', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ25', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ25', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ26', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ26', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (copy(cmbCOD_JISA.Text,1,2) = '43') and
                  ((Copy(edtCOD_JANGBI.Text, 1, 2) = 'SS') or (Copy(edtCOD_JANGBI.Text, 1, 2) = 'GS') or
                  (Copy(edtCOD_JANGBI.Text, 1, 2) = 'CM') or (Copy(edtCOD_JANGBI.Text, 1, 2) = 'CV')) then
               begin
                  //UP_PACSInsert('JJ26', 'DR', UV_sNum_id, sName+'**', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  UP_PACSInsert('JJ26', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               end else
                  UP_PACSInsert('JJ26', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ28', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ28', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ28', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ29', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ29', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ29', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ30', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ30', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ30', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ31', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ31', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ31', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ33', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ33', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ33', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ37', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ37', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ37', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ42', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ42', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ42', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ44', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ44', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ44', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ46', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ46', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ46', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ48', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ48', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ48', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ55', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ55', mskDat_gmgn.text, sName);
               if (copy(cmbCOD_JISA.Text,1,2) = '43') and
                  ((Copy(edtCOD_JANGBI.Text, 1, 2) = 'SS') or (Copy(edtCOD_JANGBI.Text, 1, 2) = 'GS') or
                  (Copy(edtCOD_JANGBI.Text, 1, 2) = 'CM') or (Copy(edtCOD_JANGBI.Text, 1, 2) = 'CV')) then
               begin
                  //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  //UP_PACSInsert('JJ55', 'DR', UV_sNum_id, sName+'**', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  UP_PACSInsert('JJ55', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               end else
                  UP_PACSInsert('JJ55', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ57', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ57', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ57', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ59', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ59', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ59', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            if (pos('JJ61', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ61', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ61', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ62', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ62', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ62', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ63', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ63', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ63', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ64', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ64', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ64', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ65', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ65', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ65', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ67', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ67', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ67', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ71', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ71', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ71', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ77', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ77', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ77', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ81', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ81', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ81', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ82', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ82', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ82', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ91', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ91', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ91', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ92', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ92', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ92', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ95', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ95', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ95', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ96', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ96', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ96', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJAB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJAB', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJAB', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJB7', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJB7', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJB7', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJC4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJC4', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJC4', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJD0', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD0', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJD0', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJD4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD4', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJD4', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJD7', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD7', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJD7', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJD9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJD9', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJD9', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJDI', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDI', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJDI', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJDO', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDO', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJDO', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJE1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE1', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJE1', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJE3', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE3', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJE3', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH6', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH6', mskDat_gmgn.text, sName);
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH6', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //골밀도(OT - 6EA)
            if (pos('JJ16', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ16', mskDat_gmgn.text, sName);
               //UP_PACSInsert('OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ16', 'OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH0', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH0', mskDat_gmgn.text, sName);
               //UP_PACSInsert('OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH0', 'OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH1', mskDat_gmgn.text, sName);
               //UP_PACSInsert('OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH1', 'OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH2', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH2', mskDat_gmgn.text, sName);
               //UP_PACSInsert('OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH2', 'OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH3', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH3', mskDat_gmgn.text, sName);
               //UP_PACSInsert('OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH3', 'OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH4', mskDat_gmgn.text, sName);
               //UP_PACSInsert('OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH4', 'OT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //안저(FS)
            if (pos('JJ03', sCod_hm) > 0) then
            begin
                GF_HangmokName('JJ03', mskDat_gmgn.text, sName);
                //UP_PACSInsert('FS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                UP_PACSInsert('JJ03', 'FS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                inc(iCount);
            end;
            if (pos('JJ94', sCod_hm) > 0) then
            begin
                GF_HangmokName('JJ94', mskDat_gmgn.text, sName);
                //UP_PACSInsert('FS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                UP_PACSInsert('JJ94', 'FS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                inc(iCount);
            end;

            //심전도(EK)[2013.04.25-유동구]수원 최성환대리 요청...
            if (pos('JJ09', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ09', mskDat_gmgn.text, sName);
               //UP_PACSInsert('EK', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ09', 'EK', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //내시경(ES - 6EA)
            if (pos('JJ34', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ34', mskDat_gmgn.text, sName);
               //UP_PACSInsert('ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ34', 'ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJB9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJB9', mskDat_gmgn.text, sName);
               //UP_PACSInsert('ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJB9', 'ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ36', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ36', mskDat_gmgn.text, sName);
               //UP_PACSInsert('ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ36', 'ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ83', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ83', mskDat_gmgn.text, sName);
               //UP_PACSInsert('ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ83', 'ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ84', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ84', mskDat_gmgn.text, sName);
               //UP_PACSInsert('ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ84', 'ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ86', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ86', mskDat_gmgn.text, sName);
               //UP_PACSInsert('ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ86', 'ES', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //UGI(RF - 3EA)
            if (pos('JJ13', sCod_hm) > 0) and (pos('JJ34', sCod_hm) <= 0) and (pos('JJB9', sCod_hm) <= 0) then
            begin
               GF_HangmokName('JJ13', mskDat_gmgn.text, sName);
               if (pos('JJ13', sCod_hm) > 0) then
                   //UP_PACSInsert('RF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJ13', 'RF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ32', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ32', mskDat_gmgn.text, sName);
               //UP_PACSInsert('RF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ32', 'RF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               if copy(cmbCod_jisa.text,1,2) = '51' then //07.05.09 철. 광주 송준석 차장님 요청. 따라오는 스카웃촬영 항목임.
               begin
                  GF_HangmokName('JJE8', mskDat_gmgn.text, sName);
                  //UP_PACSInsert('CR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  UP_PACSInsert('JJE8', 'CR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  inc(iCount);
                  GF_HangmokName('JJE9', mskDat_gmgn.text, sName);
                  //UP_PACSInsert('CR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  UP_PACSInsert('JJE9', 'CR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  inc(iCount);
                  GF_HangmokName('JJ25', mskDat_gmgn.text, sName);
                  //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  UP_PACSInsert('JJ25', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  inc(iCount);
               end;
            end;
            if (pos('JJ80', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ80', mskDat_gmgn.text, sName);
               //UP_PACSInsert('RF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ80', 'RF', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //CT(CT - 17EA)
            if (pos('JJ50', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ50', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ50', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            if  (Copy(cmbCOD_JISA.Text, 1, 2) = '11') then
            begin
                 if (pos('JJ51', sCod_hm) > 0) then
                 begin
                      GF_HangmokName('JJ51', mskDat_gmgn.text, sName);
                      //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                      UP_PACSInsert('JJ51', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                      inc(iCount);
                end;
                if (pos('JJ52', sCod_hm) > 0) then
                begin
                     GF_HangmokName('JJ52', mskDat_gmgn.text, sName);
                     //UP_PACSInsert( 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJ52', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                end;
                if (pos('JJ53', sCod_hm) > 0) then
                begin
                     GF_HangmokName('JJ53', mskDat_gmgn.text, sName);
                     //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJ53', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                end;
                if (pos('JJCA', sCod_hm) > 0) then
                begin
                    GF_HangmokName('JJCA', mskDat_gmgn.text, sName);
                    //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                    UP_PACSInsert('JJCA', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                    inc(iCount);
                end;
                if (pos('JJCB', sCod_hm) > 0) then
                begin
                    GF_HangmokName('JJCB', mskDat_gmgn.text, sName);
                    //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                    UP_PACSInsert('JJCB', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                    inc(iCount);
                end;
                if (pos('JJLK', sCod_hm) > 0) then
                begin
                     GF_HangmokName('JJLK', mskDat_gmgn.text, sName);
                     //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJLK', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                end;
                if (pos('JJRK', sCod_hm) > 0) then
                begin
                     GF_HangmokName('JJRK', mskDat_gmgn.text, sName);
                     //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJRK', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                end;
           end
           else if  (Copy(cmbCOD_JISA.Text, 1, 2) <> '11')  then
           begin
                if (pos('JJ51', sCod_hm) > 0) then
                begin
                     GF_HangmokName('JJ51', mskDat_gmgn.text, sName);
                     //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJ51', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                     GF_HangmokName('JJ26', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
                     //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     //UP_PACSInsert('JJ26', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                          UP_PACSInsert('JJ26', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                     else UP_PACSInsert('JJ26', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                end;
                if (pos('JJ52', sCod_hm) > 0) then
                begin
                     GF_HangmokName('JJ52', mskDat_gmgn.text, sName);
                     //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     UP_PACSInsert('JJ52', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                     GF_HangmokName('JJ55', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
                     //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     //UP_PACSInsert('JJ55', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                          UP_PACSInsert('JJ55', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                     else UP_PACSInsert('JJ55', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                     inc(iCount);
                end;
                if (pos('JJ53', sCod_hm) > 0) then
                begin
                   GF_HangmokName('JJ53', mskDat_gmgn.text, sName);
                   //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJ53', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                   GF_HangmokName('JJ30', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
                   //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJ30', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                end;
                if (pos('JJCA', sCod_hm) > 0) then
                begin
                   GF_HangmokName('JJCA', mskDat_gmgn.text, sName);
                   //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJCA', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                   GF_HangmokName('JJ55', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
                   //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   //UP_PACSInsert('JJ55', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                        UP_PACSInsert('JJ55', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                   else UP_PACSInsert('JJ55', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                end;
                if (pos('JJCB', sCod_hm) > 0) then
                begin
                   GF_HangmokName('JJCB', mskDat_gmgn.text, sName);
                   //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJCB', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                   GF_HangmokName('JJ26', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
                   //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   //UP_PACSInsert('JJ26', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                        UP_PACSInsert('JJ26', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                   else UP_PACSInsert('JJ26', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                end;
                if (pos('JJLK', sCod_hm) > 0) then
                begin
                   GF_HangmokName('JJLK', mskDat_gmgn.text, sName);
                   //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJLK', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                   GF_HangmokName('JJ30', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
                   //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   //UP_PACSInsert('JJ30', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                        UP_PACSInsert('JJ30', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                   else UP_PACSInsert('JJ30', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                end;
                if (pos('JJRK', sCod_hm) > 0) then
                begin
                   GF_HangmokName('JJRK', mskDat_gmgn.text, sName);
                   //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   UP_PACSInsert('JJRK', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                   GF_HangmokName('JJ30', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
                   //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   //UP_PACSInsert('JJ30', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));

                   if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                        UP_PACSInsert('JJ30', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                   else UP_PACSInsert('JJ30', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                   inc(iCount);
                end;
            end;

            if (pos('JJ54', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ54', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ54', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ5J', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5J', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ5J', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ90', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ90', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ90', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ25', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ25', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJDB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDB', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJDB', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ62', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ62', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJDD', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDD', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJDD', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ62', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ62', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
//            if (pos('JJE4', sCod_hm) > 0) then
//            begin
//               GF_HangmokName('JJE4', mskDat_gmgn.text, sName);
//               UP_PACSInsert('JJE4', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
//               inc(iCount);
//               GF_HangmokName('JJ33', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
//              UP_PACSInsert('JJ33', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
//               inc(iCount);
//            end;
            if (pos('JJH5', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH5', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH5', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ55', mskDat_gmgn.text, sName);                 //07.04.06 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ55', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH7', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH7', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH7', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH8', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH8', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH8', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJH9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJH9', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJH9', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJHB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJHB', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJHB', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJEC', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJEC', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJEC', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCX', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCX', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCX', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCY', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCY', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCY', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCZ', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCZ', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCZ', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            //2007.07.02 브레인 PET 촬영시 브레인CT 자동추가
            if (pos('JJP1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ50', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ50', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //2012.05.02 수원센터 PET 추가, 2016.07.14 여의도추가
            if ((copy(cmbCOD_JISA.Text,1,2) = '43') or (copy(cmbCOD_JISA.Text,1,2) = '12')) and (pos('JJP1', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJP1', mskDat_gmgn.text, sName);
               //UP_PACSInsert('PT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJP1', 'PT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if ((copy(cmbCOD_JISA.Text,1,2) = '43') or (copy(cmbCOD_JISA.Text,1,2) = '12')) and (pos('JJP2', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJP2', mskDat_gmgn.text, sName);
               //UP_PACSInsert('PT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJP2', 'PT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;


            if (pos('JJ5D', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5D', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ5D', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJED', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJED', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJED', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            //2011.04.16 강남센터 장범호요청사항(JJHE, JJHF 추가)
            if (pos('JJHE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJHE', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJHE', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJHF', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJHF', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJHF', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            if (pos('JJRB', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRB', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJRB', 'CT', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //MRI(MR - 22EA)
            if (pos('JJC8', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJC8', mskDat_gmgn.text, sName);
               //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJC8', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJC9', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJC9', mskDat_gmgn.text, sName);
               //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJC9', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            if (pos('JJCD', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCD', mskDat_gmgn.text, sName);
               //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCD', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCE', mskDat_gmgn.text, sName);
               //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCE', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCF', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCF', mskDat_gmgn.text, sName);
               //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCF', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCH', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCH', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCH', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCG', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCG', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCG', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCN', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCN', mskDat_gmgn.text, sName);
               //UP_PACSInsert('MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCN', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJDN', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJDN', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJDN', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJLA', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLA', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJLA', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ42', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               //UP_PACSInsert('JJ42', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                    UP_PACSInsert('JJ42', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else UP_PACSInsert('JJ42', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJLE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLE', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJLE', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ64', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               //UP_PACSInsert('JJ64', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                    UP_PACSInsert('JJ64', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else UP_PACSInsert('JJ64', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            if (pos('JJLS', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJLS', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJLS', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ92', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               //UP_PACSInsert('JJ92', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                    UP_PACSInsert('JJ92', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else UP_PACSInsert('JJ92', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJRA', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRA', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJRA', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ42', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert( 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               //UP_PACSInsert('JJ42', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                    UP_PACSInsert('JJ42', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else UP_PACSInsert('JJ42', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJRE', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRE', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJRE', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ71', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert( 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               //UP_PACSInsert('JJ71', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                    UP_PACSInsert('JJ71', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else UP_PACSInsert('JJ71', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            if (pos('JJRS', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRS', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJRS', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ92', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               //UP_PACSInsert('JJ92', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
                    UP_PACSInsert('JJ92', 'DR', UV_sNum_id, '('+sName+')', sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else UP_PACSInsert('JJ92', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCI', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCI', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCI', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCJ', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCJ', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCJ', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
               GF_HangmokName('JJ59', mskDat_gmgn.text, sName);                 //07.06.08 따라오는 스카웃촬영 항목임.
               //UP_PACSInsert('DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ59', 'DR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCK', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCK', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCK', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJCL', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJCL', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJCL', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJRF', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJRF', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJRF', 'MR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //유방촬영(CR)
            if (pos('JJ14', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ14', mskDat_gmgn.text, sName);
               //UP_PACSInsert('CR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ14', 'CR', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;

            //초음파(US - 16EA)
            if (pos('JJ10', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ10', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ10', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ20', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ20', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ20', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ21', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ21', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ21', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ22', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ22', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ22', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ23', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ23', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ23', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ24', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ24', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ24', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ27', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ27', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ27', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ38', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ38', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ38', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ39', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ39', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ39', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ41', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ41', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ41', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ47', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ47', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ47', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ56', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ56', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ56', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ79', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ79', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ79', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJA0', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJA0', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJA0', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJB8', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJB8', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJB8', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJE2', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE2', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJE2', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ2U', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ2U', mskDat_gmgn.text, sName);
               if (Copy(cmbCOD_JISA.Text, 1, 2) = '11') then
                  //UP_PACSInsert( 'AB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
                  UP_PACSInsert('JJ2U', 'AB', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'))
               else
                  //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
                  UP_PACSInsert('JJ2U', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ2B', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ2B', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ2B', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJE4', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJE4', mskDat_gmgn.text, sName);
               //UP_PACSInsert( 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJE4', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ5E', sCod_hm) > 0) then
            begin
               GF_HangmokName('JJ5E', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJ5E', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJE5', sCod_hm) > 0) and ((copy(cmbCOD_JISA.Text,1,2) = '12') or (copy(cmbCOD_JISA.Text,1,2) = '51')) then
            begin//한의 여의진단검사의학팀1700797   한의 광주진단검사의학팀1700844
               GF_HangmokName('JJE5', mskDat_gmgn.text, sName);
               //UP_PACSInsert('US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               UP_PACSInsert('JJE5', 'VS', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            if (pos('JJ5S', sCod_hm) > 0) then  //한의 재단의료행정팀장1800093
            begin
               GF_HangmokName('JJ5S', mskDat_gmgn.text, sName);
               UP_PACSInsert('JJ5S', 'US', UV_sNum_id, sName, sCheungGubn, GF_LPad(IntToStr(iCount),2,'0'));
               inc(iCount);
            end;
            ZConnection.Disconnect;
         end;

//------------------------------------------------------------------
//[2009.05.06-유동구]CPMS에 전송내역...    [2010.07.07-Song] PACS전송시 CPMS전송 부분 꺼냄.(PACS와 CPMS 따로 전송)
         if ((UV_sJisa = '12') or (UV_sJisa = '15') or (UV_sJisa = '61')) AND (chk_CPMS.Checked = True) then
         begin
            with qry_Information do
            begin
               Active := False;
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('num_id').AsString      := UV_sNum_id;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
               Active := True;
               if recordcount = 0 then
               begin
                  with qryI_Information do
                  begin
                     ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                     ParamByName('num_id').AsString      := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                     ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
                     ParamByName('desc_name').AsString   := edtDESC_NAME.Text;
                     ParamByName('cod_dc').AsString      := edtCOD_DC.Text;
                     ParamByName('desc_dc').AsString     := edtDESC_DC.Text;
                     ParamByName('desc_dept').AsString   := edtDESC_DEPT.Text;
                     ParamByName('num_samp').AsString    := edtNUM_SAMP.Text;

                     //광화문
                     if   Copy(Com_BD.Text, 1, 2) = '1 ' then ParamByName('gubn_floor').AsString    := 'BEN1'
                     else if Copy(Com_BD.Text, 1, 2) = '2 ' then ParamByName('gubn_floor').AsString := 'BEN2'
                     else if Copy(Com_BD.Text, 1, 2) = '10' then ParamByName('gubn_floor').AsString := 'BEN3'
                     //여의도
                     else if Copy(Com_BD.Text, 1, 2) = '5 ' then ParamByName('gubn_floor').AsString := 'YEN1'
                     else if Copy(Com_BD.Text, 1, 2) = '7 ' then ParamByName('gubn_floor').AsString := 'YEN1'
                     else if Copy(Com_BD.Text, 1, 2) = '6 ' then ParamByName('gubn_floor').AsString := 'YEN2'
                     else if Copy(Com_BD.Text, 1, 2) = '11' then ParamByName('gubn_floor').AsString := 'YEN3'
                     else if Copy(Com_BD.Text, 1, 2) = '16' then ParamByName('gubn_floor').AsString := 'YEN3'
                     else if Copy(Com_BD.Text, 1, 2) = '8 ' then ParamByName('gubn_floor').AsString := 'YEN4'
                     //부산
                     else if Copy(Com_BD.Text, 1, 2) = '12' then ParamByName('gubn_floor').AsString  := 'CEN1'
                     else if Copy(Com_BD.Text, 1, 2) = '13' then ParamByName('gubn_floor').AsString  := 'CEN2'
                     //그외
                     else ParamByName('gubn_floor').AsString := Copy(Com_BD.Text, 1, 2);

                     if (Trim(edtCOD_JANGBI.Text) <> '') and (Trim(edtCOD_HUL.Text) <> '') then     sGubnGumgin := '종합검진'
                     else if Copy(Trim(edtCOD_JANGBI.Text),1,2) = 'SS' then                         sGubnGumgin := '채용검진'
                     else if (Trim(edtCOD_JANGBI.Text) = '') and (Trim(edtCOD_HUL.Text) <> '') then sGubnGumgin := '준종합검진'
                     else if (cmbGUBN_NOSIN.ItemIndex = 1) or (cmbGUBN_NOSIN.ItemIndex = 2) or
                             (cmbGUBN_ADULT.ItemIndex = 1) or (cmbGUBN_ADULT.ItemIndex = 2) or
                             (cmbGUBN_LIFE.ItemIndex = 1)  or (cmbGUBN_LIFE.ItemIndex = 2)  then    sGubnGumgin := '일반검진'
                     else                                                                           sGubnGumgin := '그외검진';
                     if sGubnGumgin <> '그외검진' then
                     begin
                        if (cmbGUBN_NOSIN.ItemIndex = 2) or (cmbGUBN_ADULT.ItemIndex = 2) or (cmbGUBN_LIFE.ItemIndex = 2) then
                           sCod_hm := sCod_hm + 'JJZYJJZZ'
                        else
                           sCod_hm := sCod_hm + 'JJZYJJZZ';
                     end;
                     if (pos('P001',sHul_hm) > 0) or (pos('P002',sHul_hm) > 0) or (pos('P003',sHul_hm) > 0) or
                        (pos('P004',sHul_hm) > 0) or (pos('P007',sHul_hm) > 0) or (pos('P008',sHul_hm) > 0) then
                        sCod_hm := sCod_hm + 'JJZW';

                     if  (pos('JJ13', sCod_hm) >  0) and
                        ((pos('JJ34', sCod_hm) > 0) or (pos('JJB9', sCod_hm) > 0)) then
                     begin
                        sCod_hm := copy(sCod_hm, 1, pos('JJ13', sCod_hm) -1) +
                                   copy(sCod_hm, pos('JJ13', sCod_hm) + 4, Length(sCod_hm))
                     end;

                     ParamByName('desc_Hul').AsString    := copy(sHul_hm,1,248);
                     ParamByName('desc_jangbi').AsString := copy(sCod_hm,1,248);

                     ParamByName('desc_gumgin').AsString := sGubnGumgin;
                     ParamByName('cod_insert').AsString  := GV_sUserId;

                     Execsql;
                  end;
               end;
               Active := False;   //qry_Information Closed.
            end;
         end;
//------------------------------------------------------------------

//PACS INSERT 부분(END)---------------------------------------------------------
      end
      else
      begin
         if (Trim(edtNUM_SAMP.Text) <> '') then
         begin
            with qryI_SAMPLE_NO do
            begin
               Active := False;
               ParamByName('cod_jisa').AsString  := copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
               ParamByName('Num_samp').AsString  := edtNUM_SAMP.Text;
               ParamByName('Num_jumin').AsString := mskNUM_JUMIN.Text;
               Active := True;
               if RecordCount > 0 then
               begin
                  GF_MsgBox('Information', '샘플번호 중복입력입니다. 확인하세요..!!');
                  dmComm.database.Rollback;
                  edtNUM_SAMP.SetFocus;
                  Exit;
               end;
               Active := False;
            end;
         end;
         with qryU_Injouk do
         begin
            ParamByName('NUM_ID').AsString := UV_sNum_id;
            ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
            ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
            ParamByName('NUM_TEL').AsString     := edtNUM_TEL.Text;
            ParamByName('NUM_POST').AsString    := mskNUM_POST.Text;
            ParamByName('DESC_ADDR').AsString   := edtDESC_ADDR.Text;
            ParamByName('COD_DC').AsString      := edtCOD_DC.Text;
            ParamByName('DESC_DEPT').AsString   := edtDESC_DEPT.Text;
            if ckYSNO_FOLK.Checked = True then
               ParamByName('YSNO_FOLK').AsString := 'Y'
            else
               ParamByName('YSNO_FOLK').AsString := 'N';
            ParamByName('DAT_IPSA').AsString   := mskDAT_IPSA.Text;
            
            ParamByName('GUBN_JIK').AsString   := '';
            ParamByName('NUM_SABUN').AsString  := edtNUM_SABUN.Text;
            ParamByName('NUM_BOHM1').AsString  := '';
            ParamByName('NUM_BOHM2').AsString  := '';
//            ParamByName('DESC_HOJU').AsString  := MEdt_No.Text;

            if CK_susin.Checked = True then
               ParamByName('GUBN_SUSIN').AsString := 'Y'
            else
               ParamByName('GUBN_SUSIN').AsString := 'N';
            
            if Chk_ysno_useinfo.Checked = True then
               ParamByName('ysno_useinfo').AsString :='Y'
            else
               ParamByName('ysno_useinfo').AsString :='N';

            if CK_Sod_Citrate.Checked = True then
               ParamByName('Ysno_Sod_Citrate').AsString :='Y'
            else
               ParamByName('Ysno_Sod_Citrate').AsString :='N';

            if Chk_ysno_Homepage.Checked = True then
               ParamByName('ysno_Homepage').AsString :='Y'
            else
               ParamByName('ysno_Homepage').AsString :='N';

            if Chk_ysno_Company.Checked = True then
               ParamByName('ysno_Company').AsString :='Y'
            else
               ParamByName('ysno_Company').AsString :='N';

            if Ck_Ysno_SMS_Agreement.Checked = True then
               ParamByName('Ysno_SMS_Agreement').AsString :='Y'
            else
               ParamByName('Ysno_SMS_Agreement').AsString :='N';

            ParamByName('DESC_EMAIL').AsString  := Edt_email.Text;
            ParamByName('gubn_cnty').AsString   := Copy(Comb_CNTY.Text, 1, 3);

            ParamByName('DAT_UPDATE').AsString  := GV_sToday;
            ParamByName('COD_UPDATE').AsString  := GV_sUserId;

            Execsql;
            GP_query_log(qryU_Injouk, 'CK3I01', 'U', 'Y');
         end;

         with qryU_Gumgin do
         begin
            ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
            ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            ParamByName('NUM_ID').AsString      := UV_sNum_id;
            ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
            ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
            ParamByName('NUM_TEL').AsString     := edtNUM_TEL.Text;
            ParamByName('NUM_POST').AsString    := mskNUM_POST.Text;
            ParamByName('DESC_ADDR').AsString   := edtDESC_ADDR.Text;
            ParamByName('COD_DC').AsString      := edtCOD_DC.Text;
            ParamByName('DESC_DEPT').AsString   := edtDESC_DEPT.Text;
            if ckYSNO_FOLK.Checked = True then
               ParamByName('YSNO_FOLK').AsString := 'Y'
            else
               ParamByName('YSNO_FOLK').AsString := 'N';
            if ckGUBN_PREG.Checked = True then
               ParamByName('gubn_preg').AsString := 'Y'
            else if ckGUBN_PREG2.Checked = True then
               ParamByName('gubn_preg').AsString := 'P'
            else
               ParamByName('gubn_preg').AsString := 'N';


            ParamByName('DAT_IPSA').AsString    := mskDAT_IPSA.Text;
            //2016.05.23 김창규 특검처리
            If Copy(cmbGubn_Tkgm.Text,1,1) > '0' Then
               ParamByName('GUBN_JIK').AsString   := Copy(cmbGubn_Jik.Text,1,1)
            Else
               ParamByName('GUBN_JIK').AsString    := '';
               
            ParamByName('NUM_SABUN').AsString   := edtNUM_SABUN.Text;
            ParamByName('COD_SALER').AsString   := Copy(cmbCOD_SALER.Text, 1, 6);
            ParamByName('NUM_BALKUB').AsString  := edtNUM_BALKUB.Text;
            ParamByName('NUM_BOHM1').AsString   := '';
            ParamByName('NUM_BOHM2').AsString   := '';
            ParamByName('DESC_HOJU').AsString   := MEdt_No.Text;
            ParamByName('GUBN_NEAWON').AsString := Copy(cmbGUBN_NEAWON.Text, 1, 1);
            ParamByName('GUBN_JINCH').AsString  := Copy(Com_BD.Text, 1, 2);
            ParamByName('NUM_SAMP').AsString    := edtNUM_SAMP.Text;
            ParamByName('GUBN_HULGUM').AsString := intTostr(rdgGubn_Hulgum.itemindex + 1);
            ParamByName('COD_JANGBI').AsString  := edtCOD_JANGBI.Text;
            ParamByName('COD_HUL').AsString     := edtCOD_HUL.Text;
            ParamByName('COD_CANCER').AsString  := edtCOD_CANCER.Text;
            ParamByName('COD_CHUGA').AsString   := sCod_chuga + sChugaHangmok;

            if Copy(cmbGUBN_NEAWON.Text, 1,1) = '5' then
            begin
                 ParamByName('SUGA_DANCHE').AsFloat  := 0;
                 ParamByName('SUGA_GIBD').AsFloat    := 0;
                 ParamByName('SUGA_BOHUM').AsFloat   := 0;
                 ParamByName('suga_johap').AsFloat   := 0;
                 ParamByName('SUGA_TOT').AsFloat     := 0;
                 ParamByName('SUGA_KMI').AsFloat     := 0;

                 ParamByName('YUL_MCIJ').AsFloat     := 100;
            end
            else
            begin
                 ParamByName('SUGA_DANCHE').AsFloat  := valSUGA_DANCHE.Value;
                 ParamByName('SUGA_GIBD').AsFloat    := valSUGA_GIBD.Value;
                 ParamByName('SUGA_BOHUM').AsFloat   := valSUGA_GONGJE.Value;
                 ParamByName('suga_johap').AsFloat   := valsuga_johap.Value;
                 ParamByName('SUGA_TOT').AsFloat     := valSUGA_DANCHE.Value + valSUGA_GIBD.Value + valsuga_johap.Value;
                 ParamByName('SUGA_KMI').AsFloat     := valSUGA_JANGBI.Value + valSUGA_HUL.Value
                                                 + valSUGA_CANCER.Value + valSUM.Value;

                 ParamByName('YUL_MCIJ').AsFloat     := valYUL_MCIJ.Value;
            end;

            ParamByName('GUBN_NOSIN').AsString  := Copy(cmbGUBN_NOSIN.Text, 1, 1);
            ParamByName('GUBN_NSCG').AsString   := Copy(cmbGUBN_NSCG.Text, 1, 1);
            ParamByName('GUBN_NSYH').AsString   := Copy(edtGUBN_NSYH.Text, 1, pos('-', edtGUBN_NSYH.Text)-1);
            ParamByName('GUBN_TKGM').AsString   := Copy(cmbGUBN_TKGM.Text, 1, 1);
            ParamByName('GUBN_tkcg').AsString   := Copy(cmbGUBN_TKCG.Text, 1, 1);
            ParamByName('GUBN_TKYH').AsString   := Copy(edtGUBN_TKYH.Text, 1, 1);
            ParamByName('GUBN_BOGUN').AsString  := Copy(cmbGUBN_BOGUN.Text, 1, 1);
            ParamByName('GUBN_BGCG').AsString   := Copy(cmbGUBN_BGCG.Text, 1, 1);
            ParamByName('GUBN_BGYH').AsString   := Copy(edtGUBN_BGYH.Text, 1, 1);
            ParamByName('GUBN_ADULT').AsString  := Copy(cmbGUBN_ADULT.Text, 1, 1);
            ParamByName('GUBN_ADCG').AsString   := Copy(cmbGUBN_ADCG.Text, 1, 1);
            ParamByName('GUBN_ADYH').AsString   := Copy(edtGUBN_ADYH.Text, 1, pos('-', edtGUBN_ADYH.Text)-1);
            ParamByName('GUBN_AGAB').AsString   := Copy(cmbGUBN_AGAB.Text, 1, 1);
            ParamByName('GUBN_AGCG').AsString   := Copy(cmbGUBN_AGCG.Text, 1, 1);
            ParamByName('GUBN_AGYH').AsString   := Copy(edtGUBN_AGYH.Text, 1, 1);
            ParamByName('GUBN_GONG').AsString   := Copy(cmbGUBN_GONG.Text, 1, 1);
            ParamByName('GUBN_GOCG').AsString   := Copy(cmbGUBN_GOCG.Text, 1, 1);
            ParamByName('GUBN_GOYH').AsString   := Copy(edtGUBN_GOYH.Text, 1, pos('-', edtGUBN_GOYH.Text)-1);
            ParamByName('GUBN_LIFE').AsString   := Copy(cmbGUBN_LIFE.Text, 1, 1);
            ParamByName('GUBN_LFCG').AsString   := Copy(cmbGUBN_LFCG.Text, 1, 1);
            ParamByName('GUBN_LFYH').AsString   := Copy(edtGUBN_LFYH.Text, 1, pos('-', edtGUBN_LFYH.Text)-1);

            ParamByName('COD_GMGN').AsString    := sGmgn;
            ParamByName('NUM_SEQ').AsInteger    := iSeq;
            ParamByName('YN_MEDIC').AsString    := Copy(cmbBohm.Text, 1, 1);

            ParamByName('GUBN_PRINT').AsString  := Copy(Cmb_Print.Text, 1, 2);

            ParamByName('DAT_UPDATE').AsString  := GV_sToday;
            ParamByName('COD_UPDATE').AsString  := GV_sUserId;

            if Chk_ysno_useinfo.Checked = True then
               ParamByName('ysno_useinfo').AsString :='Y'
            else
               ParamByName('ysno_useinfo').AsString :='N';

            ParamByName('Ysno_gocg').AsString   := Copy(edt_Ysno_gocg.Text, 1, pos('-', edt_Ysno_gocg.Text)-1);
            Execsql;
            GP_query_log(qryU_Gumgin, 'CK3I01', 'U', 'Y');
         end;
         if  Gumgin_Check = false then
             begin
             with qryI_Gumgin_Check do
             begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('NUM_ID').AsString      := UV_sNum_id;
               ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
               if CK_Breastfeed.checked then  ParamByName('Breastfeed').AsString   := 'Y'
               else ParamByName('Breastfeed').AsString   := 'N';
               if  CK_Period.checked then  ParamByName('Period').AsString   := 'Y'
               else ParamByName('Period').AsString   := 'N';
               if  CK_Partner.checked then  ParamByName('partner').AsString   := 'Y'
               else ParamByName('partner').AsString   := 'N';
               if  CK_Urin.checked then  ParamByName('CK_Urin').AsString     := 'Y'
               else ParamByName('CK_Urin').AsString   := 'N';
               if  CK_Blood.checked then  ParamByName('CK_Blood').AsString   := 'Y'
               else ParamByName('CK_Blood').AsString   := 'N';
               if  CK_Trust_company.Checked then ParamByName('CK_Trust_company').AsString := 'Y'
               else ParamByName('CK_Trust_company').AsString   := 'N';
               if  CK_Pacs.Checked then ParamByName('CK_Pacs').AsString := 'Y'
               else ParamByName('CK_Pacs').AsString   := 'N';
               if  Ck_Gongdan_Chgu.Checked then ParamByName('Ck_Gongdan_Chgu').AsString := 'Y'
               else ParamByName('Ck_Gongdan_Chgu').AsString   := 'N';
               
               ParamByName('COD_INSERT').AsString  := GV_sUserId;
          
               Execsql;
               Gumgin_Check:=True;
               GP_query_log(qryI_Gumgin_Check, 'CK3I01', 'I', 'Y');
            end;
            end
          else if  Gumgin_Check = true then
             begin
             with qryU_Gumgin_Check do
             begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('NUM_ID').AsString      := UV_sNum_id;
               ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
               if CK_Breastfeed.checked = true then  ParamByName('Breastfeed').AsString   := 'Y'
               else ParamByName('Breastfeed').AsString   := 'N';
               if  CK_Period.checked = true then  ParamByName('Period').AsString    := 'Y'
               else ParamByName('Period').AsString   := 'N';
               if  CK_Partner.checked = true then  ParamByName('partner').AsString  := 'Y'
               else ParamByName('partner').AsString   := 'N';
               if  CK_Urin.checked = true then  ParamByName('CK_Urin').AsString     := 'Y'
               else ParamByName('CK_Urin').AsString   := 'N';
               if  CK_Blood.checked = true then  ParamByName('CK_Blood').AsString   := 'Y'
               else ParamByName('CK_Blood').AsString   := 'N';
               if  CK_Trust_company.Checked then ParamByName('CK_Trust_company').AsString := 'Y'
               else ParamByName('CK_Trust_company').AsString   := 'N';
               if  CK_Pacs.Checked then ParamByName('CK_Pacs').AsString := 'Y'
               else ParamByName('CK_Pacs').AsString   := 'N';
               if  Ck_Gongdan_Chgu.Checked then ParamByName('Ck_Gongdan_Chgu').AsString := 'Y'
               else ParamByName('Ck_Gongdan_Chgu').AsString   := 'N';


               ParamByName('cod_update').AsString  := GV_sUserId;
               Execsql;
               GP_query_log(qryU_Gumgin_Check, 'CK3I01', 'U', 'Y');
               Gumgin_Check:=True;
            end;
          end;
     

         //결과활용동의
         UP_Update_Ysno_Result_Ues(Copy(cmbCOD_JISA.Text, 1, 2),mskDAT_GMGN.Text ,UV_sNum_id);

         if length(MEdt_No.Text) = 10 then
         begin
            if UV_sDesc_Coupon <> '' then
            begin
               with qryCoupon_use do
               begin
                  Active := False;
                  ParamByName('cod_usejisa').AsString := Copy(cmbCOD_JISA.Text, 1, 2);
                  ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                  ParamByName('num_id').AsString      := UV_sNum_id;
                  Active := True;

                  if RecordCount > 0 then
                  begin
                     with qryU_coupon_use do
                     begin
                        ParamByName('cod_usejisa').AsString := Copy(cmbCOD_JISA.Text, 1, 2);
                        ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                        ParamByName('num_id').AsString      := UV_sNum_id;
                        ParamByName('cod_jisa').AsString    := copy(UV_sDesc_Coupon,1,2);
                        ParamByName('num_year').AsString    := copy(UV_sDesc_Coupon,3,4);
                        ParamByName('num_seq').AsString     := copy(UV_sDesc_Coupon,7,4);
                        ParamByName('num_balkub').AsString  := copy(MEdt_No.Text,6,5);
                        ParamByName('cod_sawon').AsString   := GV_sUserId;
                        ParamByName('desc_etc').AsString    := UV_sDesc_Coupon_etc;
                        ParamByName('dat_update').AsString  := GV_sToday;
                        ParamByName('cod_update').AsString  := GV_sUserId;

                        Execsql;
                        GP_query_log(qryU_coupon_use, 'CK3I01', 'U', 'Y');
                     end;
                  end
                  else
                  begin
                     with qryI_coupon_use do
                     begin
                        ParamByName('cod_jisa').AsString    := copy(UV_sDesc_Coupon,1,2);
                        ParamByName('num_year').AsString    := copy(UV_sDesc_Coupon,3,4);
                        ParamByName('num_seq').AsString     := copy(UV_sDesc_Coupon,7,4);
                        ParamByName('num_balkub').AsString  := copy(MEdt_No.Text,6,5);
                        ParamByName('cod_usejisa').AsString := Copy(cmbCOD_JISA.Text, 1, 2);
                        ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                        ParamByName('num_id').AsString      := UV_sNum_id;
                        ParamByName('cod_sawon').AsString   := GV_sUserId;
                        ParamByName('desc_etc').AsString    := UV_sDesc_Coupon_etc;
                        ParamByName('dat_insert').AsString  := GV_sToday;
                        ParamByName('cod_insert').AsString := GV_sUserId;

                        Execsql;
                        GP_query_log(qryI_coupon_use, 'CK3I01', 'I', 'Y');
                     end;
                  end;
                  Active := False;
               end;
            end;
         end
         else
         begin
            with qryD_coupon_use do
            begin
               ParamByName('cod_usejisa').AsString := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('num_id').AsString      := UV_sNum_id;

               Execsql;
               GP_query_log(qryD_coupon_use, 'CK3I01', 'D', 'Y');
            end;
         end;

         qryChunggu.Active := False;
         qryChunggu.ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         qryChunggu.ParamByName('Num_jumin').AsString := mskNUM_JUMIN.Text;
         qryChunggu.ParamByName('dat_chgu').AsString  := mskDAT_GMGN.Text;
         qryChunggu.ParamByName('gubn_chgu').AsString := '3';
         qryChunggu.Active := True;
         if qryChunggu.RecordCount = 0 then
         begin
            if (valSUGA_GIBD.Value > 0) and (valSUGA_GONGJE.Value > 0) then
            begin
               with qryI_Chunggu do
               begin
                  ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text, 1, 2);
                  ParamByName('dat_chgu').AsString   := mskDAT_GMGN.Text;
                  ParamByName('gubn_chgu').AsString  := '3';
                  if Trim(frmCK3I01.edtCOD_DC.Text) = '' then
                     ParamByName('cod_dc').AsString  := '******'
                  else
                     ParamByName('cod_dc').AsString  := edtCOD_DC.Text;
                  ParamByName('num_jumin').AsString  := mskNum_jumin.Text;
                  ParamByName('dat_gmgn').AsString   := mskDat_gmgn.Text;
                  ParamByName('suga_chgu').AsFloat   := valSUGA_GIBD.Value;
                  ParamByName('cod_saler').AsString  := Copy(cmbCOD_SALER.Text, 1, 6);
                  ParamByName('ysno_jisa').AsString  := 'Y';
                  ParamByName('suga_ipkum').AsFloat  := 0;
                  ParamByName('dat_chsd').AsString   := mskDAT_GMGN.Text;
                  ParamByName('dat_ched').AsString   := mskDAT_GMGN.Text;
                  ParamByName('gubn_chdc').AsString  := '3';
                  ParamByName('ysno_misu').AsString  := 'Y';
                  ParamByName('DAT_INSERT').AsString := GV_sToday;
                  ParamByName('COD_INSERT').AsString := GV_sUserId;

                  Execsql;
                  GP_query_log(qryI_Chunggu, 'CK3I01', 'I', 'Y');
               end;
            end
            else if (valSUGA_GIBD.Value > 0) and (valSUGA_GONGJE.Value <= 0) then
            begin
               with qryI_Chunggu do
               begin
                  ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text, 1, 2);
                  ParamByName('dat_chgu').AsString   := mskDAT_GMGN.Text;
                  ParamByName('gubn_chgu').AsString  := '3';
                  if Trim(frmCK3I01.edtCOD_DC.Text) = '' then
                     ParamByName('cod_dc').AsString  := '******'
                  else
                     ParamByName('cod_dc').AsString  := edtCOD_DC.Text;
                  ParamByName('num_jumin').AsString  := mskNum_jumin.Text;
                  ParamByName('dat_gmgn').AsString   := mskDat_gmgn.Text;
                  ParamByName('suga_chgu').AsFloat   := valSUGA_GIBD.Value;
                  ParamByName('cod_saler').AsString  := Copy(cmbCOD_SALER.Text, 1, 6);
                  ParamByName('ysno_jisa').AsString  := 'Y';
                  ParamByName('suga_ipkum').AsFloat  := 0;
                  ParamByName('dat_chsd').AsString   := mskDAT_GMGN.Text;
                  ParamByName('dat_ched').AsString   := mskDAT_GMGN.Text;
                  ParamByName('gubn_chdc').AsString  := '2';
                  ParamByName('ysno_misu').AsString  := 'Y';
                  ParamByName('DAT_INSERT').AsString := GV_sToday;
                  ParamByName('COD_INSERT').AsString := GV_sUserId;

                  Execsql;
                  GP_query_log(qryI_Chunggu, 'CK3I01', 'I', 'Y');
               end;
            end
         end
         else if qryChunggu.RecordCount > 0 then
         begin
            if edtCOD_DC.text = qryChunggu.FieldByName('cod_dc').AsString then
            begin
               if (qryChunggu.FieldByName('suga_chgu').AsFloat <> valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value  <= 0) then
               begin
                  with qryU_Chunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '2';
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qryU_Chunggu, 'CK3I01', 'U', 'Y');
                  end;
               end
               else if (qryChunggu.FieldByName('suga_chgu').AsFloat <> valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value > 0) then
               begin
                  with qryU_Chunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '3';
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qryU_Chunggu, 'CK3I01', 'U', 'Y');
                  end;
               end
               else if (qryChunggu.FieldByName('suga_chgu').AsFloat = valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value > 0) then
               begin
                  with qryU_Chunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '3';
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qryU_Chunggu, 'CK3I01', 'U', 'Y');
                  end;
               end
               else if (qryChunggu.FieldByName('suga_chgu').AsFloat = valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value <= 0) then
               begin
                  with qryU_Chunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '2';
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qryU_Chunggu, 'CK3I01', 'U', 'Y');

                  end;
               end;
            end
            else if edtCOD_DC.text <> qryChunggu.FieldByName('cod_dc').AsString then
            begin
               vdat_ipkum  := ''; vsuga_ipkum := ''; vsuga_cash  := ''; vsuga_card  := ''; vgubn_ipkum := '';
               vgubn_ikht  := ''; vdat_insert := ''; vcod_insert := ''; vdat_update := ''; vcod_update := '';
               vCheck_ik   := False;

               with qryIpkum do
               begin
                    Active := False;
                    ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
                    ParamByName('DAT_CHGU').AsString  := mskDAT_GMGN.Text;
                    ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
                    Active := True;
               end;

               if qryIpkum.RecordCount > 0 then
               begin
                    vCheck_ik   := True;
                    vdat_ipkum  := qryIpkum.FieldByName('dat_ipkum').AsString;
                    vsuga_ipkum := qryIpkum.FieldByName('suga_ipkum').AsString;
                    vsuga_cash  := qryIpkum.FieldByName('suga_cash').AsString;
                    vsuga_card  := qryIpkum.FieldByName('suga_card').AsString;
                    vgubn_ipkum := qryIpkum.FieldByName('gubn_ipkum').AsString;
                    vgubn_ikht  := qryIpkum.FieldByName('gubn_ikht').AsString;
                    vdat_insert := qryIpkum.FieldByName('dat_insert').AsString;
                    vcod_insert := qryIpkum.FieldByName('cod_insert').AsString;
                    vdat_update := qryIpkum.FieldByName('dat_update').AsString;
                    vcod_update := qryIpkum.FieldByName('cod_update').AsString;

                    with qryD_Ipkum do
                    begin
                         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
                         ParamByName('DAT_CHGU').AsString  := mskDAT_GMGN.Text;
                         ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
                         ExecSql;
                         GP_query_log(qryD_Ipkum, 'CK3I01', 'D', 'Y');
                    end;
               end;
               qryIpkum.Active := False;

               if (qryChunggu.FieldByName('suga_chgu').AsFloat <> valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value  <= 0) then
               begin
                  with qry_UChunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '2';
                     ParamByName('cod_dc').AsString        := edtCOD_DC.Text;
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qry_UChunggu, 'CK3I01', 'U', 'Y');
                  end;
               end
               else if (qryChunggu.FieldByName('suga_chgu').AsFloat <> valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value > 0) then
               begin
                  with qry_UChunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '3';
                     ParamByName('cod_dc').AsString        := edtCOD_DC.Text;
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qry_UChunggu, 'CK3I01', 'U', 'Y');
                  end;
               end
               else if (qryChunggu.FieldByName('suga_chgu').AsFloat = valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value > 0) then
               begin
                  with qry_UChunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '3';
                     ParamByName('cod_dc').AsString        := edtCOD_DC.Text;
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qry_UChunggu, 'CK3I01', 'U', 'Y');
                  end;
               end
               else if (qryChunggu.FieldByName('suga_chgu').AsFloat = valSUGA_GIBD.Value)
                    and (valSUGA_GONGJE.Value <= 0) then
               begin
                  with qry_UChunggu do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('dat_gmgn').AsString      := mskDat_gmgn.Text;
                     ParamByName('suga_chgu').AsFloat      := valSUGA_GIBD.Value;
                     ParamByName('gubn_chdc').AsString     := '2';
                     ParamByName('cod_dc').AsString        := edtCOD_DC.Text;
                     ParamByName('cod_saler').AsString     := copy(cmbCOD_SALER.Text,1,6);

                     Execsql;
                     GP_query_log(qry_UChunggu, 'CK3I01', 'U', 'Y');
                  end;
               end;

               if vCheck_ik = true then
               begin
                  with qryI_Ipkum do
                  begin
                     ParamByName('cod_jisa').AsString      := Copy(frmCK3I01.cmbCOD_JISA.Text, 1, 2);
                     ParamByName('dat_chgu').AsString      := mskDAT_GMGN.Text;
                     ParamByName('cod_dc').AsString        := edtCOD_DC.Text;
                     ParamByName('num_jumin').AsString     := mskNum_jumin.Text;
                     ParamByName('gubn_chgu').AsString     := '3';
                     ParamByName('dat_ipkum').AsString     := vdat_ipkum;
                     ParamByName('suga_ipkum').AsString    := vsuga_ipkum;
                     ParamByName('suga_cash').AsString     := vsuga_cash;
                     ParamByName('suga_card').AsString     := vsuga_card;
                     ParamByName('gubn_ipkum').AsString    := vgubn_ipkum;
                     ParamByName('gubn_ikht').AsString     := vgubn_ikht;
                     ParamByName('dat_insert').AsString    := vdat_insert;
                     ParamByName('cod_insert').AsString    := vcod_insert;
                     ParamByName('dat_update').AsString    := vdat_update;
                     ParamByName('cod_update').AsString    := vcod_update;

                     Execsql;
                     GP_query_log(qryI_Ipkum, 'CK3I01', 'I', 'Y');
                  end;
               end;
            end;
         end;
         qryChunggu.Active := False;

         with qryU_Munjin do
         begin
            ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            ParamByName('NUM_ID').AsString      := UV_sNum_id;

            if ckYSNO_DRINKY.Checked  = True then
               ParamByName('YSNO_DRINK').AsString := 'Y'
            else if ckYSNO_DRINKN.Checked  = True then
               ParamByName('YSNO_DRINK').AsString := 'N'
            else
               ParamByName('YSNO_DRINK').AsString := '';

            if ckYSNO_SMOKEY.Checked  = True then
               ParamByName('YSNO_SMOKE').AsString := 'Y'
            else if ckYSNO_SMOKEN.Checked  = True then
               ParamByName('YSNO_SMOKE').AsString := 'N'
            else
               ParamByName('YSNO_SMOKE').AsString := '';

            if ckYSNO_YSHUY.Checked  = True then
               ParamByName('YSNO_YSHU').AsString := 'Y'
            else if ckYSNO_YSHUN.Checked  = True then
               ParamByName('YSNO_YSHU').AsString := 'N'
            else
               ParamByName('YSNO_YSHU').AsString := '';

            ParamByName('DESC_KGBL').AsString   := sDesc_kgbl;
            ParamByName('DAT_UPDATE').AsString  := GV_sToday;
            ParamByName('COD_UPDATE').AsString  := GV_sUserId;

            Execsql;
            GP_query_log(qryU_Munjin, 'CK3I01', 'U', 'Y');
         end;

         //[2108.05.16-유동구]향정 처방전 식별유형 저장..
         //---------------------------------------------------------------------
         if (Trim(cmbPat_id_type.Text) <> '') and (Trim(edtPat_Id.Text) <> '') then
         begin
            //---------------------------------------------------------------------
            with qryPerson_IDType do
            begin
               Active := False;
               ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('num_id').AsString    := UV_sNum_id;
               ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
               Active := True;

               if RecordCount > 0 then
               begin
                  with qryU_Person_IDType do
                  begin
                     ParamByName('Cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                     ParamByName('Num_id').AsString      := UV_sNum_id;
                     ParamByName('Dat_gmgn').AsString    := mskDAT_GMGN.Text;
                     ParamByName('Pat_id_type').AsString := copy(cmbPat_id_type.Text,1,1);
                     ParamByName('Pat_id').AsString      := edtPat_Id.Text;
                     ParamByName('Cod_update').AsString  := GV_sUserId;

                     Execsql;
                     GP_query_log(qryU_Person_IDType, 'CK3I01', 'U', 'Y');
                  end;
               end
               else
               begin
                   with qryI_Person_IDType do
                   begin
                      ParamByName('Cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                      ParamByName('Num_id').AsString      := UV_sNum_id;
                      ParamByName('Dat_gmgn').AsString    := mskDAT_GMGN.Text;
                      ParamByName('Pat_id_type').AsString := copy(cmbPat_id_type.Text,1,1);
                      ParamByName('Pat_id').AsString      := edtPat_Id.Text;
                      ParamByName('Cod_insert').AsString  := GV_sUserId;

                      Execsql;
                      GP_query_log(qryI_Person_IDType, 'CK3I01', 'I', 'Y');
                   end;
               end;

               Active := False;
            end;
         end;
         //=====================================================================

         with qryU_Kicho do
         begin
            ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
            ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            ParamByName('NUM_ID').AsString      := UV_sNum_id;
            ParamByName('SINJANG').AsFloat      := valSINJANG.Value;
            ParamByName('CHEJUNG').AsFloat      := valCHEJUNG.Value;
            ParamByName('BIMAN').AsFloat        := valBIMAN.Value;
            ParamByName('HUL_H').AsFloat        := valHUL_H.Value;
            ParamByName('HUL_L').AsFloat        := valHUL_L.Value;
            ParamByName('EAR_LEFT10').AsFloat    := valEAR_LEFT10.Value;
            ParamByName('EAR_RIGHT10').AsFloat   := valEAR_RIGHT10.Value;
            if vip.checked = true then
               ParamByName('ysno_label').AsString := 'Y'
            else
               ParamByname('ysno_label').AsSTring := 'N';

            ParamByName('DAT_UPDATE').AsString  := GV_sToday;
            ParamByName('COD_UPDATE').AsString  := GV_sUserId;

            Execsql;
            GP_query_log(qryU_Kicho, 'CK3I01', 'U', 'Y');
         end;

         if ckEYE1.Checked  = True then
         begin
            with qryU_Kicho_EYE_MAN do
            begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('NUM_ID').AsString      := UV_sNum_id;

               ParamByName('EYE_LMAN').AsFloat     := valEYE_LMAN.Value;
               ParamByName('EYE_RMAN').AsFloat     := valEYE_RMAN.Value;

               ParamByName('DAT_UPDATE').AsString  := GV_sToday;
               ParamByName('COD_UPDATE').AsString  := GV_sUserId;

               Execsql;
               GP_query_log(qryU_Kicho_EYE_MAN, 'CK3I01', 'U', 'Y');
            end;
         end
         else if ckEYE2.Checked = True then
         begin
            with qryU_Kicho_EYE_KYO do
            begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               ParamByName('NUM_ID').AsString      := UV_sNum_id;

               ParamByName('EYE_LKYO').AsFloat     := valEYE_LMAN.Value;
               ParamByName('EYE_RKYO').AsFloat     := valEYE_RMAN.Value;

               ParamByName('DAT_UPDATE').AsString  := GV_sToday;
               ParamByName('COD_UPDATE').AsString  := GV_sUserId;

               Execsql;
               GP_query_log(qryU_Kicho_EYE_KYO, 'CK3I01', 'U', 'Y');
            end;
         end;

         //무료검진관련
          freechk := false;
          for j := 1 to grdCOD_CHUGA.Rows do
          begin
               if grdCOD_CHUGA.Cell[4, j] = 1 then
               begin
                    freechk := true;
                    break;
               end;
          end;

         if (Check_free1.Checked = true) or (Check_free2.Checked = true) or (Check_free3.Checked = true) or (freechk = true) or
            (Copy(cmbBohm.Text, 1, 1) = '3') or (Copy(cmbBohm.Text, 1, 1) = '4') or (Copy(cmbBohm.Text, 1, 1) = '5') or (MEdt_No.text <> '') then
         begin
             qryFree.Active := False;
             qryFree.ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
             qryFree.ParamByName('Num_id').AsString    := UV_sNum_id;
             qryFree.ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
             qryFree.Active := True;
             if (qryFree.RecordCount = 0)then
             begin
                  with qryI_Free do
                  begin
                       ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                       ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                       ParamByName('NUM_ID').AsString      := UV_sNum_id;

                       if Check_free1.Checked = true then
                          ParamByName('COD_JANGBI').AsString  := edtCOD_JANGBI.Text
                       else if Check_free1.Checked = false then
                          ParamByName('COD_JANGBI').AsString  := '';

                       if Check_free2.Checked = true then
                          ParamByName('COD_HUL').AsString     := edtCOD_HUL.Text
                       else if Check_free2.Checked = false then
                          ParamByName('COD_HUL').AsString     := '';

                       if Check_free3.Checked = true then
                          ParamByName('COD_CANCER').AsString  := edtCOD_CANCER.Text
                       else if Check_free3.Checked = false then
                          ParamByName('COD_CANCER').AsString  := '';


                       // 추가코드에 무료검진이 존재하는지 Check
                       for i := 1 to grdCOD_CHUGA.Rows do
                       begin
                            if grdCOD_CHUGA.Cell[4, i] = 1 then
                            begin
                                 cCod_chuga :=  cCod_chuga + grdCOD_CHUGA.Cell[1, i];
                                 ParamByName('GUBN_FREE').AsString := '5';
                            end
                            else if grdCOD_CHUGA.Cell[4, i] = 0 then
                                 cCod_chuga := cCod_chuga + '';
                       end;
                       ParamByName('COD_CHUGA').AsString   := cCod_chuga;

                       if MEdt_No.text <> '' then
                       begin
                          ParamByName('GUBN_FREE').AsString := '1';
                          //ParamByName('num_coupon').AsString := MEdt_No.text;
                       end
                       else if Copy(cmbBohm.Text, 1, 1) = '3' then
                          ParamByName('GUBN_FREE').AsString := '2'
                       else if Copy(cmbBohm.Text, 1, 1) = '4' then
                          ParamByName('GUBN_FREE').AsString := '3'
                       else if Copy(cmbBohm.Text, 1, 1) = '5' then
                          ParamByName('GUBN_FREE').AsString := '4'
                       else if (Check_free1.Checked = true) or (Check_free2.Checked = true) or (Check_free3.Checked = true) then
                          ParamByName('GUBN_FREE').AsString := '5'
                       else
                          ParamByName('GUBN_FREE').AsString := '';

                       ParamByName('DAT_INSERT').AsString  := GV_sToday;
                       ParamByName('COD_INSERT').AsString  := GV_sUserId;

                       if ((MEdt_No.text <> '') or (Copy(cmbBohm.Text, 1, 1) = '3') or (Copy(cmbBohm.Text, 1, 1) = '4') or (Copy(cmbBohm.Text, 1, 1) = '5')
                          or (Check_free1.Checked = true) or (Check_free2.Checked = true)
                          or (Check_free3.Checked = true) or (cCod_chuga <>  '')) then
                             Execsql;
                      GP_query_log(qryI_Free, 'CK3I01', 'I', 'Y');
                 end;
             end
             else if qryFree.RecordCount > 0 then
             with qryU_Free do
             begin
                ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                ParamByName('NUM_ID').AsString      := UV_sNum_id;

                if Check_free1.Checked = true then
                   ParamByName('COD_JANGBI').AsString  := edtCOD_JANGBI.Text
                else if Check_free1.Checked = false then
                   ParamByName('COD_JANGBI').AsString  := '';

                if Check_free2.Checked = true then
                   ParamByName('COD_HUL').AsString     := edtCOD_HUL.Text
                else if Check_free2.Checked = false then
                   ParamByName('COD_HUL').AsString     := '';

                if Check_free3.Checked = true then
                   ParamByName('COD_CANCER').AsString  := edtCOD_CANCER.Text
                else if Check_free3.Checked = false then
                   ParamByName('COD_CANCER').AsString  := '';

                 // 추가코드에 무료검진이 존재하는지 Check
                 for i := 1 to grdCOD_CHUGA.Rows do
                 begin
                      if grdCOD_CHUGA.Cell[4, i] = 1 then
                      begin
                         cCod_chuga :=  cCod_chuga + grdCOD_CHUGA.Cell[1, i];
                         ParamByName('GUBN_FREE').AsString := '5';
                      end
                      else if grdCOD_CHUGA.Cell[4, i] = 0 then
                         cCod_chuga :=  cCod_chuga + '';
                 end;
                 ParamByName('COD_CHUGA').AsString   := cCod_chuga;

 {ji}           if MEdt_No.text <> '' then
                begin
                   ParamByName('GUBN_FREE').AsString := '1';
                   //ParamByName('num_coupon').AsString := MEdt_No.text;
                end;
                if Copy(cmbBohm.Text, 1, 1) = '3' then
                   ParamByName('GUBN_FREE').AsString := '2'
                else if Copy(cmbBohm.Text, 1, 1) = '4' then
                   ParamByName('GUBN_FREE').AsString := '3'
                else if Copy(cmbBohm.Text, 1, 1) = '5' then
                   ParamByName('GUBN_FREE').AsString := '4';
                if (Check_free1.Checked = true) or (Check_free2.Checked = true) or (Check_free3.Checked = true) then
                   ParamByName('GUBN_FREE').AsString := '5';

                ParamByName('DAT_UPDATE').AsString  := GV_sToday;
                ParamByName('COD_UPDATE').AsString  := GV_sUserId;

                Execsql;
                GP_query_log(qryU_Free, 'CK3I01', 'U', 'Y');
             end;
             qryFree.Active := False;
          end
          else if (Check_free1.Checked = false) and (Check_free2.Checked = false) and (Check_free3.Checked = false) and (freechk = false) and
            ((Copy(cmbBohm.Text, 1, 1) = '1') or (Copy(cmbBohm.Text, 1, 1) = '2')) and (MEdt_No.text = '') then
         begin
              with qryD_Free do
              begin
                 ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                 ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                 ParamByName('num_id').AsString      := UV_sNum_id;

                 Execsql;
                 GP_query_log(qryD_Free, 'CK3I01', 'D', 'Y');
              end;
         end;

  {       // 암검사관련 05.05.26
         if (trim(Gubn_jik.text) <> '') or (trim(Gubn_am.text) <> '') or (trim(bogun_kiho.text) <> '') then
         begin
            with qryCa_gubun do
            begin
               close;
               ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
               ParamByName('num_id').AsString   := UV_sNum_id;
               ParamByName('dat_gmgn').AsString := mskDat_gmgn.text;
               open;
               if recordcount > 0 then
               begin
                  with qryCa_update do
                  begin
                     close;
                     if trim(Gubn_jik.text) <> '' then ParamByName('gubn_jik').AsString := intTostr(gubn_jik.itemindex)
                     else                              ParamByName('gubn_jik').AsString := '';
                     if trim(Gubn_am.text)  <> '' then ParamByName('gubn_am').AsString  := intTostr(gubn_am.itemindex)
                     else                              ParamByName('gubn_am').AsString  := '';
                     ParamByName('bogun_kiho').AsString     := trim(bogun_kiho.text);
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     ParamByName('cod_update').AsString     := GV_sUserId;
                     ParamByName('dat_update').AsString     := GV_sToday;
                     execsql;
                     GP_query_log(qryCa_update, 'CK3I01', 'U', 'Y');
                  end;
               end else
               begin
                  with qryCa_insert do
                  begin
                     close;
                     if trim(Gubn_jik.text) <> '' then ParamByName('gubn_jik').AsString := intTostr(gubn_jik.itemindex)
                     else                              ParamByName('gubn_jik').AsString := '';
                     if trim(Gubn_am.text)  <> '' then ParamByName('gubn_am').AsString  := intTostr(gubn_am.itemindex)
                     else                              ParamByName('gubn_am').AsString  := '';
                     ParamByName('bogun_kiho').AsString     := trim(bogun_kiho.text);
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     ParamByName('cod_insert').AsString     := GV_sUserId;
                     ParamByName('dat_insert').AsString     := GV_sToday;
                     execsql;
                     GP_query_log(qryCa_insert, 'CK3I01', 'U', 'Y');
                  end;
               end;
               close;
            end;
         end;   }

         // 내원상담, 우편발송 추가
         if (rdNeawon.checked) or (rdPost.checked) or (rdHmpg.checked) or (rdEmail.checked) or (rdCompany.checked) or (rdMobile.checked) then
         begin
            with qrySangdam_Rev do
            begin
               close;
               ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
               ParamByName('num_id').AsString   := UV_sNum_id;
               ParamByName('dat_gmgn').AsString := mskDat_gmgn.text;
               open;
               if recordcount > 0 then
               begin
                  with qrySDupdate do
                  begin
                     close;
                     if rdNeawon.checked then    ParamByName('bang_suryung').AsString := '1'
                     else if rdPost.checked then
                     begin
                        if rdEmail.checked then ParamByName('bang_suryung').AsString := '5'
                        //홈페이지 + 우편 => 7
                        else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '7'
                        //우편 + 회사전달 => 8
                        else if rdCompany.checked then ParamByName('bang_suryung').AsString := '8'                                                
                        else ParamByName('bang_suryung').AsString := '2';
                     end
                     else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '3'
                     else if rdEmail.checked then ParamByName('bang_suryung').AsString := '4'
                     else if rdCompany.checked then ParamByName('bang_suryung').AsString := '6'
                     else if rdMobile.checked then ParamByName('bang_suryung').AsString := '9';
                     if rdNeawon.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := trim(mskNeawon.text);
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdPost.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := trim(mskPost.Text);
                        if rdCompany.checked then
                          ParamByName('dat_company').AsString := trim(mskCompany.Text)
                        else
                          ParamByName('dat_company').AsString    := '';
                     end
                     else if rdHmpg.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdEmail.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdCompany.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := Trim(mskCompany.Text);
                     end
                     else if rdMobile.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end;
                     ParamByName('cod_update').AsString     := GV_sUserId;
                     ParamByName('dat_update').AsString     := GV_sToday;
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     execsql;
                     GP_query_log(qrySDupdate, 'CK3I01', 'U', 'Y');
                  end;
               end else
               begin
                  with qrySDinsert do
                  begin
                     close;
                     ParamByName('cod_jisa').AsString       := copy(cmbCod_jisa.text,1,2);
                     ParamByName('num_id').AsString         := UV_sNum_id;
                     ParamByName('dat_gmgn').AsString       := mskDat_gmgn.text;
                     if rdNeawon.checked then    ParamByName('bang_suryung').AsString := '1'
                     else if rdPost.checked then
                     begin
                        if rdEmail.checked then ParamByName('bang_suryung').AsString := '5'
                        //홈페이지 + 우편 => 7
                        else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '7'
                        //우편 + 회사전달 => 8
                        else if rdCompany.checked then ParamByName('bang_suryung').AsString := '8'                                                
                        else ParamByName('bang_suryung').AsString := '2';
                     end
                     else if rdHmpg.checked then ParamByName('bang_suryung').AsString := '3'
                     else if rdEmail.checked then ParamByName('bang_suryung').AsString := '4'
                     else if rdCompany.checked then ParamByName('bang_suryung').AsString := '6'
                     else if rdMobile.checked then ParamByName('bang_suryung').AsString := '9';

                     if rdNeawon.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := trim(mskNeawon.text);
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdPost.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := trim(mskPost.Text);
                        if rdCompany.checked then
                          ParamByName('dat_company').AsString := trim(mskCompany.Text)
                        else
                          ParamByName('dat_company').AsString    := '';
                     end
                     else if rdHmpg.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdEmail.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end
                     else if rdCompany.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := Trim(mskCompany.Text);
                     end
                     else if rdMobile.checked then
                     begin
                        ParamByName('dat_sangdamRev').AsString := '';
                        ParamByName('dat_balsong').AsString    := '';
                        ParamByName('dat_company').AsString    := '';
                     end;
                     ParamByName('dat_insert').AsString     := GV_sToday;
                     ParamByName('cod_insert').AsString     := GV_sUserId;
                     ParamByName('dat_update').AsString     := '';
                     ParamByName('cod_update').AsString     := '';
                     execsql;
                     GP_query_log(qrySDinsert, 'CK3I01', 'U', 'Y');
                   end;
               end;
               close;
            end;
         end
//2011.08.01 철. 내원상담,우편발송,이메일발송,홈페이지조회 체크빼면 Sangdam_Rev 삭제되도록.(요기)
         else
         begin
            with qrySangdam_Rev do
            begin
               close;
               ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
               ParamByName('num_id').AsString   := UV_sNum_id;
               ParamByName('dat_gmgn').AsString := mskDat_gmgn.text;
               open;
               if recordcount > 0 then
               begin
                  with qrySDdelete do
                  begin
                     ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
                     ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
                     ParamByName('NUM_ID').AsString    := UV_sNum_id;
                     ExecSql;
                     GP_query_log(qrySDdelete, 'CK3I01', 'D', 'Y');
                  end;
               end;
            end;
         end;

         qryHul_Condition.Active := False;
         qryHul_Condition.ParamByName('cod_jisa').AsString := Copy(cmbCod_jisa.Text, 1, 2);
         qryHul_Condition.ParamByName('num_id').AsString   := UV_sNum_id;
         qryHul_Condition.ParamByName('dat_gmgn').AsString := mskDAT_GMGN.Text;
         qryHul_Condition.Active := True;
         if qryHul_Condition.RecordCount = 0 then
         begin
            if HUL_Check.Checked  = True then
            begin
               with qryI_HCondition do
               begin
                  ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
                  ParamByName('NUM_ID').AsString      := UV_sNum_id;
                  ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
                  ParamByName('HUL_CK').AsString      := 'Y';
                  ParamByName('DAT_INSERT').AsString  := GV_sToday;
                  ParamByName('COD_INSERT').AsString  := GV_sUserId;
                  Execsql;
                  GP_query_log(qryI_HCondition, 'CK3I01', 'I', 'Y');
               end;
            end;
         end
         else if qryHul_Condition.RecordCount > 0 then
         begin
            with qryU_HCondition do
            begin
               ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
               ParamByName('NUM_ID').AsString      := UV_sNum_id;
               ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
               if HUL_Check.Checked  = True then
                     ParamByName('HUL_CK').AsString := 'Y'
               else  ParamByName('HUL_CK').AsString := 'N';
               ParamByName('DAT_UPDATE').AsString  := GV_sToday;
               ParamByName('COD_UPDATE').AsString  := GV_sUserId;
               Execsql;
               GP_query_log(qryU_HCondition, 'CK3I01', 'U', 'Y');
            end;
         end;
         qryHul_Condition.Active := False;
      end;
   except
      on E : EDBEngineError do
      begin
         GF_MsgBox('Error', IntToStr(E.Errors[1].NativeError));
         dmComm.database.Rollback;
         exit;
      end;
   end;

   dmComm.database.Commit;

   UV_sDesc_Coupon := ''; UV_sDesc_Coupon_etc := '';

   Cmb_Print.Font.Color := ClBlack;
   Cmb_Print.ItemIndex := Cmb_Print.ItemIndex; //색깔 변경후 보이게 하기 위해..
   edtDESC_NAME.SetFocus;

   // Save Mode & Msg
   UP_SetMode('SAVE');

   Result := True;
end;

procedure TfrmCK3I01.UP_ChugaSugaCount;
var i : Integer;
begin
   valSUM.Value := 0;

   for i := 1 to grdCOD_CHUGA.Rows do
      valSUM.Value := valSUM.Value + UV_vSuga_kmi[i-1];
end;

procedure TfrmCK3I01.btnInsertClick(Sender: TObject);
begin
   inherited;
   UV_sDesc_Coupon := ''; UV_sDesc_Coupon_etc := '';   UV_sGubn_PySeq := '';
   UV_sGubn_PyYh := '';   UV_sSel_hm := '';            UV_sAdd_hm := '';
   UV_sNum_seq   := '';   UV_sGubn_reser := '';        UV_sYsno_munjin := '';  UV_sYear := '';
   C078_Check    := False;   S021_Check  := False;   C088_Check := False;  C089_Check := False;   S079_Check := False;  S090_Check := False;
   Chk_hul := False ; Chk_hul2 := False ; bSaler := False;  chk_jindan := False;
   UV_sYsno_gocg := '';

   //[2018.05.16-유동구]향정처방전 식별번호 등록 초기화..
   cmbPat_id_type.ItemIndex := -1;
   edtPat_Id.Text := '';

   mskNUM_JUMIN.ReadOnly := False;
   SDcheck := false;
   Magam_Check :=false;

   Btn_Complain.Enabled := False;

   Chk_New_Add.checked := false;

   //[2017.10.23-유동구]동명이인 체크 초기화..
   ChkBoxOverlap.checked := false;

   //mskDAT_GMGN.SetFocus;

   Chuga_Check :=True;;
   
   //검사항목금액 Clear
   UV_SugaA1 := 0;
   UV_SugaA2 := 0;
   UV_SugaA3 := 0;
   UV_SugaA4 := 0;
   UV_SugaA5 := 0;
   UV_SugaA6 := 0;
   UV_Suga1  := 0;
   UV_Suga2  := 0;
   UV_Suga3  := 0;
   UV_Suga4  := 0;
   UV_Suga5  := 0;
   UV_Suga6  := 0;
   UV_Suga7  := 0;

   UV_GubnA1 := '';
   UV_GubnA2 := '';
   UV_GubnA3 := '';
   UV_GubnA4 := '';
   UV_GubnA5 := '';
   UV_GubnA6 := '';
   UV_GubnA7 := '';

   rdNeawon.checked := false;
   rdPost.checked   := false;
   rdHmpg.checked   := false;
   rdEmail.checked  := false;
   rdCompany.checked  := false;
   rdMobile.checked   := false;
   CK_Sod_Citrate.checked  := false;
   mskNeawon.text   := '';
   mskPost.text     := '';
   mskCompany.Text  := '';
   MEdt_No.text     := '';
   Edt_email.text   := '';  
   cmbGUBN_GONG.text := '';
   cmbGUBN_GOCG.text := '';
   ysno_nosin       := 'N';
   ysno_gibd        := 'N';

   // 선등록 체크 초기화...
   UV_sGubn_nosin := ''; UV_sGubn_Cancer := ''; Gubn_Label.Caption := '조합구분표시';

   // Complain 초기화
   mskJumin.Color := $00E6FFFE; mskNUM_JUMIN.Color := $00E6FFFE;
   Timer1.Interval := 0;

   //응급체크 초기화
   HUL_Check.Checked := False;

   //쿠폰체크 초기화
   UV_bCouponChk := False;

   //입금체크 초기화
   UV_Check_ipkm := True;
   UV_sPRStatus := 'N';

   // Field Clear & 첫번째 Field Focus
   UV_sGubn_neawon := Copy(cmbGUBN_NEAWON.Text, 1, 1);
//   pnlDetail.Enabled := True;

   cmbCOD_JISA.Enabled    := True;
   btnDelete.Enabled      := True;
   mskDAT_GMGN.Enabled    := True;
   edtCOD_JANGBI.Enabled  := True;
   edtCOD_HUL.Enabled     := True;
   edtCOD_CANCER.Enabled  := True;
   btnHm_insert.Enabled   := True;
   btnHm_delete.Enabled   := True;
   cmbGUBN_NOSIN.Enabled  := True;
   cmbGUBN_TKGM.Enabled   := True;
   cmbGUBN_BOGUN.Enabled  := True;
   cmbGUBN_ADULT.Enabled  := True;

   //[2018.05.07-유동구]특정암 분주생성 시 선택불가로 변경..(김창규 팀장 요청)
   //간암 진행 시 혈액검사가 존재
   //---------------------------------------------------------------------------
   cmbGUBN_GONG.Enabled   := True;
   cmbGUBN_GOCG.Enabled   := True;
   //===========================================================================

   cmbGUBN_AGAB.Enabled   := True;
   cmbGUBN_NSCG.Enabled   := True;
   cmbGUBN_TKCG.Enabled   := True;
   cmbGUBN_BGCG.Enabled   := True;
   cmbGUBN_ADCG.Enabled   := True;
   cmbGUBN_AGCG.Enabled   := True;
   cmbGUBN_LIFE.Enabled   := True;
   cmbGUBN_LFCG.Enabled   := True;
   valSUGA_DANCHE.Enabled := True;
   valSUGA_GIBD.Enabled   := True;
   valSUGA_GONGJE.Enabled := True;
   valSUGA_JOHAP.Enabled  := True;
   valSUGA_TOT.Enabled    := False;
   valYUL_MCIJ.Enabled    := True;
   btnSugum.Enabled       := True;
   cmbCOD_SALER.Enabled   := True;
   edtCOD_DC.Enabled      := True;
   btnCOD_DC.Enabled      := True;
   btnDAT_GMGN.Enabled    := True;
   btnPInsert.Enabled     := True;
   rdgGubn_Hulgum.Enabled := True;
   cmbGUBN_NEAWON.Enabled := True;
   mskNUM_JUMIN.Enabled   := True;
   edtNUM_SAMP.Enabled    := True;
   Com_BD.Enabled         := True;
   SBtn_PreRegister.Enabled := True;
   btnCOD_JANGBI.Enabled  := True;
   btnCOD_HUL.Enabled     := True;
   btnCOD_CANCER.Enabled  := True;
   btnCOD_CHUGA.Enabled   := True;
   CkBox_Jumin.Enabled    := True;
   cmbBohm.Enabled        := True;
   CK_Breastfeed.Enabled  := True;
   CK_Period.Enabled      := True;
   CK_Breastfeed.Checked  := False;
   CK_Period.Checked      := False;
   CK_Partner.Enabled     := True;
   CK_Partner.Checked     := False;
   CK_Urin.Enabled        := True;
   CK_Urin.Checked        := False;
   CK_Blood.Enabled       := True;
   CK_Blood.Checked       := False;
   CK_Trust_company.Enabled  := True;
   CK_Trust_company.Checked  := False;
   CK_Pacs.Enabled        := True;
   CK_Pacs.Checked        := False;
   Ck_Gongdan_Chgu.Enabled := True;
   CK_Pacs.Checked        := False;

   Chk_ysno_useinfo.Checked  := True;         //개인정보활용동의
   Chk_ysno_Homepage.Checked := True;         //온라인결과조회 동의
   CK_Gongdan_Chgu.Checked   := False;        //공단청구동의
   Ck_ysno_result_Use.Checked := False;       //결과활용동의
   Chk_Ysno_company.checked := False;
   CK_Trust_company.checked := False;
   Ck_Ysno_SMS_Agreement.Checked    := False;         //SMS 서비스 동의

   grdMaster.visible      := False;
//   HUL_Check.Enabled      := True;

   Lb_1cha.Caption := '';
   Lb_UA.Caption   := '';
   Lb_DJA.Caption  := '';
   Lb_GA.Caption   := '';
   Lb_UBA.Caption  := '';
   Lb_JGA.Caption  := '';
   Ck_1cha.Checked := False;
   Ck_UA.Checked   := False;
   Ck_DJA.Checked  := False;
   Ck_GA.Checked   := False;
   Ck_UBA.Checked  := False;
   Ck_JGA.Checked  := False;

   //특정암 미청구 관련
    Ysno_UA.Checked  := False;
    Ysno_DJA.Checked := False;
    Ysno_GA.Checked  := False;
    Ysno_UBA.Checked := False;
    Ysno_JGA.Checked := False;
    edt_Ysno_gocg.text := '';


   GP_FieldClear(pnlDetail);
   cmbBohm.ItemIndex := 0;
   Cmb_Print.Font.Color := ClRed;   
   Cmb_Print.ItemIndex := 0;
   //금연연구
   Panel_yeonse.Visible := False;
   Panel_yeonse.Caption := '';
   Label9.Caption  := '';
   Label10.Caption := '';    

   //임신 초기화
   ckGUBN_PREG.Enabled := True;
   ckGUBN_PREG2.Enabled := True;
   ckGUBN_PREG.Checked := False;
   ckGUBN_PREG2.Checked := False;


   // ji 03.06.13 안양지사만 주민번호체크버튼 마지막상태로 유지..
   if GV_sJisa = '45' then
   begin
      if CkBox_Jumin.Checked = true then
         CkBox_Jumin.checked := true
      else
         CkBox_Jumin.checked := False;
   end
   else
      CkBox_Jumin.Checked := True;

   {YDG[2006.01.02]-센터구분 및 층구분}
   Com_BD.ItemIndex := GP_SawonCheck(Com_BD, GV_sUserId);
   
   //한의 부산진행파트 1500286 - 부산층수 고정
   If Copy(GV_sUserId,1,2) = '61' Then
      Begin
         Com_BD.ItemIndex := 12;
      End;

   if (GV_sJisa = '00') or (GV_sJisa = '15') or (GV_sJisa = '11') or (GV_sJisa = '12') or (GV_sJisa = '61') or (GV_sJisa = '43') or (GV_sJisa = '51') then
      Com_BD.Enabled     := True
   else
      Com_BD.Enabled     := False;

   // 초기값 설정
   mskDAT_GMGN.Text := GV_sToday;    // 검진예정일은 오늘일자
   valYUL_MCIJ.Value := 100;         // 매출인정율 100%
   UV_sNum_id := '';
   Pnl_ID.Caption := '';
   Panel94.Caption := '';
   ckEYE1.Checked := True;
   GP_ComboDisplay(cmbGUBN_NEAWON, UV_sGubn_neawon, 1);

   // Focus
   mskDAT_GMGN.Enabled := True;
//   btnDAT_GMGN.Enabled := True;
//   btnCOD_DC.Enabled   := True;

   //단체검진품의서의 유형 Clear
   sGmgn := '';
   sDesc_Gmgn := '';
   iSeq  := 0;

   if GV_sJisa = '00' then
   begin
      cmbCOD_JISA.Enabled := True;
      GP_ComboDisplay(cmbCOD_JISA, copy(GV_sUserId,1,2), 2);
      cmbCOD_JISA.SetFocus;
   end
   else
   begin
      cmbCOD_JISA.Enabled := False;
      GP_ComboDisplay(cmbCOD_JISA, GV_sJisa, 2);
      mskDAT_GMGN.SetFocus;
   end;

   //오늘 일자 Setting
   mskDAT_GMGN.Text := GV_sToday;
   cmb_email.Itemindex :=0;


   // [본원-연구소,센터-연구소+센터] 혈액 구분
   if copy(cmbCOD_JISA.Text,1,2) = '15' then rdgGubn_Hulgum.itemindex := 0
   else                                      rdgGubn_Hulgum.itemindex := 2;

   // Insert Mode & Msg
   UP_ChugaVarMemSet(0);
   UP_SetMode('INSERT');
end;

procedure TfrmCK3I01.btnSaveClick(Sender: TObject);
var i, Age ,iAge: integer;
    iRet, j : Integer;
    vCod_chuga : variant;
    sMan, sCod_chuga :String;
begin
   inherited;
   if (length(mskNUM_JUMIN.Text) < 13)
   or (pos('*',mskNUM_JUMIN.Text) > 0)
   or (pos('-',mskNUM_JUMIN.Text) > 0) then
   begin
      showmessage('주민번호를 확인해 주세요');
      mskNUM_JUMIN.SetFocus;
      exit;
   end;

   if UV_sYsno_gocg <> Copy(edt_Ysno_gocg.Text, 1, pos('-', edt_Ysno_gocg.Text)-1) then
   begin
      UV_sYsno_gocg := Copy(edt_Ysno_gocg.Text, 1, pos('-', edt_Ysno_gocg.Text)-1);
      showmessage('특정암 미청구 항목이 변경됐습니다.'  + #13#13 + 'DSMS를 재조회 해주시기 바랍니다.');
   end;

   if (Trim(edtCOD_HUL.Text)<>'') and (GF_Hangmok_Sex('1', Trim(edtCOD_HUL.Text), mskNUM_JUMIN.text[7])) then
   begin
       if MessageDlg('혈액코드('+ Trim(edtCOD_HUL.Text) +') 검사항목 중 성별이 다른 항목코드가 있습니다. 계속 진행하시겠습니까?', mtInformation, [mbYes, mbNo], 0) <> mrYes Then exit;
   end;

   if (Trim(edtCOD_CANCER.Text)<>'') and (GF_Hangmok_Sex('1', Trim(edtCOD_CANCER.Text), mskNUM_JUMIN.text[7])) then
   begin
       if MessageDlg('종양코드('+ Trim(edtCOD_CANCER.Text) +') 검사항목 중 성별이 다른 항목코드가 있습니다. 계속 진행하시겠습니까?', mtInformation, [mbYes, mbNo], 0) <> mrYes Then exit;
   end;

   for i := 1 to grdCod_CHUGA.Rows do
   begin
       //[2018.05.16-유동구]향정 처방전 식별유형 미 입력된 자료 체크...
       //-----------------------------------------------------------------------
       if ((Trim(grdCOD_CHUGA.Cell[1,i]) = 'JJB9') or (Trim(grdCOD_CHUGA.Cell[1,i]) = 'JJ86')) and
          ((Trim(cmbPat_id_type.Text)    = ''    ) or (Trim(edtPat_Id.Text)         = ''    )) and
          ((copy(mskNUM_JUMIN.Text,7,1)  = '7'   ) or (copy(mskNUM_JUMIN.Text,7,1)  = '8'   )) then
       begin
          showmessage('외국인은 [향정]처방전에 환자식별번호가 등록 되어야 합니다.' + #13#10 +
                      '[여권번호 등]을 입력 후 다시 저장해주세요.');
          exit;
       end;
       //=======================================================================

       //한의 광주검진사업지원팀1700828
       if (edtCOD_DC.Text = '513192') and (Trim(grdCOD_CHUGA.Cell[1,i]) = 'JJIF')
           and ((edtDESC_ADDR.Text <> '') or (mskNUM_POST.Text <> '') or (rdEmail.Checked = True) or (rdHmpg.Checked = True) or (rdMobile.Checked = True))then
       begin
          showmessage('개인결과 개별발송 불가 코드가 있습니다. 주소 또는 발송구분을 확인 후 다시 저장해주세요.');
          exit;
       end;

       if GF_Hangmok_Sex('2', Trim(grdCOD_CHUGA.Cell[1,i]), mskNUM_JUMIN.text[7]) then
       begin
           if MessageDlg('검사추가항목 중 성별이 다른 항목코드('+Trim(grdCOD_CHUGA.Cell[1,i])+')가 있습니다. 계속 진행하시겠습니까?', mtInformation, [mbYes, mbNo], 0) <> mrYes Then
           begin
             exit;
           end;
           //Break;
       end;
   end;

   //한의 재단검진사업관리팀장1600112 2016.12.28
   if  (edtCOD_DC.text  = '920000') and (edtNUM_SABUN.text = '') then
   begin
      showmessage('우수고객신청번호를 입력하세요');
      edtNUM_SABUN.SetFocus;
      exit;
   end;

   //한의 재단검진사업관리팀장1600112 2017.01.07
   if  (edtCOD_DC.text  = '920000') and (Copy(cmbCOD_SALER.Text, 1, 6) = '159999') and (bSaler = False) then
   begin
      showmessage('신청영업사원코드를 입력해주세요!');
      bSaler := True;
      cmbCOD_SALER.SetFocus;
      exit;
   end;

   i := 0;
   // 이메일주소가 맞게 들어갔는지 확인.
   if rdEmail.Checked then
   begin
      if (Edt_email.Text = '') OR (pos('@', Edt_email.Text) = 0) OR (pos('.', Edt_email.Text) = 0) then
      begin
         GF_MsgBox('Information', 'E-mail주소를 확인하시기 바랍니다..!!');
         Edt_email.SetFocus;
         exit;
      end;
   end;

   // 접수시 배송선택 여러가지 선택할 경우 제어.
   if rdNeawon.Checked then i := i + 1;
   if rdPost.Checked   then i := i + 1;
   if rdEmail.Checked  then i := i + 1;
   if rdHmpg.Checked   then i := i + 1;
   if rdMobile.Checked   then i := i + 1;
   if rdCompany.Checked   then i := i + 1;
   if i > 2 then
   begin
      if not((rdPost.Checked) AND (rdEmail.Checked) AND (rdCompany.Checked) AND (rdNeawon.Checked = False) AND (rdHmpg.Checked = False)AND (rdMobile.Checked = False)) then
      begin
         GF_MsgBox('Information', '배송선택이 잘못 되었습니다.');
         rdNeawon.SetFocus;
         exit;
      end;
   end;

{
   if (Copy(mskNUM_JUMIN.Text,7,1) = '3') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') then
      Age := StrToInt(Copy(mskDAT_GMGN.Text, 1, 4)) - StrToint('20' + Copy(mskNUM_JUMIN.Text, 1, 2))
   else
      Age := StrToint(Copy(mskDAT_GMGN.Text, 1, 4)) - StrToInt('19' + Copy(mskNUM_JUMIN.Text, 1, 2));
      }
  GP_JuminToAge(mskNUM_JUMIN.Text,mskDAT_GMGN.Text, sMan, iAge);
//  Age := iAge;

   //13.02.14 철. 생애대상자 여부는 월별계산해서는 안됨. 생일여부와 관계없이 해당년인지만 체크함.
   if (Copy(mskNUM_JUMIN.Text,7,1) = '3') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') then
      Age := StrToInt(Copy(mskDAT_GMGN.Text,1,4)) - StrToInt('20' + Copy(mskNUM_JUMIN.Text,1,2))
   else
      Age := StrToInt(Copy(mskDAT_GMGN.Text,1,4)) - StrToInt('19' + Copy(mskNUM_JUMIN.Text,1,2));

   if (StrToInt(mskDAT_GMGN.Text) >= 20070101) AND (StrToInt(mskDAT_GMGN.Text) <= 20071231) AND ((Age = 40) or (Age = 66)) then
   begin
      if (cmbGUBN_NOSIN.ItemIndex = 1) or ((cmbGUBN_NOSIN.ItemIndex = 2) and (Copy(mskDAT_GMGN.Text,5,2) <> '01')) or
         (cmbGUBN_ADULT.ItemIndex = 1) or ((cmbGUBN_ADULT.ItemIndex = 2) and (Copy(mskDAT_GMGN.Text,5,2) <> '01')) then
      begin
         Showmessage('생애전환기 대상자 입니다. 생애전환기로 접수하시기 바랍니다.');
         exit;
      end;
   end;
   if (StrToInt(mskDAT_GMGN.Text) >= 20070101) AND ((Age <> 40) and (Age <> 66)) and (Copy(mskDAT_GMGN.Text,5,2) <> '01') then
   begin
      if (cmbGUBN_LIFE.ItemIndex = 1) or (cmbGUBN_LIFE.ItemIndex = 2)  then
      begin
         Showmessage('생애전환기 대상자 아닙니다.! ');

      end;
   end;
                  
   if (StrToInt(mskDAT_GMGN.Text) >= 20180101) AND (Age >= 66) then
   begin
      if (cmbGUBN_NOSIN.ItemIndex = 1) or (cmbGUBN_ADULT.ItemIndex = 1) or (cmbGUBN_LIFE.ItemIndex = 1) then
      begin
         Showmessage('66세 이상부터는 의료급여 생애 대상자일수 있습니다. '+#13+'공단 홈페이지 확인 후 재 저장 해주시기 바랍니다!!');
      end;
   end;

   //20160719.. 센터 순수노신 접수시 혈검을 센터 ..박연숙 팀장 요청  ---------------------------------------------------------------------------------
   Chk_hul  := False;   //장비
   Chk_hul2 := False;   //추가코드

    //장비 프로파일 확인
      if edtCOD_JANGBI.Text <> '' then
           begin
              qryPf_hm.Active := False;
              qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
              qryPf_hm.Active := True;
              if qryPf_hm.RecordCount > 0 then
              begin
                 while not qryPf_hm.Eof do
                 begin
                    if copy(qryPf_hm.FieldByName('COD_HM').AsString,1,2) <> 'JJ' then
                       Chk_hul :=  True;
                       qryPf_hm.Next;
                 end;
              end;
              qryPf_hm.Active := False;
           end;
     //코드 추가 부분 확인
      sCod_chuga := GF_GridToSingle(grdCod_Chuga);
      if sCod_chuga <> '' then
        begin
          iRet := GF_MulToSingle(sCod_chuga, 4, vCod_chuga);
          for i := 0 to iRet-1 do
          begin
           if  (copy(vCod_chuga[i],1,2) <> 'JJ') then Chk_hul2 := True;
          end;
        end;

   if (StrToInt(mskDAT_GMGN.Text) >= 20160719) AND (GV_sJisa <> '15') and
       (((cmbGUBN_NOSIN.ItemIndex = 1) and (copy(edtGUBN_NSYH.text, 1,  pos('-', edtGUBN_NSYH.Text)-1) <> '11')) or
       ((cmbGUBN_ADULT.ItemIndex = 1) and  (copy(edtGUBN_ADYH.text, 1,  pos('-', edtGUBN_ADYH.Text)-1) <> '11')))  and
      (Chk_hul = false) and (Chk_hul2 = false)  and (rdgGubn_Hulgum.itemindex = 2) then
   begin
        if (edtCOD_HUL.Text = '')  and (edtCOD_CANCER.Text ='') and (cmbGUBN_TKGM.ItemIndex = -1) and (cmbGUBN_GONG.ItemIndex = -1) THEN     //혈액, 종양 프로파일 존재시 Pass
        BEGIN
        GF_MsgBox('Information', '센터 노신은 혈액검사를 센터로 접수하십시오.');
        rdgGubn_Hulgum.SetFocus;
        exit;
        END;
   end;
 //=================2017.09.01 해당검사 있을 경우 센터로 접수 못하도록 _본원 진검팀
   chk_jindan := False;
   //장비 프로파일 확인
   if edtCOD_JANGBI.Text <> '' then
   begin
      qryPf_hm.Active := False;
      qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
      qryPf_hm.Active := True;
      if qryPf_hm.RecordCount > 0 then
      begin
         while not qryPf_hm.Eof do
         begin
           if (qryPf_hm.FieldByName('COD_HM').AsString = 'C001') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C002') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C003') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C004') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C005') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C006') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C007') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C012') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C013') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C017') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C044') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C045') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C046') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C047') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C048') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C049') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C050') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C051') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C052') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C053') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C054') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C055') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C056') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C057') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C083') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C084') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C085') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'E001') or (qryPf_hm.FieldByName('COD_HM').AsString = 'E002') or (qryPf_hm.FieldByName('COD_HM').AsString = 'E003') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C007') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C012') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C013') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'E015') or (qryPf_hm.FieldByName('COD_HM').AsString = 'U017') or (qryPf_hm.FieldByName('COD_HM').AsString = 'U019') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'U046') or (qryPf_hm.FieldByName('COD_HM').AsString = 'Y005') or (qryPf_hm.FieldByName('COD_HM').AsString = 'Y008') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'P007') or (qryPf_hm.FieldByName('COD_HM').AsString = 'P008')  then
              Chk_jindan :=  True;
              qryPf_hm.Next;
         end;
      end;
      qryPf_hm.Active := False;
   end;
   //혈액프로파일 체크
   if edtCOD_HUL.Text <> '' then
   begin
      qryPf_hm.Active := False;
      qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
      qryPf_hm.Active := True;
      if qryPf_hm.RecordCount > 0 then
      begin
         while not qryPf_hm.Eof do
         begin
           if (qryPf_hm.FieldByName('COD_HM').AsString = 'C001') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C002') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C003') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C004') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C005') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C006') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C007') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C012') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C013') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C017') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C044') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C045') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C046') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C047') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C048') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C049') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C050') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C051') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C052') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C053') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C054') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C055') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C056') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C057') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C083') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C084') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C085') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'E001') or (qryPf_hm.FieldByName('COD_HM').AsString = 'E002') or (qryPf_hm.FieldByName('COD_HM').AsString= 'E003') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'C007') or (qryPf_hm.FieldByName('COD_HM').AsString = 'C012') or (qryPf_hm.FieldByName('COD_HM').AsString= 'C013') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'E015') or (qryPf_hm.FieldByName('COD_HM').AsString = 'U017') or (qryPf_hm.FieldByName('COD_HM').AsString= 'U019') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'U046') or (qryPf_hm.FieldByName('COD_HM').AsString = 'Y005') or (qryPf_hm.FieldByName('COD_HM').AsString= 'Y008') or
              (qryPf_hm.FieldByName('COD_HM').AsString = 'P007') or (qryPf_hm.FieldByName('COD_HM').AsString = 'P008') then
              Chk_jindan :=  True;
              qryPf_hm.Next;
         end;
      end;
      qryPf_hm.Active := False;
   end;
   //코드 추가 부분 확인
   sCod_chuga := GF_GridToSingle(grdCod_Chuga);
   if sCod_chuga <> '' then
   begin
     iRet := GF_MulToSingle(sCod_chuga, 4, vCod_chuga);
     for i := 0 to iRet-1 do
     begin
      if (vCod_chuga[i] = 'C001') or (vCod_chuga[i] = 'C002') or (vCod_chuga[i] = 'C003') or
         (vCod_chuga[i] = 'C004') or (vCod_chuga[i] = 'C005') or (vCod_chuga[i] = 'C006') or
         (vCod_chuga[i] = 'C007') or (vCod_chuga[i] = 'C012') or (vCod_chuga[i] = 'C013') or
         (vCod_chuga[i] = 'C017') or (vCod_chuga[i] = 'C044') or (vCod_chuga[i] = 'C045') or
         (vCod_chuga[i] = 'C046') or (vCod_chuga[i] = 'C047') or (vCod_chuga[i] = 'C048') or
         (vCod_chuga[i] = 'C049') or (vCod_chuga[i] = 'C050') or (vCod_chuga[i] = 'C051') or
         (vCod_chuga[i] = 'C052') or (vCod_chuga[i] = 'C053') or (vCod_chuga[i] = 'C054') or
         (vCod_chuga[i] = 'C055') or (vCod_chuga[i] = 'C056') or (vCod_chuga[i] = 'C057') or
         (vCod_chuga[i] = 'C083') or (vCod_chuga[i] = 'C084') or (vCod_chuga[i] = 'C085') or
         (vCod_chuga[i] = 'E001') or (vCod_chuga[i] = 'E002') or (vCod_chuga[i] = 'E003') or
         (vCod_chuga[i] = 'C007') or (vCod_chuga[i] = 'C012') or (vCod_chuga[i] = 'C013') or
         (vCod_chuga[i] = 'E015') or (vCod_chuga[i] = 'U017') or (vCod_chuga[i] = 'U019') or
         (vCod_chuga[i] = 'U046') or (vCod_chuga[i] = 'Y005') or (vCod_chuga[i] = 'Y008') or
         (vCod_chuga[i] = 'P007') or (vCod_chuga[i] = 'P008')then
         Chk_jindan :=  True;
     end;
   end;

   if (StrToInt(mskDAT_GMGN.Text) >=20170901) AND (GV_sJisa <> '15') and
      (((cmbGUBN_NOSIN.ItemIndex = 1) and (copy(edtGUBN_NSYH.text, 1,  pos('-', edtGUBN_NSYH.Text)-1) = '11')) or
       ((cmbGUBN_ADULT.ItemIndex = 1) and (copy(edtGUBN_ADYH.text, 1,  pos('-', edtGUBN_ADYH.Text)-1) = '11'))) and
      (rdgGubn_Hulgum.itemindex = 1) then
   begin
        GF_MsgBox('Information', '본원만 검사 가능한 코드가 포함되어 있어, 연구소 혹은 연구+센터로 변경하십시오.(일반검진 B형간염 검사');
        rdgGubn_Hulgum.SetFocus;
        exit;
   end;

   ////연구소 + 센터 확인 문구 출력
   if (StrToInt(mskDAT_GMGN.Text) >=20170901) AND (GV_sJisa <> '15') and (Chk_jindan = True) and (rdgGubn_Hulgum.itemindex = 1) then
   begin
        GF_MsgBox('Information', '본원만 검사 가능한 코드가 포함되어 있어, 연구소 혹은 연구+센터로 변경하십시오.');
        rdgGubn_Hulgum.SetFocus;
        exit;
   end;
 //-------------------------------------------------------------------------------------------------------
   if (Copy(cmbGUBN_NEAWON.Text,1,1) = '5') and
      ((cmbGUBN_NSCG.ItemIndex = 1) or
       (cmbGUBN_ADCG.ItemIndex = 1) or
       (cmbGUBN_LFCG.ItemIndex = 1)) then
   begin
      GF_MsgBox('Information', '조합청구로 내원구분의 5-대체는 접수하실수 없습니다.');
      cmbGUBN_NEAWON.SetFocus;
      exit;
   end;

   qryDanche.Active := False;
   qryDanche.ParamByName('cod_dc').AsString := edtCOD_DC.Text;
   qryDanche.Active := True;
   if qryDanche.RecordCount > 0 then
   begin
      if (cmbCOD_JISA.Text <>  '') and (mskDAT_GMGN.Text <> '')  and
         (mskNUM_JUMIN.Text <> '') and (edtDESC_NAME.Text <> '') and
         (cmbGUBN_NEAWON.Text <> '') then
      begin
         if (GV_sJisa = '00') or (GV_sJisa = '11') or (GV_sJisa = '12') or (GV_sJisa = '15') or
            (GV_sJisa = '43') or (GV_sJisa = '51') or (GV_sJisa = '61') or (GV_sJisa = '71') then
         begin
            if CkBox_Jumin.Checked then
            begin
               // 주민번호 Check
               if Not GF_JuminCheck(mskNUM_JUMIN.Text) then
               begin
                  mskNUM_JUMIN.SetFocus;
                  Exit;
               end;
            end;
            // 이메일체크시 메일 확인
            if length(cmbCod_saler.text) <= 6 then
               GF_MsgBox('Information', '직영지사는 영업담당자를  필히 입력해야 합니다.')
            else
            begin
               if Copy(cmbCOD_JISA.Text, 1, 2) = '11' then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 강남은 구분없음을 사용할수 없습니다.' + #13#13 +
                                   '☞ 종합검사는 => [종검-4F]' + #13 + '☞ 준종합이하는  [일반-5F]으로 접수하시기 바람니다.');
                   3,4,9,14,15,19 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
               else if Copy(cmbCOD_JISA.Text, 1, 2) = '12' then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 여의도는 구분없음을 사용할수 없습니다.' + #13#13 +
                                   '☞ 종합검사는 => [종검-17F]' + #13 + '☞ VIP검사는  [VIP-18F]으로 접수하시기 바람니다.');
               5,6,7,8,11,16 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
               else if Copy(cmbCOD_JISA.Text, 1, 2) = '15' then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 본사(강북)는 구분없음을 사용할수 없습니다.' + #13#13 +
                                  '☞ 종합검사는 => [종검-3F]' + #13 + '☞ 준종합이하는 [일반-2F]으로 접수하시기 바람니다.');
                   1,2,10 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
               else if Copy(cmbCOD_JISA.Text, 1, 2) = '43' then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 수원은 구분없음을 사용할수 없습니다.');
                   17,18 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
               else if (Copy(cmbCOD_JISA.Text, 1, 2) = '61') and (Copy(cmbGUBN_NEAWON.Text, 1, 1) <> '2')then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 부산은 구분없음을 사용할수 없습니다.' + #13#13 +
                                   '☞ 종합검사는 => [종검-12F]' + #13 + '☞ 준종합이하는  [일반-11F]으로 접수하시기 바람니다.');
                   12,13 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
               else
               begin
                  UF_Save;
               end;
            end;
         end
         else
         begin
            if UV_sJisa = Copy(cmbCOD_JISA.Text, 1, 2) then
               UF_Save
            else
               GF_MsgBox('Information', '타지사 접수는 수정불가능합니다...');
         end;
      end
      else
         GF_MsgBox('Information', '필수항목을 확인하십시요...');
   end
   else
   begin
      GF_MsgBox('Information', '존재하지 않는 단체코드입니다...');
      edtCOD_DC.SetFocus;
   end;

   if ((copy(mskNUM_JUMIN.Text,7,1) = '5') or
       (copy(mskNUM_JUMIN.Text,7,1) = '6') or
       (copy(mskNUM_JUMIN.Text,7,1) = '7') or
       (copy(mskNUM_JUMIN.Text,7,1) = '8')) and
      (Comb_CNTY.Text = '') then
   begin
      GF_MsgBox('Information', '외국인은 국적표기가 필수입니다.');
      Comb_CNTY.SetFocus;
      exit;
   end;

   qryDanche.Active := False;
   SBtn_PreRegister.Enabled := False;

   with qry_getJJFK do
   begin
     close;
     filter := '';
     Filtered := False;
     ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
     ParamByName('NUM_ID').AsString      := UV_sNum_id;
     ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
     open;
     Filtered := True;
     filter := 'JJFK = ''JJFK''';
     if qry_getJJFK.recordcount > 0 then
     begin
        with qry_getHangmok do
        begin
            qry_getHangmok.close;
            qry_getHangmok.filter := '';
            qry_getHangmok.Filtered := False;
            qry_getHangmok.ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
            qry_getHangmok.ParamByName('NUM_ID').AsString      := UV_sNum_id;
            qry_getHangmok.ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
            qry_getHangmok.open;
            qry_getHangmok.Filtered := True;

            qry_getHangmok.filter := 'cod_hm = ''C025'' ';
            if qry_getHangmok.recordcount = 0 then
            begin
               if MessageDlg('JJFK + C025 코드가 없습니다. C025를 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
               begin
                   edtCOD_CHUGA.Text := 'C025';
                   btnHm_insert.Click;
                   UV_bEdit := True;
               end;
            end;
            qry_getHangmok.filter := 'cod_hm = ''C026'' ';
            if qry_getHangmok.recordcount = 0 then
            begin
               if MessageDlg('JJFK + C026 코드가 없습니다. C026를 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
               begin
                   edtCOD_CHUGA.Text := 'C026';
                   btnHm_insert.Click;
                   UV_bEdit := True;
               end;
            end;
            qry_getHangmok.filter := 'cod_hm = ''C027'' ';
            if qry_getHangmok.recordcount = 0 then
            begin
               if MessageDlg('JJFK + C027 코드가 없습니다. C027를 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
               begin
                   edtCOD_CHUGA.Text := 'C027';
                   btnHm_insert.Click;
                   UV_bEdit := True;
               end;
            end;
            qry_getHangmok.filter := 'cod_hm = ''C028'' ';
            if qry_getHangmok.recordcount = 0 then
            begin
               if MessageDlg('JJFK + C028 코드가 없습니다. C028를 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
               begin
                   edtCOD_CHUGA.Text := 'C028';
                   btnHm_insert.Click;
                   UV_bEdit := True;
               end;
            end;
            if UV_bEdit = True then  showmessage('수정내역이 있습니다. 다시 저장을 눌러 수정된 내용을 반영하세요.');
        end;
     end;
   end;
end;

procedure TfrmCK3I01.FormCreate(Sender: TObject);
begin
   inherited;
   Manual_Print;
   UV_Pannel := Panel1.caption;                                                 //07.06.27 동구 추가.
   Magam_Check := False;
   Gumgin_Check:=false;
   Chuga_Check:=false;
//   New1.checked := True;                                                        //07.06.25 슈~ 기존 구챠트->07챠트로 뜨게끔
   // 환경설정
   //UP_VarMemSet(0);
   UP_ChugaVarMemSet(0);

   // Combo Data Populate
   GP_ComboJisa(cmbCOD_JISA);
   GP_ComboSawonAll(cmbCOD_SALER, 2);
   GP_ComboFill(cmbGUBN_NEAWON, 'NEWN');

   GP_ComboFill(Comb_CNTY, 'CNTY');
   GP_ComboFill(Cmb_Print, 'PRIN');

   GP_ComboFill(cmb_email,  'MAIL');
   cmb_email.ItemIndex :=0;
   Com_BD.ItemIndex := GP_SawonCheck(Com_BD, GV_sUserId);
   Cmb_Print.ItemIndex := 0;
   
   // SQL문 저장
   UV_sBasicSQL := qryGumgin.SQL.Text;

   // 지사 Setting
   if GV_sJisa = '00' then UV_sJisa := copy(GV_sUserId,1,2)
   else                    UV_sJisa := GV_sJisa;

   Comb_printer.Items.Clear;
   Comb_printer.Items.AddStrings(Printer.Printers);
   Comb_printer.ItemIndex := 0;
   UV_iPrinrer := Printer.PrinterIndex;

   UV_sDesc_Coupon := ''; UV_sDesc_Coupon_etc := '';

   if (UV_sJisa = '61') or (UV_sJisa = '15') or (UV_sJisa = '12') then
   begin
      chk_CPMS.Visible := True;
      chk_CPMS.Checked := True;
      //CPMS.Connected := True;
   end;

   //2015.06.15 바코드 추가
   If Copy(GV_sUserId,1,2) = '43' Then
   CK_LABEL.ItemIndex := 0
   ELSE
   CK_LABEL.ItemIndex := 1;

   //[20120.07017-유동구]재검대상자 찾기 추가항목..
   if qrySokun.Active  = False then qrySokun.Active  := True;
   if qryComm06.Active = False then qryComm06.Active := True;
   //특검출력일 Visible
   Label26.Visible     := False;
   edtTk_Print.Visible := False;
   //공단출력일 Visible
   Lbl_Gong_print.Visible := False;
   edtGong_Print.Visible  := False;

   //한의 부산진행파트 1500286 - 부산층수 고정
   //한의 부산진행파트1600287 - 고정 다시 해제
   {If Copy(GV_sUserId,1,2) = '61' Then
      Begin
         Com_BD.ItemIndex := 12;
      End;}

end;

procedure TfrmCK3I01.btnQueryClick(Sender: TObject);
var i, j, iCod_chuga, fCod_chuga, iLength, iSuga : Integer;
    sName, sData, sTemp, sSelect, sWhere, sOrder : String;
    vCod_chuga, vCod_chuga_F : Variant;
    eSuga : Extended;

begin
   inherited;

   // 조회조건 Check
   if not UF_Condition then exit;
   //Panel Clear
   GP_FieldClear(pnlDetail);

   //[2018.05.16-유동구]향정처방전 식별번호 등록 초기화..
   cmbPat_id_type.ItemIndex := -1;
   edtPat_Id.Text := '';

   //검사항목금액 Clear
   UV_SugaA1 := 0;
   UV_SugaA2 := 0;
   UV_SugaA3 := 0;
   UV_SugaA4 := 0;
   UV_SugaA5 := 0;
   UV_SugaA6 := 0;
   UV_Suga1  := 0;
   UV_Suga2  := 0;
   UV_Suga3  := 0;
   UV_Suga4  := 0;
   UV_Suga5  := 0;
   UV_Suga6  := 0;
   UV_Suga7  := 0;

   UV_GubnA1 := '';
   UV_GubnA2 := '';
   UV_GubnA3 := '';
   UV_GubnA4 := '';
   UV_GubnA5 := '';
   UV_GubnA6 := '';
   UV_GubnA7 := '';
   SDcheck := false;

   Chk_New_Add.checked := false;

   // Query 수행
   with qryGumgin do
   begin
      Active := False;
      ParamByName('num_jumin').AsString := mskJumin.Text;
      ParamByName('dat_gmgn').AsString :=  Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) +
                                           Copy(cmbGmgn.Text, 9, 2);
      Active := True;

      if RecordCount > 0 then
      begin
         UP_ChugaVarMemSet(0);
         mskNUM_JUMIN.ReadOnly := True;

         Pnl_ID.Caption       := '회원번호(' + FieldByName('NUM_ID').AsString + ')';

         UV_sNum_id           := FieldByName('NUM_ID').AsString;
         UV_sNum_Jumin        := FieldByName('NUM_JUMIN').AsString;
         GP_ComboDisplay(cmbCOD_JISA, FieldByName('COD_JISA').AsString, 2);
         mskDAT_GMGN.Text     := FieldByName('DAT_GMGN').AsString;
         mskNUM_JUMIN.Text    := FieldByName('NUM_JUMIN').AsString;
         edtDESC_NAME.Text    := FieldByName('DESC_NAME').AsString;
         edtNUM_TEL.Text      := FieldByName('NUM_TEL').AsString;
         mskNUM_POST.Text     := FieldByName('NUM_POST').AsString;
         edtDESC_ADDR.Text    := FieldByName('DESC_ADDR').AsString;
         edtCOD_DC.Text       := FieldByName('COD_DC').AsString;
         edtDESC_DEPT.Text    := FieldByName('DESC_DEPT').AsString;

         {YDG[2006.01.02]-메일수신체크}
         if FieldByName('gubn_susin').AsString = 'Y' then
            CK_susin.Checked  := True
         else
            CK_susin.Checked  := False;

         Edt_email.Text       := FieldByName('DESC_EMAIL').AsString;

         sGmgn                := FieldByName('COD_GMGN').AsString;
         sDesc_Gmgn           := '[' + FieldByName('gubn_gmsa').AsString + ']' + FieldByName('DESC_GMGN').AsString;
         iSeq                 := FieldByName('NUM_SEQ').AsInteger;

         if FieldByName('YSNO_FOLK').AsString = 'Y' then
            ckYSNO_FOLK.Checked  := True
         else
            ckYSNO_FOLK.Checked  := False;
         
         if FieldByName('Ysno_useinfo').AsString ='Y' then
            Chk_ysno_useinfo.Checked  := True
         else
            Chk_ysno_useinfo.Checked  := False;

         if FieldByName('YSNO_FOLK').AsString = 'Y' then
            ckYSNO_FOLK.Checked  := True
         else
            ckYSNO_FOLK.Checked  := False;

         if FieldByName('GUBN_PREG').AsString = 'Y' then
            ckGUBN_PREG.Checked  := True
         else if FieldByName('GUBN_PREG').AsString = 'P' then
            ckGUBN_PREG2.Checked  := True
         else
         begin
            ckGUBN_PREG.Checked  := False;
            ckGUBN_PREG2.Checked := False;
         end;


         mskDAT_IPSA.Text     := FieldByName('DAT_IPSA').AsString;
         GP_ComboDisplay(cmbGUBN_JIK, FieldByName('GUBN_JIK').AsString, 1);
         If FieldByName('Gubn_Tkgm').AsString > '0' Then
            cmbGUBN_JIK.Enabled := False
         Else
            cmbGUBN_JIK.Enabled := True;

         edtNUM_SABUN.Text    := FieldByName('NUM_SABUN').AsString;
         edtNUM_BALKUB.Text   := FieldByName('NUM_BALKUB').AsString;
//         edtNUM_BOHM1.Text    := FieldByName('NUM_BOHM1').AsString;
//         edtNUM_BOHM2.Text    := FieldByName('NUM_BOHM2').AsString;
         MEdt_No.Text         := FieldByName('DESC_HOJU').AsString;
         GP_ComboDisplay(cmbCOD_SALER, FieldByName('COD_SALER').AsString, 6);
         GP_ComboDisplay(cmbGUBN_NEAWON, FieldByName('GUBN_NEAWON').AsString, 1);
         GP_ComboDisplay(Comb_CNTY, FieldByName('gubn_CNTY').AsString, 3);

         if length(Trim(FieldByName('GUBN_JINCH').AsString)) = 2 then
            GP_ComboDisplay(Com_BD, FieldByName('GUBN_JINCH').AsString, 2)
         else if Trim(FieldByName('GUBN_JINCH').AsString) <> '' then
            GP_ComboDisplay(Com_BD, FieldByName('GUBN_JINCH').AsString, 1)
         else
            GP_ComboDisplay(Com_BD, '0', 1);

         GP_ComboDisplay(cmbBohm, FieldByName('YN_MEDIC').AsString, 1);

         edtNUM_SAMP.Text     := FieldByName('NUM_SAMP').AsString;
         rdgGubn_Hulgum.itemindex := FieldByName('gubn_hulgum').AsInteger - 1;
         edtCOD_JANGBI.Text   := FieldByName('COD_JANGBI').AsString;
         edtCOD_HUL.Text      := FieldByName('COD_HUL').AsString;
         edtCOD_CANCER.Text   := FieldByName('COD_CANCER').AsString;

         //추가항목 display
         grdCOD_CHUGA.Rows := 0;
         iCod_chuga := GF_MulToSingle(FieldByName('COD_CHUGA').AsString, 4, vCod_chuga);

         UP_ChugaVarMemSet(iCod_chuga);

         if Trim(FieldByName('gubn_print').AsString) <> '' then
         begin
            Cmb_Print.Font.Color := ClBlack;
            GP_ComboDisplay(Cmb_Print, FieldByName('gubn_print').AsString, 2);
         end
         else
         begin
            Cmb_Print.Font.Color := ClRed;
            Cmb_Print.ItemIndex := 0;
         end;

         with qryNhic do
         begin
            close;
            ParamByName('cod_jisa').AsString  := copy(cmbCod_jisa.text,1,2);
            ParamByName('Num_Jumin').AsString := UV_sNum_Jumin;
            ParamByName('year_saup').AsString := copy(cmbGmgn.text,1,4);
            open;
            if recordcount > 0 then
            begin
               if FieldByName('gubn_1cha').AsString = '1' then
                  Lb_1cha.Caption := '본인부담없음'
               else if FieldByName('gubn_1cha').AsString = '2' then
                  Lb_1cha.Caption := '해당없음'
               else if FieldByName('gubn_1cha').AsString = '3' then
                  Lb_1cha.Caption := '수검완료'
               else if FieldByName('gubn_1cha').AsString = '9' then
                  Lb_1cha.Caption := '수검정보등록';

               if FieldByName('gubn_jik').AsString = '1' then
                  gubn_jik.Text := '직장'
               else if FieldByName('gubn_jik').AsString = '2' then
                  gubn_jik.Text := '지역'
               else if FieldByName('gubn_jik').AsString = '3' then
                  gubn_jik.Text := '공교'
               else if FieldByName('gubn_jik').AsString = '4' then
                  gubn_jik.Text := '의료급여';

               if FieldByName('gubn_saup').AsString = '1' then
                  gubn_saup.Text := '직장가입자'
               else if FieldByName('gubn_saup').AsString = '2' then
                  gubn_saup.Text := '직장피부양자'
               else if FieldByName('gubn_saup').AsString = '3' then
                  gubn_saup.Text := '지역세대주'
               else if FieldByName('gubn_saup').AsString = '4' then
                  gubn_saup.Text := '지역세대원'
               else if FieldByName('gubn_saup').AsString = '5' then
                  gubn_saup.Text := '공교피부양자'
               else if FieldByName('gubn_saup').AsString = '6' then
                  gubn_saup.Text := '의료보호세대주'
               else if FieldByName('gubn_saup').AsString = '7' then
                  gubn_saup.Text := '지역,피부양자'
               else if FieldByName('gubn_saup').AsString = '8' then
                  gubn_saup.Text := '의료급여';

               //2016.02.23 박대용 - 간암, 자궁암 특정 처리 -
               //간암   : 2016년도 부터 상반기, 하반기로 구분
               //자궁암 : 2016년도 3월 2일 부터 이지스와 분류
               Lb_UA.Caption  := UF_Nhic(qryNhic.FieldByName('gubn_UA').AsString);
               Lb_DJA.Caption := UF_Nhic(qryNhic.FieldByName('gubn_DJA').AsString);
               Lb_UBA.Caption := UF_Nhic(qryNhic.FieldByName('gubn_UBA').AsString);
               //간암 특정처리
               if ((copy(cmbGmgn.text, 1,4) >= '2016') and (copy(cmbGmgn.text, 6,2) < '07')) then
               begin
                      Lb_GA.Caption  := UF_Nhic(qryNhic.FieldByName('gubn_GA').AsString);
                      sGubn_GA  := qryNhic.FieldByName('gubn_GA').AsString;
               end
               else if ((copy(cmbGmgn.text, 1,4) >= '2016') and (copy(cmbGmgn.text, 6,2) >= '07')) then
               begin
                      Lb_GA.Caption  := UF_Nhic(qryNhic.FieldByName('gubn_GA2').AsString);
                      sGubn_GA  := qryNhic.FieldByName('gubn_GA2').AsString;
               end
               else
               begin
                      Lb_GA.Caption  := UF_Nhic(qryNhic.FieldByName('gubn_GA').AsString);
                      sGubn_GA  := qryNhic.FieldByName('gubn_GA').AsString;
               end;
               //자궁암 특정처리
               if (Pos('JJXQ', qryGumgin.FieldByName('cod_chuga').AsString) = 0) and
                  (copy(cmbCOD_JISA.Text, 1, 2) = '15') and
                  (copy(qryGumgin.FieldByName('dat_gmgn').AsString,1 ,8) >='20260302') then
               begin
                    Lb_JGA.Caption := '';
                    sGubn_JGA := '';
               end
               else
               begin
                    Lb_JGA.Caption := UF_Nhic(qryNhic.FieldByName('gubn_JGA').AsString);
                    sGubn_JGA := qryNhic.FieldByName('gubn_JGA').AsString;
               end;

               sGubn_UA  := qryNhic.FieldByName('gubn_UA').AsString;
               sGubn_DJA := qryNhic.FieldByName('gubn_DJA').AsString;
               sGubn_UBA := qryNhic.FieldByName('gubn_UBA').AsString;
            end
            else
            begin
               Lb_1cha.Caption := '';
               Lb_UA.Caption   := '';
               Lb_DJA.Caption  := '';
               Lb_GA.Caption   := '';
               Lb_UBA.Caption  := '';
               Lb_JGA.Caption  := '';
         
               sGubn_UA  := '';
               sGubn_DJA := '';
               sGubn_GA  := '';
               sGubn_UBA := '';
               sGubn_JGA := '';
            end;
         end;

         with qry_Gumgin_Check do
         begin
            close;
            ParamByName('cod_jisa').AsString  := copy(cmbCod_jisa.text,1,2);
            ParamByName('Num_Jumin').AsString := mskJumin.Text;
            ParamByName('dat_gmgn').AsString  := Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) +  Copy(cmbGmgn.Text, 9, 2);
            open;
            if recordcount > 0 then
            begin
               Gumgin_Check:=true;
               if qry_Gumgin_Check.FieldByName('Breastfeed').AsString = 'Y' then
                  CK_Breastfeed.Checked := true
               else CK_Breastfeed.Checked := false;
               if qry_Gumgin_Check.FieldByName('Period').AsString = 'Y' then
                  CK_Period.Checked := true
               else CK_Period.Checked := false;
               if qry_Gumgin_Check.FieldByName('partner').AsString = 'Y' then
                  CK_partner.Checked := true                                                                                         
               else CK_partner.Checked := false;
               if qry_Gumgin_Check.FieldByName('CK_Urin').AsString = 'Y' then
                  CK_Urin.Checked := true
               else CK_Urin.Checked := false;
               if qry_Gumgin_Check.FieldByName('CK_Blood').AsString = 'Y' then
                  CK_Blood.Checked := true
               else CK_Blood.Checked := false;
               if qry_Gumgin_Check.FieldByName('CK_Trust_company').AsString = 'Y' then
                  CK_Trust_company.Checked := true
               else CK_Trust_company.Checked := false;
               if qry_Gumgin_Check.FieldByName('CK_Pacs').AsString = 'Y' then
                  CK_Pacs.Checked := true
               else CK_Pacs.Checked := false;
               if qry_Gumgin_Check.FieldByName('Ck_Gongdan_Chgu').AsString = 'Y' then
                  Ck_Gongdan_Chgu.Checked := true
               else Ck_Gongdan_Chgu.Checked := false;
            end
            else
            begin
               Gumgin_Check          := false;
               CK_Breastfeed.Checked := false;
               CK_Period.Checked     := false;
               CK_partner.Checked    := false;
               CK_Urin.Checked       := false;
               CK_Blood.Checked      := false;
               CK_Trust_company.Checked := false;
               CK_Pacs.Checked       := false;
               Ck_Gongdan_Chgu.Checked := false;
            end;
         end;

         //결과활용동의
         if qryGumgin.FieldByName('NUM_ID').AsString <> '' then
           UP_Select_Ysno_Result_Ues(qryGumgin.FieldByName('cod_jisa').AsString, qryGumgin.FieldByName('dat_gmgn').AsString, qryGumgin.FieldByName('NUM_ID').AsString);


         //2010.12.01 철. 종검 재방문고객
         Panel94.Caption := '';

         with qryGmgn do
         begin
            // Filter 제거
            Filtered := False;
         
            qryGmgn.Active := False;
            qryGmgn.SQL.Clear;

            sSelect := 'SELECT cod_jisa, num_id, dat_gmgn, desc_name, cod_jangbi, cod_hul, cod_chuga , cod_dc FROM gumgin ';

            sWhere := ' WHERE num_jumin = ''' + mskNUM_JUMIN.Text + '''';
            sOrder := ' ORDER BY dat_gmgn';
         
            qryGmgn.SQL.Clear;
            qryGmgn.SQL.Add(sSelect + sWhere + sOrder);
            qryGmgn.Active := True;
         
            if RecordCount > 0 then
            begin
               while not Eof do
               begin
                  if (pos('PJ', qryGmgn.FieldByName('cod_jangbi').AsString) > 0) and
                     (Trim(qryGmgn.FieldByName('cod_hul').AsString) <> '') and
                     (Panel94.Caption = '') and
                     (qryGmgn.FieldByName('dat_gmgn').AsString <> mskDAT_GMGN.Text) then
                  begin
                     if  ((qryGmgn.FieldByName('cod_dc').AsString ='H00001') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='120001') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='115999') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='431331') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='611098') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='712421') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='511111') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='900000')) and
                         (qryGmgn.FieldByName('dat_gmgn').AsString <> mskDAT_GMGN.Text) then Panel94.Caption := '재방문 고객'
                     else                                                                    Panel94.Caption := '(종검) 재방문 고객';
                  end;

                  Next;
               end;
            end;
            // Table과 Disconnect
            qryGmgn.Active := False;
         end;

         with qryFree do
         begin
            qryFree.Active := False;
            qryFree.ParamByName('cod_jisa').AsString :=  Copy(cmbCod_jisa.Text, 1, 2);
            qryFree.ParamByName('num_id').AsString   := UV_sNum_id;
            qryFree.ParamByName('dat_gmgn').AsString :=  Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) +
                                                         Copy(cmbGmgn.Text, 9, 2);
            qryFree.Active := True;
            if (qryFree.RecordCount > 0) and (FieldByName('COD_CHUGA').AsString <> '')then
            begin
                 fCod_chuga := GF_MulToSingle(FieldByName('COD_CHUGA').AsString, 4, vCod_chuga_F);

                 for i := 0 to iCod_chuga - 1 do
                 begin
                      if (qryFree.FieldByName('cod_jangbi').AsString <> '') AND
                         (qryFree.FieldByName('cod_jangbi').AsString = qryGumgin.FieldByName('cod_jangbi').AsString) then
                         Check_free1.checked := True
                      else
                          Check_free1.checked := false;
                      if (qryFree.FieldByName('cod_hul').AsString <> '') AND
                         (qryFree.FieldByName('cod_hul').AsString = qryGumgin.FieldByName('cod_hul').AsString) then
                         Check_free2.checked := True
                      else
                          Check_free2.checked := false;

                      if (qryGumgin.FieldByName('cod_cancer').AsString <> '') and
                         (qryFree.FieldByName('cod_cancer').AsString = qryGumgin.FieldByName('cod_cancer').AsString) then
                         Check_free3.checked := True
                      else
                          Check_free3.checked := false;

                      UV_vCod_chuga_d[i] := vCod_chuga[i];
                      if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                      begin
                           for j := 0 to fCod_chuga - 1 do
                           begin
                           if vCod_chuga_F[j] = vCod_chuga[i] then
                           begin
                                UV_vDesc_chuga[i] := sName;
                                UV_vSuga_kmi[i] := eSuga;
                                UV_vGubn_free[i] := '1';
                                break;
                           end
                           else
                           begin
                                UV_vDesc_chuga[i] := sName;
                                UV_vSuga_kmi[i] := eSuga;
                                UV_vGubn_free[i] := '0';
                            end;
                            end;
                       end
                       else
                       begin
                           UV_vDesc_chuga[i] := '';
                           UV_vSuga_kmi[i] := 0;
                           UV_vGubn_free[i] := '0';
                      end;
                 end;
            end
            else
            begin
                 for i := 0 to iCod_chuga - 1 do
                 begin
                      UV_vCod_chuga_d[i] := vCod_chuga[i];
                      if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                      begin
                           UV_vDesc_chuga[i] := sName;
                           UV_vSuga_kmi[i] := eSuga;
                           UV_vGubn_free[i] := '0';
                      end
                      else
                      begin
                           UV_vDesc_chuga[i] := '';
                           UV_vSuga_kmi[i] := 0;
                           UV_vGubn_free[i] := '0';
                      end;

                 end;
            end;
            qryFree.Active := False;
         end;
         grdCOD_CHUGA.Rows := iCod_chuga;
         // 추가항목 총금액 계산

         UP_ChugaSugaCount;

         valSUGA_DANCHE.Value   := FieldByName('SUGA_DANCHE').AsInteger;
         {YDG[2006.01.02]-특검금액 및 종검금액 구분}
         if (FieldByName('suga_tkgm').AsInteger > 0) or (FieldByName('suga_tkgm2').AsInteger > 0) then
         begin
            VEdt_Jgum.Value   := FieldByName('SUGA_DANCHE').AsInteger - FieldByName('suga_tkgm').AsInteger - FieldByName('suga_tkgm2').AsInteger;
            VEdt_Tgum.Value   := FieldByName('suga_tkgm').AsInteger;
            VEdt_Tgum2.Value  := FieldByName('suga_tkgm2').AsInteger;
            Label_yh.Caption := '특검유형 : ' + FieldByName('desc_yh').AsString;
         end
         else
         begin
            VEdt_Jgum.Value  := FieldByName('SUGA_DANCHE').AsInteger;
            VEdt_Tgum.Value  := 0;
            VEdt_Tgum2.Value  := 0;
            if Trim(FieldByName('desc_yh').AsString) <> ''then
               Label_yh.Caption := '특검유형 : ' + FieldByName('desc_yh').AsString
            else
               Label_yh.Caption := '특검유형 보기 ';
         end;
         valSUGA_GIBD.Value     := FieldByName('SUGA_GIBD').AsInteger;
         valSUGA_GONGJE.Value   := FieldByName('SUGA_BOHUM').AsInteger;

         valYUL_MCIJ.Value      := FieldByName('YUL_MCIJ').AsInteger;
         valSUGA_TOT.Value      := FieldByName('SUGA_TOT').AsInteger;


         GP_ComboDisplay(cmbGUBN_NOSIN,  FieldByName('GUBN_NOSIN').AsString, 1);
         GP_ComboDisplay(cmbGUBN_NSCG,   FieldByName('GUBN_NSCG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_TKGM,   FieldByName('GUBN_TKGM').AsString,  1);
         GP_ComboDisplay(cmbGUBN_TKCG,   FieldByName('GUBN_TKCG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_BOGUN,  FieldByName('GUBN_BOGUN').AsString, 1);
         GP_ComboDisplay(cmbGUBN_BGCG,   FieldByName('GUBN_BGCG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_ADULT,  FieldByName('GUBN_ADULT').AsString, 1);
         GP_ComboDisplay(cmbGUBN_ADCG,   FieldByName('GUBN_ADCG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_AGAB,   FieldByName('GUBN_AGAB').AsString,  1);
         GP_ComboDisplay(cmbGUBN_AGCG,   FieldByName('GUBN_AGCG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_GONG,   FieldByName('GUBN_GONG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_GOCG,   FieldByName('GUBN_GOCG').AsString,  1);
         GP_ComboDisplay(cmbGUBN_LIFE,   FieldByName('GUBN_LIFE').AsString,  1);
         GP_ComboDisplay(cmbGUBN_LFCG,   FieldByName('GUBN_LFCG').AsString,  1);

         //[2018.05.16-유동구]향정 처방전 식별번호 가져오기..
         //---------------------------------------------------------------------
         with qryPerson_IDType do
         begin
            Active := False;
            ParamByName('cod_jisa').AsString  := copy(cmbCOD_JISA.Text,1,2);
            ParamByName('num_id').AsString    := qryGumgin.FieldByName('NUM_ID').AsString;
            ParamByName('dat_gmgn').AsString  := qryGumgin.FieldByName('DAT_GMGN').AsString;
            Active := True;

            if RecordCount > 0 then
            begin
               GP_ComboDisplay(cmbPat_id_type,   FieldByName('Pat_id_type').AsString,  1);
               edtPat_Id.Text := FieldByName('Pat_id').AsString;
            end
            else
            begin
               cmbPat_id_type.ItemIndex := -1;
               edtPat_Id.Text := '';
            end;

            Active := False;
         end;
         //=====================================================================

         // 수임 영업사원 Display..
         with qryPumyiJisa do
         begin
            Active := False;
            ParamByName('cod_dc').AsString    := qryGumgin.FieldByName('COD_DC').AsString;
            ParamByName('dat_gmgn').AsString  := qryGumgin.FieldByName('DAT_GMGN').AsString;
            ParamByName('cod_jisa').AsString  := copy(cmbCOD_JISA.Text,1,2);
            Active := True;
            if RecordCount > 0 then
               Edt_SuimSawon.Text := FieldByName('cod_susaler').AsString + '-' + FieldByName('desc_suimSawon').AsString
            else
               Edt_SuimSawon.Text := '';

            Active := False;
         end;


         //노신유형Display
         if FieldByName('gubn_nosin').AsString = '1' then
         begin
            edtGubn_nsyh.Text := IntToStr(FieldByName('gubn_nsyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '1', FieldByName('gubn_nsyh').AsInteger, iSuga);
            UV_SugaA1 := iSuga;
            UV_GubnA1 := FieldByName('gubn_nscg').AsString;
            UV_Suga1 := UV_SugaA1;

            Ck_1cha.Checked := True;
         end
         else if FieldByName('gubn_nosin').AsString = '2' then
         begin
           {
            edtGubn_nsyh.Text := IntToStr(FieldByName('gubn_nsyh').AsInteger) + '-'
                               + UF_Jae_Hangmok(FieldByName('cod_jisa').AsString, FieldByName('num_id').AsString, '1', FieldByName('gubn_nsyh').AsInteger, iSuga);
            }
            UV_SugaA1 := iSuga;
            UV_GubnA1 := FieldByName('gubn_nscg').AsString;
            UV_Suga1 := UV_SugaA1;
         end;

         //특검유형Display
         if FieldByName('gubn_tkyh').AsString = '1' then
         begin
            edtGubn_tkyh.Text := IntToStr(FieldByName('gubn_tkyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '2', FieldByName('gubn_tkyh').AsInteger, iSuga);
            UV_SugaA2 := iSuga;
            UV_GubnA2 := FieldByName('gubn_tkcg').AsString;
            UV_Suga2  := UV_SugaA2;
         end
         else if FieldByName('gubn_tkyh').AsString = '2' then
         begin
            edtGubn_TKyh.Text := IntToStr(FieldByName('gubn_tkyh').AsInteger) + '-'
                               + UF_Jae_Hangmok(FieldByName('cod_jisa').AsString, FieldByName('num_id').AsString, '2', FieldByName('gubn_tkyh').AsInteger, iSuga);
            UV_SugaA2 := iSuga;
            UV_GubnA2 := FieldByName('gubn_tkcg').AsString;
            UV_Suga2  := UV_SugaA2;
         end;

         //보건증유형Display
         if FieldByName('gubn_bogun').AsString = '1' then
         begin
            edtGubn_bgyh.Text := IntToStr(FieldByName('gubn_bgyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '3', FieldByName('gubn_bgyh').AsInteger, iSuga);
            UV_SugaA3 := iSuga;
            UV_GubnA3 := FieldByName('gubn_bgcg').AsString;
            UV_Suga3 := UV_SugaA3;
         end
         else if FieldByName('gubn_bogun').AsString = '2' then
         begin
            edtGubn_bgyh.Text := IntToStr(FieldByName('gubn_bgyh').AsInteger) + '-'
                               + UF_Jae_Hangmok(FieldByName('cod_jisa').AsString, FieldByName('num_id').AsString, '3', FieldByName('gubn_bgyh').AsInteger, iSuga);
            UV_SugaA3 := iSuga;
            UV_GubnA3 := FieldByName('gubn_bgcg').AsString;
            UV_Suga3 := UV_SugaA3;
         end;

         //성인병유형Display
         if FieldByName('gubn_adult').AsString = '1' then
         begin
            edtGubn_adyh.Text := IntToStr(FieldByName('gubn_adyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '4', FieldByName('gubn_adyh').AsInteger, iSuga);
            UV_SugaA4 := iSuga;
            UV_GubnA4 := FieldByName('gubn_adcg').AsString;
            UV_Suga4 := UV_SugaA4;

            Ck_1cha.Checked := True;
         end
         else if FieldByName('gubn_adult').AsString = '2' then
         begin
            {edtGubn_adyh.Text := IntToStr(FieldByName('gubn_adyh').AsInteger) + '-'
                               + UF_Jae_Hangmok(FieldByName('cod_jisa').AsString, FieldByName('num_id').AsString, '4', FieldByName('gubn_adyh').AsInteger, iSuga);}
            UV_SugaA4 := iSuga;
            UV_GubnA4 := FieldByName('gubn_adcg').AsString;
            UV_Suga4 := UV_SugaA4;
         end;

         //간염유형Display
         if FieldByName('gubn_agab').AsString = '1' then
         begin
            edtGubn_agyh.Text := IntToStr(FieldByName('gubn_agyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '5', FieldByName('gubn_agyh').AsInteger, iSuga);
            UV_SugaA5 := iSuga;
            UV_GubnA5 := FieldByName('gubn_agcg').AsString;
            UV_Suga5 := UV_SugaA5;
         end
         else if FieldByName('gubn_agab').AsString = '2' then
         begin
            edtGubn_agyh.Text := IntToStr(FieldByName('gubn_agyh').AsInteger) + '-'
                               + UF_Jae_Hangmok(FieldByName('cod_jisa').AsString, FieldByName('num_id').AsString, '5', FieldByName('gubn_agyh').AsInteger, iSuga);
            UV_SugaA5 := iSuga;
            UV_GubnA5 := FieldByName('gubn_agcg').AsString;
            UV_Suga5 := UV_SugaA5;
         end;

         sHangmokList := '';
         if edtCOD_JANGBI.Text <> '' then
         begin
            qryPf_hm.Active := False;
            qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
            qryPf_hm.Active := True;
            if qryPf_hm.RecordCount > 0 then
            begin
               while not qryPf_hm.Eof do
               begin
                  sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
                  qryPf_hm.Next;
               end;
            end;
            qryPf_hm.Active := False;
         end;

         if edtCOD_HUL.Text <> '' then
         begin
            qryPf_hm.Active := False;
            qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
            qryPf_hm.Active := True;
            if qryPf_hm.RecordCount > 0 then
            begin
               while not qryPf_hm.Eof do
               begin
                  sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
                  qryPf_hm.Next;
               end;
            end;
            qryPf_hm.Active := False;
         end;

         if edtCOD_CANCER.Text <> '' then
         begin
            qryPf_hm.Active := False;
            qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
            qryPf_hm.Active := True;
            if qryPf_hm.RecordCount > 0 then
            begin
               while not qryPf_hm.Eof do
               begin
                  sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
                  qryPf_hm.Next;
               end;
            end;
            qryPf_hm.Active := False;
         end;
         sHangmokList := sHangmokList + GF_GridToSingle(grdCod_Chuga);

         //특정암유형Display
         if FieldByName('gubn_gong').AsString = '1' then
         begin
            edtGubn_goyh.Text := IntToStr(FieldByName('gubn_goyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '6', FieldByName('gubn_goyh').AsInteger, iSuga);
            UV_SugaA6 := iSuga;
            UV_GubnA6 := FieldByName('gubn_gocg').AsString;
            UV_Suga6 := UV_SugaA6;

            if pos('위', UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '6', FieldByName('gubn_goyh').AsInteger, iSuga)) > 0 then
               Ck_UA.Checked := True;
            if pos('대장', UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '6', FieldByName('gubn_goyh').AsInteger, iSuga)) > 0 then
               Ck_DJA.Checked := True;
            if pos('간', UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '6', FieldByName('gubn_goyh').AsInteger, iSuga)) > 0 then
               Ck_GA.Checked := True;
            if pos('유방', UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '6', FieldByName('gubn_goyh').AsInteger, iSuga)) > 0 then
               Ck_UBA.Checked := True;
            if pos('자궁', UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '6', FieldByName('gubn_goyh').AsInteger, iSuga)) > 0 then
               Ck_JGA.Checked := True;
         end;

         
         //특정암 미청구 유형Display  
         UV_sYsno_gocg := FieldByName('Ysno_Gocg').AsString;
         if FieldByName('Ysno_Gocg').AsString <> '' then
         begin

            edt_Ysno_gocg.Text := IntToStr(FieldByName('Ysno_Gocg').AsInteger) + '-'
                               + UF_No_Hangmok_Ysno_gocg(FieldByName('dat_gmgn').AsString, '6', FieldByName('Ysno_Gocg').AsInteger);


            if pos('위', UF_No_Hangmok_Ysno_gocg(FieldByName('dat_gmgn').AsString, '6', FieldByName('Ysno_Gocg').AsInteger)) > 0 then
               Ysno_UA.Checked := True
            else
               Ysno_UA.Checked := False;
            if pos('대장', UF_No_Hangmok_Ysno_gocg(FieldByName('dat_gmgn').AsString, '6', FieldByName('Ysno_Gocg').AsInteger)) > 0 then
               Ysno_DJA.Checked := True
            else
               Ysno_DJA.Checked := False;
            if pos('간', UF_No_Hangmok_Ysno_gocg(FieldByName('dat_gmgn').AsString, '6', FieldByName('Ysno_Gocg').AsInteger)) > 0 then
               Ysno_GA.Checked := True
            else
               Ysno_GA.Checked := False;
            if pos('유방', UF_No_Hangmok_Ysno_gocg(FieldByName('dat_gmgn').AsString, '6', FieldByName('Ysno_Gocg').AsInteger)) > 0 then
               Ysno_UBA.Checked := True
            else
               Ysno_UBA.Checked := False;
            if pos('자궁', UF_No_Hangmok_Ysno_gocg(FieldByName('dat_gmgn').AsString, '6', FieldByName('Ysno_Gocg').AsInteger)) > 0 then
               Ysno_JGA.Checked := True
            else
               Ysno_JGA.Checked := False;
         end
         else
         begin   
            edt_Ysno_gocg.Text := '';
            Ysno_UA.Checked  := False;
            Ysno_DJA.Checked := False;
            Ysno_GA.Checked  := False;
            Ysno_UBA.Checked := False;
            Ysno_JGA.Checked := False;

         end;

         //생애전환기유형Display
         if FieldByName('gubn_life').AsString = '1' then
         begin
            edtGubn_lfyh.Text := IntToStr(FieldByName('gubn_lfyh').AsInteger) + '-'
                               + UF_No_Hangmok(FieldByName('dat_gmgn').AsString, '7', FieldByName('gubn_lfyh').AsInteger, iSuga);
            UV_SugaA7 := iSuga;
            UV_GubnA7 := FieldByName('gubn_lfcg').AsString;
            UV_Suga7 := UV_SugaA7;

            Ck_1cha.Checked := True;
         end;

         valsuga_johap.Value    := FieldByName('suga_johap').AsInteger;
         
         // 마감일자 Check.
         with qryMagam do
         begin
            Active := False;
            ParamByName('cod_jisa').AsString  := UV_sJisa;
            ParamByName('dat_magam').AsString := qryGumgin.FieldByName('DAT_GMGN').AsString;
            Active := True;
         end;

         // 분주번호 생성시 수정을 못하도록
         if (FieldByName('YSNO_BUNJU').AsString = 'Y') or (qryMagam.RecordCount > 0) then
         begin
            Magam_Check := True;
            Chuga_Check:=false;
{            pnlDetail.Enabled := False}
            btnDelete.Enabled      := False;
            mskDAT_GMGN.Enabled    := False;
            edtCOD_JANGBI.Enabled  := False;
            edtCOD_HUL.Enabled     := False;
            edtNUM_SAMP.enabled    := False;
            edtCOD_CANCER.Enabled  := False;
            btnHm_insert.Enabled   := False;
            btnHm_delete.Enabled   := False;
            cmbGUBN_NOSIN.Enabled  := False;
            cmbGUBN_TKGM.Enabled   := False;
//            cmbGUBN_BOGUN.Enabled  := False;
            cmbGUBN_ADULT.Enabled  := False;

            //[2018.05.07-유동구]특정암 분주생성 시 선택불가로 변경..(김창규 팀장 요청)
            //간암 진행 시 혈액검사가 존재
            //------------------------------------------------------------------
            cmbGUBN_GONG.Enabled   := False;
            cmbGUBN_GOCG.Enabled   := False;
            //==================================================================

            cmbGUBN_AGAB.Enabled   := False;
            cmbGUBN_NSCG.Enabled   := False;
            cmbGUBN_TKCG.Enabled   := False;
            cmbGUBN_BGCG.Enabled   := False;
            cmbGUBN_ADCG.Enabled   := False;
            cmbGUBN_AGCG.Enabled   := False;
            valSUGA_DANCHE.Enabled := False;
            valSUGA_GIBD.Enabled   := False;
            valSUGA_GONGJE.Enabled := False;
            valSUGA_JOHAP.Enabled  := False;
            valSUGA_TOT.Enabled    := False;
            valYUL_MCIJ.Enabled    := False;
            btnSugum.Enabled       := True;
            UV_Check_ipkm          := False;
            cmbGUBN_LIFE.Enabled   := False;
            cmbGUBN_LFCG.Enabled   := False;
            HUL_Check.Enabled      := False;
{
            //부산 영업사원수정 임시적용(2005.1.19)...
            if ((GV_sUserId = '610039') or (GV_sUserId = '610095')) and
               (copy(cmbCOD_JISA.Text,1,2) = '61')  then
               cmbCOD_SALER.Enabled   := True
            else
               cmbCOD_SALER.Enabled   := False;
}
            cmbCOD_SALER.Enabled     := False;
            edtCOD_DC.Enabled        := False;
            btnCOD_DC.Enabled        := False;
            cmbCOD_JISA.Enabled      := False;
            btnDAT_GMGN.Enabled      := False;
            btnPInsert.Enabled       := False;
            rdgGubn_hulgum.Enabled   := False;
            cmbGUBN_NEAWON.Enabled   := False;
            mskNUM_JUMIN.Enabled     := False;
            SBtn_PreRegister.Enabled := False;
            btnCOD_JANGBI.Enabled    := False;
            btnCOD_HUL.Enabled       := False;
            btnCOD_CANCER.Enabled    := False;
            btnCOD_CHUGA.Enabled     := False;
            CkBox_Jumin.Enabled      := False;
            Ck_1cha.Enabled          := False;

            if (GV_sJisa <> '00') AND (GV_sJisa <> '15') AND (GV_sJisa <> '11') AND (GV_sJisa <> '12') AND (GV_sJisa <> '43') AND (GV_sJisa <> '51') then
            begin
               Com_BD.Enabled      := False;
            end;

         end
         else
         begin

            if (GV_sJisa = '00') or  (copy(GV_sUserId,1,2) = copy(cmbCOD_JISA.Text,1,2)) then
            begin
              Chuga_Check:=True;
//            pnlDetail.Enabled := True;
               btnDelete.Enabled      := True;
               mskDAT_GMGN.Enabled    := True;
               edtCOD_JANGBI.Enabled  := True;
               edtCOD_HUL.Enabled     := True;
               edtCOD_CANCER.Enabled  := True;
               btnHm_insert.Enabled   := True;
               btnHm_delete.Enabled   := True;
               cmbGUBN_NOSIN.Enabled  := True;
               cmbGUBN_TKGM.Enabled   := True;
               cmbGUBN_BOGUN.Enabled  := True;
               cmbGUBN_ADULT.Enabled  := True;

               //[2018.05.07-유동구]특정암 분주생성 시 선택불가로 변경..(김창규 팀장 요청)
               //---------------------------------------------------------------
               //간암 진행 시 혈액검사가 존재
               cmbGUBN_GONG.Enabled   := True;
               cmbGUBN_GOCG.Enabled   := True;
               //===============================================================

               cmbGUBN_AGAB.Enabled   := True;
               cmbGUBN_NSCG.Enabled   := True;
               cmbGUBN_TKCG.Enabled   := True;
               cmbGUBN_BGCG.Enabled   := True;
               cmbGUBN_ADCG.Enabled   := True;
               cmbGUBN_AGCG.Enabled   := True;
               cmbGUBN_LIFE.Enabled   := True;
               cmbGUBN_LFCG.Enabled   := True;
               valSUGA_DANCHE.Enabled := True;
               valSUGA_GIBD.Enabled   := True;
               valSUGA_GONGJE.Enabled := True;
               valSUGA_JOHAP.Enabled  := True;
               valSUGA_TOT.Enabled    := False;
               valYUL_MCIJ.Enabled    := True;
               btnSugum.Enabled       := True;
               UV_Check_ipkm          := True;
               cmbCOD_SALER.Enabled   := True;
               edtCOD_DC.Enabled      := True;
               btnCOD_DC.Enabled      := True;
               cmbCOD_JISA.Enabled    := False;
               btnDAT_GMGN.Enabled    := True;
               btnPInsert.Enabled     := True;
               rdgGubn_Hulgum.Enabled := True;
               cmbGUBN_NEAWON.Enabled := True;
               mskNUM_JUMIN.Enabled   := True;
               edtNUM_SAMP.Enabled    := True;
               Com_BD.Enabled         := True;
               btnCOD_JANGBI.Enabled  := True;
               btnCOD_HUL.Enabled     := True;
               btnCOD_CANCER.Enabled  := True;
               btnCOD_CHUGA.Enabled   := True;
               CkBox_Jumin.Enabled    := True;
//               HUL_Check.Enabled      := True;
            end
            else
            begin
               Chuga_Check:=False;
               btnDelete.Enabled        := False;
               mskDAT_GMGN.Enabled      := False;
               edtCOD_JANGBI.Enabled    := False;
               edtCOD_HUL.Enabled       := False;
               edtNUM_SAMP.enabled      := False;
               edtCOD_CANCER.Enabled    := False;
               btnHm_insert.Enabled     := False;
               btnHm_delete.Enabled     := False;
               cmbGUBN_NOSIN.Enabled    := False;
               cmbGUBN_TKGM.Enabled     := False;
//               cmbGUBN_BOGUN.Enabled    := False;
               cmbGUBN_ADULT.Enabled    := False;

               //[2018.05.07-유동구]특정암 분주생성 시 선택불가로 변경..(김창규 팀장 요청)
               //---------------------------------------------------------------
               //간암 진행 시 혈액검사가 존재
               cmbGUBN_GONG.Enabled     := False;
               cmbGUBN_GOCG.Enabled     := False;
               //===============================================================

               cmbGUBN_AGAB.Enabled     := False;
               cmbGUBN_NSCG.Enabled     := False;
               cmbGUBN_TKCG.Enabled     := False;
               cmbGUBN_BGCG.Enabled     := False;
               cmbGUBN_ADCG.Enabled     := False;
               cmbGUBN_AGCG.Enabled     := False;
               cmbGUBN_LIFE.Enabled     := False;
               cmbGUBN_LFCG.Enabled     := False;
               valSUGA_DANCHE.Enabled   := False;
               valSUGA_GIBD.Enabled     := False;
               valSUGA_GONGJE.Enabled   := False;
               valSUGA_JOHAP.Enabled    := False;
               valSUGA_TOT.Enabled      := False;
               valYUL_MCIJ.Enabled      := False;
               btnSugum.Enabled         := True;
               UV_Check_ipkm            := False;
               cmbCOD_SALER.Enabled     := False;
               edtCOD_DC.Enabled        := False;
               btnCOD_DC.Enabled        := False;
               cmbCOD_JISA.Enabled      := False;
               btnDAT_GMGN.Enabled      := False;
               btnPInsert.Enabled       := False;
               rdgGubn_hulgum.Enabled   := False;
               cmbGUBN_NEAWON.Enabled   := False;
               mskNUM_JUMIN.Enabled     := False;
               SBtn_PreRegister.Enabled := False;
               btnCOD_JANGBI.Enabled    := False;
               btnCOD_HUL.Enabled       := False;
               btnCOD_CANCER.Enabled    := False;
               btnCOD_CHUGA.Enabled     := False;
               CkBox_Jumin.Enabled      := False;
               HUL_Check.Enabled        := False;
               Ck_1cha.Enabled          := False;
            end;

            if (GV_sJisa <> '00') AND (GV_sJisa <> '15') AND (GV_sJisa <> '11') AND (GV_sJisa <> '12')AND (GV_sJisa <> '43') AND (GV_sJisa <> '51')then
            begin
               Com_BD.Enabled      := False;
            end;

         end;
         qryMagam.Active := False;
      end
      else
      begin
         GF_MsgBox('Information', 'NODATA');
         exit;
      end;
      Active := False;
   end;

   // 인적이 존재하는지 확인
   with qryInjouk do
   begin
      // Filter 제거
      Filtered := False;

      Active := False;
      ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
      Active := True;
      if RecordCount > 0 then
      begin
         if FieldByName('ysno_Homepage').AsString <> ''  then
            begin
            if FieldByName('ysno_Homepage').AsString ='Y' then
               Chk_ysno_Homepage.Checked  := True
               else
               Chk_ysno_Homepage.Checked  := False;
         end;
         if FieldByName('ysno_Company').AsString <> ''  then
         begin
            if FieldByName('ysno_Company').AsString ='Y' then
               Chk_ysno_Company.Checked  := True
               else
               Chk_ysno_Company.Checked  := False;
         end;
         if FieldByName('Ysno_Sod_Citrate').AsString <> '' then
            begin
            if FieldByName('Ysno_Sod_Citrate').AsString ='Y' then
               CK_Sod_Citrate.Checked  := True
               else
               CK_Sod_Citrate.Checked  := False;
         end;

         if FieldByName('Ysno_SMS_Agreement').AsString = 'Y' then
            Ck_Ysno_SMS_Agreement.Checked := True
         else
            Ck_Ysno_SMS_Agreement.Checked := False;
      end;
      Active := False;
   end;

   with qryMunjin do
   begin
      Active := False;
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString :=  Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) +
                                           Copy(cmbGmgn.Text, 9, 2);
      Active := True;

      if RecordCount > 0 then
      begin
         if FieldByName('YSNO_DRINK').AsString = 'Y' then
            ckYSNO_DRINKY.Checked := True
         else if fieldByName('YSNO_DRINK').AsString = 'N' then
            ckYSNO_DRINKN.Checked := True
         else
         begin
            ckYSNO_DRINKY.Checked := False;
            ckYSNO_DRINKN.Checked := False;
         end;

         if FieldByName('YSNO_SMOKE').AsString = 'Y' then
            ckYSNO_SMOKEY.Checked := True
         else if FieldByName('YSNO_SMOKE').AsString = 'N' then
            ckYSNO_SMOKEN.Checked := True
         else
         begin
            ckYSNO_SMOKEY.Checked := False;
            ckYSNO_SMOKEN.Checked := False;
         end;

         if FieldByName('YSNO_YSHU').AsString = 'Y' then
            ckYSNO_YSHUY.Checked := True
         else if FieldByName('YSNO_YSHU').AsString = 'N' then
            ckYSNO_YSHUN.Checked := True
         else
         begin
            ckYSNO_YSHUY.Checked := False;
            ckYSNO_YSHUN.Checked := False;
         end;

         //과거병력 표시
         sData := FieldByName('DESC_KGBL').AsString;
         if sData <> '' then
         begin
            sTemp := sData;
            if  Pos('간장질환,', sTemp) > 0 then
            begin
               ckDESC_KGBL1.Checked := true;
               sTemp := copy(sTemp, 1, Pos('간장질환,', sTemp) - 1) +
                        copy(sTemp, Pos('간장질환,', sTemp) + 9, length(sTemp));
            end;
            if  Pos('고혈압', sTemp) > 0 then
            begin
               ckDESC_KGBL2.Checked := true;
               sTemp := copy(sTemp, 1, Pos('고혈압,', sTemp) - 1) +
                        copy(sTemp, Pos('고혈압,', sTemp) + 7, length(sTemp));
            end;
            if  Pos('뇌졸증', sTemp) > 0 then
            begin
               ckDESC_KGBL3.Checked := true;
               sTemp := copy(sTemp, 1, Pos('뇌졸증,', sTemp) - 1) +
                        copy(sTemp, Pos('뇌졸증,', sTemp) + 7, length(sTemp))
            end;
            if  Pos('심장병', sTemp) > 0 then
            begin
               ckDESC_KGBL4.Checked := true;
               sTemp := copy(sTemp, 1, Pos('심장병,', sTemp) - 1) +
                        copy(sTemp, Pos('심장병,', sTemp) + 7, length(sTemp))
            end;
            if  Pos('당뇨병', sTemp) > 0 then
            begin
               ckDESC_KGBL5.Checked := true;
               sTemp := copy(sTemp, 1, Pos('당뇨병,', sTemp) - 1) +
                        copy(sTemp, Pos('당뇨병,', sTemp) + 7, length(sTemp))
            end;
            if  Pos('암', sTemp) > 0 then
            begin
               ckDESC_KGBL6.Checked := true;
               sTemp := copy(sTemp, 1, Pos('암,', sTemp) - 1) +
                        copy(sTemp, Pos('암,', sTemp) + 3, length(sTemp))
            end;
            if sTemp <> '' then
            begin
               edtDESC_KGBL.text := sTemp;
            end;
         end;

    {     if Trim(sData) <> '' then
         begin
            if GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1)) = '간장질환' then
               ckDESC_KGBL1.Checked := True
            else
            if GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1)) = '고혈압' then
               ckDESC_KGBL2.Checked := True
            else
            if GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1)) = '뇌졸증' then
               ckDESC_KGBL3.Checked := True
            else
            if GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1)) = '심장병' then
               ckDESC_KGBL4.Checked := True
            else
            if GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1)) = '당뇨병' then
               ckDESC_KGBL5.Checked := True
            else
            if GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1)) = '암' then
               ckDESC_KGBL6.Checked := True
            else
            if pos(',', sData) > 0 then
            begin
               if Trim(GF_SpaceDel(Copy(sData, 1, Pos(',', sData)-1))) <> '' then
                  edtDESC_KGBL.Text := Trim(Copy(sData, 1, Pos(',', sData)));
            end
            else
                  edtDESC_KGBL.Text := Trim(sData);
            iLength := Length(sData);
            sData := Copy(sData, Pos(',', sData)+1, iLength-Pos(',', sData));
         end; }
      end;
      Active := False;
   end;

   with qryKicho do
   begin
      Active := False;
      ParamByName('cod_jisa').AsString :=  Copy(cmbCod_jisa.Text, 1, 2);
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString :=  Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) +
                                           Copy(cmbGmgn.Text, 9, 2);
      Active := True;

      if RecordCount > 0 then
      begin
         valSINJANG.Value     := FieldByName('SINJANG').AsFloat;
         valCHEJUNG.Value     := FieldByName('CHEJUNG').AsFloat;
         valBIMAN.Value       := FieldByName('BIMAN').AsFloat;
         valHUL_H.Value       := FieldByName('HUL_H').AsInteger;
         valHUL_L.Value       := FieldByName('HUL_L').AsInteger;
         valEAR_LEFT10.Value   := FieldByName('EAR_LEFT10').AsInteger;
         valEAR_RIGHT10.Value  := FieldByName('EAR_RIGHT10').AsInteger;
{ji}     if FieldByname('ysno_label').AsString = 'Y' then
            vip.checked := true
         else
            vip.checked := False;
         if FieldByName('EYE_LMAN').AsFloat > 0 then
         begin
            ckEYE1.Checked    := True;
            ckEYE2.Checked    := False;
            valEYE_LMAN.Value := FieldByName('EYE_LMAN').AsFloat;
            valEYE_RMAN.Value := FieldByName('EYE_RMAN').AsFloat;
         end
         else
         if FieldByName('EYE_LKYO').AsFloat > 0 then
         begin
            ckEYE2.Checked    := True;
            ckEYE1.Checked    := False;
            valEYE_LMAN.Value := FieldByName('EYE_LKYO').AsFloat;
            valEYE_RMAN.Value := FieldByName('EYE_RKYO').AsFloat;
         end;

      end;
      Active := False;
   end;

   with qryHul_Condition do
   begin
      Active := False;
      ParamByName('cod_jisa').AsString :=  Copy(cmbCod_jisa.Text, 1, 2);
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString :=  Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) +
                                           Copy(cmbGmgn.Text, 9, 2);
      Active := True;
      if RecordCount > 0 then
      begin
         if FieldByName('HUL_CK').AsString = 'Y' then
            HUL_Check.Checked := True
         else if fieldByName('HUL_CK').AsString = 'N' then
            HUL_Check.Checked := False;
      end
      else HUL_Check.Checked := False;
      Active := False;
   end;

   rdNeawon.Checked := False;
   mskNeawon.Text := '';
   rdPost.Checked := False;
   mskPost.Text := '';
   rdEmail.Checked := False;
   rdHmpg.Checked := False;
   rdMobile.Checked := False;
   rdCompany.Checked := False;
   mskCompany.Text  := '';   
   with qrySangdam_Rev do
   begin
      close;
      ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString := Copy(cmbGmgn.Text,1,4) + Copy(cmbGmgn.Text,6,2) + Copy(cmbGmgn.Text,9,2);
      open;
      if recordcount > 0 then
      begin
         if FieldByName('bang_suryung').AsString = '1' then
         begin
            rdNeawon.checked := true;
            mskNeawon.text   := FieldByName('dat_sangdamRev').AsString;
         end
         else if FieldByName('bang_suryung').AsString = '2' then
         begin
            rdPost.Checked   := true;
            mskPost.text    := FieldByName('dat_balsong').AsString;
         end
         else if FieldByName('bang_suryung').AsString = '3' then
         begin
            rdHmpg.Checked   := true;
         end
         else if FieldByName('bang_suryung').AsString = '4' then
         begin
            rdEmail.Checked   := true;
         end
         else if FieldByName('bang_suryung').AsString = '6' then
         begin
            rdCompany.Checked   := true;
            mskCompany.Text     := FieldByName('dat_Company').AsString;
         end
         else if FieldByName('bang_suryung').AsString = '5' then
         begin
            rdPost.Checked   := true;
            mskPost.text    := FieldByName('dat_balsong').AsString;
            rdEmail.Checked   := true;
         end
         else if FieldByName('bang_suryung').AsString = '7' then
         begin
            rdPost.Checked   := true;
            mskPost.text    := FieldByName('dat_balsong').AsString;
            rdHmpg.Checked   := true;
         end
         else if FieldByName('bang_suryung').AsString = '8' then
         begin
            rdPost.Checked     := true;
            mskPost.text       := FieldByName('dat_balsong').AsString;
            rdCompany.Checked  := true;
            mskCompany.Text    := FieldByName('dat_Company').AsString;
         end
         else if FieldByName('bang_suryung').AsString = '9' then
         begin
            rdMobile.Checked   := true;
         end;
      end else
      begin
         rdNeawon.checked := false;
         rdPost.checked   := false;
         rdHmpg.checked   := false;
         rdEmail.checked  := false;
         rdCompany.checked  := false;
         rdMobile.checked   := false;
         mskNeawon.text   := '';
         mskPost.Text     := '';
         mskCompany.Text  := '';
      end;
      SDcheck := true;
      close;
   end;
   //특검 출력일 표시 (2015.04.07 김창규)
   If Copy(cmbCOD_JISA.Text,1,2) = '11' Then
   With qryTk_Print Do
      Begin
         Label26.Visible     := True;
         edtTk_Print.Visible := True;
         Active := False;
         ParamByName('Cod_Jisa').AsString  := Copy(cmbCod_Jisa.Text,1,2);
         ParamByName('Dat_Gmgn').AsString  := mskDat_Gmgn.Text;
         ParamByName('Num_Jumin').AsString := mskNum_Jumin.Text;
         ParamByName('Gubn_Cha').AsString  := Copy(cmbGUBN_TKGM.Text,1,1);
         Active := True;
         If RecordCount > 0 Then edtTk_Print.Text := FieldByName('Dat_Print').AsString
         Else edtTk_Print.Text := '';
         Active := False;
      End
   Else
      Begin
          Label26.Visible     := False;
          edtTk_Print.Visible := False;
      End;


   //공단 출력일 표시  한의 강남검진사업지원팀1700961
   With qryNs_sokun Do
   Begin
      Active := False;
      ParamByName('Cod_Jisa').AsString  := Copy(cmbCod_Jisa.Text,1,2);
      ParamByName('Dat_Gmgn').AsString  := mskDat_Gmgn.Text;
      ParamByName('num_id').AsString    := UV_sNum_id;
      Active := True;
      If RecordCount > 0 Then
      begin
         Lbl_Gong_print.Visible     := True;
         edtGong_Print.Visible      := True;
         if FieldByName('Dat_Print').AsString <> '' then
         begin
            edtGong_Print.Text := FieldByName('Dat_Print').AsString;
            if FieldByName('gubn_balsong').AsString = '1' then
               Lbl_Gong_print.Caption := '공단(우편)'
            else if FieldByName('gubn_balsong').AsString = '2' then
               Lbl_Gong_print.Caption := '공단(등기)'
            else if FieldByName('gubn_balsong').AsString = '3' then
               Lbl_Gong_print.Caption := '공단(회사)'    
            else if FieldByName('gubn_balsong').AsString = '4' then
               Lbl_Gong_print.Caption := '공단(내원)'
            else if FieldByName('gubn_balsong').AsString = '5' then
               Lbl_Gong_print.Caption := '공단(택배)'
            else
               Lbl_Gong_print.Caption := '공단()';
         end
         else
         begin
            Lbl_Gong_print.Visible     := False;
            edtGong_Print.Visible      := False;
         end;
      end
      Else
      begin
         Lbl_Gong_print.Visible     := False;
         edtGong_Print.Visible      := False;
      end;
      Active := False;
   End;
   // 암검사관련 05.05.26
 {  with qryCa_gubun do
   begin
      close;
      ParamByName('cod_jisa').AsString := copy(cmbCod_jisa.text,1,2);
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString := copy(cmbGmgn.text,1,4) + copy(cmbGmgn.text,6,2) + copy(cmbGmgn.text,9,2);
      open;
      if recordcount > 0 then
      begin
         if trim(FieldByName('gubn_jik').AsString) <> '' then gubn_jik.itemindex := FieldByName('gubn_jik').AsInteger;
         if trim(FieldByName('gubn_am').AsString) <> ''  then gubn_am.itemindex  := FieldByName('gubn_am').AsInteger;
         bogun_kiho.Text    := FieldByName('bogun_kiho').AsString;
      end else
      begin
         with qryNhic do
         begin
            close;
            ParamByName('cod_jisa').AsString  := copy(cmbCod_jisa.text,1,2);
            ParamByName('num_id').AsString    := UV_sNum_id;
            ParamByName('year_saup').AsString := copy(cmbGmgn.text,1,4);
            open;
            if recordcount > 0 then
            begin
               gubn_jik.itemindex := FieldByName('gubn_jik').AsInteger - 1;
//               gubn_am.itemindex  := 0;                                       //07.04.12 제대로 보이게끔
               if ((FieldByName('gubn_UA').AsString = '1') or (FieldByName('gubn_DJA').AsString = '1') or
                  (FieldByName('gubn_GA').AsString = '1') or (FieldByName('gubn_JGA').AsString = '1')) then
                   gubn_am.itemindex  := 1
               else if ((FieldByName('gubn_UA').AsString = '2') or (FieldByName('gubn_DJA').AsString = '2') or
                  (FieldByName('gubn_GA').AsString = '2') or (FieldByName('gubn_JGA').AsString = '2')) then
                   gubn_am.itemindex  := 0;
               bogun_kiho.text    := FieldByName('num_bogun').AsString;
            end;
         end;
      end;
      close;
   end;
}
   //무료영상발급Check 2015.09.01 김창규
   With qryChk_Free Do
   Begin
      Active := False;
      ParamByName('Cod_Dc').AsString := edtCod_dc.Text;
      //ParamByName('ST_Date').AsString := Copy(mskDat_Gmgn.Text,1,4) + '%';
      //ParamByName('ED_Date').AsString := Copy(mskDat_Gmgn.Text,1,4) + '%';
      ParamByName('ST_Date').AsString := mskDat_Gmgn.Text;
      ParamByName('ED_Date').AsString := mskDat_Gmgn.Text;
      Active := True;
      if isEmpty = False then
      begin
          If FieldByName('Chk_Free').AsString = 'Y' Then
          begin
              Chk_Free.Checked := True;
          end Else
          begin
              qryChk_freeCD.Active := False;
              qryChk_freeCD.ParamByName('Cod_Dc').AsString := edtCod_dc.Text;
              qryChk_freeCD.ParamByName('num_seq').AsInteger := iSeq;
              qryChk_freeCD.ParamByName('cod_gmgn').AsString := sGmgn;
              qryChk_freeCD.ParamByName('dat_start').AsString := mskDat_Gmgn.Text;
              qryChk_freeCD.ParamByName('dat_End').AsString := mskDat_Gmgn.Text;
              qryChk_freeCD.Active := True;
              if qryChk_freeCD.IsEmpty = False then
              begin
                 if qryChk_freeCD.FieldByName('Chk_freeCD').AsString = 'Y' then Chk_Free.Checked := True
                 else Chk_Free.Checked := False;
              end else
              begin
                 Chk_Free.Checked := False;
              end;
          end;
      end else
      begin
          Chk_Free.Checked := False;
      end;
      Active := False;
   End;

   UP_SetMode('QUERY');
end;

procedure TfrmCK3I01.btnDeleteClick(Sender: TObject);
var i : integer;
begin
   inherited;

   // Delete Confirm Message
   if (Trim(mskNUM_JUMIN.Text) = '') or (mskNUM_JUMIN.Enabled = False) then exit;

   if copy(GV_sUserId,1,2) <> copy(cmbCOD_JISA.Text,1,2) then
   begin
      ShowMessage('타지사접수내역은 삭제할 수 없습니다.');
      exit;
   end;

   if not GF_MsgBox('Confirmation', 'DELETE') then exit;

   dmComm.database.StartTransaction;
   // Delete 작업수행
   try                    
      with qryD_Tk_JeaGum_chk do
      begin
         ParamByName('COD_JISA').AsString     := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString     := mskDAT_GMGN.Text;
         ParamByName('NUM_Jumin').AsString    := mskNUM_JUMIN.Text;
         ExecSql;
         GP_query_log(qryD_Tk_JeaGum_chk, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Munjin do
      begin
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qryD_Munjin, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Kicho do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qryD_Kicho, 'CK3I01', 'D', 'Y');
      end;

      with qryD_HCondition do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qryD_HCondition, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Gumgin do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qryD_Gumgin, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Tkgum do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
         ExecSql;
         GP_query_log(qryD_Tkgum, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Mechul do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
         ExecSql;
         GP_query_log(qryD_Mechul, 'CK3I01', 'D', 'Y');
      end;

      //[2018.05.16-유동구]향정 처방전 식별 유형 삭제..
      //------------------------------------------------------------------------
      with qryD_Person_IDType do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qryD_Person_IDType, 'CK3I01', 'D', 'Y');
      end;
      //========================================================================

      qry_ipkum.Active := False;
      qry_ipkum.ParamByName('COD_JISA').AsString   := Copy(cmbCOD_JISA.Text, 1, 2);
      qry_ipkum.ParamByName('NUM_JUMIN').AsString  := mskNUM_JUMIN.Text;
      qry_ipkum.ParamByName('DAT_CHGU').AsString   := mskDAT_GMGN.Text;
      qry_ipkum.Active := True;
      if qry_ipkum.RecordCount > 0 then
      begin
           for i := 0 to qry_ipkum.recordcount - 1 do
           begin
                if qry_ipkum.FieldByName('dep_no').AsString <> '' then
                begin
                     with qryU_Dep do
                     begin
                           ParamByName('cod_jisa').AsString      := Copy(cmbCOD_JISA.Text, 1, 2);
                           ParamByName('Dep_No').AsString        := qry_ipkum.FieldByName('dep_no').AsString;
                           ParamByName('Dep_date').AsString      := qry_ipkum.FieldByName('dat_ipkum').AsString;
                           ParamByName('Chk_gubn').AsString      := '';
                           ParamByName('Chk_sawon').AsString     := '';
                           ParamByName('Chk_date').AsString      := '';
                           ParamByName('COD_UPDATE').AsString    := GV_sUserId;

                           Execsql;
                           GP_query_log(qryU_Dep, 'CK3I01', 'U', 'Y');
                     end;
                end
                else if qry_ipkum.FieldByName('pay_no').AsString <> '' then
                begin
                     with qryU_pay do
                     begin
                           ParamByName('cod_jisa').AsString      := Copy(cmbCOD_JISA.Text, 1, 2);
                           ParamByName('Pay_no').AsString        := qry_ipkum.FieldByName('pay_no').AsString;
                           ParamByName('Pay_date').AsString      := qry_ipkum.FieldByName('dat_ipkum').AsString;
                           ParamByName('Chk_jisa').AsString      := '';
                           ParamByName('Chk_sawon').AsString     := '';
                           ParamByName('Chk_date').AsString      := '';
                           ParamByName('COD_UPDATE').AsString    := GV_sUserId;

                           Execsql;
                           GP_query_log(qryU_pay, 'CK3I01', 'U', 'Y');
                     end;
                end;
                qry_ipkum.Next;
           end;
      end;

      with qryD_Ipkum do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_CHGU').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
         ExecSql;
         GP_query_log(qryD_Ipkum, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Chunggu do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
         ExecSql;
         GP_query_log(qryD_Chunggu, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Send_Gumgin do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qryD_Send_Gumgin, 'CK3I01', 'D', 'Y');
      end;

      with qrySDdelete do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_ID').AsString    := UV_sNum_id;
         ExecSql;
         GP_query_log(qrySDdelete, 'CK3I01', 'D', 'Y');
      end;

      with qryD_coupon_use do
      begin
         ParamByName('cod_usejisa').AsString := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
         ParamByName('num_id').AsString      := UV_sNum_id;
         Execsql;
         GP_query_log(qryD_coupon_use, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Free do
      begin
         ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
         ParamByName('num_id').AsString      := UV_sNum_id;

         Execsql;
         GP_query_log(qryD_Free, 'CK3I01', 'D', 'Y');
      end;


      //[2018.04.16-유동구]처음 고객인 경우 삭제 시 인적정보 미삭제 회원번호와 주민번호만 남김(한의 수원영상일반파트1800347}
      //PACS연동으로 인한 인적정보 재 사용금지를 위한 조치...
      qryS_gumgin.Active := False;
      qryS_gumgin.ParamByName('NUM_JUMIN').AsString  := mskNUM_JUMIN.Text;
      qryS_gumgin.ParamByName('NUM_ID').AsString    := UV_sNum_id;
      qryS_gumgin.Active := True;
      if qryS_gumgin.RecordCount = 0 then
      begin
         with qryU_Injouk do
         begin
            ParamByName('NUM_ID').AsString             := UV_sNum_id;
            ParamByName('num_jumin').AsString          := mskNUM_JUMIN.Text;
            ParamByName('desc_name').AsString          := '';
            ParamByName('num_tel').AsString            := '';
            ParamByName('num_post').AsString           := '';
            ParamByName('ysno_folk').AsString          := '';
            ParamByName('desc_addr').AsString          := '';
            ParamByName('cod_dc').AsString             := '';
            ParamByName('num_sabun').AsString          := '';
            ParamByName('gubn_jik').AsString           := '';
            ParamByName('desc_dept').AsString          := '';
            ParamByName('num_bohm1').AsString          := '';
            ParamByName('num_bohm2').AsString          := '';
            ParamByName('dat_ipsa').AsString           := '';
            ParamByName('gubn_susin').AsString         := '';
            ParamByName('desc_email').AsString         := '';
            ParamByName('gubn_cnty').AsString          := '';
            ParamByName('ysno_useinfo').AsString       := '';
            ParamByName('ysno_Homepage').AsString      := '';
            ParamByName('ysno_Company').AsString       := '';
            ParamByName('Ysno_Sod_Citrate').AsString   := '';
            ParamByName('Ysno_SMS_Agreement').AsString := '';

            ParamByName('dat_update').AsString         := GV_sToday;
            ParamByName('cod_update').AsString         := GV_sUserId;

            ExecSql;

            GP_query_log(qryU_Injouk, 'CK3I01', 'U', 'Y');
         end;
      end;
      qryS_gumgin.Active := False;

      with qryD_cancel_jangbi do
      begin
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
         ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
         ExecSql;
         GP_query_log(qryD_cancel_jangbi, 'CK3I01', 'D', 'Y');
      end;

      // CPMS부분 삭제
      with qryD_standby do
      begin
         ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('num_Jumin').AsString := mskNUM_JUMIN.Text;
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;

         Execsql;
          GP_query_log(qryD_standby, 'CK3I01', 'D', 'Y');
      end;

      with qryD_jangbicheck do
      begin
         ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('num_id').AsString    := UV_sNum_id;
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;

         Execsql;
         GP_query_log(qryD_jangbicheck, 'CK3I01', 'D', 'Y');
      end;

      with qryD_Information do
      begin
         ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('num_Jumin').AsString := mskNUM_JUMIN.Text;
         ParamByName('num_id').AsString    := UV_sNum_id;
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;

         Execsql;
         GP_query_log(qryD_Information, 'CK3I01', 'D', 'Y');
      end;


      with qryD_Gumgin_Check do
      begin
         ParamByName('cod_jisa').AsString       := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('dat_gmgn').AsString       := mskDAT_GMGN.Text;
         ParamByName('Num_jumin').AsString      := mskNUM_JUMIN.Text;

         Execsql;
         GP_query_log(qryD_Gumgin_Check, 'CK3I01', 'D', 'Y');
      end;

      with qryD_ReserInfo do
      begin
           ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
           ParamByName('NUM_ID').AsString      := UV_sNum_id;
           ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
           Execsql;
           GP_query_log(qryD_ReserInfo, 'CK3I01', 'D', 'Y');
      end;
   except
      on E : EDBEngineError do
      begin
         GF_MsgBox('Error', IntToStr(E.Errors[1].NativeError));
         dmComm.database.Rollback;
         exit;
      end;
   end;

   dmComm.database.Commit;

   GP_FieldClear(pnlDetail);
   UV_sDesc_Coupon := ''; UV_sDesc_Coupon_etc := '';

   // Delete Mode & Msg
   UP_SetMode('DELETE');
end;

procedure TfrmCK3I01.btnCancelClick(Sender: TObject);
begin
   inherited;

   // 작업중인지 Check & Cancel Confirm Message
   if not UV_bEdit then exit;
   if not GF_MsgBox('Confirmation', 'CANCEL') then exit;

   // 취소시
   // 1.입력이면 화면 Clear
   // 2.수정이면 Re-query
   if UV_iStatus = GC_Insert then
      GP_FieldClear(pnlDetail)
   else if Trim(UV_sNum_id) <> '' then
      btnQueryClick(cmbGmgn);

   Btn_Complain.Enabled := False;
   mskNUM_JUMIN.Color := $00E6FFFE;
   Timer1.Interval := 0;

   UV_sDesc_Coupon := ''; UV_sDesc_Coupon_etc := '';
   
   // Cancel Mode & Msg
   UP_SetMode('CANCEL');
end;

procedure TfrmCK3I01.UP_Change(Sender: TObject);
var sName, sChasu, sGubun, Today, sHangmok, sData : String;
    eSuga : Extended;
    sNscg, sPart : string ;
    i : Integer;
    HmList : TstringList;
begin
   inherited;
   sData := '';
   sChasu := '';
   sGubun := '';
   // Edit Change시 Event Procedure를 공유한 후 구분을 Sender로 수행
   if (Sender = ckGUBN_PREG) or (Sender = ckGUBN_PREG2) then
   begin
     if (ckGUBN_PREG.Checked) and (ckGUBN_PREG2.Checked) then
     begin
        ShowMessage('임신과 임신가능성 동시 체크 불가');

        //다른 검진자 조회 상태에서 다시 다른 검진자 조회 시 서로 다른 임신체크일때
        //A(임신), B(임신가능) A->B 조회시 체크 중복으로인해 취소구분 초기화로인한 수정
        if (Sender = ckGUBN_PREG) then
        begin
           ckGUBN_PREG.Checked  := True;
           ckGUBN_PREG2.Checked := False;
        end
        else if (Sender = ckGUBN_PREG2) then
        begin
           ckGUBN_PREG.Checked  := False;
           ckGUBN_PREG2.Checked := True;
        end
     end;

     with qryD_cancel_jangbi2 do
     begin
         if (ckGUBN_PREG.Checked = false) then 
         begin
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
               ParamByName('Num_jumin').AsString   := mskNUM_JUMIN.Text;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('gubn_cancel').AsString := '04';
               Execsql;
         end;
         if (ckGUBN_PREG2.Checked = false) then
         begin
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
               ParamByName('Num_jumin').AsString   := mskNUM_JUMIN.Text;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('gubn_cancel').AsString := '06';
               Execsql;
         end;
     end;

     if (ckGUBN_PREG.Checked = false) and (ckGUBN_PREG2.Checked = false) then
     begin
         UV_bEdit := True;
         grdCod_chuga.Repaint;
         exit;
     end;

     HmList := TstringList.Create;

     for i:=0 to  grdCod_chuga.Rows - 1 do
     begin
         hmlist.add('HM' +inttostr(i) + '=' + grdCOD_CHUGA.Cell[1, i+1]);
         hmlist.add('ETC'+inttostr(i) + '=' + grdCOD_CHUGA.Cell[6, i+1]);
     end;

     qryPf_hm.Close;
     qryPf_hm.ParamByName('cod_pf').AsString :=  edtCOD_JANGBI.Text;
     qryPf_hm.Open;
     while not qryPf_hm.Eof do
     begin
         hmlist.add('HM' +inttostr(i) + '=' + qryPf_hm.FieldByName('Cod_Hm').AsString);
         hmlist.add('ETC'+inttostr(i) + '=' + '');
         qryPf_hm.Next;
         inc(i);
     end;
     //showmessage(hmlist.text);

     if hmlist.count > 0 then
     begin
         for i := 0 to hmlist.count - 1  do
         begin
            sPart := '';
            qry_hm.Active := False;
            qry_hm.ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
            qry_hm.ParamByName('cod_hm').AsString     := hmlist.values['HM'+inttostr(i)];
            qry_hm.Active := True;

            if qry_hm.RecordCount > 0 then
            begin
                if qry_hm.FieldByName('gubn_part').AsInteger = 11 then sPart := 'T';
            end;

            if (sPart = 'T') or (hmlist.values['HM'+inttostr(i)] = 'P001') or (hmlist.values['HM'+inttostr(i)] = 'P003') or
               (hmlist.values['HM'+inttostr(i)] = 'JJ13') or (hmlist.values['HM'+inttostr(i)] = 'JJ34') or (hmlist.values['HM'+inttostr(i)] = 'JJB9') or
               (hmlist.values['HM'+inttostr(i)] = 'JJ83') or (hmlist.values['HM'+inttostr(i)] = 'JJ86') then
            begin
               if (cmbCOD_JISA.Text <> '') and
                  (mskNUM_JUMIN.Text <> '') and
                  (mskDAT_GMGN.Text <> '') then
               begin
                  with qryCancel_jangbi do
                  begin
                     Active := False;
                     ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
                     ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
                     ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
                     ParamByName('cod_hm').AsString     := hmlist.values['HM'+inttostr(i)];
                     Active := True;
                     if RecordCount > 0 then
                     begin
                        //if fieldByName('gubn_cancel').AsString = '' then
                        //begin
                           with qryU_Cancel_jangbi do
                           begin
                              ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
                              ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
                              ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                              ParamByName('cod_hm').AsString      := hmlist.values['HM'+inttostr(i)];
                              if ckGUBN_PREG.Checked then
                                 ParamByName('gubn_cancel').AsString := '04'
                              else if ckGUBN_PREG2.Checked then
                                 ParamByName('gubn_cancel').AsString := '06';
                              ParamByName('cancel_etc').AsString  := hmlist.values['ETC'+inttostr(i)];
                              ParamByName('dat_update').AsString  := GV_sToday;
                              ParamByName('cod_update').AsString  := GV_sUserId;

                              Execsql;
                           end;
                        //end;
                     end
                     else
                     begin
                        with qryI_Cancel_jangbi do
                        begin
                           ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
                           ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
                           ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                           ParamByName('cod_hm').AsString      := hmlist.values['HM'+inttostr(i)];
                           if ckGUBN_PREG.Checked then
                              ParamByName('gubn_cancel').AsString := '04'
                           else if ckGUBN_PREG2.Checked then
                              ParamByName('gubn_cancel').AsString := '06';
                           ParamByName('cancel_etc').AsString  := hmlist.values['ETC'+inttostr(i)];
                           ParamByName('dat_insert').AsString  := GV_sToday;
                           ParamByName('cod_insert').AsString  := GV_sUserId;

                           Execsql;
                        end;
                     end; //end of else
                  end;  //end of with
               end;  // end of if
            end
            else if (ckGUBN_PREG.Checked) and (hmlist.values['HM'+inttostr(i)] = 'JJD2') then
            begin
               if (cmbCOD_JISA.Text <> '') and
                  (mskNUM_JUMIN.Text <> '') and
                  (mskDAT_GMGN.Text <> '') then
               begin
                  with qryCancel_jangbi do
                  begin
                     Active := False;
                     ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
                     ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
                     ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
                     ParamByName('cod_hm').AsString     := hmlist.values['HM'+inttostr(i)];
                     Active := True;
                     if RecordCount > 0 then
                     begin
                        //if fieldByName('gubn_cancel').AsString = '' then
                        //begin
                           with qryU_Cancel_jangbi do
                           begin
                              ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
                              ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
                              ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                              ParamByName('cod_hm').AsString      := hmlist.values['HM'+inttostr(i)];
                              ParamByName('gubn_cancel').AsString := '04';
                              ParamByName('cancel_etc').AsString  := hmlist.values['ETC'+inttostr(i)];
                              ParamByName('dat_update').AsString  := GV_sToday;
                              ParamByName('cod_update').AsString  := GV_sUserId;

                              Execsql;
                           end;
                        //end;
                     end
                     else
                     begin
                        with qryI_Cancel_jangbi do
                        begin
                           ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
                           ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
                           ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
                           ParamByName('cod_hm').AsString      := hmlist.values['HM'+inttostr(i)];
                           ParamByName('gubn_cancel').AsString := '04';
                           ParamByName('cancel_etc').AsString  := hmlist.values['ETC'+inttostr(i)];
                           ParamByName('dat_insert').AsString  := GV_sToday;
                           ParamByName('cod_insert').AsString  := GV_sUserId;

                           Execsql;
                        end;
                     end; //end of else
                  end;  //end of with
               end;  // end of if
            end; //end of if
         end; //end of for
         grdCod_chuga.repaint;
     end; // end of if
     hmlist.free;
     hmlist := Nil;
   end
   else if Sender = edtCOD_DC then
   begin
      if GF_DancheEdit(edtCOD_DC, sName) then
         edtDESC_DC.Text := sName;
      //(주)포스코[직원검진] A형 유헝으로만 접수
      if edtDESC_DC.Text = '(주)포스코[직원검진]' then
         Cmb_Print.ItemIndex := 1 ;

   end
   else if (Sender = edtCOD_JANGBI) then
   begin
      if   length(edtCOD_JANGBI.text)=4 then
           Up_overlap(edtCOD_JANGBI);

      if GF_ProfileEdit(edtCOD_JANGBI, '1', sName, eSuga) then
      begin
         edtDESC_JANGBI.Text := sName;
         valSUGA_JANGBI.Value := eSuga;

         sHangmok := '';
         // 추가코드에 자료가 존재하는지 Check
         for i := 1 to grdCOD_CHUGA.Rows do
         begin
            sHangmok := sHangmok + grdCOD_CHUGA.Cell[1, i];
         end;
         //10.09.06 철. 신신 아닌건만 결과지구분함
         if Copy(edtCOD_JANGBI.Text,1,2) <> 'SS' then
            GP_ComboDisplay(Cmb_Print, GF_PrintCheck(edtCOD_JANGBI.Text, edtCOD_HUL.Text, sHangmok, copy(cmbGUBN_NOSIN.Text,1,1), copy(edtGUBN_NSYH.Text,1,pos('-', edtGUBN_NSYH.Text)-1), copy(cmbGUBN_ADULT.Text,1,1), copy(edtGUBN_ADYH.Text,1,pos('-', edtGUBN_ADYH.Text)-1), copy(cmbGUBN_LIFE.Text,1,1), copy(edtGUBN_LFYH.Text,1,pos('-', edtGUBN_LFYH.Text)-1), copy(cmbGUBN_TKGM.Text,1,1)), 2);
      end;
   end
   else if Sender = edtCOD_HUL then
   begin
      if Copy(edtCod_Hul.Text, 1, 2) = 'NO' then
      begin
         GF_MsgBox('Information', '노신에Check 하세요.');
         edtCod_hul.Text := '';
      end;
      if GF_ProfileEdit(edtCOD_HUL, '2', sName, eSuga) then
      begin
         edtDESC_HUL.Text := sName;
         valSUGA_HUL.Value := eSuga;

         sHangmok := '';
         // 추가코드에 자료가 존재하는지 Check
         for i := 1 to grdCOD_CHUGA.Rows do
         begin
            sHangmok := sHangmok + grdCOD_CHUGA.Cell[1, i];
         end;

         //10.09.06 철. 신신 아닌건만 결과지구분함
         if Copy(edtCOD_JANGBI.Text,1,2) <> 'SS' then
            GP_ComboDisplay(Cmb_Print, GF_PrintCheck(edtCOD_JANGBI.Text, edtCOD_HUL.Text, sHangmok, copy(cmbGUBN_NOSIN.Text,1,1), copy(edtGUBN_NSYH.Text,1,pos('-', edtGUBN_NSYH.Text)-1), copy(cmbGUBN_ADULT.Text,1,1), copy(edtGUBN_ADYH.Text,1,pos('-', edtGUBN_ADYH.Text)-1), copy(cmbGUBN_LIFE.Text,1,1), copy(edtGUBN_LFYH.Text,1,pos('-', edtGUBN_LFYH.Text)-1), copy(cmbGUBN_TKGM.Text,1,1)), 2);
         
         //2016.03.29 사용하지 않는코드가 있으면 다른 코드로 추가 할것(김창규) E069 -> C078로
         If mskDat_gmgn.Text >= '20160331' Then
         With qryProfile_Hm Do
            Begin
               Close;
               ParamByName('Cod_Pf').AsString := edtCod_Hul.Text;
               ParamByName('Cod_Hm').AsString := 'E069';
               Open;
               If FieldByName('Cnt').AsInteger > 0 then
                  If MessageDlg('E069사용 중단~!!! C078 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'C078';
                        btnHm_insertClick(Self);
                        C078_Check := True;
                     End;
               Close;
            End;
         //2018.04.30 s021-> c090
         If mskDat_gmgn.Text >= '20180502' Then
         With qryProfile_Hm Do
            Begin
               Close;
               ParamByName('Cod_Pf').AsString := edtCod_Hul.Text;
               ParamByName('Cod_Hm').AsString := 'S021';
               Open;
               If FieldByName('Cnt').AsInteger > 0 then
                  If MessageDlg('S021사용 중단~!!! C090 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'C090';
                        btnHm_insertClick(Self);
                        S021_Check := True;
                     End;
               Close;
            End;

            If mskDat_gmgn.Text >= '20160711' Then
            begin
                 C088_Check := False;
                 C089_Check := False;
                 With qryProfile_Hm Do
                 Begin
                    Close;
                    ParamByName('Cod_Pf').AsString := edtCod_Hul.Text;
                    ParamByName('Cod_Hm').AsString := 'C088';
                    Open;
                    If FieldByName('Cnt').AsInteger > 0 then
                       C088_Check := True;
                    Close;

                    ParamByName('Cod_Pf').AsString := edtCod_Hul.Text;
                    ParamByName('Cod_Hm').AsString := 'C089';
                    Open;
                    If FieldByName('Cnt').AsInteger > 0 then
                       C089_Check := True;
                    Close;
                 End;

                 if (C088_Check) and (C089_Check) then
                 begin
                     If MessageDlg('황산화코드(C088C089)사용 중단~!!! C084C085 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'C084';
                        btnHm_insertClick(Self);
                        edtCOD_CHUGA.Text := 'C085';
                        btnHm_insertClick(Self);
                     End;
                 end
                 else if (C088_Check) then
                 begin
                     If MessageDlg('C088사용 중단~!!! C084 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'C084';
                        btnHm_insertClick(Self);
                     End;
                 end
                 else if (C088_Check) then
                 begin
                     If MessageDlg('C089사용 중단~!!! C085 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'C085';
                        btnHm_insertClick(Self);
                     End;
                 end;
            end;

            If mskDat_gmgn.Text >= '20170313' Then
            begin
                 S079_Check := False;
                 S090_Check := False;
                 With qryProfile_Hm Do
                 Begin
                    Close;
                    ParamByName('Cod_Pf').AsString := edtCod_Hul.Text;
                    ParamByName('Cod_Hm').AsString := 'S079';
                    Open;
                    If FieldByName('Cnt').AsInteger > 0 then
                       S079_Check := True;
                    Close;

                    ParamByName('Cod_Pf').AsString := edtCod_Hul.Text;
                    ParamByName('Cod_Hm').AsString := 'S090';
                    Open;
                    If FieldByName('Cnt').AsInteger > 0 then
                       S090_Check := True;
                    Close;
                 End;

                 if (S079_Check) and (S090_Check) then
                 begin
                     If MessageDlg('알레르기 코드(S079S090)사용 중단~!!! S101S102 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'S101';
                        btnHm_insertClick(Self);
                        edtCOD_CHUGA.Text := 'S102';
                        btnHm_insertClick(Self);
                     End;
                 end
                 else if (S079_Check) then
                 begin
                     If MessageDlg('S079사용 중단~!!! S101 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'S101';
                        btnHm_insertClick(Self);
                     End;
                 end
                 else if (S090_Check) then
                 begin
                     If MessageDlg('S090사용 중단~!!! S102 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
                     Begin
                        edtCOD_CHUGA.Text := 'S102';
                        btnHm_insertClick(Self);
                     End;
                 end;
            end;
      end;
   end
   else if Sender = edtCOD_CANCER then
   begin
      if GF_ProfileEdit(edtCOD_CANCER, '3', sName, eSuga) then
      begin
         edtDESC_CANCER.Text := sName;
         valSUGA_CANCER.Value := eSuga;
      end;
   end
   else if Sender = edtCOD_CHUGA then
   begin
      Today := Copy(GV_sToday, 1, 4) + '-' + Copy(GV_sToday, 5, 2) + '-' + Copy(GV_sToday, 7, 2);
      {if (UV_iStatus <> GC_Insert) and (edtCOD_CHUGA.Text <> '') then
         if (Copy(edtCOD_CHUGA.Text, 1, 1) <> 'J') and (cmbGmgn.Text <> GF_DateFormat(GV_sToday)) then
         begin
            GF_MsgBox('Information', '장비검사만 추가가능합니다.');
            edtCOD_CHUGA.Text  := '';
            edtDESC_CHUGA.Text := '';
         end;}

      if (UV_iStatus <> GC_Insert) and (edtCOD_CHUGA.Text <> '') then
      begin
         if (Copy(edtCOD_CHUGA.Text, 1, 1) <> 'J') and (Copy(edtCOD_CHUGA.Text, 1, 1) <> 'D') and
            (copy(edtCOD_CHUGA.Text,1,1) <> 'S') and (copy(edtCOD_CHUGA.Text,1,2) <> 'SS') and  (copy(edtCOD_CHUGA.Text,1,3) <> 'SS0') and (copy(edtCOD_CHUGA.Text,1,4) <> 'SS00') and
            //(cmbGmgn.Text <> GF_DateFormat(GV_sToday)) then
            (cmbGmgn.Text < GF_DateFormat(GV_sToday)) and (mskDAT_GMGN.Text < GF_DateFormat(GV_sToday)) then
         begin
            GF_MsgBox('Information', '장비, 채용검사만 추가가능합니다.');
            edtCOD_CHUGA.Text  := '';
            edtDESC_CHUGA.Text := '';
            edtCOD_CHUGA.SetFocus;
            exit;
         end;
      end;

      if GF_HangmokEdit(edtCOD_CHUGA.Text, mskDAT_GMGN.Text, sName, eSuga) then
      begin
          edtDESC_CHUGA.Text := sName;
          if iSeq = 0 then
          begin
	      valCOD_CHUGA.Value := eSuga;
          end
          else
          begin
              qry_pumyi_suga.Active := False;
              qry_pumyi_suga.ParamByName('cod_dc').AsString  := edtCOD_DC.Text;
              qry_pumyi_suga.ParamByName('num_seq').Asinteger := iSeq;
              qry_pumyi_suga.ParamByName('cod_hm').AsString  := edtCOD_CHUGA.Text;
              qry_pumyi_suga.Active := True;
              if qry_pumyi_suga.RecordCount > 0 then
                  valCOD_CHUGA.Value := qry_pumyi_suga.FieldByName('cod_suga').AsInteger
              else
              begin
                  qryChk_suga.Active := False;
                  qryChk_suga.ParamByName('cod_dc').AsString   := edtCOD_DC.Text;
                  qryChk_suga.ParamByName('num_seq').Asinteger := iSeq;
                  qryChk_suga.Active := True;
                  if (valSUGA_DANCHE.Value > 0)
                      or ((valSUGA_DANCHE.Value = 0) and (qryChk_suga.FieldByName('chk_suga').AsString = 'Y')) then
                  begin
                      qryHangmokSuga.Close;
                      qryHangmokSuga.ParamByName('cod_hm').AsString    := edtCOD_CHUGA.Text;
                      qryHangmokSuga.ParamByName('dat_apply').AsString := mskDAT_GMGN.Text;
                      qryHangmokSuga.Open;
                      if (qryHangmokSuga.RecordCount > 0) and (qryHangmokSuga.FieldByName('suga_danche').AsInteger > 0) then
                         valCOD_CHUGA.Value := qryHangmokSuga.FieldByName('suga_danche').AsInteger
                      else  valCOD_CHUGA.Value := eSuga;
                  end
                  else valCOD_CHUGA.Value := eSuga;
              end;
          end;
      end;
   end
   else if Sender = cmbGUBN_NOSIN then
   begin
      //청구, 유형Check
      if Copy(cmbGUBN_NOSIN.Text, 1, 1) = '0' then
      begin
         sChasu := '';
         edtGUBN_NSYH.Text := '';
         cmbGUBN_NSCG.ItemIndex := -1;
         cmbGUBN_NSCG.Enabled := False;
         if ysno_nosin = 'Y' then
           valSUGA_DANCHE.Value := valSUGA_DANCHE.Value;
      end
      else if Copy(cmbGUBN_NOSIN.Text, 1, 1) = '1' then
      begin
         up_Overlap(cmbGUBN_NOSIN);
         sChasu := Copy(cmbGUBN_NOSIN.Text, 1, 1);
         sGubun := '1';
         UP_YhCheck(sChasu, sGubun);
         cmbGUBN_NSCG.Enabled := True;
         if ysno_gibd = 'N' then
         begin
              //09.07.08 철. 단체금액은 없고 개인금액만 있는경우.
              if (ysno_nosin = 'Y') and (valSUGA_DANCHE.Value > 0) then
                 valSUGA_DANCHE.Value := valSUGA_DANCHE.Value - UV_Suga1
              else if (ysno_nosin = 'Y') and (valSUGA_GIBD.Value > 0) then
                 valSUGA_GIBD.Value := valSUGA_GIBD.Value - UV_Suga1;
         end
         else if ysno_gibd = 'Y' then
         begin
              if ysno_nosin = 'Y' then
                 valSUGA_GIBD.Value := valSUGA_GIBD.Value - UV_Suga1;
         end;
         if cmbGUBN_NSCG.Text = '' then                                         //품의를 끌고 오기 위해..
            cmbGUBN_NSCG.ItemIndex := 1;
         //cmbGUBN_NSCG.ItemIndex := 1      품의를 끌고 오기 위해..
      end
      else if Copy(cmbGUBN_NOSIN.Text, 1, 1) = '2' then
      begin
      up_Overlap(cmbGUBN_NOSIN);
      edtGUBN_NSYH.Text := '';
      cmbGUBN_NSCG.Enabled := True;
        //노신 재검일 경우 청구유형 자동입력
         with qryI_nsad do
         begin
            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
            Active := True;
            sNscg := FieldByName('gubn_nscg').AsString;
            IF sNscg = '1' then
               cmbGUBN_NSCG.ItemIndex := 0
            else if sNscg = '2' then
               cmbGUBN_NSCG.ItemIndex := 1
               else
                  cmbGUBN_NSCG.ItemIndex := -1 ;
            Active := False;
         end;
      end
      else
      begin
         edtGUBN_NSYH.Text := '';
         cmbGUBN_NSCG.ItemIndex := -1;
         cmbGUBN_NSCG.Enabled := False;
      end;
      UP_Change(cmbGUBN_NSCG);
      if C078_Check then
      begin
         edtCOD_CHUGA.Text := 'C078';
         btnHm_insertClick(Self);
         C078_Check := False;
      end;
      if S021_Check then
      begin
         edtCOD_CHUGA.Text := 'C090';
         btnHm_insertClick(Self);
         S021_Check := False;
      end;
   end
   else if Sender = cmbGUBN_gong then
   begin
    {  //청구, 유형Check
      if Copy(cmbGUBN_gong.Text, 1, 1) = '1' then
      begin
         // 이중접수체크
         with qryYijungChk do
         begin
            close;
            ParamByName('cod_jisa').AsString  := copy(cmbCod_jisa.text,1,2);
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            ParamByName('dat_gmgn').AsString  := copy(mskDAT_GMGN.Text,1,4) + '%';
            ParamByName('date').AsString      := mskDAT_GMGN.Text;
            open;
            if recordcount > 0 then
            if FieldByName('cnt').AsInteger >= 1 then
               showmessage('올해 특정암이 한번 접수되어 있습니다.' + #13#13 + '기존접수를 확인해주세요.')
            else
            begin
               sChasu := Copy(cmbGUBN_gong.Text, 1, 1);
               sGubun := '6';
               UP_YhCheck(sChasu, sGubun);
            end;
         end;
      end
      else
         edtGUBN_goyh.Text := ''; }

      if Copy(cmbGUBN_gong.Text, 1, 1) = '1' then
      begin
         sChasu := Copy(cmbGUBN_gong.Text, 1, 1);
         cmbGUBN_GOCG.ItemIndex := 1;
         sGubun := '6';
         UP_YhCheck(sChasu, sGubun);
         cmbGUBN_GOCG.Enabled := True;
         
         if  pos('간', edtGUBN_GOYH.Text) > 0 then
         begin
            edtCod_Chuga.Text := 'TT03';
            btnHm_insertClick(Self);
         end;
      end
      else
      begin
         edtGUBN_goyh.Text := '';
         cmbGUBN_GOCG.ItemIndex := -1;
         cmbGUBN_GOCG.Enabled := False;
         Ck_UA.Checked  := False;
         Ck_DJA.Checked := False;
         Ck_GA.Checked  := False;
         Ck_UBA.Checked := False;
         Ck_JGA.Checked := False;
      end;
   end
   else if Sender = cmbGUBN_TKGM then
   begin
      //청구, 유형Check
      if Copy(cmbGUBN_TKGM.Text, 1, 1) > '0' then
      begin
         up_Overlap(cmbGUBN_TKGM); //shsh
         sChasu := Copy(cmbGUBN_TKGM.Text, 1, 1);
         UP_TkCheck(sChasu);
         //if Trim(cmbGUBN_TKGM.Text) = '' then cmbGUBN_TKCG.ItemIndex := -1
         //else                                 cmbGUBN_TKCG.ItemIndex := 0;
         cmbGUBN_TKCG.ItemIndex := 0;
      end
      else
      begin
         edtGUBN_TKYH.Text := '';
         cmbGUBN_TKCG.ItemIndex := -1;
         cmbGUBN_TKCG.Enabled := False;
         with qryD_Tkgum do
         begin
              ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
              ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
              ParamByName('NUM_JUMIN').AsString := mskNUM_JUMIN.Text;
         ExecSql;
         end;
      end;
      UP_Change(cmbGUBN_TKCG);

      if (Copy(edtCOD_JANGBI.Text,1,2) <> 'SS') and (cmbGUBN_TKGM.Text <> '') then
            GP_ComboDisplay(Cmb_Print, GF_PrintCheck(edtCOD_JANGBI.Text, edtCOD_HUL.Text, sHangmok, copy(cmbGUBN_NOSIN.Text,1,1), copy(edtGUBN_NSYH.Text,1,pos('-', edtGUBN_NSYH.Text)-1), copy(cmbGUBN_ADULT.Text,1,1), copy(edtGUBN_ADYH.Text,1,pos('-', edtGUBN_ADYH.Text)-1), copy(cmbGUBN_LIFE.Text,1,1), copy(edtGUBN_LFYH.Text,1,pos('-', edtGUBN_LFYH.Text)-1), copy(cmbGUBN_TKGM.Text,1,1)), 2);
   end
   else if Sender = cmbGUBN_BOGUN then
   begin
      //청구, 유형Check
      if Copy(cmbGUBN_BOGUN.Text, 1, 1) > '0' then
      begin
         cmbGUBN_BGCG.Enabled := True
      end
      else
      begin
         edtGUBN_BGYH.Text := '';
         cmbGUBN_BGCG.ItemIndex := -1;
         cmbGUBN_BGCG.Enabled := False;
      end;
      UP_Change(cmbGUBN_BGCG);
   end
   else if Sender = cmbGUBN_ADULT then
   begin

      //청구, 유형Check
      if Copy(cmbGUBN_ADULT.Text, 1, 1) = '1' then
      begin
         up_Overlap(cmbGUBN_ADULT);
         sChasu := Copy(cmbGUBN_ADULT.Text, 1, 1);
         sGubun := '4';
         UP_YhCheck(sChasu, sGubun);
         cmbGUBN_ADCG.Enabled := True;
//         cmbGUBN_ADCG.ItemIndex := 1;
         if ysno_gibd = 'N' then
         begin
              //09.07.08 철. 단체금액은 없고 개인금액만 있는경우.
              if (ysno_nosin = 'Y') and (valSUGA_DANCHE.Value > 0) then
                 valSUGA_DANCHE.Value := valSUGA_DANCHE.Value - UV_Suga4
              else if (ysno_nosin = 'Y') and (valSUGA_GIBD.Value > 0) then
                 valSUGA_GIBD.Value := valSUGA_GIBD.Value - UV_Suga4;
         end
         else if ysno_gibd = 'Y' then
         begin
              if ysno_nosin = 'Y' then
                 valSUGA_GIBD.Value := valSUGA_GIBD.Value - UV_Suga4;
         end;

         if cmbGUBN_ADCG.Text = '' then                                         //품의를 끌고 오기 위해..
            cmbGUBN_ADCG.ItemIndex := 1;
      end
      else if Copy(cmbGUBN_ADULT.Text, 1, 1) = '2' then
      begin
         up_Overlap(cmbGUBN_ADULT);
         edtGUBN_ADYH.Text := '';
         cmbGUBN_ADCG.Enabled := true;
        //성인병 재검일경우 청구유형 자동입력
         with qryI_nsad do
         begin
            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
            Active := True;
            sNscg := FieldByName('gubn_adcg').AsString;
            IF sNscg = '1' then
               cmbGUBN_ADCG.ItemIndex := 0
            else if sNscg = '2' then
               cmbGUBN_ADCG.ItemIndex := 1
               else
                  cmbGUBN_ADCG.ItemIndex := -1 ;

            Active := False;
         end;
      end
      else
      begin
         edtGUBN_ADYH.Text := '';
         cmbGUBN_ADCG.ItemIndex := -1;
         cmbGUBN_ADCG.Enabled := False;
      end;
      UP_Change(cmbGUBN_ADCG);
   end
   else if Sender = cmbGUBN_AGAB then
   begin
      //청구, 유형Check
      if Copy(cmbGUBN_AGAB.Text, 1, 1) > '0' then
      begin
         sChasu := Copy(cmbGUBN_AGAB.Text, 1, 1);
         sGubun := '5';
         UP_YhCheck(sChasu, sGubun);
         cmbGUBN_AGCG.Enabled := True
      end
      else
      begin
         edtGUBN_AGYH.Text := '';
         cmbGUBN_AGCG.ItemIndex := -1;
         cmbGUBN_AGCG.Enabled := False;
      end;
      UP_Change(cmbGUBN_AGCG);
   end
   else if Sender = cmbGUBN_LIFE then                                           //07.05.10 철. 생애전환기
   begin

      //청구, 유형Check
      if Copy(cmbGUBN_LIFE.Text, 1, 1) = '0' then
      begin
         sChasu := '';
         edtGUBN_LFYH.Text := '';
         cmbGUBN_LFCG.ItemIndex := -1;
         cmbGUBN_LFCG.Enabled := False;
      end
      else if Copy(cmbGUBN_LIFE.Text, 1, 1) = '1' then
      begin
         up_Overlap(cmbGUBN_LIFE);
         sChasu := Copy(cmbGUBN_LIFE.Text, 1, 1);
         sGubun := '7';
         UP_YhCheck(sChasu, sGubun);
         cmbGUBN_LFCG.Enabled := True;
         cmbGUBN_LFCG.ItemIndex := 1;
         //09.07.08 철. 단체금액은 없고 개인금액만 있는경우.
         if (ysno_nosin = 'Y') and (valSUGA_DANCHE.Value > 0) then
            valSUGA_DANCHE.Value := valSUGA_DANCHE.Value - UV_Suga7
         else if (ysno_nosin = 'Y') and (valSUGA_GIBD.Value > 0) then
            valSUGA_GIBD.Value := valSUGA_GIBD.Value - UV_Suga7;
      end
      else if Copy(cmbGUBN_LIFE.Text, 1, 1) = '2' then
      begin
      up_Overlap(cmbGUBN_LIFE);
      edtGUBN_LFYH.Text := '';
      cmbGUBN_LFCG.Enabled := True;
        //노신 재검일 경우 청구유형 자동입력
         with qryI_nsad do
         begin
            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
            Active := True;
            sNscg := FieldByName('gubn_lfcg').AsString;
            IF sNscg = '1' then
               cmbGUBN_LFCG.ItemIndex := 0
            else if sNscg = '2' then
               cmbGUBN_LFCG.ItemIndex := 1
            else
               cmbGUBN_LFCG.ItemIndex := -1 ;
            Active := False;               
         end;
      end
      else
      begin
         edtGUBN_LFYH.Text := '';
         cmbGUBN_LFCG.ItemIndex := -1;
         cmbGUBN_LFCG.Enabled := False;
      end;
      UP_Change(cmbGUBN_LFCG);
   end
   else if Sender = cmbGUBN_NSCG then
   begin
      if (Trim(UV_GubnA1) <> '') or  (Trim(Copy(cmbGUBN_NSCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA1, Copy(cmbGUBN_NSCG.Text, 1, 1), UV_SugaA1, UV_Suga1);
        UV_SugaA1 := UV_Suga1;
        UV_GubnA1 := Copy(cmbGUBN_NSCG.Text, 1, 1);
      end
   end
   else if Sender = cmbGUBN_TKCG then
   begin
      if (Trim(UV_GubnA2) <> '') or  (Trim(Copy(cmbGUBN_TKCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA2, Copy(cmbGUBN_TKCG.Text, 1, 1), UV_SugaA2, UV_Suga2);
        UV_SugaA2 := UV_Suga2;
        UV_GubnA2 := Copy(cmbGUBN_TKCG.Text, 1, 1);
      end
   end
   else if Sender = cmbGUBN_BGCG then
   begin
      if (Trim(UV_GubnA3) <> '') or  (Trim(Copy(cmbGUBN_BGCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA3, Copy(cmbGUBN_BGCG.Text, 1, 1), UV_SugaA3, UV_Suga3);
        UV_SugaA3 := UV_Suga3;
        UV_GubnA3 := Copy(cmbGUBN_BGCG.Text, 1, 1);
      end
   end
   else if Sender = cmbGUBN_ADCG then
   begin
      if (Trim(UV_GubnA4) <> '') or  (Trim(Copy(cmbGUBN_ADCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA4, Copy(cmbGUBN_ADCG.Text, 1, 1), UV_SugaA4, UV_Suga4);
        UV_SugaA4 := UV_Suga4;
        UV_GubnA4 := Copy(cmbGUBN_ADCG.Text, 1, 1);
      end
   end
   else if Sender = cmbGUBN_AGCG then
   begin
      if (Trim(UV_GubnA5) <> '') or (Trim(Copy(cmbGUBN_AGCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA5, Copy(cmbGUBN_AGCG.Text, 1, 1), UV_SugaA5, UV_Suga5);
        UV_SugaA5 := UV_Suga5;
        UV_GubnA5 := Copy(cmbGUBN_AGCG.Text, 1, 1);
      end
   end
   else if Sender = cmbGUBN_GOCG then
   begin
      if (Trim(UV_GubnA6) <> '') or (Trim(Copy(cmbGUBN_GOCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA6, Copy(cmbGUBN_GOCG.Text, 1, 1), UV_SugaA6, UV_Suga6);
        UV_SugaA6 := UV_Suga6;
        UV_GubnA6 := Copy(cmbGUBN_GOCG.Text, 1, 1);
      end
   end
   else if Sender = cmbGUBN_LFCG then                                           //07.05.10 철. 생애전환기
   begin
      if (Trim(UV_GubnA7) <> '') or  (Trim(Copy(cmbGUBN_LFCG.Text, 1, 1)) <> '') then
      begin
        UP_ChungGu_Suga(UV_GubnA7, Copy(cmbGUBN_LFCG.Text, 1, 1), UV_SugaA7, UV_Suga7);
        UV_SugaA7 := UV_Suga7;
        UV_GubnA7 := Copy(cmbGUBN_LFCG.Text, 1, 1);
      end
   end
   else if (Sender = valSuga_danche) or (Sender = valSuga_gibd)
        or (Sender = valSuga_johap)  then
        begin
           valSuga_tot.Value := valSuga_danche.Value + valSuga_gibd.Value
                              + valSuga_johap.Value;

           {YDG[20060103]-특검 및 종검 수가 세분화}
           VEdt_Jgum.Value := valSUGA_DANCHE.Value - VEdt_Tgum.Value - VEdt_Tgum2.Value;
        end
   else if (Sender = rdNeawon) and (SDcheck = True) then
        begin
           if rdNeawon.checked then
           begin
              GF_CalendarClick(mskNeawon);
              rdPost.checked  := false;
              rdHmpg.checked  := false;
              rdEmail.checked := false;
              rdCompany.checked := false;
              rdMobile.checked  := false;
              mskCompany.Text := '';
              mskCompany.Enabled := false;
              mskPost.text    := '';
              mskPost.Enabled := false;
           end
           else mskNeawon.text := '';
        end
   else if (Sender = rdPost) and (SDcheck = True) then
        begin
           if rdPost.checked then
           begin
              msknum_Post.Enabled := False;
              GF_CalendarClick(mskPost);
              //rdHmpg.checked    := false;
              rdMobile.checked  := false;
              rdNeawon.checked  := false;
              mskNeawon.text    := '';
              mskNeawon.Enabled := false;
              if rdCompany.checked = False then
              begin
               rdCompany.checked := false;
               mskCompany.Text := '';
               mskCompany.Enabled := false;
              end;
              msknum_Post.Enabled := True;
           end
           else mskPost.text := '';
        end
   else if (Sender = rdHmpg) and (SDcheck = True) then
        begin
           if rdHmpg.checked then
           begin
              rdNeawon.checked := false;
              //rdPost.checked   := false;
              rdEmail.checked  := false;
              rdMobile.checked  := false;
              mskNeawon.text := '';
              mskNeawon.Enabled := False;
              //mskPost.text := '';
              //mskPost.Enabled := false;
              rdCompany.checked  := false;
              mskCompany.Text := '';
              mskCompany.Enabled := false;
           end;
        end
   else if (Sender = rdMobile) and (SDcheck = True) then
        begin
           if rdMobile.checked then
           begin
              rdNeawon.checked := false;
              rdPost.checked   := false;
              rdEmail.checked  := false;
              mskNeawon.text := '';
              mskNeawon.Enabled := False;
              mskPost.text := '';
              mskPost.Enabled := false;
              rdCompany.checked  := false;
              mskCompany.Text := '';
              mskCompany.Enabled := false;
           end;
        end
    else if (Sender = rdCompany) and (SDcheck = True) then
        begin
           if rdCompany.checked then
           begin
              GF_CalendarClick(mskCompany);
              rdHmpg.checked   := false;
              rdEmail.checked  := false;
              rdMobile.checked  := false;
              rdNeawon.checked := false;
              mskNeawon.text := '';
              mskNeawon.Enabled := False;
              if rdPost.checked = false then
              begin
               rdPost.checked   := false;
               mskPost.text := '';
               mskPost.Enabled := false;
              end;
           end
           else
              mskCompany.Text := '';
       end
   else if (Sender = rdEmail) and (SDcheck = True) then
        begin
           if rdEmail.Checked then
           begin
              //메일주소 입력 여부 확인
              if CK_susin.Checked = False then CK_susin.Checked := True;

              rdNeawon.checked := false;
              mskNeawon.text := '';
              mskNeawon.Enabled := False;
              rdHmpg.checked   := false;
              rdMobile.checked  := false;

              if Edt_email.Text = '' then
              begin
                 GF_MsgBox('Information', 'E-mail주소를 입력하여 주시기 바랍니다..!!');
                 Edt_email.SetFocus;
              end;
           end
           else
           begin
              if CK_susin.checked then
              begin
                 // Confirm Message
                 if not GF_MsgBox('Confirmation', '메일수신동의를 하지 않겠습니까?') then exit;
                    CK_susin.Checked := False;
              end;
           end;

        end
    else if Sender = rdEmail then
        begin
           if rdEmail.Checked then CK_susin.Checked := True
           else  CK_susin.Checked := false;
        end
        //혈액검사 구분..
{   else if Sender = rdgGubn_Hulgum then
        begin
          if (copy(GV_sUserId,1,2) <> '11') and (copy(GV_sUserId,1,2) <> '12') and (copy(GV_sUserId,1,2) <> '43') and
             (rdgGubn_Hulgum.ItemIndex = 2) and ((UV_iStatus = GC_Insert) or (GV_sToday = mskDAT_GMGN.Text)) then
          begin
             ShowMessage('강남센터, 여의도센터, 수원센터 테스트중입니다.' + #13#10 +
                         '사용하실려면 전산실과 분석부에 연락 주십시요..');
             rdgGubn_Hulgum.ItemIndex := 0;
             rdgGubn_Hulgum.SetFocus;
          end;

        end  }
{   else if Sender = bogun_kiho then
        begin
           if length(bogun_kiho.text) = 8 then
           begin
              with qryJohap do
              begin
                 close;
                 ParamByName('cod_jh').AsString := bogun_kiho.text;
                 open;
                 bogun_name.caption := FieldByname('desc_jh').AsString;
                 close;
              end;
           end else
              bogun_name.caption := '';
        end      }
   else if Sender = Chk_ysno_useinfo then
   begin
      if Chk_ysno_useinfo.Checked = True then
      begin
         Chk_ysno_Homepage.Checked := True;
      end
      else if Chk_ysno_useinfo.Checked = False then
      begin
         Chk_ysno_Homepage.Checked := False;
      end;
   end
   else if Sender = edtNUM_SAMP then
   begin
      sData := edtNUM_SAMP.Text;
      for i := 1 to Length(sData) do
      begin
         if (sData[i] < '0') or (sData[i] > '9') then
         begin
            ShowMessage('샘플번호는 문자를 사용할 수 없습니다.!');
            edtNUM_SAMP.Text := copy(edtNUM_SAMP.Text,1,length(edtNUM_SAMP.Text)-1);
            edtNUM_SAMP.SetFocus;
         end;
      end;
   end;
   //자주 사용하는 포털 메일 추가
   if Sender = cmb_email then
   begin
      if (pos('@',Edt_email.Text)>0) then
      begin
          Edt_email.Text:=copy(Edt_email.Text,1,pos('@',Edt_email.Text)-1);
          if (copy(cmb_email.text,1,2) <> '00') then   Edt_email.Text:=Edt_email.Text+'@'+copy(cmb_email.Text,4,length(cmb_email.Text));
      end
      else if (copy(cmb_email.text,1,2) <> '00') then  Edt_email.Text:=Edt_email.Text+'@'+ copy(cmb_email.Text,4,length(cmb_email.Text));

   end;

   UV_bEdit := True;
end;

procedure TfrmCK3I01.btnPInsertClick(Sender: TObject);
begin
   inherited;

   // 작업절차
   // 1. 사용자가 작업중이라면 저장이 입력상태
   // 2. 사용자가 작업중이아니라면 바로 입력상태
   if UV_bEdit then
   begin
      qryDanche.Active := False;
      qryDanche.ParamByName('cod_dc').AsString := edtCOD_DC.Text;
      qryDanche.Active := True;
      if qryDanche.RecordCount > 0 then
      begin
         if (cmbCOD_JISA.Text <>  '') and (mskDAT_GMGN.Text <> '')  and
            (mskNUM_JUMIN.Text <> '') and (edtDESC_NAME.Text <> '') and (cmbGUBN_NEAWON.Text <> '') then
         begin
            if (GV_sJisa = '00') or (GV_sJisa = '11') or (GV_sJisa = '12') or (GV_sJisa = '15') or
               (GV_sJisa = '43') or (GV_sJisa = '51') or (GV_sJisa = '61') or (GV_sJisa = '71') then
            begin
               if length(cmbCod_saler.text) <= 6 then
                  GF_MsgBox('Information', '직영지사는 영업담당자를  필히 입력해야 합니다.')
               else
               begin
                  if Copy(cmbCOD_JISA.Text, 1, 2) = '11' then
                  begin
                     case Com_BD.ItemIndex of
                        0 : GF_MsgBox('Information', '※ 강남은 구분없음을 사용할수 없습니다.' + #13#13 +
                                      '☞ 종합검사는 => [종검-4F]' + #13 + '☞ 준종합이하는  [일반-5F]으로 접수하시기 바람니다.');
                      3,4,9,14,15,19 : if UF_Save then btnInsert.Click;
                        else
                        begin
                           GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                           Com_BD.SetFocus;
                        end;
                     end;
                  end
                  else if Copy(cmbCOD_JISA.Text, 1, 2) = '12' then
                  begin
                     case Com_BD.ItemIndex of
                        0 : GF_MsgBox('Information', '※ 여의도는 구분없음을 사용할수 없습니다.' + #13#13 +
                                      '☞ 종합검사는 => [종검-17F]' + #13 + '☞ VIP검사는  [VIP-18F]으로 접수하시기 바람니다.');
                  5,6,7,8,11,16 : if UF_Save then btnInsert.Click;
                        else
                        begin
                           GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                           Com_BD.SetFocus;
                        end;
                     end;
                  end
                  else if Copy(cmbCOD_JISA.Text, 1, 2) = '15' then
                  begin
                     case Com_BD.ItemIndex of
                        0 : GF_MsgBox('Information', '※ 본사(강북)는 구분없음을 사용할수 없습니다.' + #13#13 +
                                     '☞ 종합검사는 => [종검-3F]' + #13 + '☞ 준종합이하는 [일반-4F]으로 접수하시기 바람니다.');
                      1,2,10 : if UF_Save then btnInsert.Click;
                        else
                        begin
                           GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                           Com_BD.SetFocus;
                        end;
                     end;
                  end
               else if Copy(cmbCOD_JISA.Text, 1, 2) = '43' then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 수원은 구분없음을 사용할수 없습니다.');
                   17,18 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
               else if (Copy(cmbCOD_JISA.Text, 1, 2) = '61') and (Copy(cmbGUBN_NEAWON.Text, 1, 1) <> '2')then
               begin
                  case Com_BD.ItemIndex of
                     0 : GF_MsgBox('Information', '※ 부산은 구분없음을 사용할수 없습니다.' + #13#13 +
                                   '☞ 종합검사는 => [종검-12F]' + #13 + '☞ 준종합이하는  [일반-11F]으로 접수하시기 바람니다.');
                   12,13 : UF_Save;
                     else
                     begin
                        GF_MsgBox('Information', '층구분을 확인하시기 바랍니다..!!');
                        Com_BD.SetFocus;
                     end;
                  end;
               end
                  else
                  begin
                     if UF_Save then btnInsert.Click;
                  end;
               end;
            end
            else
            begin
               if UV_sJisa = Copy(cmbCOD_JISA.Text, 1, 2) then
                  if UF_Save then btnInsert.Click
               else
                  GF_MsgBox('Information', '타지사 접수는 수정불가능합니다...');
            end;
         end
         else
            GF_MsgBox('Information', '필수항목을 확인하십시요...');
      end
      else
      begin
         GF_MsgBox('Information', '존재하지 않는 단체코드입니다...');
         edtCOD_DC.SetFocus;
      end;
      qryDanche.Active := False;
   end
   else
      btnInsert.Click;
end;

procedure TfrmCK3I01.UP_KeyUp(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
   inherited;

   // 추가코드에서 Delete Key를 누르면 Delete 작업
//   if Sender = grdCOD_CHUGA then
//   begin
//      if Key = VK_Delete then btnHm_delete.Click;
//   end;

   if Key <> GC_Refer then exit;

   // Hot-Key를 사용하여 Button을 누른 효과를 냄
   if      Sender = mskJumin      then UP_Click(btnJumin)
   else if Sender = edtCOD_DC     then UP_Click(btnCOD_DC)
   else if Sender = edtDESC_DEPT  then UP_Click(btnDESC_DEPT)
   else if Sender = edtCOD_JANGBI then UP_Click(btnCOD_JANGBI)
   else if Sender = edtCOD_HUL    then UP_Click(btnCOD_HUL)
   else if Sender = edtCOD_CANCER then UP_Click(btnCOD_CANCER)
   else if Sender = edtCOD_CHUGA  then UP_Click(btnCOD_CHUGA)
   else if Sender = edtDESC_ADDR  then UP_Click(Btn_Post);
end;

procedure TfrmCK3I01.UP_Click(Sender: TObject);
var sCode, sName : String;
    index : integer;
begin
   inherited;

   // Button Click시 Event Procedure를 공유한 후 구분을 Sender로 수행
   if Sender = btnDAT_GMGN then GF_CalendarClick(mskDAT_GMGN)
   else if Sender = btnJumin then
   begin
      if GF_InjoukClick(Self, sCode, sName) then
         mskJumin.Text := sCode;
      mskJumin.SetFocus;
   end
   else if Sender = btnCOD_DC then
   begin
      if GF_DancheGubunClick(Self, sCode, sName) then
      begin
         edtCOD_DC.Text  := sCode;
         edtDESC_DC.Text := sName;
      end;
   end
   else if Sender = btnDESC_DEPT then
   begin
     if GF_DeptClick(Self, edtCOD_DC.Text, sCode, sName) then
        edtDESC_DEPT.Text := sName;
   end
   else if Sender = btnCOD_JANGBI then
   begin
      if GF_ProfileClick(Self, '1', sCode, sName) then
      begin
         edtCOD_JANGBI.Text  := sCode;
         edtDESC_JANGBI.Text := sName;
      end;
   end
   else if Sender = btnCOD_HUL then
   begin
      if GF_ProfileClick(Self, '2', sCode, sName) then
      begin
         edtCOD_HUL.Text  := sCode;
         edtDESC_HUL.Text := sName;
      end;
   end
   else if Sender = btnCOD_CANCER then
   begin
      if GF_ProfileClick(Self, '3', sCode, sName) then
      begin
         edtCOD_CANCER.Text  := sCode;
         edtDESC_CANCER.Text := sName;
      end;
   end
   else if Sender = btnCOD_CHUGA then
   begin
      if GF_HangmokClick(Self, sCode, sName) then
      begin
         edtCOD_CHUGA.Text  := sCode;
         edtDESC_CHUGA.Text := sName;
      end;
   end
   else if Sender = ckYSNO_DRINKY then
   begin
      if ckYSNO_DRINKY.Checked = True then
         ckYSNO_DRINKN.Checked := False;
   end
   else if Sender = ckYSNO_DRINKN then
   begin
      if ckYSNO_DRINKN.Checked = True then
         ckYSNO_DRINKY.Checked := False;
   end
   else if Sender = ckYSNO_SMOKEY then
   begin
      if ckYSNO_SMOKEY.Checked = True then
         ckYSNO_SMOKEN.Checked := False;
   end
   else if Sender = ckYSNO_SMOKEN then
   begin
      if ckYSNO_SMOKEN.Checked = True then
         ckYSNO_SMOKEY.Checked := False;
   end
   else if Sender = ckYSNO_YSHUY then
   begin
      if ckYSNO_YSHUY.Checked = True then
         ckYSNO_YSHUN.Checked := False;
   end
   else if Sender = ckYSNO_YSHUN then
   begin
      if ckYSNO_YSHUN.Checked = True then
         ckYSNO_YSHUY.Checked := False;
   end
   else if Sender = ckEYE1 then
   begin
      if ckEYE1.Checked = True then
         ckEYE2.Checked := False;
   end
   else if Sender = ckEYE2 then
   begin
      if ckEYE2.Checked = True then
         ckEYE1.Checked := False;
   end
   else if Sender = Chk_DI then
   begin
      if Chk_DI.Checked = true then
      begin
        GF_MsgBox('Information', '출장검진시 혈액부족 및 검사불가일경우 사용합니다!');
      end;
   end
   else if Sender = btnJ_PROFILE then
   begin
      if edtCOD_JANGBI.Text <> '' then
      begin
         // Grid 초기화
         grdMaster.Rows := 0;
         index := 0;
         with qryPf_hm do
         begin
            Active := False;
            ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               VarArrayRedim(UV_vCod_hm,      recordcount - 1);
               VarArrayRedim(UV_vDesc_kor,    recordcount - 1);
               VarArrayRedim(UV_vGubn_Cancel, recordcount - 1);
               VarArrayRedim(UV_vGubn_Cancel_select, recordcount - 1);
               VarArrayRedim(UV_vCancel_Etc,  recordcount - 1);
               while not qryPf_hm.Eof do
               begin
                  UV_vCod_hm[index]   := FieldByName('COD_HM').AsString;
                  UV_vDesc_kor[index] := FieldByName('DESC_KOR').AsString;
                  with qryCancel_jangbi do
                  begin
                     Active := False;
                     ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
                     ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
                     ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
                     ParamByName('cod_hm').AsString     := UV_vCod_hm[index];
                     Active := True;
                     if RecordCount > 0 then
                     begin
                        if FieldByName('gubn_cancel').AsString <> '' then
                           UV_vGubn_Cancel_select[index]  := FieldByName('gubn_cancel').AsString + '-' + FieldByName('desc_code').AsString
                        else
                           UV_vGubn_Cancel_select[index]  := '';
                        UV_vCancel_Etc[index]          := FieldByName('cancel_etc').AsString;
                     end
                     else
                     begin
                        UV_vGubn_Cancel_select[index]  := '';
                        UV_vCancel_Etc[index]          := '';
                     end;
                  end;
                  Next;
                  Inc(index);
               end;
            end;
            Active := False;
         end;
         // Grid에 자료를 할당
         grdMaster.Rows := index;
         grdMaster.Cols := 4;
         grdMaster.Col[3].width := 60;
         grdMaster.Col[4].width := 58;
         grdMaster.Col[3].Heading := '취소구분';
         grdMaster.Col[4].Heading := '기타사유';
         grdMaster.Col[3].buttontype := btCombo;
         grdMaster.Width := 321;

         if grdMaster.visible then grdMaster.visible := False
         else
         begin
            grdMaster.Top  := 389;
            grdMaster.Left := 200;
            grdMaster.visible := True;
         end;
      end;
   end


   else if Sender = btn_Ysno_gocg then
   begin

      if GBox_Ysno_gocg.visible then GBox_Ysno_gocg.visible := False
      else
      begin
         GBox_Ysno_gocg.Top  := 288;
         GBox_Ysno_gocg.Left := 510;
         GBox_Ysno_gocg.visible := True;
      end;

   end








   else if Sender = btnH_PROFILE then
   begin
      if edtCOD_HUL.Text <> '' then
      begin
         // Grid 초기화
         grdMaster.Rows := 0;
         index := 0;
         with qryPf_hm do
         begin
            Active := False;
            ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               VarArrayRedim(UV_vCod_hm,   recordcount - 1);
               VarArrayRedim(UV_vDesc_kor, recordcount - 1);
               while not qryPf_hm.Eof do
               begin
                  UV_vCod_hm[index]   := FieldByName('COD_HM').AsString;
                  UV_vDesc_kor[index] := FieldByName('DESC_KOR').AsString;
                  Next;
                  Inc(index);
               end;
            end;
            Active := False;
         end;
         // Grid에 자료를 할당
         grdMaster.Rows  := index;
         grdMaster.Cols  := 2;
         grdMaster.Width := 200;

         if grdMaster.visible then grdMaster.visible := False
         else
         begin
            grdMaster.Top  := 411;
            grdMaster.Left := 200;
            grdMaster.visible := True;
         end;
      end;
   end
   else if Sender = btnC_PROFILE then
   begin
      if edtCOD_CANCER.Text <> '' then
      begin
         // Grid 초기화
         grdMaster.Rows := 0;
         index := 0;
         with qryPf_hm do
         begin
            Active := False;
            ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               VarArrayRedim(UV_vCod_hm,   recordcount - 1);
               VarArrayRedim(UV_vDesc_kor, recordcount - 1);
               while not qryPf_hm.Eof do
               begin
                  UV_vCod_hm[index]   := FieldByName('COD_HM').AsString;
                  UV_vDesc_kor[index] := FieldByName('DESC_KOR').AsString;
                  Next;
                  Inc(index);
               end;
            end;
            Active := False;
         end;
         // Grid에 자료를 할당
         grdMaster.Rows := index;
         grdMaster.Cols := 2;
         grdMaster.Width := 200;

         if grdMaster.visible then grdMaster.visible := False
         else
         begin
            grdMaster.Top  := 433;
            grdMaster.Left := 200;
            grdMaster.visible := True;
         end;
      end;
   end
   else if Sender = Btn_Post then
   begin
      H := LoadLibrary(PChar('C:\Windows\System32\DelphiDLL'));
      if H <= 0 then
      begin
        ShowMessage('DelphiDLL.dll을 찾을 수 없습니다.');
        ShellExecute(Handle, nil, 'cmd.exe', '/K xcopy \\222.222.1.4\센터\☞업데이트폴더☜\DLL\DelphiDLL.dll C:\Windows\System32', nil, SW_NORMAL);
        ShowMessage('복사를 시도하였습니다. 다시 실행해 주세요.');
        exit;
      end else
      begin
        try
          @DllPost := GetProcAddress(H, PChar('DllPost'));
          S := DllPost;
          if (H <> 0)  then begin
              if (S <> widestring('')) then begin
                  mskNUM_POST.Text := trim(Copy(S, 1, 5));
                  edtDESC_ADDR.Text := trim(Copy(S, 6, length(s)));
              end;
          end
          else
              showmessage('Error');
        finally
          freeLibrary(H);
          edtDESC_ADDR.SetFocus;
          PostMessage(edtDESC_ADDR.Handle, WM_KEYDOWN, VK_end, 0);
        end;
      end;
     { frmNewPost  := TfrmNewPost.Create(self);
      if frmNewPost.ShowModal = mrOK then
      begin
        mskNUM_POST.Text := GV_sCode;
        edtDESC_ADDR.Text := GV_sName;
        edtDESC_ADDR.SetFocus;
        PostMessage(edtDESC_ADDR.Handle, WM_KEYDOWN, VK_end, 0);
      end; }
   end;
end;

procedure TfrmCK3I01.btnHm_insertClick(Sender: TObject);
var i, iCod_chuga : Integer;
    vCod_chuga : Variant;
    eSuga : Extended;
    cCheck, sName, sHangmok : String;
begin
   inherited;

   // 자료가 있는지 Check
   if edtCOD_CHUGA.Text = '' then exit;

   sHangmok := '';
   // 추가코드에 자료가 존재하는지 Check
   for i := 1 to grdCOD_CHUGA.Rows do
   begin
      sHangmok := sHangmok + grdCOD_CHUGA.Cell[1, i];
      if grdCOD_CHUGA.Cell[1, i] = edtCOD_CHUGA.Text then
      begin
         GF_MsgBox('Warning', '동일한 검사항목이 이미 등록되어있습니다.');

         // 자료 Clear
         edtCOD_CHUGA.Text := '';
         exit;
      end;
   end;

   //[2010.08.03-동구]결과지 출력구분...
   sHangmok := sHangmok + edtCOD_CHUGA.Text;
   //10.09.06 철. 신신 아닌건만 결과지구분함
   if Copy(edtCOD_JANGBI.Text,1,2) <> 'SS' then
      GP_ComboDisplay(Cmb_Print, GF_PrintCheck(edtCOD_JANGBI.Text, edtCOD_HUL.Text, sHangmok, copy(cmbGUBN_NOSIN.Text,1,1), copy(edtGUBN_NSYH.Text,1,pos('-', edtGUBN_NSYH.Text)-1), copy(cmbGUBN_ADULT.Text,1,1), copy(edtGUBN_ADYH.Text,1,pos('-', edtGUBN_ADYH.Text)-1), copy(cmbGUBN_LIFE.Text,1,1), copy(edtGUBN_LFYH.Text,1,pos('-', edtGUBN_LFYH.Text)-1), copy(cmbGUBN_TKGM.Text,1,1)), 2);

   // 추가코드에 등록
   with grdCOD_CHUGA do
   begin
      UP_ChugaVarMemSet(Rows);
      UV_vCod_chuga_d[Rows]  := edtCOD_CHUGA.Text;
      UV_vDesc_chuga[Rows]   := edtDESC_CHUGA.Text;
      UV_vSuga_kmi[Rows]     := valCOD_CHUGA.Value;
      UV_vGubn_free[Rows]    := '0';
      Rows := Rows + 1;
   end;

   // 합계 및 정상수가 계산
   UP_ChugaSugaCount;

   // 단체품의서의 추가 or 개인추가구분
   cCheck := 'F';
   if Trim(vChuga_d) <> '' then
   begin
      iCod_chuga := GF_MulToSingle(vchuga_d, 4, vCod_chuga);
      for i := 0 to iCod_chuga - 1 do
      begin
         if edtCOD_CHUGA.Text = vCod_chuga[i] then
         begin
            cCheck := 'T';
            break;
         end;
//---------------------------------------[2007.06.04]유동구 삭제(의미가 없음)...
//         UV_vGubn_free[i] := '0';
      end;
   end;

{ //기획팀 요청으로 자동추가 제외 14.03.10
   if (cCheck = 'F') and (valCOD_CHUGA.Value > 0) then
   begin
      if GF_HangmokEdit(edtCOD_CHUGA.Text, mskDAT_GMGN.Text, sName, eSuga) then
         if Magam_Check = false then
            valSUGA_GIBD.Value := valSUGA_GIBD.Value + eSuga
         else valSUGA_GIBD.Value:= valSUGA_GIBD.Value;
   end;
}
//한의 본원종합검사3파트1600331
  {if copy(edtCOD_CHUGA.text,1,1)='D' then
  begin
    if (cCheck = 'F') and (valCOD_CHUGA.Value > 0) then
    begin
      if GF_HangmokEdit(edtCOD_CHUGA.Text, mskDAT_GMGN.Text, sName, eSuga) then
         valSUGA_GIBD.Value := valSUGA_GIBD.Value + eSuga
    end;
  end;}
  
   // 자료 Clear & Focus
   edtCOD_CHUGA.Text := '';
   edtCOD_CHUGA.SetFocus;

   // 수정 Flag Check
   UV_bEdit := True;
end;

procedure TfrmCK3I01.btnHm_deleteClick(Sender: TObject);
var i, ii, j, iCod_chuga : Integer;
    vCod_chuga : Variant;
    eSuga : Extended;
    cCheck, sName : String;
begin
   inherited;

   // 자료가 존재하는지 Check
   if grdCOD_CHUGA.Rows = 0 then exit;

   // Confirm Message
   if not GF_MsgBox('Confirmation', '검사항목을 삭제하시겠습니까 ?') then exit;

   // 선택된 모든 항목을 삭제
   with grdCOD_CHUGA do
   begin
      i := 1;
      while Rows > 0 do
      begin
         if i > Rows then break;

         if RowSelected[i] then
         begin
            // 장비 생성되어 있음 삭제 안 되게..  by.Song
            if pos('JJ', cell[1, i]) > 0 then
            begin
               with qry_JangbiWork do
               begin
                  Active := False;
                  ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text, 1, 2);
                  ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
                  ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
                  ParamByName('cod_jangbi').AsString := Trim(cell[1, i]);
                  Active := True;
                  if qry_JangbiWork.RecordCount > 0 then
                  begin
                     GF_MsgBox('Information', '장비가 생성되어 삭제할 수 없습니다.');
                     Active := False;
                     exit;
                  end;
                  Active := False;
               end;
            end;

            // 단체품의서의 추가 or 개인추가구분
            cCheck := 'F';
            if Trim(vChuga_d) <> '' then
            begin
               iCod_chuga := GF_MulToSingle(vchuga_d, 4, vCod_chuga);
               for ii := 0 to iCod_chuga - 1 do
               begin
                  if Trim(cell[1, ii]) = vCod_chuga[ii] then
                  begin
                     cCheck := 'T';
                     break;
                  end;
//-----------------------------------[2007.06.04]유동구 삭제(삭제오류로 인한)...
//                  UV_vGubn_free[i] := '0';
               end;
            end;
            if cCheck = 'F' then
            begin
               if GF_HangmokEdit(Trim(cell[1, i]), mskDAT_GMGN.Text, sName, eSuga) then
               begin
                  if (copy(Trim(cell[1, i]),1,1)= 'D') and (mskDAT_GMGN.Text < GV_sToday) then   ////한의 본원종합검사3파트1600331
                        valSUGA_GIBD.Value := valSUGA_GIBD.Value
                  else  valSUGA_GIBD.Value := valSUGA_GIBD.Value - eSuga;
                  if valSUGA_GIBD.Value < 0 then
                     valSUGA_GIBD.Value := 0;
               end;
            end;

            if (Trim(cell[1, i]) = 'JJ13') or
               (Trim(cell[1, i]) = 'JJ34') or
               (Trim(cell[1, i]) = 'JJB9') then
               Ck_UA.Checked := False;
            if (Trim(cell[1, i]) = 'Y004') then
               Ck_DJA.Checked := False;
            if (Trim(cell[1, i]) = 'JJ20') then
               Ck_GA.Checked := False;
            if (Trim(cell[1, i]) = 'JJ14') then
               Ck_UBA.Checked := False;
            if (Trim(cell[1, i]) = 'P003') then
               Ck_JGA.Checked := False;
                           
            for j := (i-1) to rows-2 do
            begin
               UV_vCod_chuga_d[j] := UV_vCod_chuga_d[j+1];
               UV_vDesc_chuga[j]  := UV_vDesc_chuga[j+1];
               UV_vSuga_kmi[j]    := UV_vSuga_kmi[j+1];
               UV_vGubn_free[j]   := UV_vGubn_free[j+1];
            end;

            DeleteRows(i, i);
         end
         else
            Inc(i);
      end;
   end;

   // 합계 및 정상수가 계산
   UP_ChugaSugaCount;

   // 수정 Flag Check
   UV_bEdit := True;
end;

procedure TfrmCK3I01.grdCOD_CHUGACellLoaded(Sender: TObject; DataCol,
  DataRow: Integer; var Value: Variant);
begin
   inherited;

   with qryCancel_jangbi do
   begin
      Active := False;
      ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
      ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
      ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
      ParamByName('cod_hm').AsString     := UV_vCod_chuga_d[DataRow-1];
      Active := True;
      if RecordCount > 0 then
      begin
         if FieldByName('gubn_cancel').AsString <> '' then
            UV_vGubn_Cancel_Chuga[DataRow-1]  := FieldByName('gubn_cancel').AsString + '-' + FieldByName('desc_code').AsString
         else
            UV_vGubn_Cancel_Chuga[DataRow-1]  := '';
         UV_Cancel_Chuga_Etc[DataRow-1]       := FieldByName('cancel_etc').AsString;
      end
      else
      begin
         UV_vGubn_Cancel_Chuga[DataRow-1]   := '';
         UV_Cancel_Chuga_Etc[DataRow-1]     := '';
      end;
   end;

   // 자룔를 화면에 조회
   case DataCol of
      1 : Value := UV_vCod_chuga_d[DataRow-1];
      2 : Value := UV_vDesc_chuga[DataRow-1];
      3 : Value := FormatFloat('#,##0', UV_vSuga_kmi[DataRow-1]);
      4 : Value := StrToInt(UV_vGubn_free[DataRow-1]);
      5 : Value := UV_vGubn_Cancel_Chuga[DataRow-1];
      6 : Value := UV_Cancel_Chuga_Etc[DataRow-1];
   end;

//동의서처리 2015.04.03 김창규
   If UV_iStatus = GC_Insert Then
      Begin
         if (UV_vCod_chuga_d[DataRow-1] = 'FT52') or (UV_vCod_chuga_d[DataRow-1] = 'DRVC') or (UV_vCod_chuga_d[DataRow-1] = 'JJEN') or
            (UV_vCod_chuga_d[DataRow-1] = 'FT60') or (UV_vCod_chuga_d[DataRow-1] = 'FT57') or (UV_vCod_chuga_d[DataRow-1] = 'FT56') then
            Chk_Ysno_company.checked := true;

         if (UV_vCod_chuga_d[DataRow-1] = 'FT55') then
            CK_Trust_company.checked := true;
      End;

end;

function TfrmCK3I01.UF_Retest_Check(Flag : Integer; sNum_jumin : String) : Boolean;
var
  qry_Temp : TQuery;
  v_Today, v_Hm_gmgn, v_dat_gmgn  : TDateTime;
  sCod_hm, sMsg : String;
Begin
  if Flag=1 then
  begin
    qry_Temp := qrySin_Sokun;
    sCod_hm := 'JJ1I';
    sMsg:= '채용 검진(';
  end
  else if flag=2 then
  begin
    qry_Temp := qryJJPP;
    sCod_hm := 'JJRP';
    sMsg:= '철도 면허 검진(';
  end;

  with qry_Temp do
  begin
    Close;
    ParamByName('num_jumin').AsString := sNum_jumin;
    Open;

    if IsEmpty = False then
    begin
      v_Today := StrToDate(copy(GV_sToday,1,4)+'-'+copy(GV_sToday,5,2)+'-'+copy(GV_sToday,7,2));
      v_Hm_gmgn := StrToDate(copy(FieldByName('dat_gmgn').AsString,1,4)+'-'+copy(FieldByName('dat_gmgn').AsString,5,2)+'-'+copy(FieldByName('dat_gmgn').AsString,7,2));
      if v_Today - v_Hm_gmgn > 180 then exit;
      qry_gmgn_retest.Close;
      qry_gmgn_retest.ParamByName('Num_jumin').AsString := sNum_jumin;
      qry_gmgn_retest.ParamByName('Dat_gmgn').AsString := FieldByName('dat_gmgn').AsString;
      qry_gmgn_retest.Open;
      if qry_gmgn_retest.IsEmpty = False then
      begin
           while not qry_gmgn_retest.Eof do
           begin
               if (FieldByName('dat_gmgn').AsString < qry_gmgn_retest.FieldByName('dat_gmgn').AsString)
               and (pos(sCod_hm,qry_gmgn_retest.FieldByName('cod_chuga').AsString) > 0) then
               begin
                   EXIT;
               end;
               if (FieldByName('dat_gmgn').AsString = qry_gmgn_retest.FieldByName('dat_gmgn').AsString) then
               begin
                   Showmessage(sMsg+FormatDateTime('yyyy-mm-dd',v_Hm_gmgn)+ ')에 대한 재검 대상자입니다.');
                   EXIT;
               end;
               qry_gmgn_retest.NEXT;
           end; //while not qry_gmgn_retest.Eof do
       end; //if qry_gmgn_retest.IsEmpty = False then
    end;  //if IsEmpty = False then
  end; //with qry_Temp do

  qry_gmgn_retest.Close;
  qry_Temp.Close;
end;

procedure TfrmCK3I01.UP_Exit(Sender: TObject);
var sCode, sName, sSelect, sWhere, sOrder,
    sDate_NS1, sDate_NS2, sDate_TK1, sDate_TK2, sID, sJisa, sNsJisa, sNsGubn, sNsCg : String;
    eSuga : Extended;
    iCod_chuga, i, eA, iTemp, iStart, iEnd : Integer;
    vCod_chuga : Variant;
begin
   inherited;

   bSaler := True;//한의 재단검진사업관리팀장1600112 2017.01.07 - 단체코드 : 920000  영업 담당자 : 159999 일때 저장시 메세지 출력

   //[2017.02.15-유동구]위탁업체정보동의 및 회사제출정보동의 => 이 함수 타면서 자동 빠짐(저장되어 있던 것도 자동 빠짐)
   //수원센터-고유미선임 요청
   //Chk_Ysno_company.checked := False;
   //CK_Trust_company.checked := False;

   if Sender = mskNUM_POST then
   begin
      if GF_PostEdit(mskNUM_POST, sName) then
         edtDESC_ADDR.Text := sName;
   end
   else if Sender = mskJumin then
   begin
      // 주민번호의 입력오류일 경우 처리
      if Length(mskJumin.Text) < 13 then
      begin
         cmbGmgn.Clear;
         exit;
      end;

      //응급체크 초기화
      HUL_Check.Checked := False;

      //종검 재방문고객 Clear
      Panel94.Caption := '';

      with qryGmgn do
      begin
         // Filter 제거
         Filtered := False;

         Panel_yeonse.Visible := False;

         Active := False;
         SQL.Clear;

         sSelect := 'SELECT cod_jisa, num_id, dat_gmgn, desc_name, cod_jangbi, cod_hul, cod_chuga, cod_dc  FROM gumgin ';

         sWhere := ' WHERE ' + sWhere + ' num_jumin = ''' + mskJumin.Text + '''';
         sOrder := ' ORDER BY dat_gmgn';

         SQL.Clear;
         SQL.Add(sSelect + sWhere + sOrder);
         Active := True;

         cmbGmgn.Clear;
         if RecordCount > 0 then
         begin
            while not Eof do
            begin
               edtName.Text := FieldByName('DESC_NAME').AsString;
               cmbGmgn.Items.Add(GF_DateFormat(FieldByname('DAT_GMGN').AsString));
{
               if (pos('DI03', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '대사재검진';
               end
               else if (pos('DI01', FieldByName('cod_chuga').AsString) > 0) or
                       (pos('DI02', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '대사연구동의';
               end;

}
               if (pos('DI05', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '2015금연연구';
               end;
               if (pos('DI04', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '2015환경연구';
               end;

               if (pos('PJ', FieldByName('cod_jangbi').AsString) > 0) and
                  (Trim(FieldByName('cod_hul').AsString) <> '') and
                  (Panel94.Caption = '') and
                  (FieldByName('dat_gmgn').AsString <> mskDAT_GMGN.Text) then
               begin
               if  ((qryGmgn.FieldByName('cod_dc').AsString ='H00001') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='120001') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='115999') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='431331') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='611098') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='712421') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='511111') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='900000')) and
                         (qryGmgn.FieldByName('dat_gmgn').AsString <> mskDAT_GMGN.Text) then Panel94.Caption := '재방문 고객'
                     else                                                                    Panel94.Caption := '(종검) 재방문 고객';
                end;
               Next;
            end;

            // 마지막 자료를 Default로 표시
            cmbGmgn.ItemIndex := cmbGmgn.Items.Count - 1;

            // Complain이 존재할 시 색깔 깜박임...
            with qryComplain do
            begin
               Active := False;
               ParamByName('Num_jumin').AsString := mskJumin.Text;
               ParamByName('gubun').AsString := '%';
               Active := True;
               if RecordCount > 0 then
               begin
                  UI_Timechk := 12;
                  Timer1.Interval := 400;
               end
               else
               begin
                  mskJumin.Color := $00E6FFFE;
                  Timer1.Interval := 0;
               end;
               Active := False;
            end;

            Btn_Complain.Enabled := True;

            // VIP고객일경우 VIP체크
            with qryVIP do
            begin
               Active := False;
               ParamByName('Num_id').AsString := qryGmgn.FieldByName('Num_id').AsString;
               Active := True;
               if RecordCount > 0 then
               begin
                  if FieldByName('ysno_label').AsString = 'Y' then
                    vip.checked := true
                  else
                    vip.checked := false;
               end
               else
                  vip.checked := false;
               Active := False;
            end;

            btnQueryClick(cmbGmgn);

            SBtn_PreRegister.Enabled := False;
         end
         else
         begin
            Btn_Complain.Enabled := False;
            mskJumin.Color := $00E6FFFE;
            Timer1.Interval := 0;
            GF_MsgBox('Warning', '해당 주민번호는 검진자가 아닙니다.');
            mskJumin.SetFocus;
         end;
         Active := False;
      end;
   end
   else if (Sender = edtNUM_TEL) and (UV_iStatus = GC_Insert) then
   begin
        with qry_Num_tel do
        begin
         // Filter 제거
         Filtered := False;

         Active := False;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         ParamByName('Dat_gmgn').AsString  := mskDAT_GMGN.Text;

         Active := True;
         if RecordCount > 0 then
         begin
            if  UF_Num_Tel(edtNUM_TEL.Text) <>  UF_Num_Tel(FieldByName('Num_tel').AsString)  then
                GF_MsgBox('Information', '이전 검진 전화번호와 다릅니다!' );
         end;
         Active := False;
      end;
   end
             
   else if Sender = edtDESC_ADDR then
   begin
      if Chk_New_Add.checked then
      begin
         if GF_PostName_New(edtDESC_ADDR, sCode, sName, Self) then
         begin
           mskNUM_POST.Text := sCode;
           edtDESC_ADDR.Text := sName;
           edtDESC_ADDR.SetFocus;
         end;
      end
      else
      begin
         if GF_PostName(edtDESC_ADDR, sCode, sName, Self) then
         begin
           mskNUM_POST.Text := sCode;
           edtDESC_ADDR.Text := sName;
           edtDESC_ADDR.SetFocus;
         end;
      end;
   end
   else if (Sender = edtCOD_CHUGA) and (edtCOD_CHUGA.Text <> '') then
   begin
      if mskDAT_GMGN.Text >= '20170313' then
      begin
          if edtCOD_CHUGA.Text = 'S079' then
          begin
              If MessageDlg('알레르기 코드(S079)사용 중단~!!! S101 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
              begin
                  edtCOD_CHUGA.Text := 'S101';
              end else exit;
          end;

          if edtCOD_CHUGA.Text = 'S090' then
          begin
              If MessageDlg('알레르기 코드(S090)사용 중단~!!! S102 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
              begin
                  edtCOD_CHUGA.Text := 'S102';
              end else exit;
          end;
      end;
      
      if (UV_iStatus <> GC_Insert) then
      begin
         if (Copy(edtCOD_CHUGA.Text, 1, 1) <> 'J') and (Copy(edtCOD_CHUGA.Text, 1, 1) <> 'D') and (edtCOD_CHUGA.Text <> 'SS00')
         //and (cmbGmgn.Text <> GF_DateFormat(GV_sToday)) then
         and (cmbGmgn.Text < GF_DateFormat(GV_sToday)) then
         begin
            GF_MsgBox('Information', '장비, 채용검사만 추가가능합니다.');
            edtCOD_CHUGA.Text  := '';
            edtDESC_CHUGA.Text := '';
            edtCOD_CHUGA.SetFocus;
            exit;
         end;
      end;
      {
      if (((Copy(mskNUM_JUMIN.Text,7,1) = '1') or (Copy(mskNUM_JUMIN.Text,7,1) = '3') or
         (Copy(mskNUM_JUMIN.Text,7,1) = '5') or (Copy(mskNUM_JUMIN.Text,7,1) = '7'))) and
         ((pos(edtCOD_CHUGA.Text,'T007')>0) or (pos(edtCOD_CHUGA.Text,'T037')>0)) then
      begin
           GF_MsgBox('Information', '추가 하신 항목코드는 여자 코드 입니다 !');
           edtCOD_CHUGA.Text  := '';
           edtDESC_CHUGA.Text := '';
           edtCOD_CHUGA.SetFocus;
           exit;
      end
      else if (((Copy(mskNUM_JUMIN.Text,7,1) = '2') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') or
           (Copy(mskNUM_JUMIN.Text,7,1) = '6') or (Copy(mskNUM_JUMIN.Text,7,1) = '8'))) and
           ((pos(edtCOD_CHUGA.Text,'T011')>0) or (pos(edtCOD_CHUGA.Text,'T023')>0) or (pos(edtCOD_CHUGA.Text,'E047')>0)) then
           begin
           GF_MsgBox('Information', '추가 하신 항목코드는 남자 코드 입니다!');
           edtCOD_CHUGA.Text  := '';
           edtDESC_CHUGA.Text := '';
           edtCOD_CHUGA.SetFocus;
           exit;
      end;
      }

      if  Length(edtCOD_CHUGA.Text) <> 4 then
      begin
           GF_MsgBox('Information', '추가코드를 확인해주세요!');
           edtCOD_CHUGA.Text  := '';
           edtDESC_CHUGA.Text := '';
           edtCOD_CHUGA.SetFocus;
           exit;
      end
      else if GF_MsgBox('Confirmation', '추가코드에 등록하시겠습니까 ?') then
      begin
         if edtCOD_CHUGA.Text = 'DI01' then
         begin
            for iTemp := 1 to 3 do
            begin
               case iTemp of
                  1 : edtCOD_CHUGA.Text := 'DI01';
                  2 : begin
                         edtCOD_CHUGA.Text := 'C028';
                         valCOD_CHUGA.Value := 0;
                      end;
                  3 : begin
                         edtCOD_CHUGA.Text := 'C026';
                         valCOD_CHUGA.Value := 0;
                      end;
               end;
               // 추가검사 Add
               btnHm_insert.Click;
            end;
         end

         else
         begin
            // 추가검사 Add
            btnHm_insert.Click;

         end;
      end;
   end
   else if (Sender = mskNUM_JUMIN) and (UV_iStatus = GC_Insert) then
   begin
      if CkBox_Jumin.Checked then
      begin
         // 주민번호 Check
         if Not GF_JuminCheck(mskNUM_JUMIN.Text) then
         begin
            mskNUM_JUMIN.SetFocus;
            Exit;
         end;
      end
      else
      begin
         // 주민번호의 입력오류일 경우 처리
         if (Length(mskNUM_JUMIN.Text) < 13) AND (copy(cmbCOD_JISA.Text,1,2) <> '11') then
         begin
            GF_MsgBox('Warning', '주민번호 자릿수 확인 요망.');
            mskNUM_JUMIN.SetFocus;
            exit;
         end;
      end;

      //2010.11.30 철. 주민번호 수정 못하게끔.
      mskNUM_JUMIN.Enabled := False;

      //종검 재방문고객 Clear
      Panel94.Caption := '';

      //2007.12.28 대사증후군
      with qryGmgn do
      begin
         // Filter 제거
         Filtered := False;

         Panel_yeonse.Visible := False;

         Active := False;
         SQL.Clear;

         sSelect := ' SELECT cod_jisa, num_id, dat_gmgn, desc_name, cod_jangbi, cod_hul, cod_chuga, cod_dc, gubn_nosin, gubn_adult, gubn_life, gubn_tkgm, gubn_nscg, gubn_adcg, gubn_lfcg  FROM gumgin ';

         sWhere := ' WHERE num_jumin = ''' + mskNUM_JUMIN.Text + '''';
         sOrder := ' ORDER BY dat_gmgn';

         SQL.Clear;
         SQL.Add(sSelect + sWhere + sOrder);
         Active := True;

         if RecordCount > 0 then
         begin
            UF_Retest_Check(1,mskNUM_JUMIN.Text);
            UF_Retest_Check(2,mskNUM_JUMIN.Text);
            //[20120717-유동구]노신 및 특검 재검관련 내용 DISPLAY
            sDate_NS1 := ''; sDate_NS2 := ''; sDate_TK1 := ''; sDate_TK2 := ''; sID := ''; sJisa := ''; sNsJisa := '';
            sNsGubn   := ''; sNsCg     := '';

            while not Eof do
            begin
               if (pos('PJ', FieldByName('cod_jangbi').AsString) > 0) and
                  (Trim(FieldByName('cod_hul').AsString) <> '') and
                  (Panel94.Caption = '') and
                  (FieldByName('dat_gmgn').AsString <> mskDAT_GMGN.Text) then
               begin
               if  ((qryGmgn.FieldByName('cod_dc').AsString ='H00001') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='120001') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='115999') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='431331') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='611098') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='712421') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='511111') or
                          (qryGmgn.FieldByName('cod_dc').AsString ='900000')) and
                         (qryGmgn.FieldByName('dat_gmgn').AsString <> mskDAT_GMGN.Text) then Panel94.Caption := '재방문 고객'
                     else                                                                    Panel94.Caption := '(종검) 재방문 고객';
                  end;
{
               if (pos('DI03', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '대사재검진';
               end
               else if (pos('DI01', FieldByName('cod_chuga').AsString) > 0) or
                       (pos('DI02', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '대사연구동의';
               end;
}
               if (pos('DI05', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '2015금연연구';
               end;
               if (pos('DI04', FieldByName('cod_chuga').AsString) > 0) then
               begin
                  Panel_yeonse.Visible := True;
                  Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                  Label9.Caption := '2015환경연구';
               end;
               //[20120717-유동구]노신 및 특검 재검관련 내용 DISPLAY
               //---------------------------------------------------------------
               if (FieldByName('gubn_nosin').AsString = '1') or
                  (FieldByName('gubn_adult').AsString = '1') or
                  (FieldByName('gubn_life').AsString  = '1') then
               begin
                  sDate_NS1 := FieldByName('dat_gmgn').AsString;
                  sID       := FieldByName('num_id').AsString;
                  sNsJisa     := FieldByName('cod_jisa').AsString;

                  if FieldByName('gubn_nosin').AsString = '1' then sNsGubn := 'N';
                  if FieldByName('gubn_adult').AsString = '1' then sNsGubn := 'A';
                  if FieldByName('gubn_life').AsString  = '1' then sNsGubn := 'L';

                  if FieldByName('gubn_nosin').AsString = '1' then
                     sNsCg := FieldByName('gubn_nscg').AsString;
                  if FieldByName('gubn_adult').AsString = '1' then
                     sNsCg := FieldByName('gubn_adcg').AsString;
                  if FieldByName('gubn_life').AsString  = '1' then
                     sNsCg := FieldByName('gubn_lfcg').AsString;
               end;

               if ((FieldByName('gubn_nosin').AsString = '2')  or
                   (FieldByName('gubn_adult').AsString = '2')  or
                   (FieldByName('gubn_life').AsString  = '2')) then
                   sDate_NS2 := FieldByName('dat_gmgn').AsString;

               //JJIP
               if pos('JJIP',FieldByName('cod_chuga').AsString) > 0 then
                  sDate_NS2 := FieldByName('dat_gmgn').AsString;

               if (FieldByName('gubn_tkgm').AsString = '1') then
               begin
                  sDate_TK1 := FieldByName('dat_gmgn').AsString;
                  sID       := FieldByName('num_id').AsString;
                  sJisa     := FieldByName('cod_jisa').AsString;

                  //[20171101-유동구]특검이 여러번 온 경우 모두 재검 체크 가능하게..
                  //마지막만 체크 함...
                  if UF_2ChaMigum_Check(FieldByName('dat_gmgn').AsString, FieldByName('cod_jisa').AsString, mskNUM_JUMIN.Text) then
                  begin
                     //[20170201-유동구]특수검진 2차 재검진행 2월까지 진행함(통보일로부터 14일에서 30일로 바뀌면서 2월까지 검진 진행예정)_김유미 책임(응급-선적용)
                     if (copy(sDate_TK1,1,4) = copy(mskDAT_GMGN.Text,1,4)) or
                        (((copy(mskDAT_GMGN.Text,5,2) = '01') or (copy(mskDAT_GMGN.Text,5,2) = '02')) and (copy(sDate_TK1,1,4) = IntTostr(StrToInt(copy(mskDAT_GMGN.Text,1,4))-1))) then
                     begin
                        UP_GumsaCheck('2', sID, sJisa, sNsGubn, sNsCg, sDate_TK1, '');
                     end;
                  end;

               end;

               if (FieldByName('gubn_tkgm').AsString = '2') then sDate_TK2 := FieldByName('dat_gmgn').AsString;
               //---------------------------------------------------------------

               Next;
            end;
         end;
         // Table과 Disconnect
         Active := False;
      end;

      // 2015년 연대 금연사업(2015.04.06)
      with qrySmoke do
      begin
         Active := False;
         ParamByName('Num_Jumin').AsString := mskNum_Jumin.Text;
         Active := True;
         if RecordCount > 0 then
         begin
            Panel_yeonse.Visible := True;
            Label9.Caption := '2015금연연구';
            Label10.Caption := '대상임!!!';
         end
         Else
         begin
            Panel_yeonse.Visible := False;
            Label9.Caption  := '';
            Label10.Caption := '';
         end;
         Active := False;
      end;

      //[20120717-유동구]노신 및 특검 재검관련 내용 DISPLAY
      {노신1차 검사일자가 현재 재검 대상인지 체크}
      //------------------------------------------------------------------------
      if (copy(sDate_NS1,1,4) = copy(mskDAT_GMGN.Text,1,4)) or
         ((copy(mskDAT_GMGN.Text,5,2) = '01') and (copy(sDate_NS1,1,4) = IntTostr(StrToInt(copy(mskDAT_GMGN.Text,1,4))-1))) then
      begin
         if      sDate_NS2 = ''        then UP_GumsaCheck('1', sID, sNsJisa, sNsGubn, sNsCg, sDate_NS1, sDate_NS2)
         else if sDate_NS1 > sDate_NS2 then UP_GumsaCheck('1', sID, sNsJisa, sNsGubn, sNsCg, sDate_NS1, sDate_NS2);
      end;
{
      //[20171101-유동구]위쪽으로 이동됨..
      //[20170201-유동구]특수검진 2차 재검진행 2월까지 진행함(통보일로부터 14일에서 30일로 바뀌면서 2월까지 검진 진행예정)_김유미 책임(응급-선적용)
      if (copy(sDate_TK1,1,4) = copy(mskDAT_GMGN.Text,1,4)) or
         (((copy(mskDAT_GMGN.Text,5,2) = '01') or (copy(mskDAT_GMGN.Text,5,2) = '02')) and (copy(sDate_TK1,1,4) = IntTostr(StrToInt(copy(mskDAT_GMGN.Text,1,4))-1))) then
      begin
         if      sDate_TK2 = ''        then UP_GumsaCheck('2', sID, sJisa, sNsGubn, sNsCg, sDate_TK1, sDate_TK2)
         else if sDate_TK1 > sDate_TK2 then UP_GumsaCheck('2', sID, sJisa, sNsGubn, sNsCg, sDate_TK1, sDate_TK2);
      end;
}
      //------------------------------------------------------------------------

      with qryGumgin do
      begin
         // Filter 제거
         Filtered := False;

         Active := False;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         ParamByName('dat_gmgn').AsString :=  mskDAT_GMGN.Text;
         Active := True;
         if RecordCount > 0 then
         begin
            GF_MsgBox('Information', '중복자료입니다. 확인하세요..!');
            mskJumin.Text := mskNUM_JUMIN.Text;
            UP_SetMode('QUERY');
            UP_Exit(mskJumin);
            cmbGmgn.SetFocus;
            Exit;
         end;
         Active := False;
      end;

      // Complain이 존재할 시 색깔 깜박임...
      with qryComplain do
      begin
         Active := False;
         ParamByName('Num_jumin').AsString := mskNUM_JUMIN.Text;
         ParamByName('gubun').AsString := '1';
         Active := True;
         if RecordCount > 0 then
         begin
            UI_Timechk := 102;
            Timer1.Interval := 400;
         end
         else
         begin
            mskNUM_JUMIN.Color := $00E6FFFE;
            Timer1.Interval := 0;
         end;
         Active := False;
      end;

      Btn_Complain.Enabled := True;

      // 인적 Table 확인
      with qryInjouk do
      begin
         // Filter 제거
         Filtered := False;

         Active := False;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         Active := True;

         if RecordCount > 0 then
         begin
            if UV_sPRStatus ='N' then
            begin
              Pnl_ID.Caption       := '회원번호(' + FieldByName('NUM_ID').AsString + ')';

              UV_sNum_id           := FieldByName('NUM_ID').AsString;
              edtDESC_NAME.Text    := FieldByName('DESC_NAME').AsString;
            //  edtNUM_TEL.Text      := FieldByName('NUM_TEL').AsString;
            //  mskNUM_POST.Text     := FieldByName('NUM_POST').AsString;
            //  edtDESC_ADDR.Text    := FieldByName('DESC_ADDR').AsString;
            //  edtDESC_DEPT.Text    := FieldByName('DESC_DEPT').AsString;
            //검진사업부 권지현과장님 요청 병원부합의
              edtCOD_DC.Text       := FieldByName('COD_DC').AsString;
              if FieldByName('YSNO_FOLK').AsString = 'Y' then
                 ckYSNO_FOLK.Checked  := True
              else
                  ckYSNO_FOLK.Checked  := False;
         {     if FieldByName('Ysno_useinfo').AsString ='Y' then
                 Chk_ysno_useinfo.Checked  := True
              else
                 Chk_ysno_useinfo.Checked  := False;
              }
              if FieldByName('ysno_Homepage').AsString <> '' then
                 begin
                 if FieldByName('ysno_Homepage').AsString ='Y' then
                    Chk_ysno_Homepage.Checked  := True
                    else
                 Chk_ysno_Homepage.Checked  := False;
              end;
{2015.04.03 김창규
              if FieldByName('ysno_Company').AsString <> '' then
              begin
                 if FieldByName('ysno_Company').AsString ='Y' then
                    Chk_ysno_Company.Checked  := True
                 else
                 Chk_ysno_Company.Checked  := False;
              end;
}
              if FieldByName('Ysno_Sod_Citrate').AsString <> '' then
              begin
                   if FieldByName('Ysno_Sod_Citrate').AsString ='Y' then
                   CK_Sod_Citrate.Checked :=True
                   else
                   CK_Sod_Citrate.Checked :=False;
              end;



              mskDAT_IPSA.Text     := FieldByName('DAT_IPSA').AsString;
              GP_ComboDisplay(cmbGUBN_JIK, FieldByName('GUBN_JIK').AsString, 1);

              //edtNUM_SABUN.Text    := FieldByName('NUM_SABUN').AsString; //검진사업부 권지현과장님 요청 병원부합의
//              edtNUM_BOHM1.Text    := FieldByName('NUM_BOHM1').AsString;
//              edtNUM_BOHM2.Text    := FieldByName('NUM_BOHM2').AsString;
//            MEdt_No.Text    := FieldByName('DESC_HOJU').AsString;

              {YDG[20060103]-메일추가}
              if FieldByName('GUBN_SUSIN').AsString = 'Y' then
                 CK_susin.Checked := True
               else
                   CK_susin.Checked := False;
               
           
               Edt_email.Text := FieldByName('DESC_EMAIL').AsString;

               UV_injStatus := 'Y';

               // VIP고객일경우 VIP체크
               with qryVIP do
               begin
                    Active := False;
                    ParamByName('Num_id').AsString := qryInjouk.FieldByName('Num_id').AsString;
                    Active := True;
                    if RecordCount > 0 then
                    begin
                        if FieldByName('ysno_label').AsString = 'Y' then
                           vip.checked := true
                        else
                          vip.checked := false;
                    end
                    else
                       vip.checked := false;
                    Active := False;
               end;
            end
            else
            begin
               Pnl_ID.Caption := '회원번호(' + FieldByName('NUM_ID').AsString + ')';
               UV_sNum_id     := FieldByName('NUM_ID').AsString;
            end
         end
         //2010.04.23 철. 선등록으로 불러온경우는 지워지지않도록.
         else if UV_sPRStatus ='N' then
         begin
            UV_sNum_id           := '';
            Pnl_ID.Caption       := '';

            { - 쿠폰 발행 땜시 -
            edtCOD_DC.Text       := '';
            edtDESC_DEPT.Text    := '';
            MEdt_No.Text         := '';
            }
            if UV_bCouponChk = False then
            begin
               edtCOD_DC.Text    := '';
               edtDESC_DEPT.Text := '';
               MEdt_No.Text      := '';
            end;

            edtDESC_NAME.Text    := '';
            edtNUM_TEL.Text      := '';
            mskNUM_POST.Text     := '';
            edtDESC_ADDR.Text    := '';

            ckYSNO_FOLK.Checked  := False;

            mskDAT_IPSA.Text     := '';
            cmbGUBN_JIK.ItemIndex := -1;
            cmbGubn_Jik.Enabled   := True;
            edtNUM_SABUN.Text    := '';
//            edtNUM_BOHM1.Text    := '';
//            edtNUM_BOHM2.Text    := '';

            CK_susin.Checked     := False;
            Edt_email.Text       := '';

            UV_injStatus := 'N';
         end;
         Active := False;
      end;

      //혈액소견중 혈액구분이 02-바이러스성 간염검사 인것중에 판정이 'C'판정이상으로 안좋은 판정이 있는경우 간암대상자여부확인요망.
      with qry_hul_sokun do
      begin
         // Filter 제거
         Filtered := False;

         Active := False;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
         Active := True;

         if RecordCount > 0 then
         begin
            showmessage('간암대상자여부확인요망');
         end;
      end;

      //접수년도에 특정암-분변잠혈 양성으로 재검대상자인경우
      iStart := 85;
      iEnd   := 90;
      qryGulkwa.Active := false;
      qryGulkwa.ParamByName('Cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
      qryGulkwa.ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
      qryGulkwa.ParamByName('Dat_gmgn').AsString   := mskDAT_GMGN.Text;
      qryGulkwa.Active := true;
      if qrygulkwa.RecordCount > 0 then
      begin
         UV_fGulkwa := '';
         UV_fGulkwa1 := qryGulkwa.FieldByName('DESC_GLKWA1').AsString;
         UV_fGulkwa2 := qryGulkwa.FieldByName('DESC_GLKWA2').AsString;
         UV_fGulkwa3 := qryGulkwa.FieldByName('DESC_GLKWA3').AsString;
         GF_HulGulkwa('2', UV_fGulkwa1, UV_fGulkwa2, UV_fGulkwa3, UV_fGulkwa);

         if trim(copy(UV_fGulkwa, iStart, iEnd - iStart + 1)) = '양성' then
         begin
            showmessage('특정암-분변잠혈 양성으로 재검대상자입니다.');
         end;
      end;


      // 예약자 확인
{      with qryReser do
      begin
         Active := False;
         ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         Active := True;
         if RecordCount > 0 then
         begin
            if Trim(edtDESC_NAME.Text) = '' then
            begin
               edtDESC_NAME.Text    := FieldByName('DESC_NAME').AsString;
               edtNUM_TEL.Text      := FieldByName('NUM_TEL').AsString;
               mskNUM_POST.Text     := FieldByName('NUM_POST').AsString;
               edtDESC_ADDR.Text    := FieldByName('DESC_ADDR').AsString;
            end;
            edtCOD_JANGBI.Text  := FieldByName('COD_JANGBI').AsString;
            edtCOD_HUL.Text    := FieldByName('COD_HUL').AsString;
            edtCOD_CANCER.Text := FieldByName('COD_CANCER').AsString;
            edtCOD_Dc.Text     := FieldByName('COD_Dc').AsString;
            //추가항목 display
            grdCOD_CHUGA.Rows := 0;
            iCod_chuga := GF_MulToSingle(FieldByName('COD_CHUGA').AsString, 4, vCod_chuga);
            UP_ChugaVarMemSet(iCod_chuga);
            for i := 0 to iCod_chuga - 1 do
            begin
               UV_vCod_chuga_d[i] := vCod_chuga[i];
               if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
               begin
                  UV_vDesc_chuga[i] := sName;
                  UV_vSuga_kmi[i] := eSuga;
               end
               else
               begin
                  UV_vDesc_chuga[i] := '';
                  UV_vSuga_kmi[i] := 0;
               end;
            end;
            grdCOD_CHUGA.Rows := iCod_chuga;
            // 추가항목 총금액 계산

            UP_ChugaSugaCount;
            valSUGA_Danche.Value   := FieldByName('SUGA_danche').AsInteger;
            valSUGA_GIBD.Value     := FieldByName('SUGA_gibd').AsInteger;
            valSUGA_johap.Value    := FieldByName('SUGA_johap').AsInteger;
            valSUGA_TOT.Value      := FieldByName('SUGA_tot').AsInteger;

            GP_ComboDisplay(cmbCod_Saler,   FieldByName('Cod_Seller').AsString, 6);
            GP_ComboDisplay(cmbGUBN_NOSIN,  FieldByName('GUBN_NOSIN').AsString, 1);
            GP_ComboDisplay(cmbGUBN_NSCG,   FieldByName('GUBN_NSCG').AsString, 1);
            GP_ComboDisplay(cmbGUBN_TKGM,   FieldByName('GUBN_TKGM').AsString, 1);
            GP_ComboDisplay(cmbGUBN_TKCG,   FieldByName('GUBN_TKCG').AsString, 1);
            GP_ComboDisplay(cmbGUBN_BOGUN,  FieldByName('GUBN_BOGUN').AsString, 1);
            GP_ComboDisplay(cmbGUBN_BGCG,   FieldByName('GUBN_BGCG').AsString, 1);
            GP_ComboDisplay(cmbGUBN_ADULT,  FieldByName('GUBN_ADULT').AsString, 1);
            GP_ComboDisplay(cmbGUBN_ADCG,   FieldByName('GUBN_ADCG').AsString, 1);
            GP_ComboDisplay(cmbGUBN_AGAB,   FieldByName('GUBN_AGAB').AsString, 1);
            GP_ComboDisplay(cmbGUBN_AGCG,   FieldByName('GUBN_AGCG').AsString, 1);
            GP_ComboDisplay(cmbGUBN_GONG,   FieldByName('GUBN_GONG').AsString, 1);
            GP_ComboDisplay(cmbGUBN_GOCG,   FieldByName('GUBN_GOCG').AsString, 1);

            //노신, 신신등의 조합, 회사청구 계산
            UP_Change(cmbGubn_Nosin);
            UP_Change(cmbGubn_nscg);
            UP_Change(cmbGubn_tkgm);
            UP_Change(cmbGubn_tkcg);
            UP_Change(cmbGubn_bogun);
            UP_Change(cmbGubn_bgcg);
            UP_Change(cmbGubn_adult);
            UP_Change(cmbGubn_adcg);
            UP_Change(cmbGubn_agab);
            UP_Change(cmbGubn_agcg);
            UP_Change(cmbGubn_gong);
            UP_Change(cmbGubn_gocg);

            if FieldByName('gubn_nosin').AsString = '1' then
               edtGubn_nsyh.Text := IntToStr(FieldByName('gubn_nsyh').AsInteger) + '-'
                                  + UF_No_Hangmok(mskDAT_GMGN.Text, '1', FieldByName('gubn_nsyh').AsInteger, eA);

            //특검유형Display
            if FieldByName('gubn_tkyh').AsString = '1' then
               edtGubn_tkyh.Text := IntToStr(FieldByName('gubn_tkyh').AsInteger) + '-'
                                  + UF_No_Hangmok(mskDAT_GMGN.Text, '2', FieldByName('gubn_tkyh').AsInteger, eA);


            //성인병유형Display
            if FieldByName('gubn_adult').AsString = '1' then
               edtGubn_adyh.Text := IntToStr(FieldByName('gubn_adyh').AsInteger) + '-'
                                  + UF_No_Hangmok(mskDAT_GMGN.Text, '4', FieldByName('gubn_adyh').AsInteger, eA);

            //간염유형Display
            if FieldByName('gubn_agab').AsString = '1' then
               edtGubn_agyh.Text := IntToStr(FieldByName('gubn_agyh').AsInteger) + '-'
                                  + UF_No_Hangmok(mskDAT_GMGN.Text, '5', FieldByName('gubn_agyh').AsInteger, eA);

            //공교의보유형Display
            if FieldByName('gubn_gong').AsString = '1' then
               edtGubn_goyh.Text := IntToStr(FieldByName('gubn_goyh').AsInteger) + '-'
                                  + UF_No_Hangmok(mskDAT_GMGN.Text, '6', FieldByName('gubn_goyh').AsInteger, eA);

            //입사일자에 Focus;
            mskDAT_IPSA.SetFocus;
            Exit;
         end;
         Active := False;
      end; }
{
      // 단제검사 품의서 확인
      if (UV_injStatus = 'Y') and (Trim(edtCOD_DC.Text) <> '') then
      begin
         UP_PumyiDisplay;
      end;
}

      //[2018.04.23-유동구]응급-주민번호 변경 시 공단 재 검점할 수 있게 추가 작업...
      //[2018.04.27-유동구]응급-수원센터만 활용요청(공단금액 부분은 수원센터 확인 하기로 함)...
      {  
      if copy(cmbCOD_JISA.Text,1,2) = '43' then
      begin
        if      copy(cmbGUBN_NOSIN.Text,1,1) = '1' then UP_Change(cmbGUBN_NOSIN)
        else if copy(cmbGUBN_ADULT.Text,1,1) = '1' then UP_Change(cmbGUBN_ADULT);
      end;
      }
   end
   else if Sender = edtCOD_DC then
   begin
      {Chk_Ysno_company.checked := False;
      CK_Trust_company.checked := False;
      Chk_Free.Checked         := False;}

      // 단제검사 품의서 확인
      if (UV_iStatus = GC_Insert) and (Trim(edtCOD_DC.Text) <> '') then
      begin
         UP_PumyiDisplay;

         qryDanche.Active := False;
         qryDanche.ParamByName('cod_dc').AsString := edtCOD_DC.Text;
         qryDanche.Active := True;
         if qryDanche.RecordCount > 0 then
         begin
            if trim(cmbCOD_SALER.Text) = '' then
            begin
               if qryDanche.RecordCount > 0 then
                  GP_ComboDisplay(cmbCOD_SALER, qryDanche.FieldByName('cod_saler').AsString, 6);
            end;

            // 수임 영업사원 Display..
            with qryPumyiJisa do
            begin
               Active := False;
               ParamByName('cod_dc').AsString    := edtCOD_DC.Text;
               ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
               ParamByName('cod_jisa').AsString  := copy(cmbCOD_JISA.Text,1,2);
               Active := True;
               if RecordCount > 0 then
                  Edt_SuimSawon.Text := FieldByName('cod_susaler').AsString + '-' + FieldByName('desc_suimSawon').AsString
               else
                  Edt_SuimSawon.Text := '';
               Active := False;
            end;
         end
         else
         begin
            edtCOD_DC.Text := '';
            GF_MsgBox('Information', '존재하지 않는 단체코드입니다...');
            edtCOD_DC.SetFocus;
            Exit;
         end;
         qryDanche.Active := False;
      end;
      //무료영상발급Check 2015.09.01 김창규
      With qryChk_Free Do
      Begin
        Active := False;
        ParamByName('Cod_Dc').AsString := edtCod_dc.Text;
        //ParamByName('ST_Date').AsString := Copy(mskDat_Gmgn.Text,1,4) + '%';
        //ParamByName('ED_Date').AsString := Copy(mskDat_Gmgn.Text,1,4) + '%';
        ParamByName('ST_Date').AsString := mskDat_Gmgn.Text;
        ParamByName('ED_Date').AsString := mskDat_Gmgn.Text;
        Active := True;
        if isEmpty = False then
        begin
            If FieldByName('Chk_Free').AsString = 'Y' Then
            begin
                Chk_Free.Checked := True;
            end Else
            begin
                qryChk_freeCD.Active := False;
                qryChk_freeCD.ParamByName('Cod_Dc').AsString := edtCod_dc.Text;
                qryChk_freeCD.ParamByName('num_seq').AsInteger := iSeq;
                qryChk_freeCD.ParamByName('cod_gmgn').AsString := sGmgn;
                qryChk_freeCD.ParamByName('dat_start').AsString := mskDat_Gmgn.Text;
                qryChk_freeCD.ParamByName('dat_End').AsString := mskDat_Gmgn.Text;
                qryChk_freeCD.Active := True;
                if qryChk_freeCD.IsEmpty = False then
                begin
                   if qryChk_freeCD.FieldByName('Chk_freeCD').AsString = 'Y' then Chk_Free.Checked := True
                   else Chk_Free.Checked := False;
                end else
                begin
                   Chk_Free.Checked := False;
                end;
            end;
        end else
        begin
            Chk_Free.Checked := False;
        end;
        Active := False;
      End;
   end
   else if (Sender = valSUGA_DANCHE) or (Sender = valSUGA_GIBD) or (Sender = valsuga_johap) then
       valSUGA_TOT.Value := valSUGA_DANCHE.Value + valSUGA_GIBD.Value + valsuga_johap.Value
   else if (Sender = valSINJANG) or (Sender = valCHEJUNG) then
   begin
      if  (valCHEJUNG.Value > 0) and  (valSINJANG.Value > 0) then
       valBIMAN.Value :=  round(valCHEJUNG.Value / ((valSINJANG.Value - 100) * 0.9) * 100);
   end
   else if Sender = mskDAT_GMGN then
   begin
      with qryMagam do
      begin
         Active := False;
         ParamByName('cod_jisa').AsString  := UV_sJisa;
         ParamByName('dat_magam').AsString := mskDAT_GMGN.Text;
         Active := True;
         if RecordCount > 0 then
            GF_MsgBox('Warning', '마감된 일자입니다...!');
         Active := False;
      end;

      //검진년도 체크
      if not UF_DAT_GMGN_Validation(mskDAT_GMGN.Text) then
      begin
        GF_MsgBox('Warning', '검진일을 확인해 주십시오!');
      end;
   end;
end;

procedure TfrmCK3I01.UP_YhCheck(sChasu, sGubun : string);
begin
   frmCK3I013  := TFrmCK3I013.Create(self);
   frmCK3I013.UV_Gum_gubun := sGubun;
   if frmCK3I013.ShowModal <> mrOK then
   begin
      case StrToInt(sGubun) of
      1 : cmbGUBN_NOSIN.ItemIndex := -1;
      2 : cmbGUBN_TKGM.ItemIndex := -1;
      3 : cmbGUBN_BOGUN.ItemIndex := -1;
      4 : cmbGUBN_ADULT.ItemIndex := -1;
      5 : cmbGUBN_AGAB.ItemIndex := -1;
      6 : cmbGUBN_GONG.ItemIndex := -1;
      7 : cmbGUBN_LIFE.ItemIndex := -1;
      end;
   end;
end;

procedure TfrmCK3I01.UP_TkCheck(sChasu{, sGubun }: string);
var
   sSqlText : string;
begin
   if mskDAT_GMGN.Text >= '20180115' then
   begin
      frmCK3I019_18  := TFrmCK3I019_18.Create(self);
      frmCK3I019_18.cmbChasu.ItemIndex := StrToInt(sChasu);
      frmCK3I019_18.edtDESC_NAME.Text  := edtDESC_NAME.Text;
      frmCK3I019_18.edtCOD_DC.Text     := edtCOD_DC.Text;
      frmCK3I019_18.edtDESC_DC.Text    := edtDESC_DC.Text;

      if frmCK3I019_18.ShowModal = mrOK then
      begin
         VEdt_Tgum.Value  := UV_Suga2;
         VEdt_Tgum.Value  := frmCK3I019_18.ValSuga.Value;
         VEdt_Tgum2.Value := frmCK3I019_18.ValSuga2.Value;
         Label_yh.Caption := UV_TkDesc_yh;
      end
      else
      begin
         //[2107.02.07-유동구]특검접수에서 취소되었을 경우.. 특검접수 존재 여부 확인..
         //------------------------------------------------------------------------
         sSqlText := ' SELECT * FROM Tkgum ' + #13 +
                     ' WHERE COD_JISA  = ''' + Copy(cmbCOD_JISA.Text, 1, 2)  + ''' ' + #13 +
                     '   AND NUM_JUMIN = ''' + mskNUM_JUMIN.Text + ''' ' + #13 +
                     '   AND DAT_GMGN  = ''' + mskDAT_GMGN.Text  + ''' ' + #13 +
                     '   AND GUBN_CHA  = ''' + sChasu            + ''' ';

         with dmComm.qryShare do
         begin
            Active := False;
            SQL.Clear;
            SQL.Text := sSqlText;
            Active := True;

            if IsEmpty then
            begin
               VEdt_Jgum.Value   := valSUGA_DANCHE.Value;;
               VEdt_Tgum.Value   := 0;
               VEdt_Tgum2.Value  := 0;
               Label_yh.Caption  := '특검유형 보기';
               cmbGUBN_TKGM.ItemIndex := -1;
               cmbGUBN_TKCG.ItemIndex := -1;
            end;

            Active := False;
         end;
         //========================================================================
      end;
   end
   else
   begin
      frmCK3I019  := TFrmCK3I019.Create(self);
      frmCK3I019.cmbChasu.ItemIndex := StrToInt(sChasu);
      frmCK3I019.edtDESC_NAME.Text  := edtDESC_NAME.Text;
      frmCK3I019.edtCOD_DC.Text     := edtCOD_DC.Text;
      frmCK3I019.edtDESC_DC.Text    := edtDESC_DC.Text;

      if frmCK3I019.ShowModal = mrOK then
      begin
         VEdt_Tgum.Value  := UV_Suga2;
         VEdt_Tgum.Value  := frmCK3I019.ValSuga.Value;
         VEdt_Tgum2.Value := frmCK3I019.ValSuga2.Value;
         Label_yh.Caption := UV_TkDesc_yh;
      end
      else
      begin
         //[2107.02.07-유동구]특검접수에서 취소되었을 경우.. 특검접수 존재 여부 확인..
         //------------------------------------------------------------------------
         sSqlText := ' SELECT * FROM Tkgum ' + #13 +
                     ' WHERE COD_JISA  = ''' + Copy(cmbCOD_JISA.Text, 1, 2)  + ''' ' + #13 +
                     '   AND NUM_JUMIN = ''' + mskNUM_JUMIN.Text + ''' ' + #13 +
                     '   AND DAT_GMGN  = ''' + mskDAT_GMGN.Text  + ''' ' + #13 +
                     '   AND GUBN_CHA  = ''' + sChasu            + ''' ';

         with dmComm.qryShare do
         begin
            Active := False;
            SQL.Clear;
            SQL.Text := sSqlText;
            Active := True;

            if IsEmpty then
            begin
               VEdt_Jgum.Value   := valSUGA_DANCHE.Value;;
               VEdt_Tgum.Value   := 0;
               VEdt_Tgum2.Value  := 0;
               Label_yh.Caption  := '특검유형 보기';
               cmbGUBN_TKGM.ItemIndex := -1;
               cmbGUBN_TKCG.ItemIndex := -1;
            end;

            Active := False;
         end;
         //========================================================================
      end;
   end;
end;

procedure TfrmCK3I01.UP_PumyiDisplay;
var iCod_chuga, i, j, iCod_chugas : Integer;
    sName, sHangmok : String;
    vCod_chuga, vCod_chugas : Variant;
    eSuga : Extended;
begin

   with qryPumyi do
   begin
      // Filter 제거
      Filtered := False;
      //if UV_sGubn_PySeq <> '' then Filtered := True;

      Active := False;
      ParamByName('cod_dc').AsString    := edtCOD_DC.Text;
//      ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
      Active := True;
      vChuga_d := '';
      vChuga_s := '';
      if RecordCount > 0 then
      begin
         if (UV_sGubn_PySeq <> '') and (UV_sGubn_PySeq <> '0') then
         begin
            Filtered := True;
            qryPumyi.Filter := ' num_seq = ''' + UV_sGubn_PySeq + '''';
         end;
         edtCOD_DC.Text       := FieldByName('COD_DC').AsString;
         GP_ComboDisplay(cmbCOD_SALER, FieldByName('COD_SALER').AsString, 6);
         frmCK3I011 := TFrmCK3I011.Create(self);
         frmCK3I011.edtCOD_DC.Text  := edtCOD_DC.Text;
         frmCK3I011.edtDESC_DC.Text := edtDESC_DC.Text;
         frmCK3I011.Date.Text := mskDAT_GMGN.Text;
         frmCK3I011.Date_Start.Text :=  FieldByName('dat_start').AsString;
         frmCK3I011.Date_End.Text   :=  FieldByName('dat_end').AsString;
         frmCK3I011.Memo1.Lines.Text := FieldByName('etc_gita').AsString;

//         if UV_sGubn_PySeq = '' then
//            frmCK3I011.Edt_PySeq.Text := FieldByName('num_seq').AsString
//       else
//            frmCK3I011.Edt_PySeq.Text := UV_sGubn_PySeq;
         frmCK3I011.Edt_PyYh.Text  := UV_sGubn_PyYh;
         frmCK3I011.Edt_Sel_hm.Text  := UV_sSel_hm;
         frmCK3I011.Edt_Add_hm.Text  := UV_sAdd_hm;

         if frmCK3I011.ShowModal = mrOK then
         begin
            if (chk_sel <> '') and (chk_sel <> '0') then
            begin
              if cod_sel = 'N' then
              begin
                 if frmCK3I011.Edt_Sel_hm.Text = '' then
                 begin
                   frmCK3I020 := TFrmCK3I020.Create(self);
                   //frmCK3I020.cnt_sel.Text :=  chk_sel;
                   frmCK3I020.edtCOD_DC.Text := edtCOD_DC.Text;
                   frmCK3I020.edtDESC_DC.Text :=  edtDESC_DC.Text;
                   frmCK3I020.Date.Text := mskDAT_GMGN.Text;
                   frmCK3I020.P_seq.Text := IntToStr(iSeq);
                   frmCK3I020.edtCOD_YH.Text := sGmgn;
                   //frmCK3I020.ShowModal;
                   if frmCK3I020.ShowModal = mrOK then
                   begin
                        if (Trim(vChuga_s) <> '') and (pnlDetail.Enabled = True) then
                        begin
                             //추가항목 display
                             grdCOD_CHUGA.Rows := 0;
                             iCod_chuga := GF_MulToSingle(vchuga_d, 4, vCod_chuga);
                             iCod_chugas := GF_MulToSingle(vchuga_s, 4, vCod_chugas);
                             UP_ChugaVarMemSet(iCod_chuga + iCod_chugas);
                             for i := 0 to iCod_chuga - 1 do
                             begin
                                  UV_vCod_chuga_d[i] := vCod_chuga[i];

                                  if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                                  begin
                                       UV_vDesc_chuga[i] := sName;
                                       UV_vSuga_kmi[i] := eSuga;
                                  end
                                  else
                                  begin
                                       UV_vDesc_chuga[i] := '';
                                       UV_vSuga_kmi[i] := 0;
                                  end;
                                  UV_vGubn_free[i]  := '0';
                             end;

                             //UP_ChugaVarMemSet(iCod_chugas);
                             for i := iCod_chuga to (iCod_chuga + iCod_chugas) - 1 do
                             begin
                                  UV_vCod_chuga_d[i] := vCod_chugas[i - iCod_chuga];

                                  if GF_HangmokEdit(vCod_chugas[i - iCod_chuga], mskDAT_GMGN.Text, sName, eSuga) then
                                  begin
                                       UV_vDesc_chuga[i] := sName;
                                       UV_vSuga_kmi[i] := eSuga;
                                  end
                                  else
                                  begin
                                       UV_vDesc_chuga[i] := '';
                                       UV_vSuga_kmi[i] := 0;
                                  end;
                                  UV_vGubn_free[i]  := '0';
                             end;
                             grdCOD_CHUGA.Rows := iCod_chuga + iCod_chugas;
                        end;

                        UP_Change(cmbGubn_Nosin);
                        if UV_sGubn_nosin = 'K' then
                        begin
                             GP_ComboDisplay(cmbGUBN_NSCG, '2', 1);
                             UP_Change(cmbGubn_nscg);
                        end
                        else
                            UP_Change(cmbGubn_nscg);
                   end;
                 end
                 else
                 begin
                    if (frmCK3I011.Edt_Sel_hm.Text <> '') and (pnlDetail.Enabled = True) then
                    begin
                         //추가항목 display
                         grdCOD_CHUGA.Rows := 0;
                         iCod_chuga := GF_MulToSingle(vchuga_d, 4, vCod_chuga);
                         iCod_chugas := GF_MulToSingle(frmCK3I011.Edt_Sel_hm.Text, 4, vCod_chugas);
                         UP_ChugaVarMemSet(iCod_chuga + iCod_chugas);
                         for i := 0 to iCod_chuga - 1 do
                         begin
                              UV_vCod_chuga_d[i] := vCod_chuga[i];

                              if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                              begin
                                   UV_vDesc_chuga[i] := sName;
                                   UV_vSuga_kmi[i] := eSuga;
                              end
                              else
                              begin
                                   UV_vDesc_chuga[i] := '';
                                   UV_vSuga_kmi[i] := 0;
                              end;
                              UV_vGubn_free[i]  := '0';
                         end;

                         //UP_ChugaVarMemSet(iCod_chugas);
                         for i := iCod_chuga to (iCod_chuga + iCod_chugas) - 1 do
                         begin
                              UV_vCod_chuga_d[i] := vCod_chugas[i - iCod_chuga];

                              if GF_HangmokEdit(vCod_chugas[i - iCod_chuga], mskDAT_GMGN.Text, sName, eSuga) then
                              begin
                                   UV_vDesc_chuga[i] := sName;
                                   UV_vSuga_kmi[i] := eSuga;
                              end
                              else
                              begin
                                   UV_vDesc_chuga[i] := '';
                                   UV_vSuga_kmi[i] := 0;
                              end;
                              UV_vGubn_free[i]  := '0';
                         end;
                         grdCOD_CHUGA.Rows := iCod_chuga + iCod_chugas;
                    end;
                    UP_Change(cmbGubn_Nosin);
                    if UV_sGubn_nosin = 'K' then
                    begin
                         GP_ComboDisplay(cmbGUBN_NSCG, '2', 1);
                         UP_Change(cmbGubn_nscg);
                    end
                    else
                        UP_Change(cmbGubn_nscg);
                 end
              end
              else if cod_sel = 'Y' then
              begin
                   frmCK3I023 := TFrmCK3I023.Create(self);
                   frmCK3I023.cnt_sel.Text :=  chk_sel;
                   frmCK3I023.edtCOD_DC.Text := edtCOD_DC.Text;
                   frmCK3I023.edtDESC_DC.Text :=  edtDESC_DC.Text;
                   frmCK3I023.Date.Text := mskDAT_GMGN.Text;
                   frmCK3I023.edtCOD_YH.Text := sGmgn;
                   if frmCK3I023.ShowModal = mrOK then
                   begin
                        if (Trim(vChuga_s) <> '') and (pnlDetail.Enabled = True) then
                        begin
                             //추가항목 display
                             grdCOD_CHUGA.Rows := 0;
                             iCod_chuga := GF_MulToSingle(vchuga_d, 4, vCod_chuga);
                             iCod_chugas := GF_MulToSingle(vchuga_s, 4, vCod_chugas);
                             UP_ChugaVarMemSet(iCod_chuga + iCod_chugas);
                             for i := 0 to iCod_chuga - 1 do
                             begin
                                  UV_vCod_chuga_d[i] := vCod_chuga[i];

                                  if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                                  begin
                                       UV_vDesc_chuga[i] := sName;
                                       UV_vSuga_kmi[i] := eSuga;
                                  end
                                  else
                                  begin
                                       UV_vDesc_chuga[i] := '';
                                       UV_vSuga_kmi[i] := 0;
                                  end;
                                  UV_vGubn_free[i]  := '0';
                             end;

                             //UP_ChugaVarMemSet(iCod_chugas);
                             for i := iCod_chuga to (iCod_chuga + iCod_chugas) - 1 do
                             begin
                                  UV_vCod_chuga_d[i] := vCod_chugas[i - iCod_chuga];

                                  if GF_HangmokEdit(vCod_chugas[i - iCod_chuga], mskDAT_GMGN.Text, sName, eSuga) then
                                  begin
                                       UV_vDesc_chuga[i] := sName;
                                       UV_vSuga_kmi[i] := eSuga;
                                  end
                                  else
                                  begin
                                       UV_vDesc_chuga[i] := '';
                                       UV_vSuga_kmi[i] := 0;
                                  end;
                                  UV_vGubn_free[i]  := '0';
                             end;
                             grdCOD_CHUGA.Rows := iCod_chuga + iCod_chugas;
                        end;
                        UP_Change(cmbGubn_Nosin);
                        if UV_sGubn_nosin = 'K' then
                        begin
                             GP_ComboDisplay(cmbGUBN_NSCG, '2', 1);
                             UP_Change(cmbGubn_nscg);
                        end
                        else
                            UP_Change(cmbGubn_nscg);
                   end;
              end;
            end
            else
            begin
                 if (Trim(vChuga_d) <> '') and (pnlDetail.Enabled = True) then
                 begin
                      //추가항목 display
                      grdCOD_CHUGA.Rows := 0;
                      iCod_chuga := GF_MulToSingle(vchuga_d, 4, vCod_chuga);
                      UP_ChugaVarMemSet(iCod_chuga);
                      for i := 0 to iCod_chuga - 1 do
                      begin
                           UV_vCod_chuga_d[i] := vCod_chuga[i];

                           if GF_HangmokEdit(vCod_chuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                           begin
                                UV_vDesc_chuga[i] := sName;
                                UV_vSuga_kmi[i] := eSuga;
                           end
                           else
                           begin
                                UV_vDesc_chuga[i] := '';
                                UV_vSuga_kmi[i] := 0;
                           end;
                           UV_vGubn_free[i]  := '0';
                      end;
                      grdCOD_CHUGA.Rows := iCod_chuga;
                 end;
                 UP_Change(cmbGubn_Nosin);
                 if UV_sGubn_nosin = 'K' then
                 begin
                      GP_ComboDisplay(cmbGUBN_NSCG, '2', 1);
                      UP_Change(cmbGubn_nscg);
                 end
                 else
                     UP_Change(cmbGubn_nscg);
            end;
            UP_Change(cmbGubn_tkgm);
            UP_Change(cmbGubn_tkcg);
            UP_Change(cmbGubn_bogun);
            UP_Change(cmbGubn_bgcg);
            UP_Change(cmbGubn_adult);
            if UV_sGubn_nosin = 'J' then
            begin
               GP_ComboDisplay(cmbGubn_adcg, '2', 1);
               UP_Change(cmbGubn_adcg);
            end
            else
               UP_Change(cmbGubn_adcg);

            UP_Change(cmbGubn_life);
            UP_Change(cmbGubn_lfcg);
            UP_Change(cmbGubn_agab);
            UP_Change(cmbGubn_agcg);
            UP_Change(cmbGubn_gong);
            UP_Change(cmbGubn_gocg);
         end;

         //[2010.09.01-승철]결과지 출력구분...
         sHangmok := vchuga_d + vchuga_s;
         //10.09.06 철. 신신 아닌건만 결과지구분함
         if Copy(edtCOD_JANGBI.Text,1,2) <> 'SS' then
            GP_ComboDisplay(Cmb_Print, GF_PrintCheck(edtCOD_JANGBI.Text, edtCOD_HUL.Text, sHangmok, copy(cmbGUBN_NOSIN.Text,1,1), copy(edtGUBN_NSYH.Text,1,pos('-', edtGUBN_NSYH.Text)-1), copy(cmbGUBN_ADULT.Text,1,1), copy(edtGUBN_ADYH.Text,1,pos('-', edtGUBN_ADYH.Text)-1), copy(cmbGUBN_LIFE.Text,1,1), copy(edtGUBN_LFYH.Text,1,pos('-', edtGUBN_LFYH.Text)-1), copy(cmbGUBN_TKGM.Text,1,1)), 2);

      end;
      Active := False;
   end;
   //2016.03.29 사용하지 않는코드가 있으면 다른 코드로 추가 할것(김창규) E069 -> C078로
   If (mskDat_gmgn.Text >= '20160331') And
      (Pos('E069',sHangmok) > 0) Then
      Begin
         If MessageDlg('E069사용 중단~!!! C078 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'C078';
               btnHm_insertClick(Self);
            End;
      End;

   //2018.04.30
   If (mskDat_gmgn.Text >= '20180502') And
      (Pos('S021',sHangmok) > 0) Then
      Begin
         If MessageDlg('S021사용 중단~!!! C090 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'C090';
               btnHm_insertClick(Self);
            End;
      End;


   If mskDat_gmgn.Text >= '20160711' Then
   begin
        C088_Check := False;
        C089_Check := False;
        if (Pos('C088',sHangmok) > 0) Then
              C088_Check := True;

        if (Pos('C089',sHangmok) > 0) Then
              C089_Check := True;

        if (C088_Check) and (C089_Check) then
        begin
            If MessageDlg('황산화코드(C088C089)사용 중단~!!! C084C085 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'C084';
               btnHm_insertClick(Self);
               edtCOD_CHUGA.Text := 'C085';
               btnHm_insertClick(Self);
            End;
        end
        else if (C088_Check) then
        begin
            If MessageDlg('C088사용 중단~!!! C084 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'C084';
               btnHm_insertClick(Self);
            End;
        end
        else if (C088_Check) then
        begin
            If MessageDlg('C089사용 중단~!!! C085 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'C085';
               btnHm_insertClick(Self);
            End;
        end;
   end;


   If mskDat_gmgn.Text >= '20170313' Then
   begin
        S079_Check := False;
        S090_Check := False;
        if (Pos('S079',sHangmok) > 0) Then
              S079_Check := True;

        if (Pos('S090',sHangmok) > 0) Then
              S090_Check := True;

        if (S079_Check) and (S090_Check) then
        begin
            If MessageDlg('알레르기 코드(S079S090)사용 중단~!!! S101S102 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'S101';
               btnHm_insertClick(Self);
               edtCOD_CHUGA.Text := 'S102';
               btnHm_insertClick(Self);
            End;
        end
        else if (S079_Check) then
        begin
            If MessageDlg('S079사용 중단~!!! S101 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'S101';
               btnHm_insertClick(Self);
            End;
        end
        else if (S090_Check) then
        begin
            If MessageDlg('S090사용 중단~!!! S102 을 추가하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
            Begin
               edtCOD_CHUGA.Text := 'S102';
               btnHm_insertClick(Self);
            End;
        end;
   end;

   If (mskDat_gmgn.Text >= '20180322') And
      (Pos('JK40',sHangmok) > 0) Then
   Begin
      If MessageDlg('우울증검사(PHQ-9)(JK40)코드가 있습니다. 동의 하십니까?', mtInformation, [mbYes, mbNo], 0) = mrNo Then
      Begin
         for j := 1 to grdCOD_CHUGA.Rows do
         begin
            if grdCOD_CHUGA.cell[1, j] =  'JK40' then
            begin
               grdCOD_CHUGA.TopRow := j;
               grdCOD_CHUGA.RowSelected[j] := true;
               btnHm_delete.Click;
               break;
            end;
         end;
      End;
   End;

end;

procedure TfrmCK3I01.UP_ChungGu_Suga(Gubun, sGubun : String; SugaA, Suga : Extended);
begin
   if Gubun = '' then
   begin
      if sGubun = '2' then
      begin
        // valSUGA_JOHAP.Value := valSUGA_JOHAP.Value + Suga;
      end
      else if sGubun = '1' then
      begin
         valSUGA_DANCHE.Value := valSUGA_DANCHE.Value + Suga;
      end;
   end else if Gubun = '1' then
   begin
      if sGubun = '2' then
      begin
         valSUGA_DANCHE.Value := valSUGA_DANCHE.Value - SugaA;
       //  valSUGA_JOHAP.Value := valSUGA_JOHAP.Value + Suga;
      end
      else if sGubun = '1' then
      begin
         valSUGA_DANCHE.Value := valSUGA_DANCHE.Value - SugaA + Suga;
      end
      else
      begin
         valSUGA_DANCHE.Value := valSUGA_DANCHE.Value - SugaA;
      end;
   end  else if Gubun = '2' then
   begin
      if sGubun = '2' then
      begin
        // valSUGA_JOHAP.Value  := valSUGA_JOHAP.Value - SugaA + Suga;
      end
      else if sGubun = '1' then
      begin
         valSUGA_DANCHE.Value := valSUGA_DANCHE.Value + Suga;
       //  valSUGA_JOHAP.Value := valSUGA_JOHAP.Value - SugaA;
      end
      else
      begin
       //  valSUGA_JOHAP.Value := valSUGA_JOHAP.Value - SugaA;
      end;
   end;
   {YDG[20060103]-특검 및 종검 수가 세분화}
   VEdt_Jgum.Value := valSUGA_DANCHE.Value - VEdt_Tgum.Value - VEdt_Tgum2.Value;
end;

function  TfrmCK3I01.UF_No_Hangmok(sDate, sGubun : String; iYh : Integer; var iSuga : Integer): String;
begin
   Result := '';
   iSuga := 0;
   with qryNo_hangmok do
   begin
      Active := False;     
      //2017.07.01 공단 7월 이후 수가 변경과 no_hangmok이 년도 적용만 가능해서 수정
      if (sDate >= '20170101') and
         (sDate <= '20170630') then
        ParamByName('dat_apply').AsString   := '4017'
      else
        ParamByName('dat_apply').AsString   := sDate;
      ParamByName('gubn_code').AsString   := sGubun;
      ParamByName('gubn_yh').AsInteger    := iYh;
      Active := True;
      if RecordCount > 0 then
      begin
         Result := FieldByName('desc_yhname').AsString;
         iSuga  := FieldByName('suga_amt').AsInteger;
      end;
      Active := False;
   end;
end;



function  TfrmCK3I01.UF_No_Hangmok_Ysno_gocg(sDate, sGubun : String; iYh : Integer): String;
begin
   Result := '';
   with qryNo_hangmok do
   begin
      Active := False;
      ParamByName('dat_apply').AsString   := sDate;
      ParamByName('gubn_code').AsString   := sGubun;
      ParamByName('gubn_yh').AsInteger    := iYh;
      Active := True;
      if RecordCount > 0 then
      begin
         Result := FieldByName('desc_yhname').AsString;
      end;
      Active := False;
   end;
end;



function  TfrmCK3I01.UF_Jae_Hangmok(sJisa, sJumin, sGubun : String; iYh : Integer; var iSuga : Integer): String;
begin
   Result := '';
   iSuga := 0;
   with qryJaegumhm do
   begin
      Active := False;
      ParamByName('cod_jisa').AsString    := sJisa;
      ParamByName('num_id').AsString      := sJumin;
      ParamByName('gubn_code').AsString   := sGubun;
      ParamByName('num_sil').AsInteger    := iYh;
      Active := True;
      if RecordCount > 0 then
      begin
         Result := FieldByName('desc_yhname').AsString;
         iSuga  := FieldByName('suga_amt').AsInteger;
      end;
      Active := False;
   end;
end;

procedure TfrmCK3I01.btnSugumClick(Sender: TObject);
begin
   inherited;
   if (cmbCOD_JISA.Text <>  '') and (mskDAT_GMGN.Text <> '')  and
      (mskNUM_JUMIN.Text <> '') and (edtDESC_NAME.Text <> '') and
      (edtCOD_DC.Text <> '')    and (cmbGUBN_NEAWON.Text <> ''){and
      (valSUGA_GIBD.Value > 0)} and (length(mskNUM_JUMIN.Text) = 13) and
      (pos('*',mskNUM_JUMIN.Text) = 0) and (pos('-',mskNUM_JUMIN.Text) = 0) then
   begin
      frmCK3I012 := TFrmCK3I012.Create(self);

      if  UV_Check_ipkm = True then
      begin
         frmCK3I012.mskDat_ipkum.Enabled := True;
         frmCK3I012.cmbGubn_ipkum.Enabled := True;
         frmCK3I012.cmbGubn_ikht.Enabled := True;
         frmCK3I012.cmbGubn_cardsa.Enabled := True;
         frmCK3I012.valSuga_ipkum.Enabled := True;
         frmCK3I012.valSuga_cash.Enabled := True;
         frmCK3I012.valSuga_card.Enabled := True;
         frmCK3I012.btnPSave.visible := True;
      end
      else
      begin
         frmCK3I012.mskDat_ipkum.Enabled := False;
         frmCK3I012.cmbGubn_ipkum.Enabled := False;
         frmCK3I012.cmbGubn_ikht.Enabled := False;
         frmCK3I012.cmbGubn_cardsa.Enabled := False;
         frmCK3I012.valSuga_ipkum.Enabled := False;
         frmCK3I012.valSuga_cash.Enabled := False;
         frmCK3I012.valSuga_card.Enabled := False;
         frmCK3I012.btnPSave.visible := False;
      end;

      with frmCK3I012.qry_chgu do
      begin
         Active := False;
         ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         Active := True;
      end;
      
      with frmCK3I012.qrychunggu do
      begin
         Active := False;
         ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         Active := True;
      end;

      with frmCK3I012.qryOnly_Chunggu do
      begin
         Active := False;
         ParamByName('cod_jisa').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
         ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
         ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
         Active := True;
      end;
      frmCK3I012.ShowModal;
    end
    else
    begin
       ShowMessage('입금 처리 할 자료 확인요합니다.');
       exit;
    end;
end;

procedure TfrmCK3I01.btnPrintClick(Sender: TObject);
Var
   I, J, K : Integer;
begin
   inherited;
   Panel100.Visible := False;
   K := 0;
   UV_DI05 := '';
   //연대 DI05 항목Check 2015.04.06
   For I := 1 To grdCod_Chuga.Rows Do
      Begin
         If (grdCod_Chuga.Cell[01,I] = 'DI04') Or
            (grdCod_Chuga.Cell[01,I] = 'DI05') Then
            K := 999;
            UV_DI05 := grdCod_Chuga.Cell[1,I];
      End;

   // 라벨 출력...
   if (pos('TTP-24',Comb_printer.Text) > 0) And
      (chk_BarCode.Checked = True) then
   begin
      if CK_Label.ItemIndex = 0 then
      begin
         frmCK3P21 := TfrmCK3P21.Create(Self);
         frmCK3P21.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
         frmCK3P21.QuickRep.Print;
         If K = 999 Then // 연대 라벨지 출력
            Begin
               frmCK3P22 := TfrmCK3P22.Create(Self);
               frmCK3P22.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
               frmCK3P22.QuickRep.Print;
            End;
      end
      Else if CK_Label.ItemIndex = 1 then
      begin
         frmCK3P17 := TfrmCK3P17.Create(Self);
         frmCK3P17.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
         frmCK3P17.QuickRep.Print;
         If K = 999 Then // 연대 라벨지 출력
            Begin
               frmCK3P18 := TfrmCK3P18.Create(Self);
               frmCK3P18.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
               frmCK3P18.QuickRep.Print;
            End;
      end
      else if CK_Label.ItemIndex = 2 then
      begin
         frmCK3P11 := TfrmCK3P11.Create(Self);
         frmCK3P11.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
         frmCK3P11.QuickRep.Print;
      end;
   end;

   if ckJinryoChart.Checked = True then
   begin
     // 의무기록지 챠트 출력...
     frmCK3P09 := TfrmCK3P09.Create(Self);
     frmCK3P09.QuickRep.PrinterSettings.PrinterIndex := UV_iPrinrer;
     frmCK3P09.QuickRep.Print;
     //frmCK3P09.QuickRep.preview;
   end
   else
   begin
     // 챠트 출력...
     frmCK3P04 := TfrmCK3P04.Create(Self);
     //2015.04.27 임시 처리 김창규
     {If (Copy(cmbCod_Jisa.Text,1,2) = '15') And
        ((Com_BD.ItemIndex = 1) or (Com_BD.ItemIndex = 2) or (Com_BD.ItemIndex = 10))    Then
        frmCK3P04.QuickRep.Page.TopMargin := 10;
      }
     frmCK3P04.QuickRep.Page.TopMargin := ValTop.Value;
     frmCK3P04.QuickRep.PrinterSettings.PrinterIndex := UV_iPrinrer;
     frmCK3P04.QuickRep.Print;
     //frmCK3P04.QuickRep.preview;
   end;



end;

procedure TfrmCK3I01.cmbRelationChange(Sender: TObject);
var
    sFull_FileName, sFileName : String;
    iLength, i : integer;

    AppHandle: HWND;    
begin
  inherited;
  if cmbRelation.ItemIndex = 0 then
  begin
     frmCK3I014  := TFrmCK3I014.Create(self);
     frmCK3I014.ShowModal;
  end
  else if cmbRelation.ItemIndex = 1 then
  begin
     UV_sDesc_Coupon := ''; UV_sDesc_Coupon_etc := '';

     frmCK3I016 := TfrmCK3I016.Create(self);
     if frmCK3I016.ShowModal = mrOk then
     begin
        UV_bCouponChk := True;

        if (pos('판매',frmCK3I016.UV_sDesc_balkub) > 0) then
        begin
           if pos('발행',frmCK3I016.UV_sDesc_balkub) > 0 then
                valSUGA_DANCHE.Value := frmCK3I016.UV_iSuga_tot
           else valSUGA_GIBD.Value   := frmCK3I016.UV_iSuga_tot;
        end
        else valSUGA_DANCHE.Value := 0;

        edtCOD_DC.Text := copy(frmCK3I016.UV_sDesc_balkub,1,Pos('??',frmCK3I016.UV_sDesc_balkub) - 1);
        MEdt_No.Text   := frmCK3I016.UV_sDesc_balkubNo;
        Gubn_Label.Caption := frmCK3I016.UV_sDesc_Hangmok;
        if UV_iStatus = GC_Insert then
        begin
           GP_ComboDisplay(cmbCOD_SALER, copy(frmCK3I016.UV_sDesc_sincheongin,1,6), 6);
           if Trim(cmbCOD_SALER.Text) = '' then
              UP_Exit(edtCOD_DC);
//              cmbCOD_SALER.Text := '129999-순수내원';
        end;

        UV_sDesc_Coupon := frmCK3I016.UV_sList_Coupon;
        UV_sDesc_Coupon_etc := frmCK3I016.UV_sCDesc_etc;
        UV_bEdit := True;
     end
     else
     begin
        UV_sDesc_Coupon := '';
        UV_sDesc_Coupon_etc := '';

        if UV_iStatus = GC_Insert then
        begin
           UV_bCouponChk := False;
           MEdt_No.Text := '';
           GF_MsgBox('Information', '예약확인증 적용이 취소 되었습니다..');
        end;
     end;
     if UV_iStatus = GC_Insert then
    //    mskNUM_JUMIN.SetFocus;
  end
  else if cmbRelation.ItemIndex = 2 then
  begin
     if (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
     begin
        frmCK3I017  := TFrmCK3I017.Create(self);
        frmCK3I017.Edt_Id.Text := UV_sNum_id;

        if frmCK3I017.ShowModal = mrOk then GF_MsgBox('Information', 'PACS전송이 완료되었습니다.')
        else                                GF_MsgBox('Information', 'PACS전송이 취소되었습니다.');
     end
     else
     begin
        GF_MsgBox('Information', '자료를 조회한 후에 작업하여 주십시요..');
        mskJumin.SetFocus;
     end;
  end
  else if cmbRelation.ItemIndex = 3 then
  begin
     if (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
     begin
        frmCK3I024  := TFrmCK3I024.Create(self);
        frmCK3I024.Edt_Id.Text := UV_sNum_id;
        if frmCK3I024.ShowModal = mrOk then GF_MsgBox('Information', 'PACS전송이 완료되었습니다.')
        else                                GF_MsgBox('Information', 'PACS전송이 취소되었습니다.');
     end
     else
     begin
        GF_MsgBox('Information', '자료를 조회한 후에 작업하여 주십시요..');
        mskJumin.SetFocus;
     end;
  end
  else if cmbRelation.ItemIndex = 4 then
  begin
     qrySawon.Active := False;
     qrySawon.ParamByName('cod_sawon').AsString := GV_sUserId;
     qrySawon.Active := True;

     if (qrySawon.RecordCount > 0) and (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
     begin
        if qrySawon.FieldByName('desc_licen').AsString = 'Y' then
        begin
           sFull_FileName := '';
           i :=  0;

           frmCK3I01A  := TfrmCK3I01A.Create(self);

           frmCK3I01A.ComboBox.Items.Clear;
           sFull_FileName := '\\222.222.1.6\MDMS_Chart_image\' + copy(cmbCOD_JISA.Text,1,2) + '\' + copy(mskDAT_GMGN.Text,1,4) + '\' + mskDAT_GMGN.Text + '\';
           frmCK3I01A.UV_Full_FileName := '\\222.222.1.6\MDMS_Chart_image\' + copy(cmbCOD_JISA.Text,1,2) + '\' + copy(mskDAT_GMGN.Text,1,4) + '\' + mskDAT_GMGN.Text + '\';
           frmCK3I01A.FileListBox.Mask := sFull_FileName + mskNUM_JUMIN.Text + '*.jpg';

           for i := 1 to frmCK3I01A.FileListBox.Items.Count  do
           begin
              frmCK3I01A.ComboBox.Items.Add(mskNUM_JUMIN.Text + GF_LPad(IntToStr(i), 2, '0')  + '.jpg');
           end;
           frmCK3I01A.ComboBox.ItemIndex := 0;

           frmCK3I01A.Image.Picture.LoadFromFile(sFull_FileName + frmCK3I01A.ComboBox.Text);
           frmCK3I01A.ShowModal;
        end
        else
        begin
           GF_MsgBox('Information', '조회권한이 없습니다..');
           mskJumin.SetFocus;
        end;
     end
     else
     begin
        GF_MsgBox('Information', '조회된 자료가 없습니다..!!');
        mskJumin.SetFocus;
     end;
  end
  //[2011.08.22]요기(차트관리(PDF))
  //------------------------------------------------------------------------------
  else if cmbRelation.ItemIndex = 5 then
  begin
     qrySawon.Active := False;
     qrySawon.ParamByName('cod_sawon').AsString := GV_sUserId;
     qrySawon.Active := True;

     if (qrySawon.RecordCount > 0) and (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
     begin
        if qrySawon.FieldByName('desc_licen').AsString = 'Y' then
        begin
           sFull_FileName := '\\222.222.1.6\MDMS_Chart_image\' + copy(cmbCOD_JISA.Text,1,2) + '\' + copy(mskDAT_GMGN.Text,1,4) + '\' + mskDAT_GMGN.Text + '\' + mskNUM_JUMIN.Text + '.pdf';

           if not FileExists(sFull_FileName) then
           begin
              MessageDlg('PDF파일이 존재하지 않습니다.. '+ #10#13 + '('+sFull_FileName+')', mtError, [mbOK], 0);
              exit;
           end
           else
           begin
              AppHandle := ShellExecute(Handle,'open',PChar(sFull_FileName),'','',SW_SHOWNORMAL);
           end;
        end
        else
        begin
           GF_MsgBox('Information', '조회권한이 없습니다..');
           mskJumin.SetFocus;
        end;
     end
  end
    //----------------------------------------------------------------------------  장비 삭제
  else if cmbRelation.ItemIndex = 6 then
  begin
     if (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
     begin
          if Copy(cmbGmgn.Text, 1, 4) + Copy(cmbGmgn.Text, 6, 2) + Copy(cmbGmgn.Text, 9, 2) = GV_sToday then
          begin
               frmCK3I026  := TFrmCK3I026.Create(self);
               frmCK3I026.ShowModal
          end
          else GF_MsgBox('Information', '당일 검진만 조회 가능합니다. ');
     end
     else
     begin
        GF_MsgBox('Information', '자료를 조회한 후에 작업하여 주십시요..');
        mskJumin.SetFocus;
     end;
  end
//----------------------------------------------------------------------------  08-실시간DSMS 재조회
  else if cmbRelation.ItemIndex = 7 then
  begin
     if (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
     begin
        // Confirm message
        if not GF_MsgBox('Confirmation', '실시간DSMS를 재조회하시겠습니까?') then exit;

        with qryD_Send_Gumgin do
        begin
           ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
           ParamByName('DAT_GMGN').AsString  := mskDAT_GMGN.Text;
           ParamByName('NUM_ID').AsString    := UV_sNum_id;
           ExecSql;
           GP_query_log(qryD_Send_Gumgin, 'CK3I01', 'D', 'Y');
        end;

        with qryD_Nhic do
        begin
           ParamByName('COD_JISA').AsString  := Copy(cmbCOD_JISA.Text, 1, 2);
           ParamByName('NUM_ID').AsString    := UV_sNum_id;
           ParamByName('Year_saup').AsString := Copy(mskDAT_GMGN.Text, 1, 4);
           ExecSql;
           GP_query_log(qryD_Nhic, 'CK3I01', 'D', 'Y');
        end;

        if mskDAT_GMGN.Text >= '20120901' then
        begin
           with qryI_Send_Gumgin do
           begin
              ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
              ParamByName('NUM_ID').AsString      := UV_sNum_id;
              ParamByName('NUM_JUMIN').AsString   := mskNUM_JUMIN.Text;
              ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
              ParamByName('DESC_NAME').AsString   := edtDESC_NAME.Text;
              ParamByName('COD_INSERT').AsString  := GV_sUserId;
               Execsql;
              GP_query_log(qryI_Send_Gumgin, 'CK3I01', 'I', 'Y');
           end;
        end;

        if valSUGA_JOHAP.Value <> 0 then
        begin
           valSUGA_JOHAP.Value := 0;
           valSUGA_TOT.Value   := valSUGA_DANCHE.Value + valSUGA_GIBD.Value;
        end;

        UV_bEdit := True;
        
        if cmbGUBN_NSCG.ItemIndex = 0 then
        begin
           cmbGUBN_NSCG.ItemIndex := 1;
           UF_Save;
        end
        else if cmbGUBN_ADCG.ItemIndex = 0 then
        begin
           cmbGUBN_ADCG.ItemIndex := 1;
           UF_Save;
        end
        else if cmbGUBN_LFCG.ItemIndex = 0 then
        begin
           cmbGUBN_LFCG.ItemIndex := 1;
           UF_Save;
        end;
     end
     else
     begin
        GF_MsgBox('Information', '자료를 조회한 후에 작업하여 주십시요..');
        mskJumin.SetFocus;
     end;
  end
  else if cmbRelation.ItemIndex = 8 then
     begin
        qrySawon.Active := False;
        qrySawon.ParamByName('cod_sawon').AsString := GV_sUserId;
        qrySawon.Active := True;

        if (qrySawon.RecordCount > 0) and (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
        begin
           if qrySawon.FieldByName('desc_licen').AsString = 'Y' then
           begin
              sFull_FileName := '\\222.222.1.6\Munjin_Chart_image\' + copy(cmbCOD_JISA.Text,1,2) + '\' + copy(mskDAT_GMGN.Text,1,4) + '\' + mskDAT_GMGN.Text + '\' + mskNUM_JUMIN.Text + '.pdf';

              if not FileExists(sFull_FileName) then
              begin
                 MessageDlg('PDF파일이 존재하지 않습니다.. '+ #10#13 + '('+sFull_FileName+')', mtError, [mbOK], 0);
                 exit;
              end
              else
              begin
                 AppHandle := ShellExecute(Handle,'open',PChar(sFull_FileName),'','',SW_SHOWNORMAL);
              end;
           end
           else
           begin
              GF_MsgBox('Information', '조회권한이 없습니다..');
              mskJumin.SetFocus;
           end;
        end
     end
end;

procedure TfrmCK3I01.SBtn_PreRegisterClick(Sender: TObject);
var iCod_vchuga, i, Rows : Integer;
    sSelect,sWhere, sOrder, sName, sHangmok : String;
    vCod_vchuga : Variant;
    eSuga : Extended;
begin
   inherited;
   UV_sGubn_nosin := ''; UV_sGubn_Cancer := ''; UV_sGubn_agab := ''; UV_sGubn_agab2 := '';
   UV_sGubn_Cancer2 := ''; UV_sGubn_PySeq := ''; UV_sGubn_PyYh := ''; UV_sDesc_email := '';
   Gubn_Label.Caption := ''; UV_sSel_hm := '';  UV_sAdd_hm := '';   UV_sNum_seq := ''; UV_sGubn_reser := '';   UV_sYear := ''; UV_sYsno_munjin := '';
   edtDESC_DEPT.SetFocus;

   frmCK3IA2 := TfrmCK3IA2.Create(self);
   frmCK3IA2.UV_Date := mskDAT_GMGN.Text;
   if frmCK3IA2.ShowModal = mrOk then
   begin
      UV_sPRStatus := 'Y';
      if UV_iStatus = GC_Insert then
      begin
         if UV_sGubn_nosin = 'K' then
            Gubn_Label.Caption := '노신,'
         else if UV_sGubn_nosin = 'J' then
            Gubn_Label.Caption := '성인병,'
         else if UV_sGubn_nosin = 'G' then
            Gubn_Label.Caption := '공교,';

         Gubn_Label.Caption := Gubn_Label.Caption + '암[' + UV_sGubn_cancer2 + '],';

         if UV_sGubn_agab = 'Y' then
            Gubn_Label.Caption := Gubn_Label.Caption + '2차간염대상,';

         if UV_sGubn_agab2 = '1' then
            Gubn_Label.Caption := Gubn_Label.Caption + '간암검사대상';

         with qryGumgin do
         begin
            // Filter 제거
            Filtered := False;

            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            ParamByName('dat_gmgn').AsString :=  mskDAT_GMGN.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               GF_MsgBox('Information', '중복자료입니다. 확인하세요..!');
               mskJumin.Text := mskNUM_JUMIN.Text;
               UP_SetMode('QUERY');
               UP_Exit(mskJumin);
               cmbGmgn.SetFocus;
               Exit;
            end;
            Active := False;
         end;

         //2007.12.28 대사증후군
         with qryGmgn do
         begin
            // Filter 제거
            Filtered := False;

            Panel_yeonse.Visible := False;

            Active := False;
            SQL.Clear;

            sSelect := 'SELECT cod_jisa, num_id, dat_gmgn, desc_name, cod_chuga FROM gumgin ';

            sWhere := ' WHERE num_jumin = ''' + mskNUM_JUMIN.Text + '''';
            sOrder := ' ORDER BY dat_gmgn';

            SQL.Clear;
            SQL.Add(sSelect + sWhere + sOrder);
            Active := True;

            if RecordCount > 0 then
            begin
               while not Eof do
               begin
{
                  if (pos('DI03', FieldByName('cod_chuga').AsString) > 0) then
                  begin
                     Panel_yeonse.Visible := True;
                     Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                     Label9.Caption := '대사재검진';
                  end
                  else if (pos('DI01', FieldByName('cod_chuga').AsString) > 0) or
                          (pos('DI02', FieldByName('cod_chuga').AsString) > 0) then
                  begin
                     Panel_yeonse.Visible := True;
                     Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                     Label9.Caption := '대사연구동의';
                  end;
}
                  if (pos('DI05', FieldByName('cod_chuga').AsString) > 0) then
                  begin
                     Panel_yeonse.Visible := True;
                     Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                     Label9.Caption := '2015금연연구';
                  end;
                  if (pos('DI04', FieldByName('cod_chuga').AsString) > 0) then
                  begin
                     Panel_yeonse.Visible := True;
                     Panel_yeonse.Caption := GF_DateFormat(FieldByName('dat_gmgn').AsString);
                     Label9.Caption := '2015환경연구';
                  end;
                  Next;
               end;
            end;
            // Table과 Disconnect
            Active := False;
         end;

         // 인적 Table 확인
         with qryInjouk do
         begin
            // Filter 제거
            Filtered := False;

            Active := False;
            ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
            Active := True;
            if RecordCount > 0 then
            begin
               Pnl_ID.Caption       := '회원번호(' + FieldByName('NUM_ID').AsString + ')';

               UV_sNum_id           := FieldByName('NUM_ID').AsString;
               if edtNUM_TEL.Text = '' then
                  edtNUM_TEL.Text      := FieldByName('NUM_TEL').AsString;
               if mskNUM_POST.Text ='' then
                  mskNUM_POST.Text     := FieldByName('NUM_POST').AsString;
               if edtDESC_ADDR.Text ='' then
                  edtDESC_ADDR.Text    := FieldByName('DESC_ADDR').AsString;
               if   mskDAT_IPSA.text = '' then
                    mskDAT_IPSA.Text     := FieldByName('DAT_IPSA').AsString;
               if Trim(edtNUM_SABUN.Text) = '' then
                  edtNUM_SABUN.Text    := FieldByName('NUM_SABUN').AsString;
//               MEdt_No.Text    := FieldByName('DESC_HOJU').AsString;

               {YDG[20060103]-메일추가}
               if FieldByName('GUBN_SUSIN').AsString = 'Y' then
                  CK_susin.Checked := True
               else
                  CK_susin.Checked := False;

          //     if  FieldByName('ysno_useinfo').AsString = 'Y' then
          //        Chk_ysno_useinfo.Checked:=True
          //     else
          //        Chk_ysno_useinfo.Checked:=False;
               if FieldByName('ysno_Homepage').AsString <> '' then
                  begin
                  if FieldByName('ysno_Homepage').AsString ='Y' then
                     Chk_ysno_Homepage.Checked  := True
                  else
                     Chk_ysno_Homepage.Checked  := False;
               end;
{2015.04.03 김창규
               if FieldByName('ysno_Company').AsString <> '' then
               begin
                  if FieldByName('ysno_Company').AsString ='Y' then
                     Chk_ysno_Company.Checked  := True
                  else
                     Chk_ysno_Company.Checked  := False;
               end;
}

               if FieldByName('Ysno_Sod_Citrate').AsString <> '' then
               begin
                    if FieldByName('Ysno_Sod_Citrate').AsString ='Y' then
                    CK_Sod_Citrate.Checked  := True
                    else  CK_Sod_Citrate.Checked  := False;
               end;


               if Trim(Edt_email.Text) = '' then
                  Edt_email.Text := FieldByName('DESC_EMAIL').AsString;

               UV_injStatus := 'Y';
            end
            else
            begin
               UV_sNum_id           := '';
               Pnl_ID.Caption       := '';
               //edtNUM_TEL.Text      := '';  // 선등록 전화번호 끌고오도록..
               mskNUM_POST.Text     := '';
               edtDESC_ADDR.Text    := '';
               //mskDAT_IPSA.Text     := '';//선등록 입사일
               MEdt_No.Text         := '';

               CK_susin.Checked := False;

               UV_injStatus := 'N';
            end;
            Active := False;
         end;

         // 단제검사 품의서 확인
         if Trim(edtCOD_DC.Text) <> '' then
         begin
            UP_PumyiDisplay;
         end;

         //추가항목 display
         if UV_sAdd_hm <> '' then
         begin
              iCod_vchuga := GF_MulToSingle(UV_sAdd_hm, 4, vCod_vchuga);
              Rows := grdCOD_CHUGA.Rows;

              //UP_ChugaVarMemSet(iCod_chugas);
              for i := 0 to iCod_vchuga - 1 do
              begin
                   UP_ChugaVarMemSet(Rows);
                   UV_vCod_chuga_d[Rows] := vCod_vchuga[i];
                   if GF_HangmokEdit(vCod_vchuga[i], mskDAT_GMGN.Text, sName, eSuga) then
                   begin
                        UV_vDesc_chuga[Rows] := sName;

                        qry_pumyi_suga.Active := False;
                        qry_pumyi_suga.ParamByName('cod_dc').AsString  := edtCOD_DC.Text;
                        qry_pumyi_suga.ParamByName('num_seq').AsString := UV_sGubn_PySeq;
                        qry_pumyi_suga.ParamByName('cod_hm').AsString  := vCod_vchuga[i];
                        qry_pumyi_suga.Active := True;
                        if qry_pumyi_suga.RecordCount > 0 then
                           UV_vSuga_kmi[Rows] := qry_pumyi_suga.FieldByName('cod_suga').AsInteger
                        else
                        begin
                            qryChk_suga.Active := False;
                            qryChk_suga.ParamByName('cod_dc').AsString   := edtCOD_DC.Text;
                            qryChk_suga.ParamByName('num_seq').Asinteger := iSeq;
                            qryChk_suga.Active := True;
                            if (valSUGA_DANCHE.Value > 0)
                               or ((valSUGA_DANCHE.Value = 0) and (qryChk_suga.FieldByName('chk_suga').AsString = 'Y')) then
                            begin
                                  qryHangmokSuga.Close;
                                  qryHangmokSuga.ParamByName('cod_hm').AsString    := vCod_vchuga[i];
                                  qryHangmokSuga.ParamByName('dat_apply').AsString := mskDAT_GMGN.Text;
                                  qryHangmokSuga.Open;
                                  if (qryHangmokSuga.RecordCount > 0) and (qryHangmokSuga.FieldByName('suga_danche').AsInteger > 0) then
                                     UV_vSuga_kmi[Rows] := qryHangmokSuga.FieldByName('suga_danche').AsInteger
                                  else UV_vSuga_kmi[Rows] := eSuga;
                            end
                            else UV_vSuga_kmi[Rows] := eSuga;
                        end;
                        valSUGA_GIBD.value := valSUGA_GIBD.value + UV_vSuga_kmi[Rows];
                   end
                   else
                   begin
                        UV_vDesc_chuga[Rows] := '';
                        UV_vSuga_kmi[Rows] := 0;
                   end;
                   UV_vGubn_free[Rows]  := '0';
                   Rows := Rows + 1;
              end;
              grdCOD_CHUGA.Rows := Rows;
         end;

         {if copy(cmbcod_jisa.text,1,2) = '15' then
            edtNUM_TEL.SetFocus
         else
            cmbGUBN_NEAWON.SetFocus;}

         if mskNUM_JUMIN.Enabled = False then mskNUM_JUMIN.Enabled := True;

         mskNUM_JUMIN.SetFocus;
      end;
   end
   else
      mskDAT_GMGN.SetFocus;

   //혈액소견중 혈액구분이 02-바이러스성 간염검사 인것중에 판정이 'C'판정이상으로 안좋은 판정이 있는경우 간암대상자여부확인요망.
   with qry_hul_sokun do
   begin
      // Filter 제거
      Filtered := False;

      Active := False;
      ParamByName('num_jumin').AsString := mskNUM_JUMIN.Text;
      ParamByName('dat_gmgn').AsString  := mskDAT_GMGN.Text;
      Active := True;

      if RecordCount > 0 then
      begin
         showmessage('간암대상자여부확인요망');
      end;
   end;      
end;

procedure TfrmCK3I01.Action1Execute(Sender: TObject);
begin
  inherited;
  // 선등록 작업 클릭...
  if UV_iStatus = GC_Insert then SBtn_PreRegister.Click;
end;

procedure TfrmCK3I01.Timer1Timer(Sender: TObject);
begin
   inherited;
   if UI_Timechk = 12 then
   begin
      UI_Timechk := 10;
      mskJumin.Color := $00F4D8F5;
   end
   else if (UI_Timechk >= 10) and (UI_Timechk <= 12) then
      mskJumin.Color := $00E6FFFE
   else if UI_Timechk = 102 then
   begin
      UI_Timechk := 100;
      mskNUM_JUMIN.Color := $00F4D8F5;
   end
   else if (UI_Timechk >= 100) and (UI_Timechk <= 102) then
      mskNUM_JUMIN.Color := $00E6FFFE;

   UI_Timechk := UI_Timechk + 1;
   Application.ProcessMessages;
end;

procedure TfrmCK3I01.Btn_ComplainClick(Sender: TObject);
begin
   inherited;
   frmCK3I015 := TfrmCK3I015.Create(self);
   frmCK3I015.MEdt_jumin.Text    := mskNUM_JUMIN.Text;
   frmCK3I015.Edt_desc_name.Text := edtDESC_NAME.Text;
   frmCK3I015.Date.Text          := mskDAT_GMGN.Text;
   frmCK3I015.edtCOD_DC.Text     := edtCOD_DC.Text;
   frmCK3I015.edtDESC_DC.Text    := edtDESC_DC.Text;
   frmCK3I015.ShowModal;
end;

procedure TfrmCK3I01.Action2Execute(Sender: TObject);
begin
  inherited;
  // Complain 작업 클릭...
  if Btn_Complain.Enabled = True then Btn_Complain.Click;
end;

procedure TfrmCK3I01.cmbGmgnKeyPress(Sender: TObject; var Key: Char);
begin
  inherited;
   If Key = #13 Then
   Begin
      if Sender = cmbGmgn then
         edtDESC_NAME.SetFocus;
   End;
end;
{// 구 PACS 연계 작업 정지 2015.07.09
procedure TfrmCK3I01.UP_PACSInsert(sHangmok, sID, sHM_name, sGubn, sCount : String);
var sEng, sYear, sMonth, sDay, sHour : String;
begin
   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 3, 2), sEng);
   sYear  := sEng;

   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 5, 2), sEng);
   sMonth  := sEng;

   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 7, 2), sEng);
   sDay  := sEng;

   sEng := '';
   UF_Num_Hour(FormatDateTime('hh', Time), sEng);
   sHour := sEng;

   with qryI_Pacs do
   begin
      Active := False;
      ParamByName('PATID').AsString        :=  mskNUM_JUMIN.Text;
      ParamByName('PATIENT_UID').AsString  :=  UV_sNum_id;
//      ParamByName('APPLYNO').AsString     :=  copy(cmbCOD_JISA.Text,1,2) + mskNUM_JUMIN.Text + Copy(mskDAT_GMGN.Text,1,6) +
//                                              FormatDateTime('hhnnss', Time) + sCount;
//      ParamByName('APPLYNO').AsString     :=  Copy(mskDAT_GMGN.Text,3,6) + FormatDateTime('hhnnss', Time) + sCount;
      //2011.06.23 철
      ParamByName('APPLYNO').AsString     :=  Copy(mskDAT_GMGN.Text,3,6) + sHour + Copy(FormatDateTime('nnss', Time),1,3) + Copy(GV_sUserId,5,2) + sCount;
//    20100728, 년월일을 영문자로 변환.
//      ParamByName('APPLYNO').AsString :=  sYear + sMonth + sDay + FormatDateTime('hhnnss', Time) + Copy(GV_sUserId,4,3) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0');

      ParamByName('NAME').AsString        :=  trim(edtDESC_NAME.Text);
      if ((Copy(mskNUM_JUMIN.Text,7,1) = '1') or (Copy(mskNUM_JUMIN.Text,7,1) = '3') or
          (Copy(mskNUM_JUMIN.Text,7,1) = '5') or (Copy(mskNUM_JUMIN.Text,7,1) = '7')) then
         ParamByName('SEX').AsString      :=  'M'
      else
         ParamByName('SEX').AsString      :=  'F';

      if (Copy(mskNUM_JUMIN.Text,7,1) = '3') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') then
         ParamByName('AGE').AsInteger     := StrToInt(Copy(mskDAT_GMGN.Text, 1, 4)) - StrToint('20' + Copy(mskNUM_JUMIN.Text, 1, 2))
      else
         ParamByName('AGE').AsInteger     := StrToint(Copy(mskDAT_GMGN.Text, 1, 4)) - StrToInt('19' + Copy(mskNUM_JUMIN.Text, 1, 2));

      ParamByName('ENAME').AsString       :=  '';
      if (Copy(mskNUM_JUMIN.Text,7,1) = '3') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') then
         ParamByName('BIRTH_DATE').AsString := '20' + Copy(mskNUM_JUMIN.Text,1,6)
      else
         ParamByName('BIRTH_DATE').AsString := '19' + Copy(mskNUM_JUMIN.Text,1,6);
      ParamByName('SEEK_DATE').AsString   :=  mskDAT_GMGN.Text;
      ParamByName('SEEK_TIME').AsString   :=  FormatDateTime('hhnnss', Time);   //2007.05.25 철.
      if (Copy(cmbCOD_JISA.Text,1,2) = '15') and
         (Copy(edtCOD_JANGBI.Text,1,2) = 'SS') then
         ParamByName('IPDOPD').AsString   :=  'S'
      //2014.03.14 중국동포검사인경우 PACS뷰어리스트에서 인식할수 있는 'C' 값 전송.
      else if (Copy(cmbCOD_JISA.Text,1,2) = '15') and
         ((edtCOD_DC.Text = '156940') or (edtCOD_DC.Text = '156944')) then
         ParamByName('IPDOPD').AsString   :=  'C'
      else
         ParamByName('IPDOPD').AsString   :=  'O';
      ParamByName('DEPTCODE').AsString    :=  sGubn;
      ParamByName('DRNAME').AsString      :=  '';
      ParamByName('MODALITY').AsString    :=  sHangmok;
      ParamByName('EXAMNAME').AsString    :=  sHM_name;
      ParamByName('DRXNAME').AsString     :=  '';
      ParamByName('READ_DATE').AsString   :=  '';
      ParamByName('RESULT').AsString      :=  '';
      ParamByName('S_FLAG').AsString      :=  '';
      ParamByName('R_FLAG').AsString      :=  '';
      ParamByName('ISCANCEL').AsString    :=  'N';
      Execsql;
   end;
end;
}
//--2015 PACS 연계작업 김창규 2015.07.10 시작
procedure TfrmCK3I01.UP_PACSInsert(sCode, sHangmok, sID,        sHM_name, sGubn,       sCount : String);
var sEng, sYear, sMonth, sDay, sHour, sFloor, sTime : String;
     Hour, Min, Sec, MSec: Word;
begin
   //층구분
   sFloor := Trim(Copy(Com_BD.Text,1,Pos('-',Com_BD.Text)-1));
   If Length(sFloor) = 1 Then sFloor := '0' + sFloor;
   //밀리세컨드 작업
   DecodeTime(Time, Hour, Min, Sec, MSec);
   sTime := Format('%d%d%d%d',[Hour,Min,Sec, MSec]);

   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 3, 2), sEng);
   sYear  := sEng;

   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 5, 2), sEng);
   sMonth  := sEng;

   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 7, 2), sEng);
   sDay  := sEng;

   sEng := '';
   UF_Num_Hour(FormatDateTime('hh', Time), sEng);
   sHour := sEng;

   with qryI_Pacs_2015 do
   begin
      Active := False;
      ParamByName('PATID').AsString        :=  mskNUM_JUMIN.Text;
      //회원번호(1234567890)  2016.05.23 김창규
      If Trim(UV_sNum_Id) = '' Then
         UV_sNum_Id := Copy(Pnl_Id.Caption,10,10);
         
      ParamByName('PATIENT_UID').AsString  :=  UV_sNum_id;
//      ParamByName('APPLYNO').AsString     :=  copy(cmbCOD_JISA.Text,1,2) + mskNUM_JUMIN.Text + Copy(mskDAT_GMGN.Text,1,6) +
//                                              FormatDateTime('hhnnss', Time) + sCount;
//      ParamByName('APPLYNO').AsString     :=  Copy(mskDAT_GMGN.Text,3,6) + FormatDateTime('hhnnss', Time) + sCount;
      ParamByName('APPLYNO').AsString     :=  Copy(mskDAT_GMGN.Text,3,6) + sHour + Copy(FormatDateTime('nnss', Time),1,3) + Copy(GV_sUserId,3,4) + sCount;
//    20100728, 년월일을 영문자로 변환.
//      ParamByName('APPLYNO').AsString :=  sYear + sMonth + sDay + FormatDateTime('hhnnss', Time) + Copy(GV_sUserId,4,3) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0');

      ParamByName('NAME').AsString        :=  trim(edtDESC_NAME.Text);
      if ((Copy(mskNUM_JUMIN.Text,7,1) = '1') or (Copy(mskNUM_JUMIN.Text,7,1) = '3') or
          (Copy(mskNUM_JUMIN.Text,7,1) = '5') or (Copy(mskNUM_JUMIN.Text,7,1) = '7')) then
         ParamByName('SEX').AsString      :=  'M'
      else
         ParamByName('SEX').AsString      :=  'F';

      if (Copy(mskNUM_JUMIN.Text,7,1) = '3') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') then
         ParamByName('AGE').AsInteger     := StrToInt(Copy(mskDAT_GMGN.Text, 1, 4)) - StrToint('20' + Copy(mskNUM_JUMIN.Text, 1, 2))
      else
         ParamByName('AGE').AsInteger     := StrToint(Copy(mskDAT_GMGN.Text, 1, 4)) - StrToInt('19' + Copy(mskNUM_JUMIN.Text, 1, 2));

      ParamByName('ENAME').AsString       :=  '';
      if (Copy(mskNUM_JUMIN.Text,7,1) = '3') or (Copy(mskNUM_JUMIN.Text,7,1) = '4') then
         ParamByName('BIRTH_DATE').AsString := '20' + Copy(mskNUM_JUMIN.Text,1,6)
      else
         ParamByName('BIRTH_DATE').AsString := '19' + Copy(mskNUM_JUMIN.Text,1,6);
      ParamByName('EXAMCODE').AsString    :=  sCode;
      ParamByName('SEEK_DATE').AsString   :=  mskDAT_GMGN.Text;
      ParamByName('SEEK_TIME').AsString   :=  FormatDateTime('hhnnss', Time);   //2007.05.25 철.
      if (Copy(cmbCOD_JISA.Text,1,2) = '15') and
         (Copy(edtCOD_JANGBI.Text,1,2) = 'SS') then
         ParamByName('IPDOPD').AsString   :=  'S'
      //2014.03.14 중국동포검사인경우 PACS뷰어리스트에서 인식할수 있는 'C' 값 전송.
      else if (Copy(cmbCOD_JISA.Text,1,2) = '15') and
         ((edtCOD_DC.Text = '156940') or (edtCOD_DC.Text = '156944')) then
         ParamByName('IPDOPD').AsString   :=  'C'
      //2015.10.12 이지스여성의원
      else if (Copy(cmbCOD_JISA.Text,1,2) = '15') and
         (edtCOD_DC.Text = 'H00013') then
         ParamByName('IPDOPD').AsString   :=  'E'
      else
         ParamByName('IPDOPD').AsString   :=  'O';
      ParamByName('DEPTCODE').AsString    :=  sGubn;
      ParamByName('DRNAME').AsString      :=  '';
      ParamByName('MODALITY').AsString    :=  sHangmok;
      ParamByName('EXAMNAME').AsString    :=  sHM_name;
      ParamByName('DRXNAME').AsString     :=  '';
      ParamByName('READ_DATE').AsString   :=  '';
      ParamByName('RESULT').AsString      :=  '';
      ParamByName('S_FLAG').AsString      :=  '';
      ParamByName('R_FLAG').AsString      :=  '';
      ParamByName('ISCANCEL').AsString    :=  'N';
      Execsql;
   end;
end;


procedure TfrmCK3I01.BUSAN_PACSInsert(sHangmok, sID, sHM_name, sGubn, sCount : String);
var sEng, sMonth, sDay, sHour, sCount_Jangbi : String;
begin
   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 5, 2), sEng);
   sMonth := sEng;

   sEng := '';
   UF_Num_Eng(Copy(mskDAT_GMGN.text, 7, 2), sEng);
   sDay  := sEng;

   sEng := '';
   UF_Num_Hour(FormatDateTime('hh', Time), sEng);
   sHour := sEng;

   sEng := '';
   UF_Num_Eng(IntToStr(UV_Max_no + StrToInt(sCount)), sEng);
   sCount_Jangbi := sEng;

   with qryI_BUSAN_Order do
   begin
      Close;
      Sql.Clear;
      SQL.BeginUpdate;
      Sql.Add(' INSERT INTO KMIOrder ');
      Sql.Add('   (QUEUEID, FLAG, WORKTIME, PATID, EVENTTYPE, HISORDERID, ACCESSIONNO, EXAMDATE, EXAMTIME, EXAMCODE, EXAMNAME, PATNAME, PATSEX, PATTYPE )     ');
      Sql.Add(' VALUES (:QUEUEID, :FLAG, SYSDATE, :PATID, :EVENTTYPE, :HISORDERID, :ACCESSIONNO, :EXAMDATE, :EXAMTIME, :EXAMCODE, :EXAMNAME, :PATNAME, :PATSEX, :PATTYPE) ');
      Sql.EndUpdate;

      Active := False;
      ParamByName('QUEUEID').AsString     :=  mskDAT_GMGN.Text + FormatDateTime('hhnnss', Time) + sCount;
//      ParamByName('QUEUEID').AsString     :=  mskDAT_GMGN.Text + UV_Time + sCount;
      ParamByName('FLAG').AsString        :=  'N';
      ParamByName('PATID').AsString       :=  mskNUM_JUMIN.Text;
      ParamByName('EVENTTYPE').AsString   :=  'NW';
//      ParamByName('HISORDERID').AsString  :=  IntToStr(UV_Max_no + StrToInt(sCount));
//      ParamByName('ACCESSIONNO').AsString :=  IntToStr(UV_Max_no + StrToInt(sCount));
      //ParamByName('HISORDERID').AsString  :=  mskDAT_GMGN.Text + FormatDateTime('hhnnss', Time) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),4,'0');
      ParamByName('HISORDERID').AsString  :=  mskDAT_GMGN.Text +sHour +  Copy(FormatDateTime('nnss', Time),1,3) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0') + Copy(GV_sUserId,5,2) ;
//    ParamByName('ACCESSIONNO').AsString :=  Copy(mskDAT_GMGN.Text,3,6) + FormatDateTime('hhnnss', Time) + GV_sUserId + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0');
//    14자리
//      ParamByName('ACCESSIONNO').AsString :=  Copy(mskDAT_GMGN.Text,3,6) + FormatDateTime('hhnnss', Time) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0');
//    20101215, 8자리
      ParamByName('ACCESSIONNO').AsString :=  sHour +  Copy(FormatDateTime('nnss', Time),1,3) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0') + Copy(GV_sUserId,5,2) ;
//      ParamByName('ACCESSIONNO').AsString :=  sMonth + sDay + sHour + FormatDateTime('nnss', Time) + sCount_Jangbi;
//      ParamByName('ACCESSIONNO').AsString :=  sDay + sHour + FormatDateTime('nnss', Time) + GF_LPad(IntToStr(UV_Max_no + StrToInt(sCount)),2,'0');

      ParamByName('EXAMDATE').AsString    :=  mskDAT_GMGN.Text;
      ParamByName('EXAMTIME').AsString    :=  FormatDateTime('hhnnss', Time);
      ParamByName('EXAMCODE').AsString    :=  sHangmok;
      ParamByName('EXAMNAME').AsString    :=  sHM_name;
      ParamByName('PATNAME').AsString     :=  trim(edtDESC_NAME.Text);
      if ((Copy(mskNUM_JUMIN.Text,7,1) = '1') or (Copy(mskNUM_JUMIN.Text,7,1) = '3') or
          (Copy(mskNUM_JUMIN.Text,7,1) = '5') or (Copy(mskNUM_JUMIN.Text,7,1) = '7')) then
         ParamByName('PATSEX').AsString   :=  'M'
      else
         ParamByName('PATSEX').AsString   :=  'F';
      ParamByName('PATTYPE').AsString     :=  'O';
      Prepare;
      ExecSQL;
   end;
end;

function  TfrmCK3I01.UF_No_Hangmok1(sDate, sGubun : String; iYh : Integer): String;
begin
   Result := '';
   with qryNo_hangmok do
   begin
      Active := False;
      ParamByName('dat_apply').AsString   := sDate;
      ParamByName('gubn_code').AsString   := sGubun;
      ParamByName('gubn_yh').AsInteger    := iYh;
      Active := True;
      if RecordCount > 0 then
      begin
         Result := FieldByName('desc_hul').AsString;
         Result := Result + FieldByName('desc_jangbi').AsString;
      end;
      Active := False;
   end;
end;

procedure TfrmCK3I01.Action3Execute(Sender: TObject);
begin
   inherited;
   if (length(mskNUM_JUMIN.Text) = 13) and (length(mskDAT_GMGN.Text) = 8) then
   begin
      frmCK3I017  := TFrmCK3I017.Create(self);
      frmCK3I017.Edt_Id.Text := UV_sNum_id;
      if frmCK3I017.ShowModal = mrOk then GF_MsgBox('Information', 'PACS전송이 완료되었습니다.')
      else                                GF_MsgBox('Information', 'PACS전송이 취소되었습니다.');
   end
   else
   begin
      GF_MsgBox('Information', '자료를 조회한 후에 작업하여 주십시요..');
      mskJumin.SetFocus;
   end;
end;

procedure TfrmCK3I01.BitBtn1Click(Sender: TObject);
Var
   I, J, K : Integer;                             // 라벨만 출력시.
begin
   inherited;
   UV_DI05 := '';
   //연대 DI05 항목Check 2015.04.06, 연대 DI04 항목Check 2015.05.26
   K := 0;
   For I := 1 To grdCod_Chuga.Rows Do
      Begin
         If (grdCod_Chuga.Cell[1,I] = 'DI04') Or
            (grdCod_Chuga.Cell[1,I] = 'DI05') Then
            Begin
               K := 999;
               UV_DI05 := grdCod_Chuga.Cell[1,I];
            End;
      End;

   // 라벨 출력...
   // 13.09.23 부산센터의 경우 라벨지에 회원번호 추가
   if ((Copy(cmbCOD_JISA.Text,1,2) = '12') or ((Copy(cmbCOD_JISA.Text,1,2) = '61') and (Copy(cmbGUBN_NEAWON.Text, 1, 1) <> '2'))) and
      (Pnl_ID.Caption = '') then
      showmessage('신규고객의 경우 먼저 저장을 하시어' + #13#13 + '회원번호를 부여받으시기 바랍니다.')
   else
   begin
      if pos('TTP-24',Comb_printer.Text) > 0 then
      begin
         if CK_Label.ItemIndex = 0 then
         begin
            frmCK3P21 := TfrmCK3P21.Create(Self);
            frmCK3P21.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
            if Chk_BarcodeRreview.Checked then frmCK3P21.QuickRep.Preview
            else                               frmCK3P21.QuickRep.Print;
     //    frmCK3P17.QuickRep.Preview;
            If K = 999 Then //연대 라벨지 출력
               Begin
                  frmCK3P22 := TfrmCK3P22.Create(Self);
                  frmCK3P22.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
                  if Chk_BarcodeRreview.Checked then frmCK3P22.QuickRep.Preview
                  else                               frmCK3P22.QuickRep.Print;

    //            frmCK3P22.QuickRep.Print;
    //            frmCK3P18.QuickRep.Preview;
               End;
         end
         Else if CK_Label.ItemIndex = 1 then
         begin
            frmCK3P17 := TfrmCK3P17.Create(Self);
            frmCK3P17.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
            if Chk_BarcodeRreview.Checked then frmCK3P17.QuickRep.Preview
            else                               frmCK3P17.QuickRep.Print;

           // frmCK3P17.QuickRep.Print;
          //  frmCK3P17.QuickRep.Preview;
            If K = 999 Then //연대 라벨지 출력
               Begin
                  frmCK3P18 := TfrmCK3P18.Create(Self);
                  frmCK3P18.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
                  if Chk_BarcodeRreview.Checked then frmCK3P18.QuickRep.Preview
                  else                               frmCK3P18.QuickRep.Print;

    //              frmCK3P18.QuickRep.Print;
    //            frmCK3P18.QuickRep.Preview;
               End;
         end
         else if CK_Label.ItemIndex = 2 then
         begin
            frmCK3P11 := TfrmCK3P11.Create(Self);
            frmCK3P11.QuickRep.PrinterSettings.PrinterIndex := Comb_printer.ItemIndex;
            if Chk_BarcodeRreview.Checked then frmCK3P11.QuickRep.Preview
            else                               frmCK3P11.QuickRep.Print;

           // frmCK3P11.QuickRep.Print;
         end;
      end;
   end;
end;

procedure TfrmCK3I01.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  inherited;
  //if CPMS.Connected = True then CPMS.Connected := False;
end;

function  TfrmCK3I01.UF_Num_Eng(sNum : String; var sEng : String ): Boolean;
begin
   inherited;
   if (sNum = '1') or (sNum = '01') then
      sEng := '1'
   else if (sNum = '2') or (sNum = '02') then
      sEng := '2'
   else if (sNum = '3') or (sNum = '03') then
      sEng := '3'
   else if (sNum = '4') or (sNum = '04') then
      sEng := '4'
   else if (sNum = '5') or (sNum = '05') then
      sEng := '5'
   else if (sNum = '6') or (sNum = '06') then
      sEng := '6'
   else if (sNum = '7') or (sNum = '07') then
      sEng := '7'
   else if (sNum = '8') or (sNum = '08') then
      sEng := '8'
   else if (sNum = '9') or (sNum = '09') then
      sEng := '9'
   else if sNum = '10' then
      sEng := 'A'
   else if sNum = '11' then
      sEng := 'B'
   else if sNum = '12' then
      sEng := 'C'
   else if sNum = '13' then
      sEng := 'D'
   else if sNum = '14' then
      sEng := 'E'
   else if sNum = '15' then
      sEng := 'F'
   else if sNum = '16' then
      sEng := 'G'
   else if sNum = '17' then
      sEng := 'H'
   else if sNum = '18' then
      sEng := 'I'
   else if sNum = '19' then
      sEng := 'J'
   else if sNum = '20' then
      sEng := 'K'
   else if sNum = '21' then
      sEng := 'L'
   else if sNum = '22' then
      sEng := 'M'
   else if sNum = '23' then
      sEng := 'N'
   else if sNum = '24' then
      sEng := 'O'
   else if sNum = '25' then
      sEng := 'P'
   else if sNum = '26' then
      sEng := 'Q'
   else if sNum = '27' then
      sEng := 'R'
   else if sNum = '28' then
      sEng := 'S'
   else if sNum = '29' then
      sEng := 'T'
   else if sNum = '30' then
      sEng := 'U'
   else if sNum = '31' then
      sEng := 'V';
end;

function  TfrmCK3I01.UF_Num_Hour(sNum : String; var sEng : String ): Boolean;
begin
   inherited;
   if (sNum = '1') or (sNum = '01') then
      sEng := '1'
   else if (sNum = '2') or (sNum = '02') then
      sEng := '2'
   else if (sNum = '3') or (sNum = '03') then
      sEng := '3'
   else if (sNum = '4') or (sNum = '04') then
      sEng := '4'
   else if (sNum = '5') or (sNum = '05') then
      sEng := '5'
   else if (sNum = '6') or (sNum = '06') then
      sEng := '6'
   else if (sNum = '7') or (sNum = '07') then
      sEng := '7'
   else if (sNum = '8') or (sNum = '08') then
      sEng := '8'
   else if (sNum = '9') or (sNum = '09') then
      sEng := '9'
   else if sNum = '10' then
      sEng := '0'
   else if sNum = '11' then
      sEng := '1'
   else if sNum = '12' then
      sEng := '2'
   else if sNum = '13' then
      sEng := '3'
   else if sNum = '14' then
      sEng := '4'
   else if sNum = '15' then
      sEng := '5'
   else if sNum = '16' then
      sEng := '6'
   else if sNum = '17' then
      sEng := '7'
   else if sNum = '18' then
      sEng := '8'
   else if sNum = '19' then
      sEng := '9'
   else if sNum = '20' then
      sEng := '0'
   else if sNum = '21' then
      sEng := '1'
   else if sNum = '22' then
      sEng := '2'
   else if sNum = '23' then
      sEng := '3'
   else if sNum = '24' then
      sEng := '4';
end;

procedure TfrmCK3I01.edtDESC_NAMEKeyPress(Sender: TObject; var Key: Char);
begin
  inherited;
   //10.10.05 승철. 특수문자 사용안되게끔.
   if ( Key in [ #39, '`', '~', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_', '+', '=', '\', '|', '{', '}', '[', ']', ';', ':', '"', '<', '>', ',', '.', '?', '/' ] ) then
   begin
      Key := #0;
      showmessage('특수문자는 사용하실수 없습니다.');
   end;
end;

procedure TfrmCK3I01.UP_GumsaCheck(gubun, sID_1, sJisa_1, sNsGubn_1, sNsCg_1, sDate1, sDate2  : String);
var
   sSelect, sWhere, sOrderBy,
   sTemp, sTemp_NS, sTemp_Tk, sTk_YHGM, sTkCg, sTemp_jeagum, cod_JJIP : String;

begin
   inherited;
   sSelect := ''; sWhere := ''; sOrderBy := ''; sTemp := ''; sTemp_NS := ''; sTemp_Tk  := '';  sTk_YHGM:= '';{검진구분} sTkCg := '';{특검청구구분}
   sTemp_jeagum  := '재검';
   cod_JJIP := '';//jjip
   if gubun = '1' then
   begin
      {노신}
      qryTemp.Active := False;

      if sDate1 >= '20180101' then
      begin
         sSelect := ' select G.cod_chuga, N.*, T.medi_care1, T.medi_care2, T.medi_care3, T.medi_care4 from Ns_sokun2018 N  ';
         sSelect := sSelect + ' left outer join Tot_Munjin2018 T ';
      end
      else
      begin
         sSelect := ' select G.cod_chuga, N.*, T.medi_care1, T.medi_care2, T.medi_care3, T.medi_care4 from Ns_sokun N  ';
         sSelect := sSelect + ' left outer join Tot_Munjin2010 T ';
      end;
      sSelect := sSelect + ' On N.cod_jisa = T.cod_jisa and N.num_id = T.num_id and N.dat_gmgn = T.dat_gmgn ';
      //JJIP
      sSelect := sSelect + ' left outer join gumgin G ';
      sSelect := sSelect + ' On N.cod_jisa = G.cod_jisa and N.num_id = G.num_id and N.dat_gmgn = G.dat_gmgn ';

      sWhere  := ' where N.cod_jisa = ''' + sJisa_1 + '''';
      sWhere  := sWhere + ' and N.num_id   = ''' + sID_1   + '''';
      sWhere  := sWhere + ' and N.dat_gmgn = ''' + sDate1  + '''';

      qryTemp.SQL.Clear;
      qryTemp.SQL.Add(sSelect + sWhere + sOrderBy);
      qryTemp.Active := True;

      if not(qryTemp.IsEmpty) then
      begin
         if (qryTemp.FieldByName('cod_panjg1').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun1').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun1').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun1').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg2').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun2').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun2').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun2').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg3').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun3').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun3').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun3').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg4').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun4').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun4').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun4').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg5').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun5').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun5').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun5').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg6').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun6').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun6').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun6').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg7').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun7').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun7').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun7').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg8').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun8').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun8').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun8').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg9').AsString  = 'R2') and
            (((qryTemp.FieldByName('cod_sokun9').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun9').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun9').AsString) + ',';
         if (qryTemp.FieldByName('cod_panjg10').AsString = 'R2') and
            (((qryTemp.FieldByName('cod_sokun10').AsString  = 'F002') and (qryTemp.FieldByName('medi_care1').AsString <> 'Y'))
          or ((qryTemp.FieldByName('cod_sokun10').AsString  = 'C001') and (qryTemp.FieldByName('medi_care2').AsString <> 'Y'))) then
            sTemp_NS := sTemp_NS + UF_Sokun_cnvt(qryTemp.FieldByName('cod_sokun10').AsString) + ',';
         if Pos('JJIP', qryTemp.FieldByName('cod_chuga').AsString) > 0 then
            cod_JJIP := 'Y';
      end;

      qryTemp.Active := False;
   end
   else if gubun = '2' then
   begin
      {특검}
      //[20160905-유동구]특검 검진구분 찾기...
      //------------------------------------------------------------------------
      //[20170419-유동구]1차 검진 청구 유형 가져오기...
      sSelect := ' select G.gubn_tkcg, T.* from tkgum T with (Nolock) left outer join gumgin G with (Nolock) ON T.cod_jisa = G.cod_jisa AND T.num_jumin = G.num_jumin AND T.dat_gmgn = G.dat_gmgn AND T.gubn_cha = G.gubn_tkgm ';
      sWhere  := ' where T.cod_jisa = ''' + sJisa_1 + '''';
      sWhere  := sWhere + ' and T.num_jumin = ''' + mskNUM_JUMIN.Text + '''';
      sWhere  := sWhere + ' and T.dat_gmgn = ''' + sDate1 + '''';
      sWhere  := sWhere + ' and T.gubn_cha = ''1''';
{
      sSelect := ' select * from tkgum with (Nolock) ';
      sWhere  := ' where cod_jisa = ''' + sJisa_1 + '''';
      sWhere  := sWhere + ' and num_jumin = ''' + mskNUM_JUMIN.Text + '''';
      sWhere  := sWhere + ' and dat_gmgn = ''' + sDate1 + '''';
      sWhere  := sWhere + ' and gubn_cha = ''1''';
}
      qryTemp.Active := False;
      qryTemp.SQL.Clear;
      qryTemp.SQL.Add(sSelect + sWhere + sOrderBy);
      qryTemp.Active := True;

      if qryTemp.RecordCount > 0 then
      begin
         if      pos('TC77', qryTemp.FieldByName('cod_prf').AsString) > 0 then sTk_YHGM := '특검[TC77-배치전]'  //배치전
         else if pos('TC93', qryTemp.FieldByName('cod_prf').AsString) > 0 then sTk_YHGM := '특검[TC93-배치후]'  //배치후
         else if pos('TC79', qryTemp.FieldByName('cod_prf').AsString) > 0 then sTk_YHGM := '특검[TC79-임시]'    //임시
         else if pos('TC78', qryTemp.FieldByName('cod_prf').AsString) > 0 then sTk_YHGM := '특검[TC78-수시]'    //수시
         else if pos('TCA7', qryTemp.FieldByName('cod_prf').AsString) > 0 then sTk_YHGM := '특검[TCA7-추적]'    //추적
         else if Trim(sTk_YHGM) = ''                                      then sTk_YHGM := '특검';              //특검

         if      qryTemp.FieldByName('gubn_Tkcg').AsString = '1' then begin sTk_YHGM := sTk_YHGM + '(회청)'; sTkCg := '1'; end
         else if qryTemp.FieldByName('gubn_Tkcg').AsString = '2' then begin sTk_YHGM := sTk_YHGM + '(공청)'; sTkCg := '2'; end;
      end;
      //========================================================================

      //재검 항목 찾기..
      //------------------------------------------------------------------------
      sSelect := ' select * from tk_sokun2009 ';
      sWhere  := ' where cod_jisa = ''' + sJisa_1 + '''';
      sWhere  := sWhere + ' and num_jumin = ''' + mskNUM_JUMIN.Text + '''';
      sWhere  := sWhere + ' and dat_gmgn = ''' + sDate1 + '''';
      sWhere  := sWhere + ' and gubn_cha = ''1''';

      qryTemp.Active := False;
      qryTemp.SQL.Clear;
      qryTemp.SQL.Add(sSelect + sWhere + sOrderBy);
      qryTemp.Active := True;

      if qryTemp.RecordCount > 0 then
      begin
         while not qryTemp.Eof do
         begin
            if qryTemp.FieldByName('cod_pan').AsString  = 'R' then sTemp_Tk := sTemp_Tk + UF_Hmatter_cnvt(qryTemp.FieldByName('cod_Hmatter').AsString) + ',';

            qryTemp.Next;
         end;
      end;
      //========================================================================

      qryTemp.Active := False;
   end;

   if gubun = '1' then
      begin
      {일반}
      if (sTemp_NS <> '') and (sNsGubn_1 <> 'L') then
      begin
         if sNsGubn_1 = 'N' then sTemp := '일반검진';
         if sNsGubn_1 = 'A' then sTemp := '성인병검진';
//         if sNsGubn_1 = 'L' then sTemp := '생애전환기검진';

         if  sDate1 >= '20180101' then
         begin
            //JJIP
            if cod_JJIP <> 'Y' then
               sTemp_jeagum  := '확진검사'
            else
               sTemp_jeagum  := '';
         end else
            sTemp_jeagum  := '재검';

         if      sNsCg_1 = '1' then sTemp := sTemp + '[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')|청구(회사)]' + sTemp_jeagum + '(' + copy(sTemp_NS,1,length(sTemp_NS)-1) + ')'
         else if sNsCg_1 = '2' then sTemp := sTemp + '[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')|청구(조합)]' + sTemp_jeagum + '(' + copy(sTemp_NS,1,length(sTemp_NS)-1) + ')'
         else                       sTemp := sTemp + '[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')|청구(' + sNsCg_1 + ')]' + sTemp_jeagum + '(' + copy(sTemp_NS,1,length(sTemp_NS)-1) + ')' ;
      end
      else if (sNsGubn_1 = 'L') and (sDate1 < '20180101') then
      begin
         if sNsGubn_1 = 'L' then sTemp := '생애전환기검진';
         if      sNsCg_1 = '1' then sTemp := sTemp + '[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')|청구(회사)]' + '재검(' + copy(sTemp_NS,1,length(sTemp_NS)-1) + ')'
         else if sNsCg_1 = '2' then sTemp := sTemp + '[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')|청구(조합)]' + '재검(' + copy(sTemp_NS,1,length(sTemp_NS)-1) + ')'
         else                       sTemp := sTemp + '[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')|청구(' + sNsCg_1 + ')]' + '재검(' + copy(sTemp_NS,1,length(sTemp_NS)-1) + ')' ;

         With qryNs_sokun Do
         Begin
            Active := False;
            ParamByName('Cod_Jisa').AsString  := sJisa_1;
            ParamByName('Dat_Gmgn').AsString  := sDate1;
            ParamByName('num_id').AsString    := sID_1;
            Active := True;
            If RecordCount > 0 Then
            begin
               if (FieldByName('cod_panjg1').AsString = '') and
                  (FieldByName('cod_panjg2').AsString = '') and
                  (FieldByName('cod_panjg3').AsString = '') and
                  (FieldByName('cod_panjg4').AsString = '') and
                  (FieldByName('cod_panjg5').AsString = '') then
               begin
                  sTemp := sTemp + #10#13#13 + '생애재검 대상, 1차 소견정리 안됨';
               end;
            end
            else
            begin
                  sTemp := sTemp + #10#13#13 + '생애재검 대상, 1차 소견정리 안됨';
            end;
            Active := False;
         End;
      end;
   end;

   if gubun = '2' then
   begin
      if sTemp_Tk <> '' then GP_ComboDisplay(cmbGUBN_TKCG, sTkCg, 1);
      {특검}
      if (sTemp_Tk <> '') and (sTemp_NS <> '') then sTemp := sTemp + #10#13 + '특검[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')]' + '재검(' + copy(sTemp_Tk,1,length(sTemp_Tk)-1) + ')'
      else if sTemp_Tk <> '' then sTemp := '특검[센터(' + sJisa_1 + ')|검진일(' + sDate1 + ')]' + '재검(' + copy(sTemp_Tk,1,length(sTemp_Tk)-1) + ')';
   end;

   if sTemp <> '' then ShowMessage(sTemp + #10#13#13 +
                                   ' ## ' + sTk_YHGM + ' ' + sTemp_jeagum + '대상자 입니다.' + #10#13#13 +
                                   '★노신과 동시재검일 경우, 필히 노신' + sTemp_jeagum + ' 선접수★');
end;

function TfrmCK3I01.UF_Sokun_cnvt(sCod_sokun : string): String;
begin
   Result := '';
   qrySokun.Filter := ' cod_sokun = ''' + sCod_sokun + '''';

   if qrySokun.RecordCount > 0 then Result := qrySokun.FieldByName('Desc_sokun').AsString;
end;

function TfrmCK3I01.UF_Hmatter_cnvt(sCod_Hmatter : string): String;
begin
   Result := '';
   qryComm06.Filter := ' 물질코드 = ''' + sCod_Hmatter + '''';

   if qryComm06.RecordCount > 0 then Result := qryComm06.FieldByName('유해물질명').AsString;
end;

function TfrmCK3I01.UF_Nhic(sGubun : string): String;
begin
   Result := '';
   if sGubun = '1' then
      Result := '본인부담없음'
   else if sGubun = '2' then
      Result := '10%부담'
   else if sGubun = '3' then
      Result := '해당없음'
   else if sGubun = '4' then
      Result := '수검완료'
   else if sGubun = '5' then
      Result := '대상'
   else if sGubun = '6' then
      Result := '간염후실시'
   else if sGubun = '7' then
      Result := '대상아님'  
   else if sGubun = '9' then
      Result := '수검정보등록';
   {else if sGubun = '9' then
      Result := 'KMI수검완료';}
end;

procedure TfrmCK3I01.UP_Johap_SugaUpdate;
var chk_cancer, chkUA, chkUBA, chkDJA, chkGA, chkJGA, no_cancer : string;
    iSuga : Integer;
begin
   suga_johap := 0;
   chkUA := '0'; chkUBA := '0'; chkGA := '0'; chkJGA := '0'; chkDJA := '0';

   if (Panel1.Caption = '검  진  접  수  관  리 [수정모드]') and
      (mskDAT_GMGN.Text >= '20120901') then
   begin
      if (Copy(cmbGUBN_NOSIN.Text,1,1) = '1') and (Copy(cmbGUBN_NSCG.Text,1,1) = '2') and
         (Ck_1cha.Checked = True) then
      begin
         UF_No_Hangmok(mskDAT_GMGN.Text, '1', StrToint(Copy(edtGUBN_NSYH.Text,1,pos('-', edtGUBN_NSYH.Text)-1)), iSuga);
         suga_johap := iSuga;
      end
      else if (Copy(cmbGUBN_ADULT.Text,1,1) = '1') and (Copy(cmbGUBN_ADCG.Text,1,1) = '2') and
           (Ck_1cha.Checked = True)then
      begin
         UF_No_Hangmok(mskDAT_GMGN.Text, '4', StrToint(Copy(edtGUBN_ADYH.Text,1,pos('-', edtGUBN_ADYH.Text)-1)), iSuga);
         suga_johap := iSuga;
      end
      else if (Copy(cmbGUBN_LIFE.Text,1,1) = '1') and (Copy(cmbGUBN_LFCG.Text,1,1) = '2') and
           (Ck_1cha.Checked = True)then
      begin
         UF_No_Hangmok(mskDAT_GMGN.Text, '7', StrToint(Copy(edtGUBN_LFYH.Text,1,pos('-', edtGUBN_LFYH.Text)-1)), iSuga);
         suga_johap := iSuga;
      end;

      if Copy(cmbGUBN_GONG.Text,1,1) = '1' then
      begin
         if qryHangmok_Gongdan.Active = False then qryHangmok_Gongdan.Active := True;

         //5대암 체크박스 체크시 자동으로 특정암 유형 변경
         if (Ck_UA.Checked = True) then
//            ((sGubn_UA  = '1') or (sGubn_UA  = '2') or (sGubn_UA  = '5')) then
            chkUA := '1';
         if (Ck_DJA.Checked = True) then
//            ((sGubn_DJA  = '1') or (sGubn_DJA  = '2') or (sGubn_DJA  = '5')) then
            chkDJA := '1';
         if (Ck_GA.Checked = True) then
//            ((sGubn_GA  = '1') or (sGubn_GA  = '2') or (sGubn_GA  = '5') or (sGubn_GA  = '6')) then
             chkGA := '1';
         if (Ck_UBA.Checked = True) then
//            ((sGubn_UBA = '1') or (sGubn_UBA = '2') or (sGubn_UBA = '5')) then
            chkUBA := '1';
         if (Ck_JGA.Checked = True) then
//            ((sGubn_JGA = '1') or (sGubn_JGA = '2') or (sGubn_JGA = '5')) then
            chkJGA := '1';
         chk_cancer := chkUA + chkGA + chkUBA + chkDJA + chkJGA;

         //특정암 체크박수와 특정암 유형 비교
         if (chk_cancer <> '00000') then
         begin
            with qryNo_hangmok_Cancer do
            begin
               close;
               ParamByName('dat_apply').AsString := copy(mskDAT_GMGN.Text,1,4);
               open;
               if recordcount > 0 then
               while not eof do
               begin
                  No_cancer := '';
                  if pos('위', FieldByName('desc_yhname').AsString) > 0   then No_cancer := '1'
                  else                                                         No_cancer := '0';
                  if pos('간', FieldByName('desc_yhname').AsString) > 0   then No_cancer := No_cancer + '1'
                  else                                                         No_cancer := No_cancer + '0';
                  if pos('유방', FieldByName('desc_yhname').AsString) > 0 then No_cancer := No_cancer + '1'
                  else                                                         No_cancer := No_cancer + '0';
                  if pos('대장', FieldByName('desc_yhname').AsString) > 0 then No_cancer := No_cancer + '1'
                  else                                                         No_cancer := No_cancer + '0';
                  if pos('자궁', FieldByName('desc_yhname').AsString) > 0 then No_cancer := No_cancer + '1'
                  else                                                         No_cancer := No_cancer + '0';

                  if (chk_cancer = No_cancer) then
                  begin
                     edtGUBN_GOYH.Text := qryNo_hangmok_Cancer.FieldByName('gubn_yh').AsString + '-' + qryNo_hangmok_Cancer.FieldByName('desc_yhname').AsString;
                  end;
                  next;
               end;
            end;
         end
         else if (chk_cancer = '00000') and (Ck_UA.Checked = False) and (Ck_DJA.Checked = False) and
                 (Ck_GA.Checked = False) and (Ck_UBA.Checked = False) and (Ck_JGA.Checked = False) then
         begin
            cmbGUBN_GONG.Text := '';
            edtGUBN_GOYH.Text := '';
            cmbGUBN_GOCG.Text := '';
         end;

         //특정암 조합금액
         if (pos('위', edtGubn_goyh.text) > 0) and (Ck_UA.Checked = True) and
            ((sGubn_UA  = '1') or (sGubn_UA  = '2') or (sGubn_UA  = '5')) then
         begin
            if (Pos('JJ34', sHangmokList) > 0) or
               (Pos('JJB9', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ34'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_UA = '1') or (sGubn_UA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_UA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Pos('JJ13', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ13'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_UA = '1') or (sGubn_UA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_UA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
         end;

         if (pos('대장', edtGubn_goyh.text) > 0) and (Ck_DJA.Checked = True) and
            ((sGubn_DJA  = '1') or (sGubn_DJA  = '2') or (sGubn_DJA  = '5')) then
         begin
            if (Pos('Y004', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''Y004'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_DJA = '1') or (sGubn_DJA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_DJA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Pos('JJ32', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ32'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_DJA = '1') or (sGubn_DJA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_DJA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Pos('JJ83', sHangmokList) > 0) or
                    (Pos('JJ86', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ83'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_DJA = '1') or (sGubn_DJA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_DJA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
         end;

         if (pos('간', edtGubn_goyh.text) > 0) and (Ck_GA.Checked = True) and
            ((sGubn_GA  = '1') or (sGubn_GA  = '2') or (sGubn_GA  = '5') or (sGubn_GA  = '6')) then
         begin
            if (Pos('TT01', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''TT01'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_GA = '1') or (sGubn_GA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_GA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
            if (Pos('TT02', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''TT02'' AND Desc_Kor = ''혈청알파태아단백검사(EIA)'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_GA = '1') or (sGubn_GA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_GA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
            if (Pos('JJ10', sHangmokList) > 0) or (Pos('JJ20', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ20'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_GA = '1') or (sGubn_GA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_GA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
         end;

         if (pos('유방', edtGubn_goyh.text) > 0) and (Ck_UBA.Checked = True) and
            ((sGubn_UBA = '1') or (sGubn_UBA = '2') or (sGubn_UBA = '5')) then
         begin
            if (Pos('JJ14', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ14'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_UBA = '1') or (sGubn_UBA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_UBA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
         end;

         if (pos('자궁', edtGubn_goyh.text) > 0) and (Ck_JGA.Checked = True) and
            ((sGubn_JGA = '1') or (sGubn_JGA = '2') or (sGubn_JGA = '5')) then
         begin
            if (Pos('P003', sHangmokList) > 0) then
            begin
               qryHangmok_Gongdan.Filter := ' COD_HM = ''P003'' AND ' +
                                            ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
               if (sGubn_JGA = '1') or (sGubn_JGA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_JGA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
         end;

         if (Ck_UA.Checked = True) or (Ck_DJA.Checked = True) or (Ck_GA.Checked = True) or
            (Ck_UBA.Checked = True) or (Ck_JGA.Checked = True) then
         begin
            qryHangmok_Gongdan.Filter := ' COD_HM = ''JJ74'' AND cod_kor = ''AA254'' AND ' +
                                         ' DAT_APPLY <= ''' + mskDAT_GMGN.Text + '''';
            if (Ck_UA.Checked = True) then
            begin
               if (sGubn_UA = '1') or (sGubn_UA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_UA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Ck_DJA.Checked = True) then
            begin
               if (sGubn_DJA = '1') or (sGubn_DJA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_DJA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Ck_GA.Checked = True) then
            begin
               if (sGubn_GA = '1') or (sGubn_GA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_GA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Ck_UBA.Checked = True) then
            begin
               if (sGubn_UBA = '1') or (sGubn_UBA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_UBA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end
            else if (Ck_JGA.Checked = True) then
            begin
               if (sGubn_JGA = '1') or (sGubn_JGA = '5') then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger
               else if sGubn_JGA = '2' then
                  suga_johap := suga_johap + qryHangmok_Gongdan.FieldByName('Suga_Hangmok').AsInteger * 0.9;
            end;
         end;
      end;  //end of if Copy(cmbGUBN_GONG.Text,1,1) = '1' then
      valSUGA_JOHAP.Value := suga_johap;
   end;
   UV_bEdit := True;
end;

procedure TfrmCK3I01.UP_GUBN_GOYH_Change;
var chk_cancer, chkUA, chkUBA, chkDJA, chkGA, chkJGA, no_cancer : string;
begin
   chkUA := '0'; chkUBA := '0'; chkGA := '0'; chkJGA := '0'; chkDJA := '0';

   if Copy(cmbGUBN_GONG.Text,1,1) = '1' then
   begin
      if qryHangmok_Gongdan.Active = False then qryHangmok_Gongdan.Active := True;

      //5대암 체크박스 체크시 자동으로 특정암 유형 변경
      if (Ck_UA.Checked = True) then
//         ((sGubn_UA  = '1') or (sGubn_UA  = '2') or (sGubn_UA  = '5')) then
         chkUA := '1';
      if (Ck_DJA.Checked = True) then
//         ((sGubn_DJA  = '1') or (sGubn_DJA  = '2') or (sGubn_DJA  = '5')) then
         chkDJA := '1';
      if (Ck_GA.Checked = True) then
//         ((sGubn_GA  = '1') or (sGubn_GA  = '2') or (sGubn_GA  = '5') or (sGubn_GA  = '6')) then
          chkGA := '1';
      if (Ck_UBA.Checked = True) then
//         ((sGubn_UBA = '1') or (sGubn_UBA = '2') or (sGubn_UBA = '5')) then
         chkUBA := '1';
      if (Ck_JGA.Checked = True) then
//         ((sGubn_JGA = '1') or (sGubn_JGA = '2') or (sGubn_JGA = '5')) then
         chkJGA := '1';
      chk_cancer := chkUA + chkGA + chkUBA + chkDJA + chkJGA;

      //특정암 체크박수와 특정암 유형 비교
      if (chk_cancer <> '00000') then
      begin
         with qryNo_hangmok_Cancer do
         begin
            close;
            ParamByName('dat_apply').AsString := copy(mskDAT_GMGN.Text,1,4);
            open;
            if recordcount > 0 then
            while not eof do
            begin
               No_cancer := '';
               if pos('위', FieldByName('desc_yhname').AsString) > 0   then No_cancer := '1'
               else                                                         No_cancer := '0';
               if pos('간', FieldByName('desc_yhname').AsString) > 0   then No_cancer := No_cancer + '1'
               else                                                         No_cancer := No_cancer + '0';
               if pos('유방', FieldByName('desc_yhname').AsString) > 0 then No_cancer := No_cancer + '1'
               else                                                         No_cancer := No_cancer + '0';
               if pos('대장', FieldByName('desc_yhname').AsString) > 0 then No_cancer := No_cancer + '1'
               else                                                         No_cancer := No_cancer + '0';
               if pos('자궁', FieldByName('desc_yhname').AsString) > 0 then No_cancer := No_cancer + '1'
               else                                                         No_cancer := No_cancer + '0';

               if (chk_cancer = No_cancer) then
               begin
                  edtGUBN_GOYH.Text := qryNo_hangmok_Cancer.FieldByName('gubn_yh').AsString + '-' + qryNo_hangmok_Cancer.FieldByName('desc_yhname').AsString;
               end;
               next;
            end;
         end;
      end
      else if (chk_cancer = '00000') and (Ck_UA.Checked = False) and (Ck_DJA.Checked = False) and
              (Ck_GA.Checked = False) and (Ck_UBA.Checked = False) and (Ck_JGA.Checked = False) then
      begin
         cmbGUBN_GONG.Text := '';
         edtGUBN_GOYH.Text := '';
         cmbGUBN_GOCG.Text := '';
      end;
   end;  //end of if Copy(cmbGUBN_GONG.Text,1,1) = '1' then
end;

procedure TfrmCK3I01.Ck_UAClick(Sender: TObject);
begin
  inherited;

  sHangmokList := '';
  if edtCOD_JANGBI.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_HUL.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_CANCER.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;
  sHangmokList := sHangmokList + GF_GridToSingle(grdCod_Chuga);

  if (Ck_UA.Checked = True) and (UV_iStatus <> GC_Insert) and
     ((Pos('JJ13', sHangmokList) <= 0) and
      (Pos('JJ34', sHangmokList) <= 0) and
      (Pos('JJB9', sHangmokList) <= 0)) then
  begin
     showmessage('위암 관련 항목이 접수되어 있지 않습니다.');
     Ck_UA.Checked := False;
  end
  else
  begin
     if (Ck_UA.Checked = True) and
        (Copy(cmbGUBN_GONG.text,1,1) <> '1') then
        begin
            cmbGUBN_GONG.text := '1-유';
            cmbGUBN_GOCG.text := '2-조합청구';
        end;

     UP_Johap_SugaUpdate;

     if (UV_iStatus = GC_Insert) then
     begin
        if (Ck_UA.Checked = True) and
           ((Pos('JJ13', sHangmokList) <= 0) and
            (Pos('JJ34', sHangmokList) <= 0) and
            (Pos('JJB9', sHangmokList) <= 0)) then
        begin
           showmessage('위암 관련 항목이 접수되어 있지 않습니다.');
           Ck_UA.Checked := False;
        end
        else
        begin
           UP_GUBN_GOYH_Change;
        end;
     end;
  end;
end;

procedure TfrmCK3I01.Ck_DJAClick(Sender: TObject);
begin
  inherited;

  sHangmokList := '';
  if edtCOD_JANGBI.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_HUL.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_CANCER.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;
  sHangmokList := sHangmokList + GF_GridToSingle(grdCod_Chuga);

  if (Ck_DJA.Checked = True) and (UV_iStatus <> GC_Insert) and
     ((Pos('Y004', sHangmokList) <= 0) and
      (Pos('JJ83', sHangmokList) <= 0) and
      (Pos('JJ86', sHangmokList) <= 0)) then
  begin
     showmessage('대장암 관련 항목이 접수되어 있지 않습니다.');
     Ck_DJA.Checked := False;
  end
  else
  begin
     if (Ck_DJA.Checked = True) and
        (Copy(cmbGUBN_GONG.text,1,1) <> '1') then
        begin
            cmbGUBN_GONG.text := '1-유';
            cmbGUBN_GOCG.text := '2-조합청구';
        end;
     UP_Johap_SugaUpdate;  

     if (UV_iStatus = GC_Insert) then
     begin
        if (Ck_DJA.Checked = True) and
           ((Pos('Y004', sHangmokList) <= 0) and
            (Pos('JJ83', sHangmokList) <= 0) and
            (Pos('JJ86', sHangmokList) <= 0)) then
        begin
           showmessage('대장암 관련 항목이 접수되어 있지 않습니다.');
           Ck_DJA.Checked := False;
        end
        else
        begin
           UP_GUBN_GOYH_Change;
        end;
     end;
  end;
end;

procedure TfrmCK3I01.Ck_GAClick(Sender: TObject);
begin
  inherited;

  sHangmokList := '';
  if edtCOD_JANGBI.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_HUL.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_CANCER.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;
  sHangmokList := sHangmokList + GF_GridToSingle(grdCod_Chuga);

{  if (Ck_GA.Checked = True) and (UV_iStatus <> GC_Insert) and
     ((Pos('TT01', sHangmokList) <= 0) and
      (Pos('TT02', sHangmokList) <= 0) and
      (Pos('JJ20', sHangmokList) <= 0)) then
  begin
     showmessage('간암 관련 항목이 접수되어 있지 않습니다.');
     Ck_GA.Checked := False;
  end
  else
  begin
     if (Ck_GA.Checked = True) and
        (Copy(cmbGUBN_GONG.text,1,1) <> '1') then
        cmbGUBN_GONG.text := '1-유';

     UP_Johap_SugaUpdate;
  end;   }
  { 김창규 수정 2016.02.01 TT03 자동 추가
  if ((Pos('TT01', sHangmokList) > 0) or
      (Pos('TT02', sHangmokList) > 0) or
      (Pos('JJ10', sHangmokList) > 0) or
      (Pos('JJ20', sHangmokList) > 0) or
      (Pos('C010', sHangmokList) > 0) or
      (Pos('S007', sHangmokList) > 0)) then
}
  if ((Pos('JJ10', sHangmokList) > 0) or
      (Pos('JJ20', sHangmokList) > 0) or
      (Pos('C010', sHangmokList) > 0) or
      (Pos('S007', sHangmokList) > 0)) then
  begin
     if (Ck_GA.Checked = True) and
        (Copy(cmbGUBN_GONG.text,1,1) <> '1') then
        Begin
           cmbGUBN_GONG.text := '1-유';
           cmbGUBN_GOCG.text := '2-조합청구';
           
           If Pos('TT03',sHangmokList) > 0 Then
              Showmessage('※ 검사항목에 TT03 이 있습니다.!!')
           Else
              Begin
                 edtCod_Chuga.Text := 'TT03';
                 btnHm_insertClick(Self);
              End;

        End;

     UP_Johap_SugaUpdate; 

     if (UV_iStatus = GC_Insert) then
           UP_GUBN_GOYH_Change;
  end
  else if (Ck_GA.Checked = True) then
  begin
     showmessage('간암 관련 항목이 접수되어 있지 않습니다.');
     Ck_GA.Checked := False;
  end;

end;

procedure TfrmCK3I01.Ck_UBAClick(Sender: TObject);
begin
  inherited;

  sHangmokList := '';
  if edtCOD_JANGBI.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_HUL.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_CANCER.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;
  sHangmokList := sHangmokList + GF_GridToSingle(grdCod_Chuga);

  if (Ck_UBA.Checked = True) and (UV_iStatus <> GC_Insert) and
     (Pos('JJ14', sHangmokList) <= 0) then
  begin
     showmessage('유방암 관련 항목이 접수되어 있지 않습니다.');
     Ck_UBA.Checked := False;
  end
  else
  begin
     if (Ck_UBA.Checked = True) and
        (Copy(cmbGUBN_GONG.text,1,1) <> '1') then
        begin
            cmbGUBN_GONG.text := '1-유';
            cmbGUBN_GOCG.text := '2-조합청구';
        end;

     UP_Johap_SugaUpdate; 

     if (UV_iStatus = GC_Insert) then
     begin
        if (Ck_UBA.Checked = True) and
           (Pos('JJ14', sHangmokList) <= 0) then
        begin
           showmessage('유방암 관련 항목이 접수되어 있지 않습니다.');
           Ck_UBA.Checked := False;
        end
        else
        begin
           UP_GUBN_GOYH_Change;
        end;
     end;
  end;
end;

procedure TfrmCK3I01.Up_Overlap(Sender: TObject);
var sCode, sName,sSelect,sWhere,sOrder : String;

    index : integer;
begin
   inherited;
   if  UV_iStatus <> GC_Insert then exit;
   with qryGmgn do
      begin
         // Filter 제거
         Filtered := False;
         Active := False;
         SQL.Clear;

         sSelect := 'SELECT cod_jisa, num_id, dat_gmgn, desc_name, cod_jangbi, cod_hul, cod_chuga, cod_dc,gubn_nosin,gubn_adult,gubn_life, gubn_tkgm  FROM gumgin WITH(NOLOCK)';

         sWhere := ' WHERE ' + sWhere + ' num_jumin = ''' + mskNUM_JUMIN.Text + '''';
         sOrder := ' ORDER BY dat_gmgn';

         SQL.Clear;
         SQL.Add(sSelect + sWhere + sOrder);
         Active := True;
         if RecordCount > 0 then
         begin
            while not Eof do
            begin
               if ((copy(FieldByName('dat_gmgn').AsString,1,4)) = (copy(mskDAT_GMGN.Text,1,4))) and
                  ((FieldByName('dat_gmgn').AsString) <> (mskDAT_GMGN.Text)) then
                  begin
                  if ((pos('PJ', FieldByName('cod_jangbi').AsString) > 0) and (copy(edtCOD_JANGBI.Text,1,2)='PJ')) and (Sender = edtCOD_JANGBI)then
                      GF_MsgBox('Warning', copy(fieldByName('Dat_gmgn').AsString,1,4) + '년' +  copy(fieldByName('Dat_gmgn').AsString,5,2) + '월' + copy(fieldByName('Dat_gmgn').AsString,7,2) + '일 종합검진 받은 내역이 있습니다.')
                  else if (((FieldByName('gubn_nosin').AsString='1') and (cmbGUBN_NOSIN.ItemIndex = 1)) or
                          ((FieldByName('gubn_nosin').AsString='2') and (cmbGUBN_NOSIN.ItemIndex = 2))) and (Sender = cmbGUBN_NOSIN)then
                          GF_MsgBox('Warning', copy(fieldByName('Dat_gmgn').AsString,1,4) + '년' +  copy(fieldByName('Dat_gmgn').AsString,5,2) + '월' + copy(fieldByName('Dat_gmgn').AsString,7,2) + '일 동일한 검진(노신)을 받은 내역이 있습니다.')
                  else if (((FieldByName('gubn_adult').AsString='1') and (cmbGUBN_adult.ItemIndex = 1)) or
                          ((FieldByName('gubn_adult').AsString='2') and (cmbGUBN_adult.ItemIndex = 2))) and (Sender = cmbGUBN_ADULT) then
                       GF_MsgBox('Warning', copy(fieldByName('Dat_gmgn').AsString,1,4) + '년' +  copy(fieldByName('Dat_gmgn').AsString,5,2) + '월' + copy(fieldByName('Dat_gmgn').AsString,7,2) + '일 동일한 검진(성인병)을 받은 내역이 있습니다.')
                  else if (((FieldByName('gubn_life').AsString='1') and (cmbGUBN_life.ItemIndex = 1)) or
                          ((FieldByName('gubn_life').AsString='2') and (cmbGUBN_life.ItemIndex = 2))) and (Sender = cmbGUBN_LIFE) then
                       GF_MsgBox('Warning', copy(fieldByName('Dat_gmgn').AsString,1,4) + '년' +  copy(fieldByName('Dat_gmgn').AsString,5,2) + '월' + copy(fieldByName('Dat_gmgn').AsString,7,2) + '일 동일한 검진(생애)을 받은 내역이 있습니다.')
                  //shsh
                  else if (((FieldByName('gubn_tkgm').AsString='1') and (cmbGUBN_TKGM.ItemIndex = 1)) or
                          ((FieldByName('gubn_tkgm').AsString='2') and (cmbGUBN_TKGM.ItemIndex = 2))) and (Sender = cmbGUBN_TKGM) then
                       GF_MsgBox('Warning', copy(fieldByName('Dat_gmgn').AsString,1,4) + '년' +  copy(fieldByName('Dat_gmgn').AsString,5,2) + '월' + copy(fieldByName('Dat_gmgn').AsString,7,2) + '일 동일한 검진(특검)을 받은 내역이 있습니다.');

                end;
               Next;
             end;
         end;
         Active := False;
      end;
   end;
procedure TfrmCK3I01.Ck_JGAClick(Sender: TObject);
begin
  inherited;

  sHangmokList := '';
  if edtCOD_JANGBI.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_JANGBI.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_HUL.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_HUL.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;

  if edtCOD_CANCER.Text <> '' then
  begin
     qryPf_hm.Active := False;
     qryPf_hm.ParamByName('Cod_Pf').AsString := edtCOD_CANCER.Text;
     qryPf_hm.Active := True;
     if qryPf_hm.RecordCount > 0 then
     begin
        while not qryPf_hm.Eof do
        begin
           sHangmokList := sHangmokList + qryPf_hm.FieldByName('COD_HM').AsString;
           qryPf_hm.Next;
        end;
     end;
     qryPf_hm.Active := False;
  end;
  sHangmokList := sHangmokList + GF_GridToSingle(grdCod_Chuga);
    
  if (Ck_JGA.Checked = True) and (UV_iStatus <> GC_Insert) and
     (Pos('P003', sHangmokList) <= 0) then
  begin
     showmessage('자궁암 관련 항목이 접수되어 있지 않습니다.');
     Ck_JGA.Checked := False;
  end
  else
  begin
     if (Ck_JGA.Checked = True) and
        (Copy(cmbGUBN_GONG.text,1,1) <> '1') then
        begin
            cmbGUBN_GONG.text := '1-유';
            cmbGUBN_GOCG.text := '2-조합청구';
        end;

     UP_Johap_SugaUpdate;        

     if (UV_iStatus = GC_Insert) then
     begin
        if (Ck_JGA.Checked = True) and
           (Pos('P003', sHangmokList) <= 0) then
        begin
           showmessage('자궁암 관련 항목이 접수되어 있지 않습니다.');
           Ck_JGA.Checked := False;
        end
        else
        begin
           UP_GUBN_GOYH_Change;
        end;
     end;
  end;
end;

procedure TfrmCK3I01.Ck_Ysno_Gocg(Sender: TObject);
var chk_Not_cancer, No_Not_cancer : String;
begin
  inherited;
    chk_Not_cancer := '';
    No_Not_cancer  := '';

    if Ysno_UA.Checked then chk_Not_cancer :=  chk_Not_cancer + '1'
    else  chk_Not_cancer :=  chk_Not_cancer + '0';
    
    if Ysno_DJA.Checked then chk_Not_cancer :=  chk_Not_cancer + '1'
    else  chk_Not_cancer :=  chk_Not_cancer + '0';

    if Ysno_GA.Checked then chk_Not_cancer :=  chk_Not_cancer + '1'
    else  chk_Not_cancer :=  chk_Not_cancer + '0';
    
    if Ysno_UBA.Checked then chk_Not_cancer :=  chk_Not_cancer + '1'
    else  chk_Not_cancer :=  chk_Not_cancer + '0';

    if Ysno_JGA.Checked then chk_Not_cancer :=  chk_Not_cancer + '1'
    else  chk_Not_cancer :=  chk_Not_cancer + '0';


    //특정암 체크박수와 특정암 유형 비교 - 미청구대상 특정암
    if (chk_Not_cancer <> '00000') then
    begin
       with qryNo_hangmok_Cancer do
       begin
          close;
          ParamByName('dat_apply').AsString := copy(mskDAT_GMGN.Text,1,4);
          open;
          if recordcount > 0 then
          while not eof do
          begin
             No_Not_cancer := '';
             if pos('위', FieldByName('desc_yhname').AsString) > 0   then No_Not_cancer := '1'
             else                                                         No_Not_cancer := '0';
             if pos('대장', FieldByName('desc_yhname').AsString) > 0 then No_Not_cancer := No_Not_cancer + '1'
             else                                                         No_Not_cancer := No_Not_cancer + '0';
             if pos('간', FieldByName('desc_yhname').AsString) > 0   then No_Not_cancer := No_Not_cancer + '1'
             else                                                         No_Not_cancer := No_Not_cancer + '0';
             if pos('유방', FieldByName('desc_yhname').AsString) > 0 then No_Not_cancer := No_Not_cancer + '1'
             else                                                         No_Not_cancer := No_Not_cancer + '0';
             if pos('자궁', FieldByName('desc_yhname').AsString) > 0 then No_Not_cancer := No_Not_cancer + '1'
             else                                                         No_Not_cancer := No_Not_cancer + '0';

             if (chk_Not_cancer = No_Not_cancer) then
             begin
                edt_Ysno_gocg.Text := qryNo_hangmok_Cancer.FieldByName('gubn_yh').AsString + '-' + qryNo_hangmok_Cancer.FieldByName('desc_yhname').AsString;
             end;
             next;
          end;
       end;
    end
    else if (chk_Not_cancer = '00000')  then
    begin
       edt_Ysno_gocg.Text := '';
    end;

end;




procedure TfrmCK3I01.grdCOD_CHUGACellEdit(Sender: TObject; DataCol,
  DataRow: Integer; ByUser: Boolean);
begin
  inherited;
//  UV_vGubn_free[DataRow - 1] := grdCOD_CHUGA.Cell[4, DataRow];

   case DataCol of
      4 : UV_vGubn_free[DataRow - 1]         := grdCOD_CHUGA.CurrentCell.Value;
      5 : UV_vGubn_Cancel_Chuga[DataRow - 1] := grdCOD_CHUGA.CurrentCell.Value;
      6 : UV_Cancel_Chuga_Etc[DataRow - 1]   := grdCOD_CHUGA.CurrentCell.Value;
   end;

   Gong_Cancel_Jangbi('C',DataRow);

   // 수정된 Column을 표시
   grdCOD_CHUGA.AssignCellFont(DataCol, DataRow);
   grdCOD_CHUGA.CellFont[DataCol, DataRow].Color := clBlue;

   if (cmbCOD_JISA.Text <> '') and
      (mskNUM_JUMIN.Text <> '') and
      (mskDAT_GMGN.Text <> '') then
   begin
      with qryCancel_jangbi do
      begin
         Active := False;
         ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
         ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
         ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
         ParamByName('cod_hm').AsString     := UV_vCod_chuga_d[DataRow-1];
         Active := True;
         if RecordCount > 0 then
         begin
            with qryU_Cancel_jangbi do
            begin
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
               ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('cod_hm').AsString      := UV_vCod_chuga_d[DataRow-1];
               ParamByName('gubn_cancel').AsString := UV_vGubn_Cancel_Chuga[DataRow - 1];
               ParamByName('cancel_etc').AsString  := UV_Cancel_Chuga_Etc[DataRow - 1];
               ParamByName('dat_update').AsString  := GV_sToday;
               ParamByName('cod_update').AsString  := GV_sUserId;

               Execsql;
            end;
         end
         else
         begin
            with qryI_Cancel_jangbi do
            begin
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
               ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('cod_hm').AsString      := UV_vCod_chuga_d[DataRow-1];
               ParamByName('gubn_cancel').AsString := UV_vGubn_Cancel_Chuga[DataRow - 1];
               ParamByName('cancel_etc').AsString  := UV_Cancel_Chuga_Etc[DataRow - 1];
               ParamByName('dat_insert').AsString  := GV_sToday;
               ParamByName('cod_insert').AsString  := GV_sUserId;

               Execsql;
            end;
         end;
      end;
   end;

end;

procedure TfrmCK3I01.grdMasterCellEdit(Sender: TObject; DataCol,
  DataRow: Integer; ByUser: Boolean);
begin
  inherited;
   case DataCol of
      3 : UV_vGubn_Cancel_select[DataRow - 1] := grdMaster.CurrentCell.Value;
      4 : UV_vCancel_Etc[DataRow - 1]         := grdMaster.CurrentCell.Value;
   end;

   Gong_Cancel_Jangbi('J',DataRow);

   // 수정된 Column을 표시
   grdMaster.AssignCellFont(DataCol, DataRow);
   grdMaster.CellFont[DataCol, DataRow].Color := clBlue;


   if (cmbCOD_JISA.Text <> '') and
      (mskNUM_JUMIN.Text <> '') and
      (mskDAT_GMGN.Text <> '') then
   begin
      with qryCancel_jangbi do
      begin
         Active := False;
         ParamByName('cod_jisa').AsString   := Copy(cmbCOD_JISA.Text,1,2);
         ParamByName('num_jumin').AsString  := mskNUM_JUMIN.Text;
         ParamByName('dat_gmgn').AsString   := mskDAT_GMGN.Text;
         ParamByName('cod_hm').AsString     := UV_vCod_hm[DataRow-1];
         Active := True;
         if RecordCount > 0 then
         begin
            with qryU_Cancel_jangbi do
            begin
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
               ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('cod_hm').AsString      := UV_vCod_hm[DataRow-1];
               ParamByName('gubn_cancel').AsString := UV_vGubn_Cancel_select[DataRow - 1];
               ParamByName('cancel_etc').AsString  := UV_vCancel_Etc[DataRow - 1];
               ParamByName('dat_update').AsString  := GV_sToday;
               ParamByName('cod_update').AsString  := GV_sUserId;

               Execsql;
            end;
         end
         else
         begin
            with qryI_Cancel_jangbi do
            begin
               ParamByName('cod_jisa').AsString    := Copy(cmbCOD_JISA.Text,1,2);
               ParamByName('num_jumin').AsString   := mskNUM_JUMIN.Text;
               ParamByName('dat_gmgn').AsString    := mskDAT_GMGN.Text;
               ParamByName('cod_hm').AsString      := UV_vCod_hm[DataRow-1];
               ParamByName('gubn_cancel').AsString := UV_vGubn_Cancel_select[DataRow - 1];
               ParamByName('cancel_etc').AsString  := UV_vCancel_Etc[DataRow - 1];
               ParamByName('dat_insert').AsString  := GV_sToday;
               ParamByName('cod_insert').AsString  := GV_sUserId;

               Execsql;
            end;
         end;
      end;
   end;
   
   // 수정되었음을 표시 -> 내부적으로 사용하는 Edit Flag
//   UV_bEdit := True;
end;

procedure TfrmCK3I01.grdMasterCellLoaded(Sender: TObject; DataCol,
  DataRow: Integer; var Value: Variant);
begin
  inherited;
   // 자룔를 화면에 조회
   case DataCol of
      1 : Value  := UV_vCod_hm[DataRow-1];
      2 : Value  := UV_vDesc_kor[DataRow-1];
      3 : Value  := UV_vGubn_Cancel_select[DataRow - 1];
      4 : Value  := UV_vCancel_Etc[DataRow - 1];
   end;

end;

procedure TfrmCK3I01.grdMasterComboInit(Sender: TObject;
  Combo: TtsComboGrid; DataCol, DataRow: Integer);
var
    itemp : Integer;
    sSelect, sWhere : String;
begin
  inherited;
   itemp := 0;
   case DataCol of
      3 : begin
             qryTemp.Active := False;
             qryTemp.SQL.Clear;

             // SQL문 생성
             sSelect := ' select * from common ' ;
             sWhere  := ' where cod_group = ''DEL1'' ';

             qryTemp.SQL.Add(sSelect + sWhere);
             qryTemp.Active := True;

             if qryTemp.RecordCount > 0 then
             begin
                VarArrayRedim(UV_vGubn_Cancel, qryTemp.RecordCount - 1);
                while not qryTemp.Eof do
                begin
                   UV_vGubn_Cancel[itemp] := qryTemp.FieldByName('cod_detail').AsString + '-' +
                                             qryTemp.FieldByName('desc_code').AsString;

                   qryTemp.Next;
                   Inc(itemp);
                end;
             end
             else
             begin
                itemp := 0;
             end;

             Combo.DropDownRows := itemp;
             Combo.Grid.Rows    := itemp;
          end;
   end;
end;

procedure TfrmCK3I01.grdMasterComboCellLoaded(Sender: TObject;
  Combo: TtsComboGrid; DataCol, DataRow: Integer; var Value: Variant);
begin
  inherited;
    case grdMaster.CurrentCell.DataCol of
      3 : Value := UV_vGubn_Cancel[DataRow-1];
   end;
end;


procedure TfrmCK3I01.grdCOD_CHUGAComboInit(Sender: TObject;
  Combo: TtsComboGrid; DataCol, DataRow: Integer);
var
    itemp : Integer;
    sSelect, sWhere : String;  
begin
  inherited;
   itemp := 0;
   case DataCol of
      5 : begin
             qryTemp.Active := False;
             qryTemp.SQL.Clear;

             // SQL문 생성
             sSelect := ' select * from common ' ;
             sWhere  := ' where cod_group = ''DEL1'' ';

             qryTemp.SQL.Add(sSelect + sWhere);
             qryTemp.Active := True;

             if qryTemp.RecordCount > 0 then
             begin
                VarArrayRedim(UV_vGubn_Cancel, qryTemp.RecordCount - 1);
                while not qryTemp.Eof do
                begin
                   UV_vGubn_Cancel[itemp] := qryTemp.FieldByName('cod_detail').AsString + '-' +
                                             qryTemp.FieldByName('desc_code').AsString;

                   qryTemp.Next;
                   Inc(itemp);
                end;
             end
             else
             begin
                itemp := 0;
             end;

             Combo.DropDownRows := itemp;
             Combo.Grid.Rows    := itemp;
          end;
   end;
end;

procedure TfrmCK3I01.grdCOD_CHUGAComboCellLoaded(Sender: TObject;
  Combo: TtsComboGrid; DataCol, DataRow: Integer; var Value: Variant);
begin
  inherited;
    case grdCOD_CHUGA.CurrentCell.DataCol of
      5 : Value := UV_vGubn_Cancel[DataRow-1];
   end;
end;

function TfrmCK3I01.UF_DAT_GMGN_Validation(sDate : String): Boolean;
begin
  Result := True;
  // 입력된 날짜가 현재 날짜의 10년 이상이면 False
  if strtoint(copy(sDate,1,4)) > strtoint(copy(DateToStr(Now()),1,4)) + 10 then
  begin
    Result := False;
  end;
end;

procedure TfrmCK3I01.UP_Select_Ysno_Result_Ues(Cod_jisa, Dat_Gmgn, Num_Id : String);
begin
  if Dat_Gmgn >= '20180101' then
  begin 
     With qry_Tot_munjin2018 Do
     Begin
       Close;
       ParamByName('Cod_jisa').AsString := Cod_jisa;
       ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
       ParamByName('Num_Id').AsString   := Num_Id;
       Open;
       If RecordCount > 0 Then
       Begin
         if FieldByName('Ysno_agree').AsString = '1' then
           Ck_ysno_result_Use.Checked := True
         else
           Ck_ysno_result_Use.Checked := False;
       End
       else
       begin
         Ck_ysno_result_Use.Checked := False;
       end;
     end;
  end
  else
  begin
     With qry_Tot_munjin2010 Do
     Begin
       Close;
       ParamByName('Cod_jisa').AsString := Cod_jisa;
       ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
       ParamByName('Num_Id').AsString   := Num_Id;
       Open;
       If RecordCount > 0 Then
       Begin
         if FieldByName('Ysno_agree').AsString = '1' then
           Ck_ysno_result_Use.Checked := True
         else
           Ck_ysno_result_Use.Checked := False;
       End
       else
       begin
         Ck_ysno_result_Use.Checked := False;
       end;
     end;
  end;
end;

procedure TfrmCK3I01.UP_Update_Ysno_Result_Ues(Cod_jisa, Dat_Gmgn, Num_id : String);
begin
  if Dat_Gmgn >= '20180101' then
  begin     
     With qry_Tot_Munjin2018 Do
     Begin
       Close;
       ParamByName('Cod_jisa').AsString := Cod_jisa;
       ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
       ParamByName('Num_Id').AsString   := Num_id;
       Open;
       If RecordCount > 0 Then
       begin
         With qryU_Tot_Munjin2018 Do
         Begin
           Close;
           ParamByName('Cod_jisa').AsString := Cod_jisa;
           ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
           ParamByName('Num_Id').AsString   := Num_id;
    
           if ((qry_Tot_Munjin2018.FieldByName('Ysno_agree').ASString = '1')  and (Ck_ysno_result_Use.Checked = True)) or
              ((qry_Tot_Munjin2018.FieldByName('Ysno_agree').ASString <> '1') and (Ck_ysno_result_Use.Checked = False)) then exit;
    
           If Ck_ysno_result_Use.Checked = True then
           begin
             ParamByName('Ysno_agree').ASString := '1';
           end
           else
           begin
             if qry_Tot_Munjin2018.FieldByName('Ysno_agree').AsString = '1' then
               ParamByName('Ysno_agree').AsString := '2'
             else
               ParamByName('Ysno_agree').AsString := '';
           end;
    
           ParamByName('dat_Update').AsString := Gv_sToday;
           ParamByName('cod_Update').AsString := GV_sUserId;
    
           ExecSql;
    
           GP_query_log(qryU_Tot_Munjin2018, 'CK3I01', 'U', 'Y');
           Close;
         end;
       end
       Else
       begin
         if Ck_ysno_result_Use.Checked = True then
         begin
           With qryI_Tot_Munjin2018 Do
           Begin
             Close;
             ParamByName('Cod_jisa').AsString := Cod_jisa;
             ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
             ParamByName('Num_Id').AsString   := Num_id;

             //정보활용 동의여부
             If Ck_ysno_result_Use.Checked = True then ParamByName('Ysno_agree').ASString := '1'
             else                                      ParamByName('Ysno_agree').AsString := '';

             ParamByName('dat_Insert').AsString := Gv_sToday;
             ParamByName('cod_Insert').AsString := GV_sUserId;

             ExecSql;
             Close;

             GP_query_log(qryI_Tot_Munjin2018, 'CK3I01', 'I', 'Y');
           end;
         end;
       end;
     end;
  end
  else
  begin
     With qry_Tot_Munjin2010 Do
     Begin
       Close;
       ParamByName('Cod_jisa').AsString := Cod_jisa;
       ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
       ParamByName('Num_Id').AsString   := Num_id;
       Open;
       If RecordCount > 0 Then
       begin
         With qryU_Tot_Munjin2010 Do
         Begin
           Close;
           ParamByName('Cod_jisa').AsString := Cod_jisa;
           ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
           ParamByName('Num_Id').AsString   := Num_id;
    
           if ((qry_Tot_Munjin2010.FieldByName('Ysno_agree').ASString = '1')  and (Ck_ysno_result_Use.Checked = True)) or
              ((qry_Tot_Munjin2010.FieldByName('Ysno_agree').ASString <> '1') and (Ck_ysno_result_Use.Checked = False)) then exit;
    
           If Ck_ysno_result_Use.Checked = True then
           begin
             ParamByName('Ysno_agree').ASString := '1';
           end
           else
           begin
             if qry_Tot_Munjin2010.FieldByName('Ysno_agree').AsString = '1' then
               ParamByName('Ysno_agree').AsString := '2'
             else
               ParamByName('Ysno_agree').AsString := '';
           end;
    
           ParamByName('dat_Update').AsString := Gv_sToday;
           ParamByName('cod_Update').AsString := GV_sUserId;
    
           ExecSql;
    
           GP_query_log(qryU_Tot_Munjin2010, 'CK3I01', 'U', 'Y');
           Close;
         end;
       end
       Else
       begin
         if Ck_ysno_result_Use.Checked = True then
         begin
           With qryI_Tot_Munjin2010 Do
           Begin
             Close;
             ParamByName('Cod_jisa').AsString := Cod_jisa;
             ParamByName('Dat_Gmgn').AsString := Dat_Gmgn;
             ParamByName('Num_Id').AsString   := Num_id;

             //정보활용 동의여부
             If Ck_ysno_result_Use.Checked = True then ParamByName('Ysno_agree').ASString := '1'
             else                                      ParamByName('Ysno_agree').AsString := '';

             ParamByName('dat_Insert').AsString := Gv_sToday;
             ParamByName('cod_Insert').AsString := GV_sUserId;

             ExecSql;
             Close;

             GP_query_log(qryI_Tot_Munjin2010, 'CK3I01', 'I', 'Y');
           end;
         end;
       end;
     end;
  end;
end;

//shsh
function TfrmCK3I01.UF_Check_Munjin: Boolean;
begin
  Result := False;
  with qryMunjin do
  begin
    try
      Active := False;
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString := mskDAT_GMGN.Text;
      Active := True;
      FetchAll;
      if RecordCount > 0 then
      begin
        Result := True;
      end;
    Finally
      Active := False;
    end;
  end;
end;

function TfrmCK3I01.UF_Check_Kicho: Boolean;
begin
  Result := False;
  with qryKicho do
  begin
    try
      Active := False;
      ParamByName('cod_jisa').AsString := Copy(cmbCod_jisa.Text, 1, 2);
      ParamByName('num_id').AsString   := UV_sNum_id;
      ParamByName('dat_gmgn').AsString := mskDAT_GMGN.Text;
      Active := True;
      if RecordCount > 0 then
      begin
        Result := True;
      end;
    Finally
      Active := False;
    end;
  end;
end;

procedure TfrmCK3I01.UP_Insert_Munjin(sDesc_kgbl : String);
begin
  with qryI_Munjin do
  begin
    ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
    ParamByName('NUM_ID').AsString      := UV_sNum_id;
    if ckYSNO_DRINKY.Checked  = True then
      ParamByName('YSNO_DRINK').AsString := 'Y'
    else if ckYSNO_DRINKN.Checked  = True then
      ParamByName('YSNO_DRINK').AsString := 'N'
    else
      ParamByName('YSNO_DRINK').AsString := '';

    if ckYSNO_SMOKEY.Checked  = True then
      ParamByName('YSNO_SMOKE').AsString := 'Y'
    else if ckYSNO_SMOKEN.Checked  = True then
      ParamByName('YSNO_SMOKE').AsString := 'N'
    else
      ParamByName('YSNO_SMOKE').AsString := '';

    if ckYSNO_YSHUY.Checked  = True then
      ParamByName('YSNO_YSHU').AsString := 'Y'
    else if ckYSNO_YSHUN.Checked  = True then
      ParamByName('YSNO_YSHU').AsString := 'N'
    else
      ParamByName('YSNO_YSHU').AsString := '';

    ParamByName('DESC_KGBL').AsString   := sDesc_kgbl;
    ParamByName('DAT_INSERT').AsString  := GV_sToday;
    ParamByName('COD_INSERT').AsString  := GV_sUserId;

    Execsql;
    GP_query_log(qryI_Munjin, 'CK3I01', 'I', 'Y');
  end;
end;

procedure TfrmCK3I01.UP_Insert_Kicho;
begin
  with qryI_Kicho do
  begin
    ParamByName('COD_JISA').AsString    := Copy(cmbCOD_JISA.Text, 1, 2);
    ParamByName('DAT_GMGN').AsString    := mskDAT_GMGN.Text;
    ParamByName('NUM_ID').AsString      := UV_sNum_id;
    ParamByName('SINJANG').AsFloat      := valSINJANG.Value;
    ParamByName('CHEJUNG').AsFloat      := valCHEJUNG.Value;
    ParamByName('BIMAN').AsFloat        := valBIMAN.Value;
    ParamByName('HUL_H').AsFloat        := valHUL_H.Value;
    ParamByName('HUL_L').AsFloat        := valHUL_L.Value;
    ParamByName('EAR_LEFT10').AsFloat    := valEAR_LEFT10.Value;
    ParamByName('EAR_RIGHT10').AsFloat   := valEAR_RIGHT10.Value;
    if vip.checked = true then
      ParamByName('ysno_label').AsString := 'Y'
    else
      ParamByName('ysno_label').AsString := 'N';

    if ckEYE1.Checked  = True then
    begin
      ParamByName('EYE_LMAN').AsFloat   := valEYE_LMAN.Value;
      ParamByName('EYE_RMAN').AsFloat   := valEYE_RMAN.Value;
      ParamByName('EYE_LKYO').AsFloat   := 0;
      ParamByName('EYE_RKYO').AsFloat   := 0;
    end
    else if ckEYE2.Checked = True then
    begin
      ParamByName('EYE_LKYO').AsFloat   := valEYE_LMAN.Value;
      ParamByName('EYE_RKYO').AsFloat   := valEYE_RMAN.Value;
      ParamByName('EYE_LMAN').AsFloat   := 0;
      ParamByName('EYE_RMAN').AsFloat   := 0;
    end;
    ParamByName('DAT_INSERT').AsString  := GV_sToday;
    ParamByName('COD_INSERT').AsString  := GV_sUserId;

    Execsql;
    GP_query_log(qryI_Kicho, 'CK3I01', 'I', 'Y');
  end;
end;

procedure TfrmCK3I01.grdCOD_CHUGAClickCell(Sender: TObject; DataColDown,
  DataRowDown, DataColUp, DataRowUp: Integer; DownPos,
  UpPos: TtsClickPosition);
 const
 BoolToStr : array [Boolean] of String = ('False','True');
begin
  inherited;
  //showmessage(BoolToStr[chuga_check]);

  if Chuga_Check = False then
  begin
    if copy(grdCOD_CHUGA.Cell[1,DataRowUp],1,1)='D' then
     begin
       btnHm_delete.enabled := true;
       exit;
     end
     else
     begin
       btnHm_delete.enabled := false;
       exit;
     end;
   end;
end;

procedure TfrmCK3I01.Panel100Exit(Sender: TObject);
var
F: TextFile;
S, sFileNM : String;
begin
  inherited;
  S:= ValTop.Text;
  sFileNM := 'C:\Program Files\ValTop';
  AssignFile(F,sFileNM);
  Rewrite(F);
  Writeln(F,S);
  CloseFile(F);

  Panel100.Visible := False;
end;

procedure TfrmCK3I01.btnPrintMouseUp(Sender: TObject; Button: TMouseButton;
  Shift: TShiftState; X, Y: Integer);
begin
  inherited;
  Manual_Print;
  Panel100.Visible := True;
  ValTop.Setfocus;
end;

procedure TfrmCK3I01.Manual_Print;
var
 F: TextFile;
 sFileNM, S: String;
begin
  inherited;
  sFileNM := 'C:\Program Files\ValTop';
  if not FileExists(sFileNM) then
  begin
     S:='8';
     AssignFile(F,sFileNM);
     Rewrite(F);
     Writeln(F,S);
     CloseFile(F);
  end;
  AssignFile(F, sFileNM);
  Reset(F);
  Readln(F, S);
  ValTop.Value := StrtoInt(S);
  CloseFile(F);
end;

procedure TfrmCK3I01.Panel100DblClick(Sender: TObject);
begin
  inherited;
  Panel100.Visible := False;
end;

procedure TfrmCK3I01.edtNUM_SAMPDblClick(Sender: TObject);
var
sSelect, sWhere : String;
begin
  inherited;
  If MessageDlg('혈액샘플No.를 생성하시겠습니까?', mtInformation, [mbYes, mbNo], 0) = mrYes Then
  begin
     sSelect := ''; sWhere := '';
     if (Trim(edtNUM_SAMP.Text) = '') and (CBox_samp.Checked = True) and (mskDAT_GMGN.Text = GV_sToday)then
     begin
        if (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '1') or (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '3') or (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '4') then
        begin
           //---------------------------------------------------------------
           {if (Copy(cmbCOD_JISA.Text, 1, 2) = '51') then
           begin
              //샘플번호 찾기[수원,광주-혈액구분으로 구분자 사용]...
              with qrySAMPLE do
              begin
                 sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin with (nolock) ';
                 sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                 sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                 sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                 case rdgGubn_Hulgum.ItemIndex of
                    2 : begin
                           if (copy(cmbGUBN_NOSIN.Text,1,1) = '1') or (copy(cmbGUBN_ADULT.Text,1,1) = '1') or (copy(cmbGUBN_LIFE.Text, 1,1) = '1') then
                           begin
                              sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                              sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + '''';
                           end
                           else
                           begin
                              //한의 광주종합검사2파트1700684
                              //sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                              //sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '4' + '''';
                              sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                              sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + '''';
                           end;
                        end;
                    else sWhere  := sWhere + ' and gubn_hulgum = ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + '''';
                 end;

                 Active := False;
                 SQL.Clear;
                 SQL.Add(sSelect + sWhere);
                 Active := True;

                 if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                    (Trim(FieldByName('SAMPLE').AsString) = '0') then
                 begin
                    case rdgGubn_Hulgum.ItemIndex of
                       0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 0 - 연구소
                       1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 1 - 센터
                       2 : begin
                              if (copy(cmbGUBN_NOSIN.Text,1,1) = '1') or
                                 (copy(cmbGUBN_ADULT.Text,1,1) = '1') or
                                 (copy(cmbGUBN_LIFE.Text, 1,1) = '1') then edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'  // 2 - 연구소 + 센터(노신포함)
                              //한의 광주종합검사2파트1700684
                              //else                                         edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 2 - 연구소 + 센터(노신미포함)
                              else                                         edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001';
                           end;
                    end;
                 end
                 else
                 begin
                    edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                 end;
                 Active := False;
              end;
           end }
           if (Copy(cmbCOD_JISA.Text, 1, 2) = '51') then
           begin
              //샘플번호 찾기[수원,광주-혈액구분으로 구분자 사용]...
              with qrySAMPLE do
              begin
                 sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin with(nolock) ';
                 sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                 sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                 sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                 {if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                    sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''51'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + ''''
                 else  if Trim(Copy(Com_BD.Text, 1, 2))= '21' then
                       sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''51'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 4) + '''';
                 }
                 if rdgGubn_Hulgum.itemindex = 1 then
                 begin
                     if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                     begin
                        sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''511'' '
                     end
                     else if Trim(Copy(Com_BD.Text, 1, 2))= '21' then
                     begin
                        sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''512'' ';
                     end;
                 end else if rdgGubn_Hulgum.itemindex = 2 then
                 begin
                     if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                     begin
                        sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''513'' '
                     end
                     else if Trim(Copy(Com_BD.Text, 1, 2))= '21' then
                     begin
                        sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''514'' ';
                     end;
                 end;

                 Active := False;
                 SQL.Clear;
                 SQL.Add(sSelect + sWhere);
                 Active := True;

                 if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                    (Trim(FieldByName('SAMPLE').AsString) = '0') then
                 begin
                    if Trim(Copy(Com_BD.Text, 1, 2)) = '20' then
                       case rdgGubn_Hulgum.ItemIndex of
                             //0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 0 - 연구소
                             1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 1 - 센터
                             2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 2 - 연구소 + 센터
                       end
                    else if Trim(Copy(Com_BD.Text, 1, 2)) = '21' then
                       case rdgGubn_Hulgum.ItemIndex of
                             //0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 0 - 연구소
                             1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 1 - 센터
                             2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 2 - 연구소 + 센터
                       end;
                 end
                 else
                    edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                 Active := False;
              end;
           end
           else if (Copy(cmbCOD_JISA.Text, 1, 2) = '43') then
           begin
              //샘플번호 찾기[수원,광주-혈액구분으로 구분자 사용]...
              with qrySAMPLE do
              begin
                 sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin with (nolock) ';
                 sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                 sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                 sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                 if Trim(Copy(Com_BD.Text, 1, 2)) = '17' then
                    sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''43'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 1) + ''''
                 else  if Trim(Copy(Com_BD.Text, 1, 2))= '18' then
                       sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''43'' + ''' + intTostr(rdgGubn_Hulgum.itemindex + 4) + '''';


                 Active := False;
                 SQL.Clear;
                 SQL.Add(sSelect + sWhere);
                 Active := True;

                 if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                    (Trim(FieldByName('SAMPLE').AsString) = '0') then
                 begin
                    if Trim(Copy(Com_BD.Text, 1, 2)) = '17' then
                       case rdgGubn_Hulgum.ItemIndex of
                             0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 0 - 연구소
                             1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 1 - 센터
                             2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 2 - 연구소 + 센터
                       end
                    else if Trim(Copy(Com_BD.Text, 1, 2)) = '18' then
                       case rdgGubn_Hulgum.ItemIndex of
                             0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; // 0 - 연구소
                             1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '5001'; // 1 - 센터
                             2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '6001'; // 2 - 연구소 + 센터
                       end;
                 end
                 else
                    edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                 Active := False;
              end;
           end
           else
           begin
              //샘플번호 찾기[기본형-층구분으로 구분자 사용]...
              with qrySAMPLE do
              begin
                 sSelect := ' select Max(CAST(num_samp AS INT)) AS SAMPLE from gumgin with (nolock) ';
                 sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
                 sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
                 sWhere  := sWhere + ' and gubn_neawon in ( ''1'',''3'',''4'')';
                 if (Trim(Copy(Com_BD.Text, 1, 2)) = '5') or (Trim(Copy(Com_BD.Text, 1, 2)) = '7') then
                   sWhere  := sWhere + ' and gubn_jinch in (''5'',''7'')'
                 else if (Trim(Copy(Com_BD.Text, 1, 2)) = '11') or (Trim(Copy(Com_BD.Text, 1, 2)) = '16') then
                   sWhere  := sWhere + ' and gubn_jinch in (''11'',''16'')'
                 else
                    sWhere  := sWhere + ' and gubn_jinch = ''' + Trim(Copy(Com_BD.Text, 1, 2)) + '''';

                 case Com_BD.ItemIndex of
                        0 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '0' + ''''; // 0 -구분없음
                        1 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; // 1 -(1)본원[종검-2F]
                        2 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 2 -(2)본원[일반-3F]
                        3 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + ''''; // 3 -(1)강남[종검-7F]
//                            4 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 4 -(2)강남[일반-6F]
                     5, 7 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; // 5 -(1)여의도[VIP-18F],7 -여의도[종검-18F]
                        6 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 6 -(2)여의도[종검-17F]
                        8 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + ''''; // 8 -(3)여의도[일반-15F]
                        9 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; // 9 -(2)강남[VIP-8F]
                       10 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '3' + ''''; //10 -(3)본원[신신-4F]
                   11, 16 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '4' + ''''; //11 -(4)여의도[일반-14F], 16-여의도[외래-14F]
                       12 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; //12 -(1)부산[종검-20F]
                       13 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '2' + ''''; //13 -(2)부산[일반-22F]
                       14 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '1' + ''''; //14 -(1)강남[일반-2F]
                       19 : sWhere  := sWhere + ' and SUBSTRING(num_samp,1,3) = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '4' + ''''; //19 -(4)강남[VIP-4F]
                 end;

                 Active := False;
                 SQL.Clear;
                 SQL.Add(sSelect + sWhere);
                 Active := True;

                 if (Trim(FieldByName('SAMPLE').AsString) = '')  or
                    (Trim(FieldByName('SAMPLE').AsString) = '0') then
                 begin
                    case Com_BD.ItemIndex of
                          0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '0001'; // 0 -구분없음
                          1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 1 -(1)본원[종검-2F]
                          2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 2 -(2)본원[일반-3F]
                          3 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 3 -(3)강남[종검-7F]
//                              4 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 4 -(2)강남[일반-6F]
                       5, 7 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 5 -(1)여의도[VIP-18F],7 -여의도[종검-18F]
                          6 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 6 -(2)여의도[종검-17F]
                          8 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 8 -(3)여의도[일반-15F]
                          9 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 9 -(2)강남[VIP-8F]
                         10 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; //10 -(3)본원[신신-4F]
                     11, 16 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; //11 -(4)여의도[일반-14F], 16-여의도[외래-14F]
                         12 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; //12 -(1)부산[종검-20F]
                         13 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; //13 -(2)부산[일반-22F]
                         14 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; //14 -(1)14-강남[일반-2F]
                         19 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; //14 -(4)19-강남[VIP-4F]
                         15 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '5001'; //15 -(5)강남[외래-3F]
                    end;
                 end
                 else
                    edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
                 Active := False;
              end;
              //---------------------------------------------------------------
           end;
        end
        else if (Copy(cmbGUBN_NEAWON.Text, 1, 1) = '2') then
        begin
{
           with qrySAMPLE do
           begin
              sSelect := ' select Max(num_samp) AS SAMPLE from gumgin ';
              sWhere  := ' where cod_jisa = ''' + Copy(cmbCOD_JISA.Text, 1, 2) + '''';
              sWhere  := sWhere + ' and dat_gmgn = ''' + mskDAT_GMGN.Text + '''';
              sWhere  := sWhere + ' and gubn_neawon = ''2''';
              if (Trim(Copy(Com_BD.Text, 1, 2)) = '5') or (Trim(Copy(Com_BD.Text, 1, 2)) = '7') then
                sWhere  := sWhere + ' and gubn_jinch in (''5'',''7'')'
              else
                sWhere  := sWhere + ' and gubn_jinch = ''' + Trim(Copy(Com_BD.Text, 1, 2)) + '''';

              Active := False;
              SQL.Clear;
              SQL.Add(sSelect + sWhere);
              Active := True;

              if Trim(FieldByName('SAMPLE').AsString) = '' then
              begin
                 case Com_BD.ItemIndex of
                       0 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '5001'; // 0 -구분없음
                       1 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 1 -(1)본원[종검-2F]
                       2 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 2 -(2)본원[일반-3F]
                       3 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 3 -(1)강남[종검-7F]
                       4 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 4 -(2)강남[일반-6F]
                    5, 7 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '1001'; // 5 -(1)여의도[VIP-18F],7 -여의도[종검-18F]
                       6 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '2001'; // 6 -(2)여의도[종검-17F]
                       8 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 8 -(3)여의도[일반-15F]
                       9 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; // 9 -(3)강남[VIP-8F]
                      10 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '3001'; //10 -(3)본원[신신-4F]
                      11 : edtNUM_SAMP.Text := Copy(cmbCOD_JISA.Text, 1, 2) + '4001'; //11 -(4)여의도[일반-14F]
                 end;
              end
              else
                 edtNUM_SAMP.Text := IntToStr(FieldByName('SAMPLE').AsInteger + 1);
           end;
}
        end;
     end;
  end;
end;

procedure TfrmCK3I01.Gong_Cancel_Jangbi(Gubn_grid : String; DataRow : Integer); 
var sHangMok_gong :String;
begin
  inherited;
  sHangMok_gong := 'JJ34JJB9JJ13JJ14JJ10JJ20Y004P003';

  if Gubn_grid = 'C' then
  begin
    if (pos(UV_vCod_chuga_d[DataRow - 1], sHangMok_gong) > 0 ) then
    begin
       if UV_vGubn_Cancel_Chuga[DataRow - 1] <> '' then
       begin
           if ((UV_vCod_chuga_d[DataRow - 1] = 'JJ34') or
               (UV_vCod_chuga_d[DataRow - 1] = 'JJB9') or
               (UV_vCod_chuga_d[DataRow - 1] = 'JJ13')) and
              (Ck_UA.checked = True) then //위
                  ShowMessage('특정암(위) 체크 확인바람...');

           if (UV_vCod_chuga_d[DataRow - 1] = 'Y004') and
              (Ck_DJA.checked = True) then //대장         
                  ShowMessage('특정암(대장) 체크 확인바람...');

           if (UV_vCod_chuga_d[DataRow - 1] = 'JJ14') and
              (Ck_UBA.checked = True) then //유방          
                  ShowMessage('특정암(유방) 체크 확인바람...');

           if (UV_vCod_chuga_d[DataRow - 1] = 'P003') and
              (Ck_JGA.checked = True) then //자궁
                  ShowMessage('특정암(자궁) 체크 확인바람...');
       end;
    end;
  end
  else if Gubn_grid = 'J' then
  begin   
    if (pos(UV_vCod_hm[DataRow - 1], sHangMok_gong) > 0 ) then
    begin
       if UV_vGubn_Cancel_select[DataRow - 1] <> '' then
       begin
           if ((UV_vCod_hm[DataRow - 1] = 'JJ34') or
               (UV_vCod_hm[DataRow - 1] = 'JJB9') or
               (UV_vCod_hm[DataRow - 1] = 'JJ13')) and
              (Ck_UA.checked = True) then //위
                  ShowMessage('특정암(위) 체크 확인바람...');

           if (UV_vCod_hm[DataRow - 1] = 'Y004') and
              (Ck_DJA.checked = True) then //대장
                  ShowMessage('특정암(대장) 체크 확인바람...');

           if (UV_vCod_hm[DataRow - 1] = 'JJ14') and
              (Ck_UBA.checked = True) then //유방          
                  ShowMessage('특정암(유방) 체크 확인바람...');

           if (UV_vCod_hm[DataRow - 1] = 'P003') and
              (Ck_JGA.checked = True) then //자궁
                  ShowMessage('특정암(자궁) 체크 확인바람...');
       end;
    end;
  end;
end;    

procedure TfrmCK3I01.cmb_emailKeyPress(Sender: TObject; var Key: Char);
begin
  inherited;
  if Key = #13 then
  begin   
      if (pos('@',Edt_email.Text)>0) then
      begin
          Edt_email.Text:=copy(Edt_email.Text,1,pos('@',Edt_email.Text)-1);
          if (copy(cmb_email.text,1,2) <> '00') then   Edt_email.Text:=Edt_email.Text+'@'+copy(cmb_email.Text,4,length(cmb_email.Text));
      end
      else if (copy(cmb_email.text,1,2) <> '00') then  Edt_email.Text:=Edt_email.Text+'@'+ copy(cmb_email.Text,4,length(cmb_email.Text));

  end;
end;

procedure TfrmCK3I01.Panel9Click(Sender: TObject);
begin
  inherited;
  if (Sender = Panel9) and (Trim(edtCOD_DC.Text) <> '') and (UV_iStatus <> GC_Insert) then
  begin
     if Panel9.bevelInner  = bvRaised  then
     begin
        Panel9.bevelInner  :=  bvLowered;
        Panel9.Color := clBtnFace;
        UP_PumyiDisplay;
        Panel9.bevelInner  :=  bvRaised;
        Panel9.Color := clActiveCaption;
     end;
  end;
end;


procedure TfrmCK3I01.btn_pregmgnClick(Sender: TObject);
var
sSelect, sWhere, sOrder : string;
v_Today, v_Datgmgn : TDateTime;
begin
  inherited;                  
  if (mskNUM_JUMIN.Text = '') or (edtDESC_NAME.Text = '') then
  begin
     showmessage('해당 기능을 사용할 수 없습니다.' + #13#10 + #13#10 + '주민번호와 성명이 입력 및 조회된 후 사용가능합니다.');
     exit;
  end else
  begin
      with qryPregmgn do
      begin
         Active := False;
         sSelect := ' select top 1 G.dat_gmgn, G.Cod_jisa, G.num_tel, G.num_post, G.desc_addr, G.cod_dc, G.cod_saler, G.gubn_neawon, I.Desc_EMail from gumgin G with(nolock) ' +
                    ' left outer join injouk I on G.num_jumin = I.num_jumin and G.num_id = I.num_id ';
         sWhere  := ' WHERE G.num_jumin = ''' + mskNUM_JUMIN.Text + ''' and dat_gmgn < '''+ GV_sToday +''' ';
         sOrder  := ' ORDER BY dat_gmgn DESC ';
         SQL.Clear;
         SQL.Add(sSelect + sWhere + sOrder);
         Active := True;

         if IsEmpty = False then
         begin
             v_Today   := StrToDate(copy(GV_sToday,1,4)+'-'+copy(GV_sToday,5,2)+'-'+copy(GV_sToday,7,2));
             v_Datgmgn := StrToDate(copy(FieldByName('dat_gmgn').AsString,1,4)+'-'+copy(FieldByName('dat_gmgn').AsString,5,2)+'-'+copy(FieldByName('dat_gmgn').AsString,7,2));

             if ((v_Today - v_Datgmgn) <= 180) and ((v_Today - v_Datgmgn) > 0)then
             begin
                edtNUM_TEL.Text     := FieldByName('num_tel').AsString;
                mskNUM_POST.Text    := FieldByName('num_post').AsString;
                edtDESC_ADDR.Text   := FieldByName('desc_addr').AsString;
                GP_ComboDisplay(cmbGUBN_NEAWON, FieldByName('gubn_neawon').AsString, 1);

                showmessage('종전 데이터 불러오기 완료!! ' + #13#10 + '실제 정보와 다를 수 있으니 꼭 확인 후 접수하시기 바랍니다.');
             end else
             begin
                showmessage('180일 이전 접수 데이터가 없습니다.');
             end;
         end else
         begin
             showmessage('접수 데이터가 존재하지 않습니다.');
         end;

         Active := False;
      end;
  end;
end;

procedure TfrmCK3I01.btn_ptClick(Sender: TObject);
begin
  inherited;
  if copy(cmbGmgn.text, 1, 4) >= '2018' then
  begin   
     with qry_priv do
     begin
        Close;
        ParamByName('cod_sawon').AsString := GV_sUserId;
        ParamByName('cod_prog').AsString := 'CK6PB1';
        Open;
        if IsEmpty = True then
        begin
           showmessage('[CK6PB1]2018년도 결과지 출력 권한이 없습니다.');
           exit;
        end;
     end;
     
     if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '00')
        or (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '') then
     begin
        showmessage('A,B,C,D 형 결과지만 가능합니다.');
        exit;
     end;

     frmCK6PB1 := TfrmCK6PB1.Create(nil);
     frmCK6PB1.msksDate.Text := mskDAT_GMGN.Text;
     frmCK6PB1.mskeDate.Text := mskDAT_GMGN.Text;
     frmCK6PB1.edtDc.text := edtCOD_DC.Text;
     frmCK6PB1.edtsName.Text := edtDESC_NAME.Text;
     frmCK6PB1.edteName.Text := edtDESC_NAME.Text;
     if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '01') or (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '02') then frmCK6PB1.Cmb_Print.ItemIndex := 1
     else if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '03')  then frmCK6PB1.Cmb_Print.ItemIndex := 2
     else if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '04')  then frmCK6PB1.Cmb_Print.ItemIndex := 3;
     GP_ComboDisplay(frmCK6PB1.cmbJisa, Copy(frmCK3I01.cmbCOD_JISA.Text,1,2), 2);
     frmCK6PB1.ShowModal;
  end
  else
  begin
     with qry_priv do
     begin
        Close;
        ParamByName('cod_sawon').AsString := GV_sUserId;
        ParamByName('cod_prog').AsString := 'CK6PA1';
        Open;
        if IsEmpty = True then
        begin
           showmessage('[CK6PA1]2016년도 결과지 출력 권한이 없습니다.');
           exit;
        end;
     end;
     
     if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '00')
        or (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '') then
     begin
        showmessage('A,B,C,D 형 결과지만 가능합니다.');
        exit;
     end;

     frmCK6PA1 := TfrmCK6PA1.Create(nil);
     frmCK6PA1.msksDate.Text := mskDAT_GMGN.Text;
     frmCK6PA1.mskeDate.Text := mskDAT_GMGN.Text;
     frmCK6PA1.edtDc.text := edtCOD_DC.Text;
     frmCK6PA1.edtsName.Text := edtDESC_NAME.Text;
     frmCK6PA1.edteName.Text := edtDESC_NAME.Text;
     if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '01') or (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '02') then frmCK6PA1.Cmb_Print.ItemIndex := 1
     else if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '03')  then frmCK6PA1.Cmb_Print.ItemIndex := 2
     else if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '04')  then frmCK6PA1.Cmb_Print.ItemIndex := 3;
     GP_ComboDisplay(frmCK6PA1.cmbJisa, Copy(frmCK3I01.cmbCOD_JISA.Text,1,2), 2);
     frmCK6PA1.ShowModal;
  end;
end;

procedure TfrmCK3I01.PDF1Click(Sender: TObject);
begin
  inherited;
  with qry_priv do
  begin
     Close;
     ParamByName('cod_sawon').AsString := GV_sUserId;
     ParamByName('cod_prog').AsString := 'CK6PA4';
     Open;
     if IsEmpty = True then
     begin
        showmessage('[CK6PA4]2016년도PDF 결과지 출력 권한이 없습니다.');
        exit;
     end;
  end;

  if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '00')
     or (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '') then
  begin
     showmessage('A,B,C,D 형 결과지만 가능합니다.');
     exit;
  end;

  frmCK6PA4 := TfrmCK6PA4.Create(nil);
  frmCK6PA4.msksDate.Text := mskDAT_GMGN.Text;
  frmCK6PA4.mskeDate.Text := mskDAT_GMGN.Text;
  frmCK6PA4.edtDc.text := edtCOD_DC.Text;
  frmCK6PA4.edtsName.Text := edtDESC_NAME.Text;
  frmCK6PA4.edteName.Text := edtDESC_NAME.Text;
  if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '01') or (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '02') then frmCK6PA4.Cmb_Print.ItemIndex := 1
  else if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '03')  then frmCK6PA4.Cmb_Print.ItemIndex := 2
  else if (Copy(frmCK3I01.Cmb_Print.Text,1,2) = '04')  then frmCK6PA4.Cmb_Print.ItemIndex := 3;
  GP_ComboDisplay(frmCK6PA4.cmbJisa, Copy(frmCK3I01.cmbCOD_JISA.Text,1,2), 2);
  frmCK6PA4.ShowModal;
end;


procedure TfrmCK3I01.N1Click(Sender: TObject);
begin
  inherited;
  with qry_priv do
  begin
     Close;
     ParamByName('cod_sawon').AsString := GV_sUserId;
     ParamByName('cod_prog').AsString := 'CKEI02';
     Open;
     if IsEmpty = True then
     begin
        showmessage('[CKEI02][2017]메일전송 결과업로드 권한이  없습니다.');
        exit;
     end;
  end;
  Application.CreateForm(TfrmCKEI02, frmCKEI02);
  frmCKEI02.msksDate.Text := mskDAT_GMGN.Text;
  frmCKEI02.mskeDate.Text := mskDAT_GMGN.Text;
  frmCKEI02.edtDc.text := edtCOD_DC.Text;
  frmCKEI02.edt_jumin.Text := frmCK3I01.mskNUM_JUMIN.Text;
  frmCKEI02.edtDESC_NAME.Text := edtDESC_NAME.Text;
  GP_ComboDisplay(frmCKEI02.cmbJisa, Copy(frmCK3I01.cmbCOD_JISA.Text,1,2), 2);
  frmCKEI02.CBox_Tot_sokun.checked := True;
  frmCKEI02.CBox_Jangbi.checked := True;
  frmCKEI02.CBox_SMS.checked := True;
  frmCKEI02.Cmb_Time.itemindex := 1;
  frmCKEI02.Show;
end;

end.



